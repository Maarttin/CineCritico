import './polyfills.server.mjs';
import{a as Yf,b as br,c as Jf,d as Xf,g as Zf,h as ep,i as tp,j as np,k as rp,l as ip,m as sp,n as op,o as ap,p as lp}from"./chunk-S6YSGKKB.mjs";import{a as up}from"./chunk-FVTTCWXS.mjs";import{a as cp}from"./chunk-3MMBQDRY.mjs";import{$ as _l,H as kf,I as Jt,K as Er,Ka as Ff,La as Bf,M as Pf,Q as El,Ua as qf,Y as pn,Z as vt,Za as Uf,_ as St,aa as Mf,ab as Vf,ba as Ms,ca as Hn,db as zf,eb as Gf,fa as Xt,fb as jf,ga as Ls,gb as _r,h as Af,hb as $f,ib as At,jb as Kf,k as Nf,ka as Lf,kb as Wf,l as vl,lb as Hf,mb as Qf,nb as Fs,o as Of,ob as bl,p as Sl,q as Tl,r as xf}from"./chunk-THEB3H2P.mjs";import{c as re,e as I,f as Df}from"./chunk-N7QBYMCK.mjs";var ne=I(lt=>{"use strict";Object.defineProperty(lt,"__esModule",{value:!0});lt.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=lt.DEFAULT_MAX_SEND_MESSAGE_LENGTH=lt.Propagate=lt.LogVerbosity=lt.Status=void 0;var pp=(function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n})(pp||(lt.Status=pp={})),mp=(function(n){return n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.ERROR=2]="ERROR",n[n.NONE=3]="NONE",n})(mp||(lt.LogVerbosity=mp={})),gp=(function(n){return n[n.DEADLINE=1]="DEADLINE",n[n.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",n[n.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",n[n.CANCELLATION=8]="CANCELLATION",n[n.DEFAULTS=65535]="DEFAULTS",n})(gp||(lt.Propagate=gp={}));lt.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1;lt.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4*1024*1024});var wl=I((xx,GT)=>{GT.exports={name:"@grpc/grpc-js",version:"1.9.15",description:"gRPC Library for Node - pure JS implementation",homepage:"https://grpc.io/",repository:"https://github.com/grpc/grpc-node/tree/master/packages/grpc-js",main:"build/src/index.js",engines:{node:"^8.13.0 || >=10.10.0"},keywords:[],author:{name:"Google Inc."},types:"build/src/index.d.ts",license:"Apache-2.0",devDependencies:{"@types/gulp":"^4.0.6","@types/gulp-mocha":"0.0.32","@types/lodash":"^4.14.186","@types/mocha":"^5.2.6","@types/ncp":"^2.0.1","@types/pify":"^3.0.2","@types/semver":"^7.3.9","@typescript-eslint/eslint-plugin":"^5.59.11","@typescript-eslint/parser":"^5.59.11","@typescript-eslint/typescript-estree":"^5.59.11","clang-format":"^1.0.55",eslint:"^8.42.0","eslint-config-prettier":"^8.8.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^4.2.1",execa:"^2.0.3",gulp:"^4.0.2","gulp-mocha":"^6.0.0",lodash:"^4.17.4",madge:"^5.0.1","mocha-jenkins-reporter":"^0.4.1",ncp:"^2.0.0",pify:"^4.0.1",prettier:"^2.8.8",rimraf:"^3.0.2",semver:"^7.3.5","ts-node":"^10.9.1",typescript:"^5.1.3"},contributors:[{name:"Google Inc."}],scripts:{build:"npm run compile",clean:"rimraf ./build",compile:"tsc -p .",format:'clang-format -i -style="{Language: JavaScript, BasedOnStyle: Google, ColumnLimit: 80}" src/*.ts test/*.ts',lint:"eslint src/*.ts test/*.ts",prepare:"npm run generate-types && npm run compile",test:"gulp test",check:"npm run lint",fix:"eslint --fix src/*.ts test/*.ts",pretest:"npm run generate-types && npm run generate-test-types && npm run compile",posttest:"npm run check && madge -c ./build/src","generate-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --includeDirs proto/ --include-dirs test/fixtures/ -O src/generated/ --grpcLib ../index channelz.proto","generate-test-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --include-dirs test/fixtures/ -O test/generated/ --grpcLib ../../src/index test_service.proto"},dependencies:{"@grpc/proto-loader":"^0.7.8","@types/node":">=12.12.47"},files:["src/**/*.ts","build/src/**/*.{js,d.ts,js.map}","proto/*.proto","LICENSE","deps/envoy-api/envoy/api/v2/**/*.proto","deps/envoy-api/envoy/config/**/*.proto","deps/envoy-api/envoy/service/**/*.proto","deps/envoy-api/envoy/type/**/*.proto","deps/udpa/udpa/**/*.proto","deps/googleapis/google/api/*.proto","deps/googleapis/google/rpc/*.proto","deps/protoc-gen-validate/validate/**/*.proto"]}});var fe=I(He=>{"use strict";var Cl,Il,Rl,Dl;Object.defineProperty(He,"__esModule",{value:!0});He.isTracerEnabled=He.trace=He.log=He.setLoggerVerbosity=He.setLogger=He.getLogger=void 0;var mn=ne(),jT=re("process"),$T=wl().version,KT={error:(n,...e)=>{console.error("E "+n,...e)},info:(n,...e)=>{console.error("I "+n,...e)},debug:(n,...e)=>{console.error("D "+n,...e)}},Qn=KT,wr=mn.LogVerbosity.ERROR,WT=(Il=(Cl=process.env.GRPC_NODE_VERBOSITY)!==null&&Cl!==void 0?Cl:process.env.GRPC_VERBOSITY)!==null&&Il!==void 0?Il:"";switch(WT.toUpperCase()){case"DEBUG":wr=mn.LogVerbosity.DEBUG;break;case"INFO":wr=mn.LogVerbosity.INFO;break;case"ERROR":wr=mn.LogVerbosity.ERROR;break;case"NONE":wr=mn.LogVerbosity.NONE;break;default:}var HT=()=>Qn;He.getLogger=HT;var QT=n=>{Qn=n};He.setLogger=QT;var YT=n=>{wr=n};He.setLoggerVerbosity=YT;var JT=(n,...e)=>{let t;if(n>=wr){switch(n){case mn.LogVerbosity.DEBUG:t=Qn.debug;break;case mn.LogVerbosity.INFO:t=Qn.info;break;case mn.LogVerbosity.ERROR:t=Qn.error;break}t||(t=Qn.error),t&&t.bind(Qn)(...e)}};He.log=JT;var XT=(Dl=(Rl=process.env.GRPC_NODE_TRACE)!==null&&Rl!==void 0?Rl:process.env.GRPC_TRACE)!==null&&Dl!==void 0?Dl:"",Al=new Set,yp=new Set;for(let n of XT.split(","))n.startsWith("-")?yp.add(n.substring(1)):Al.add(n);var ZT=Al.has("all");function eE(n,e,t){vp(e)&&(0,He.log)(n,new Date().toISOString()+" | v"+$T+" "+jT.pid+" | "+e+" | "+t)}He.trace=eE;function vp(n){return!yp.has(n)&&(ZT||Al.has(n))}He.isTracerEnabled=vp});var qs=I(Cr=>{"use strict";Object.defineProperty(Cr,"__esModule",{value:!0});Cr.getErrorCode=Cr.getErrorMessage=void 0;function tE(n){return n instanceof Error?n.message:String(n)}Cr.getErrorMessage=tE;function nE(n){return typeof n=="object"&&n!==null&&"code"in n&&typeof n.code=="number"?n.code:null}Cr.getErrorCode=nE});var Ye=I(Vs=>{"use strict";Object.defineProperty(Vs,"__esModule",{value:!0});Vs.Metadata=void 0;var rE=fe(),iE=ne(),sE=qs(),oE=/^[0-9a-z_.-]+$/,aE=/^[ -~]*$/;function lE(n){return oE.test(n)}function cE(n){return aE.test(n)}function Tp(n){return n.endsWith("-bin")}function uE(n){return!n.startsWith("grpc-")}function Us(n){return n.toLowerCase()}function Sp(n,e){if(!lE(n))throw new Error('Metadata key "'+n+'" contains illegal characters');if(e!=null)if(Tp(n)){if(!Buffer.isBuffer(e))throw new Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(e))throw new Error("keys that don't end with '-bin' must have String values");if(!cE(e))throw new Error('Metadata string value "'+e+'" contains illegal characters')}}var Nl=class n{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){e=Us(e),Sp(e,t),this.internalRepr.set(e,[t])}add(e,t){e=Us(e),Sp(e,t);let r=this.internalRepr.get(e);r===void 0?this.internalRepr.set(e,[t]):r.push(t)}remove(e){e=Us(e),this.internalRepr.delete(e)}get(e){return e=Us(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,r]of this.internalRepr)if(r.length>0){let i=r[0];e[t]=Buffer.isBuffer(i)?Buffer.from(i):i}return e}clone(){let e=new n(this.options),t=e.internalRepr;for(let[r,i]of this.internalRepr){let s=i.map(o=>Buffer.isBuffer(o)?Buffer.from(o):o);t.set(r,s)}return e}merge(e){for(let[t,r]of e.internalRepr){let i=(this.internalRepr.get(t)||[]).concat(r);this.internalRepr.set(t,i)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,r]of this.internalRepr)e[t]=r.map(dE);return e}toJSON(){let e={};for(let[t,r]of this.internalRepr)e[t]=r;return e}static fromHttp2Headers(e){let t=new n;for(let r of Object.keys(e)){if(r.charAt(0)===":")continue;let i=e[r];try{Tp(r)?Array.isArray(i)?i.forEach(s=>{t.add(r,Buffer.from(s,"base64"))}):i!==void 0&&(uE(r)?i.split(",").forEach(s=>{t.add(r,Buffer.from(s.trim(),"base64"))}):t.add(r,Buffer.from(i,"base64"))):Array.isArray(i)?i.forEach(s=>{t.add(r,s)}):i!==void 0&&t.add(r,i)}catch(s){let o=`Failed to add metadata entry ${r}: ${i}. ${(0,sE.getErrorMessage)(s)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,rE.log)(iE.LogVerbosity.ERROR,o)}}return t}};Vs.Metadata=Nl;var dE=n=>Buffer.isBuffer(n)?n.toString("base64"):n});var Ml=I(zs=>{"use strict";Object.defineProperty(zs,"__esModule",{value:!0});zs.CallCredentials=void 0;var Pl=Ye();function hE(n){return"getRequestHeaders"in n&&typeof n.getRequestHeaders=="function"}var Ir=class n{static createFromMetadataGenerator(e){return new xl(e)}static createFromGoogleCredential(e){return n.createFromMetadataGenerator((t,r)=>{let i;hE(e)?i=e.getRequestHeaders(t.service_url):i=new Promise((s,o)=>{e.getRequestMetadata(t.service_url,(a,l)=>{if(a){o(a);return}if(!l){o(new Error("Headers not set by metadata plugin"));return}s(l)})}),i.then(s=>{let o=new Pl.Metadata;for(let a of Object.keys(s))o.add(a,s[a]);r(null,o)},s=>{r(s)})})}static createEmpty(){return new kl}};zs.CallCredentials=Ir;var Ol=class n extends Ir{constructor(e){super(),this.creds=e}async generateMetadata(e){let t=new Pl.Metadata,r=await Promise.all(this.creds.map(i=>i.generateMetadata(e)));for(let i of r)t.merge(i);return t}compose(e){return new n(this.creds.concat([e]))}_equals(e){return this===e?!0:e instanceof n?this.creds.every((t,r)=>t._equals(e.creds[r])):!1}},xl=class n extends Ir{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,r)=>{this.metadataGenerator(e,(i,s)=>{s!==void 0?t(s):r(i)})})}compose(e){return new Ol([this,e])}_equals(e){return this===e?!0:e instanceof n?this.metadataGenerator===e.metadataGenerator:!1}},kl=class n extends Ir{generateMetadata(e){return Promise.resolve(new Pl.Metadata)}compose(e){return e}_equals(e){return e instanceof n}}});var Fl=I(Rr=>{"use strict";Object.defineProperty(Rr,"__esModule",{value:!0});Rr.getDefaultRootsData=Rr.CIPHER_SUITES=void 0;var fE=re("fs");Rr.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;var Ep=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,Ll=null;function pE(){return Ep?(Ll===null&&(Ll=fE.readFileSync(Ep)),Ll):null}Rr.getDefaultRootsData=pE});var $s=I(js=>{"use strict";Object.defineProperty(js,"__esModule",{value:!0});js.ChannelCredentials=void 0;var mE=re("tls"),gE=Ml(),_p=Fl();function Bl(n,e){if(n&&!(n instanceof Buffer))throw new TypeError(`${e}, if provided, must be a Buffer.`)}var Dr=class{constructor(e){this.callCredentials=e||gE.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,r,i){var s;if(Bl(e,"Root certificate"),Bl(t,"Private key"),Bl(r,"Certificate chain"),t&&!r)throw new Error("Private key must be given with accompanying certificate chain");if(!t&&r)throw new Error("Certificate chain must be given with accompanying private key");let o=(0,mE.createSecureContext)({ca:(s=e??(0,_p.getDefaultRootsData)())!==null&&s!==void 0?s:void 0,key:t??void 0,cert:r??void 0,ciphers:_p.CIPHER_SUITES});return new Gs(o,i??{})}static createFromSecureContext(e,t){return new Gs(e,t??{})}static createInsecure(){return new ql}};js.ChannelCredentials=Dr;var ql=class n extends Dr{constructor(e){super(e)}compose(e){throw new Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof n}},Gs=class n extends Dr{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},t?.checkServerIdentity&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){let t=this.callCredentials.compose(e);return new Ul(this,t)}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity:!1}},Ul=class n extends Dr{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new n(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials):!1}}});var yn=I(Fe=>{"use strict";Object.defineProperty(Fe,"__esModule",{value:!0});Fe.validateLoadBalancingConfig=Fe.getFirstUsableConfig=Fe.isLoadBalancerNameRegistered=Fe.createLoadBalancer=Fe.registerDefaultLoadBalancerType=Fe.registerLoadBalancerType=Fe.createChildChannelControlHelper=void 0;function yE(n,e){var t,r,i,s,o,a,l,c,u,m;return{createSubchannel:(r=(t=e.createSubchannel)===null||t===void 0?void 0:t.bind(e))!==null&&r!==void 0?r:n.createSubchannel.bind(n),updateState:(s=(i=e.updateState)===null||i===void 0?void 0:i.bind(e))!==null&&s!==void 0?s:n.updateState.bind(n),requestReresolution:(a=(o=e.requestReresolution)===null||o===void 0?void 0:o.bind(e))!==null&&a!==void 0?a:n.requestReresolution.bind(n),addChannelzChild:(c=(l=e.addChannelzChild)===null||l===void 0?void 0:l.bind(e))!==null&&c!==void 0?c:n.addChannelzChild.bind(n),removeChannelzChild:(m=(u=e.removeChannelzChild)===null||u===void 0?void 0:u.bind(e))!==null&&m!==void 0?m:n.removeChannelzChild.bind(n)}}Fe.createChildChannelControlHelper=yE;var gn={},Vl=null;function vE(n,e,t){gn[n]={LoadBalancer:e,LoadBalancingConfig:t}}Fe.registerLoadBalancerType=vE;function SE(n){Vl=n}Fe.registerDefaultLoadBalancerType=SE;function TE(n,e){let t=n.getLoadBalancerName();return t in gn?new gn[t].LoadBalancer(e):null}Fe.createLoadBalancer=TE;function EE(n){return n in gn}Fe.isLoadBalancerNameRegistered=EE;function _E(n,e=!1){for(let t of n)if(t.getLoadBalancerName()in gn)return t;return e&&Vl?new gn[Vl].LoadBalancingConfig:null}Fe.getFirstUsableConfig=_E;function bE(n){if(!(n!==null&&typeof n=="object"))throw new Error("Load balancing config must be an object");let e=Object.keys(n);if(e.length!==1)throw new Error("Provided load balancing config has multiple conflicting entries");let t=e[0];if(t in gn)return gn[t].LoadBalancingConfig.createFromJson(n[t]);throw new Error(`Unrecognized load balancing config name ${t}`)}Fe.validateLoadBalancingConfig=bE});var zl=I(vn=>{"use strict";Object.defineProperty(vn,"__esModule",{value:!0});vn.extractAndSelectServiceConfig=vn.validateServiceConfig=vn.validateRetryThrottling=void 0;var wE=re("os"),Ks=ne(),CE=yn(),Ws=/^\d+(\.\d{1,9})?s$/,IE="node";function RE(n){if("service"in n&&n.service!==""){if(typeof n.service!="string")throw new Error(`Invalid method config name: invalid service: expected type string, got ${typeof n.service}`);if("method"in n&&n.method!==""){if(typeof n.method!="string")throw new Error(`Invalid method config name: invalid method: expected type string, got ${typeof n.service}`);return{service:n.service,method:n.method}}else return{service:n.service}}else{if("method"in n&&n.method!==void 0)throw new Error("Invalid method config name: method set with empty or unset service");return{}}}function DE(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in n)||typeof n.initialBackoff!="string"||!Ws.test(n.initialBackoff))throw new Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in n)||typeof n.maxBackoff!="string"||!Ws.test(n.maxBackoff))throw new Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in n)||typeof n.backoffMultiplier!="number"||n.backoffMultiplier<=0)throw new Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in n&&Array.isArray(n.retryableStatusCodes)))throw new Error("Invalid method config retry policy: retryableStatusCodes is required");if(n.retryableStatusCodes.length===0)throw new Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let e of n.retryableStatusCodes)if(typeof e=="number"){if(!Object.values(Ks.Status).includes(e))throw new Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if(typeof e=="string"){if(!Object.values(Ks.Status).includes(e.toUpperCase()))throw new Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw new Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:n.maxAttempts,initialBackoff:n.initialBackoff,maxBackoff:n.maxBackoff,backoffMultiplier:n.backoffMultiplier,retryableStatusCodes:n.retryableStatusCodes}}function AE(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in n&&(typeof n.hedgingDelay!="string"||!Ws.test(n.hedgingDelay)))throw new Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in n&&Array.isArray(n.nonFatalStatusCodes))for(let t of n.nonFatalStatusCodes)if(typeof t=="number"){if(!Object.values(Ks.Status).includes(t))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if(typeof t=="string"){if(!Object.values(Ks.Status).includes(t.toUpperCase()))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let e={maxAttempts:n.maxAttempts};return n.hedgingDelay&&(e.hedgingDelay=n.hedgingDelay),n.nonFatalStatusCodes&&(e.nonFatalStatusCodes=n.nonFatalStatusCodes),e}function NE(n){var e;let t={name:[]};if(!("name"in n)||!Array.isArray(n.name))throw new Error("Invalid method config: invalid name array");for(let r of n.name)t.name.push(RE(r));if("waitForReady"in n){if(typeof n.waitForReady!="boolean")throw new Error("Invalid method config: invalid waitForReady");t.waitForReady=n.waitForReady}if("timeout"in n)if(typeof n.timeout=="object"){if(!("seconds"in n.timeout)||typeof n.timeout.seconds!="number")throw new Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in n.timeout)||typeof n.timeout.nanos!="number")throw new Error("Invalid method config: invalid timeout.nanos");t.timeout=n.timeout}else if(typeof n.timeout=="string"&&Ws.test(n.timeout)){let r=n.timeout.substring(0,n.timeout.length-1).split(".");t.timeout={seconds:r[0]|0,nanos:((e=r[1])!==null&&e!==void 0?e:0)|0}}else throw new Error("Invalid method config: invalid timeout");if("maxRequestBytes"in n){if(typeof n.maxRequestBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxRequestBytes=n.maxRequestBytes}if("maxResponseBytes"in n){if(typeof n.maxResponseBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxResponseBytes=n.maxResponseBytes}if("retryPolicy"in n){if("hedgingPolicy"in n)throw new Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");t.retryPolicy=DE(n.retryPolicy)}else"hedgingPolicy"in n&&(t.hedgingPolicy=AE(n.hedgingPolicy));return t}function bp(n){if(!("maxTokens"in n)||typeof n.maxTokens!="number"||n.maxTokens<=0||n.maxTokens>1e3)throw new Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in n)||typeof n.tokenRatio!="number"||n.tokenRatio<=0)throw new Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+n.maxTokens.toFixed(3),tokenRatio:+n.tokenRatio.toFixed(3)}}vn.validateRetryThrottling=bp;function wp(n){let e={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in n)if(typeof n.loadBalancingPolicy=="string")e.loadBalancingPolicy=n.loadBalancingPolicy;else throw new Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in n)if(Array.isArray(n.loadBalancingConfig))for(let r of n.loadBalancingConfig)e.loadBalancingConfig.push((0,CE.validateLoadBalancingConfig)(r));else throw new Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in n&&Array.isArray(n.methodConfig))for(let r of n.methodConfig)e.methodConfig.push(NE(r));"retryThrottling"in n&&(e.retryThrottling=bp(n.retryThrottling));let t=[];for(let r of e.methodConfig)for(let i of r.name){for(let s of t)if(i.service===s.service&&i.method===s.method)throw new Error(`Invalid service config: duplicate name ${i.service}/${i.method}`);t.push(i)}return e}vn.validateServiceConfig=wp;function OE(n){if(!("serviceConfig"in n))throw new Error("Invalid service config choice: missing service config");let e={serviceConfig:wp(n.serviceConfig)};if("clientLanguage"in n)if(Array.isArray(n.clientLanguage)){e.clientLanguage=[];for(let r of n.clientLanguage)if(typeof r=="string")e.clientLanguage.push(r);else throw new Error("Invalid service config choice: invalid clientLanguage")}else throw new Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in n)if(Array.isArray(n.clientHostname)){e.clientHostname=[];for(let r of n.clientHostname)if(typeof r=="string")e.clientHostname.push(r);else throw new Error("Invalid service config choice: invalid clientHostname")}else throw new Error("Invalid service config choice: invalid clientHostname");if("percentage"in n)if(typeof n.percentage=="number"&&0<=n.percentage&&n.percentage<=100)e.percentage=n.percentage;else throw new Error("Invalid service config choice: invalid percentage");let t=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let r in n)if(!t.includes(r))throw new Error(`Invalid service config choice: unexpected field ${r}`);return e}function xE(n,e){if(!Array.isArray(n))throw new Error("Invalid service config list");for(let t of n){let r=OE(t);if(!(typeof r.percentage=="number"&&e>r.percentage)){if(Array.isArray(r.clientHostname)){let i=!1;for(let s of r.clientHostname)s===wE.hostname()&&(i=!0);if(!i)continue}if(Array.isArray(r.clientLanguage)){let i=!1;for(let s of r.clientLanguage)s===IE&&(i=!0);if(!i)continue}return r.serviceConfig}}throw new Error("No matching service config found")}function kE(n,e){for(let t of n)if(t.length>0&&t[0].startsWith("grpc_config=")){let r=t.join("").substring(12),i=JSON.parse(r);return xE(i,e)}return null}vn.extractAndSelectServiceConfig=kE});var ct=I(Hs=>{"use strict";Object.defineProperty(Hs,"__esModule",{value:!0});Hs.ConnectivityState=void 0;var Cp=(function(n){return n[n.IDLE=0]="IDLE",n[n.CONNECTING=1]="CONNECTING",n[n.READY=2]="READY",n[n.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",n[n.SHUTDOWN=4]="SHUTDOWN",n})(Cp||(Hs.ConnectivityState=Cp={}))});var et=I(Sn=>{"use strict";Object.defineProperty(Sn,"__esModule",{value:!0});Sn.uriToString=Sn.splitHostPort=Sn.parseUri=void 0;var PE=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function ME(n){let e=PE.exec(n);return e===null?null:{scheme:e[1],authority:e[2],path:e[3]}}Sn.parseUri=ME;var Ip=/^\d+$/;function LE(n){if(n.startsWith("[")){let e=n.indexOf("]");if(e===-1)return null;let t=n.substring(1,e);if(t.indexOf(":")===-1)return null;if(n.length>e+1)if(n[e+1]===":"){let r=n.substring(e+2);return Ip.test(r)?{host:t,port:+r}:null}else return null;else return{host:t}}else{let e=n.split(":");return e.length===2?Ip.test(e[1])?{host:e[0],port:+e[1]}:null:{host:n}}}Sn.splitHostPort=LE;function FE(n){let e="";return n.scheme!==void 0&&(e+=n.scheme+":"),n.authority!==void 0&&(e+="//"+n.authority+"/"),e+=n.path,e}Sn.uriToString=FE});var Nt=I(ut=>{"use strict";Object.defineProperty(ut,"__esModule",{value:!0});ut.mapUriDefaultScheme=ut.getDefaultAuthority=ut.createResolver=ut.registerDefaultScheme=ut.registerResolver=void 0;var jl=et(),Ar={},Gl=null;function BE(n,e){Ar[n]=e}ut.registerResolver=BE;function qE(n){Gl=n}ut.registerDefaultScheme=qE;function UE(n,e,t){if(n.scheme!==void 0&&n.scheme in Ar)return new Ar[n.scheme](n,e,t);throw new Error(`No resolver could be created for target ${(0,jl.uriToString)(n)}`)}ut.createResolver=UE;function VE(n){if(n.scheme!==void 0&&n.scheme in Ar)return Ar[n.scheme].getDefaultAuthority(n);throw new Error(`Invalid target ${(0,jl.uriToString)(n)}`)}ut.getDefaultAuthority=VE;function zE(n){return n.scheme===void 0||!(n.scheme in Ar)?Gl!==null?{scheme:Gl,authority:void 0,path:(0,jl.uriToString)(n)}:null:n}ut.mapUriDefaultScheme=zE});var En=I(Tn=>{"use strict";Object.defineProperty(Tn,"__esModule",{value:!0});Tn.QueuePicker=Tn.UnavailablePicker=Tn.PickResultType=void 0;var GE=Ye(),jE=ne(),Qs=(function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.QUEUE=1]="QUEUE",n[n.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",n[n.DROP=3]="DROP",n})(Qs||(Tn.PickResultType=Qs={})),$l=class{constructor(e){this.status=Object.assign({code:jE.Status.UNAVAILABLE,details:"No connection established",metadata:new GE.Metadata},e)}pick(e){return{pickResultType:Qs.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}};Tn.UnavailablePicker=$l;var Kl=class{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:Qs.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}};Tn.QueuePicker=Kl});var Ai=I(Ys=>{"use strict";Object.defineProperty(Ys,"__esModule",{value:!0});Ys.BackoffTimeout=void 0;var $E=1e3,KE=1.6,WE=12e4,HE=.2;function QE(n,e){return Math.random()*(e-n)+n}var Wl=class{constructor(e,t){this.callback=e,this.initialDelay=$E,this.multiplier=KE,this.maxDelay=WE,this.jitter=HE,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,r;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||(r=(t=this.timerId).unref)===null||r===void 0||r.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+QE(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,(t=(e=this.timerId).ref)===null||t===void 0||t.call(e)}unref(){var e,t;this.hasRef=!1,(t=(e=this.timerId).unref)===null||t===void 0||t.call(e)}getEndTime(){return this.endTime}};Ys.BackoffTimeout=Wl});var Xs=I(Js=>{"use strict";Object.defineProperty(Js,"__esModule",{value:!0});Js.ChildLoadBalancerHandler=void 0;var YE=yn(),JE=ct(),XE="child_load_balancer_helper",Hl=class{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(t){this.parent=t,this.child=null}createSubchannel(t,r){return this.parent.channelControlHelper.createSubchannel(t,r)}updateState(t,r){var i;if(this.calledByPendingChild()){if(t===JE.ConnectivityState.CONNECTING)return;(i=this.parent.currentChild)===null||i===void 0||i.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(t,r)}requestReresolution(){var t;let r=(t=this.parent.pendingChild)!==null&&t!==void 0?t:this.parent.currentChild;this.child===r&&this.parent.channelControlHelper.requestReresolution()}setChild(t){this.child=t}addChannelzChild(t){this.parent.channelControlHelper.addChannelzChild(t)}removeChannelzChild(t){this.parent.channelControlHelper.removeChannelzChild(t)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,r){let i;if(this.currentChild===null||this.latestConfig===null||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let s=new this.ChildPolicyHelper(this),o=(0,YE.createLoadBalancer)(t,s);s.setChild(o),this.currentChild===null?(this.currentChild=o,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=o,i=this.pendingChild)}else this.pendingChild===null?i=this.currentChild:i=this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,r)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return XE}};Js.ChildLoadBalancerHandler=Hl});var Dp=I(Zs=>{"use strict";Object.defineProperty(Zs,"__esModule",{value:!0});Zs.ResolvingLoadBalancer=void 0;var ZE=yn(),e_=zl(),Je=ct(),t_=Nt(),Nr=En(),n_=Ai(),Ql=ne(),r_=Ye(),i_=fe(),s_=ne(),o_=et(),a_=Xs(),l_="resolving_load_balancer";function Rp(n){i_.trace(s_.LogVerbosity.DEBUG,l_,n)}var c_=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function u_(n,e,t,r){for(let i of t.name)switch(r){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===n&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===n&&i.method===e)return!0}return!1}function d_(n,e,t,r){for(let i of t)if(u_(n,e,i,r))return i;return null}function h_(n){return function(t,r){var i,s;let o=t.split("/").filter(c=>c.length>0),a=(i=o[0])!==null&&i!==void 0?i:"",l=(s=o[1])!==null&&s!==void 0?s:"";if(n&&n.methodConfig)for(let c of c_){let u=d_(a,l,n.methodConfig,c);if(u)return{methodConfig:u,pickInformation:{},status:Ql.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:Ql.Status.OK,dynamicFilterFactories:[]}}}var Yl=class{constructor(e,t,r,i,s){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=i,this.onFailedResolution=s,this.latestChildState=Je.ConnectivityState.IDLE,this.latestChildPicker=new Nr.QueuePicker(this),this.currentState=Je.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,r["grpc.service_config"]?this.defaultServiceConfig=(0,e_.validateServiceConfig)(JSON.parse(r["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(Je.ConnectivityState.IDLE,new Nr.QueuePicker(this)),this.childLoadBalancer=new a_.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(Rp("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(a,l)=>{this.latestChildState=a,this.latestChildPicker=l,this.updateState(a,l)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,t_.createResolver)(e,{onSuccessfulResolution:(a,l,c,u,m)=>{var S;this.backoffTimeout.stop(),this.backoffTimeout.reset();let E=null;l===null?c===null?(this.previousServiceConfig=null,E=this.defaultServiceConfig):this.previousServiceConfig===null?this.handleResolutionFailure(c):E=this.previousServiceConfig:(E=l,this.previousServiceConfig=l);let _=(S=E?.loadBalancingConfig)!==null&&S!==void 0?S:[],w=(0,ZE.getFirstUsableConfig)(_,!0);if(w===null){this.handleResolutionFailure({code:Ql.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new r_.Metadata});return}this.childLoadBalancer.updateAddressList(a,w,m);let C=E??this.defaultServiceConfig;this.onSuccessfulResolution(C,u??h_(C))},onError:a=>{this.handleResolutionFailure(a)}},r);let o={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new n_.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},o),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===Je.ConnectivityState.IDLE&&this.updateState(Je.ConnectivityState.CONNECTING,new Nr.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){Rp((0,o_.uriToString)(this.target)+" "+Je.ConnectivityState[this.currentState]+" -> "+Je.ConnectivityState[e]),e===Je.ConnectivityState.IDLE&&(t=new Nr.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===Je.ConnectivityState.IDLE&&(this.updateState(Je.ConnectivityState.TRANSIENT_FAILURE,new Nr.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===Je.ConnectivityState.IDLE||this.currentState===Je.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw new Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=Je.ConnectivityState.IDLE,this.latestChildPicker=new Nr.QueuePicker(this),this.currentState=Je.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}};Zs.ResolvingLoadBalancer=Yl});var Ap=I(Or=>{"use strict";Object.defineProperty(Or,"__esModule",{value:!0});Or.channelOptionsEqual=Or.recognizedOptions=void 0;Or.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0};function f_(n,e){let t=Object.keys(n).sort(),r=Object.keys(e).sort();if(t.length!==r.length)return!1;for(let i=0;i<t.length;i+=1)if(t[i]!==r[i]||n[t[i]]!==e[r[i]])return!1;return!0}Or.channelOptionsEqual=f_});var xt=I(Ot=>{"use strict";Object.defineProperty(Ot,"__esModule",{value:!0});Ot.stringToSubchannelAddress=Ot.subchannelAddressToString=Ot.subchannelAddressEqual=Ot.isTcpSubchannelAddress=void 0;var p_=re("net");function Ni(n){return"port"in n}Ot.isTcpSubchannelAddress=Ni;function m_(n,e){return!n&&!e?!0:!n||!e?!1:Ni(n)?Ni(e)&&n.host===e.host&&n.port===e.port:!Ni(e)&&n.path===e.path}Ot.subchannelAddressEqual=m_;function g_(n){return Ni(n)?n.host+":"+n.port:n.path}Ot.subchannelAddressToString=g_;var y_=443;function v_(n,e){return(0,p_.isIP)(n)?{host:n,port:e??y_}:{path:n}}Ot.stringToSubchannelAddress=v_});var eo=I(xr=>{"use strict";Object.defineProperty(xr,"__esModule",{value:!0});xr.addAdminServicesToServer=xr.registerAdminService=void 0;var Np=[];function S_(n,e){Np.push({getServiceDefinition:n,getHandlers:e})}xr.registerAdminService=S_;function T_(n){for(let{getServiceDefinition:e,getHandlers:t}of Np)n.addService(e(),t())}xr.addAdminServicesToServer=T_});var Op=I(dt=>{"use strict";Object.defineProperty(dt,"__esModule",{value:!0});dt.ClientDuplexStreamImpl=dt.ClientWritableStreamImpl=dt.ClientReadableStreamImpl=dt.ClientUnaryCallImpl=dt.callErrorFromStatus=void 0;var E_=re("events"),tc=re("stream"),Oi=ne();function __(n,e){let t=`${n.code} ${Oi.Status[n.code]}: ${n.details}`,i=`${new Error(t).stack}
for call at
${e}`;return Object.assign(new Error(t),n,{stack:i})}dt.callErrorFromStatus=__;var Jl=class extends E_.EventEmitter{constructor(){super()}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Oi.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}};dt.ClientUnaryCallImpl=Jl;var Xl=class extends tc.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Oi.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}};dt.ClientReadableStreamImpl=Xl;var Zl=class extends tc.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Oi.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};dt.ClientWritableStreamImpl=Zl;var ec=class extends tc.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Oi.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};dt.ClientDuplexStreamImpl=ec});var xp=I(kr=>{"use strict";Object.defineProperty(kr,"__esModule",{value:!0});kr.InterceptingListenerImpl=kr.isInterceptingListener=void 0;function b_(n){return n.onReceiveMetadata!==void 0&&n.onReceiveMetadata.length===1}kr.isInterceptingListener=b_;var nc=class{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,t=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(t),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,t=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=t,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(t),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,t=>{this.processingMetadata||this.processingMessage?this.pendingStatus=t:this.nextListener.onReceiveStatus(t)})}};kr.InterceptingListenerImpl=nc});var cc=I(ht=>{"use strict";Object.defineProperty(ht,"__esModule",{value:!0});ht.getInterceptingCall=ht.InterceptingCall=ht.RequesterBuilder=ht.ListenerBuilder=ht.InterceptorConfigurationError=void 0;var w_=Ye(),kp=xp(),Pp=ne(),Mp=qs(),ki=class n extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,n)}};ht.InterceptorConfigurationError=ki;var ic=class{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}};ht.ListenerBuilder=ic;var sc=class{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}};ht.RequesterBuilder=sc;var rc={onReceiveMetadata:(n,e)=>{e(n)},onReceiveMessage:(n,e)=>{e(n)},onReceiveStatus:(n,e)=>{e(n)}},xi={start:(n,e,t)=>{t(n,e)},sendMessage:(n,e)=>{e(n)},halfClose:n=>{n()},cancel:n=>{n()}},oc=class{constructor(e,t){var r,i,s,o;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:(r=t.start)!==null&&r!==void 0?r:xi.start,sendMessage:(i=t.sendMessage)!==null&&i!==void 0?i:xi.sendMessage,halfClose:(s=t.halfClose)!==null&&s!==void 0?s:xi.halfClose,cancel:(o=t.cancel)!==null&&o!==void 0?o:xi.cancel}:this.requester=xi}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var r,i,s,o,a,l;let c={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:u=>{},onReceiveMessage:(o=(s=t?.onReceiveMessage)===null||s===void 0?void 0:s.bind(t))!==null&&o!==void 0?o:u=>{},onReceiveStatus:(l=(a=t?.onReceiveStatus)===null||a===void 0?void 0:a.bind(t))!==null&&l!==void 0?l:u=>{}};this.processingMetadata=!0,this.requester.start(e,c,(u,m)=>{var S,E,_;this.processingMetadata=!1;let w;if((0,kp.isInterceptingListener)(m))w=m;else{let C={onReceiveMetadata:(S=m.onReceiveMetadata)!==null&&S!==void 0?S:rc.onReceiveMetadata,onReceiveMessage:(E=m.onReceiveMessage)!==null&&E!==void 0?E:rc.onReceiveMessage,onReceiveStatus:(_=m.onReceiveStatus)!==null&&_!==void 0?_:rc.onReceiveStatus};w=new kp.InterceptingListenerImpl(C,c)}this.nextCall.start(u,w),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,r=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,r),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}};ht.InterceptingCall=oc;function C_(n,e,t){var r,i;let s=(r=t.deadline)!==null&&r!==void 0?r:1/0,o=t.host,a=(i=t.parent)!==null&&i!==void 0?i:null,l=t.propagate_flags,c=t.credentials,u=n.createCall(e,s,o,a,l);return c&&u.setCredentials(c),u}var to=class{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let r;try{r=this.methodDefinition.requestSerialize(t)}catch(i){this.call.cancelWithStatus(Pp.Status.INTERNAL,`Request message serialization failure: ${(0,Mp.getErrorMessage)(i)}`);return}this.call.sendMessageWithContext(e,r)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let r=null;this.call.start(e,{onReceiveMetadata:i=>{var s;(s=t?.onReceiveMetadata)===null||s===void 0||s.call(t,i)},onReceiveMessage:i=>{var s;let o;try{o=this.methodDefinition.responseDeserialize(i)}catch(a){r={code:Pp.Status.INTERNAL,details:`Response message parsing error: ${(0,Mp.getErrorMessage)(a)}`,metadata:new w_.Metadata},this.call.cancelWithStatus(r.code,r.details);return}(s=t?.onReceiveMessage)===null||s===void 0||s.call(t,o)},onReceiveStatus:i=>{var s,o;r?(s=t?.onReceiveStatus)===null||s===void 0||s.call(t,r):(o=t?.onReceiveStatus)===null||o===void 0||o.call(t,i)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}},ac=class extends to{constructor(e,t){super(e,t)}start(e,t){var r,i;let s=!1,o={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:a=>{},onReceiveMessage:a=>{var l;s=!0,(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,a)},onReceiveStatus:a=>{var l,c;s||(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,null),(c=t?.onReceiveStatus)===null||c===void 0||c.call(t,a)}};super.start(e,o),this.call.startRead()}},lc=class extends to{};function I_(n,e,t){let r=C_(n,t.path,e);return t.responseStream?new lc(r,t):new ac(r,t)}function R_(n,e,t,r){if(n.clientInterceptors.length>0&&n.clientInterceptorProviders.length>0)throw new ki("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(n.callInterceptors.length>0&&n.callInterceptorProviders.length>0)throw new ki("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];n.callInterceptors.length>0||n.callInterceptorProviders.length>0?i=[].concat(n.callInterceptors,n.callInterceptorProviders.map(a=>a(e))).filter(a=>a):i=[].concat(n.clientInterceptors,n.clientInterceptorProviders.map(a=>a(e))).filter(a=>a);let s=Object.assign({},t,{method_definition:e});return i.reduceRight((a,l)=>c=>l(c,a),a=>I_(r,a,e))(s)}ht.getInterceptingCall=R_});var hc=I(ro=>{"use strict";Object.defineProperty(ro,"__esModule",{value:!0});ro.Client=void 0;var kt=Op(),D_=fc(),A_=ct(),_n=ne(),Pr=Ye(),no=cc(),Tt=Symbol(),Mr=Symbol(),Lr=Symbol(),Zt=Symbol();function uc(n){return typeof n=="function"}function Fr(n){return n.stack.split(`
`).slice(1).join(`
`)}var dc=class{constructor(e,t,r={}){var i,s;if(r=Object.assign({},r),this[Mr]=(i=r.interceptors)!==null&&i!==void 0?i:[],delete r.interceptors,this[Lr]=(s=r.interceptor_providers)!==null&&s!==void 0?s:[],delete r.interceptor_providers,this[Mr].length>0&&this[Lr].length>0)throw new Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[Zt]=r.callInvocationTransformer,delete r.callInvocationTransformer,r.channelOverride)this[Tt]=r.channelOverride;else if(r.channelFactoryOverride){let o=r.channelFactoryOverride;delete r.channelFactoryOverride,this[Tt]=o(e,t,r)}else this[Tt]=new D_.ChannelImplementation(e,t,r)}close(){this[Tt].close()}getChannel(){return this[Tt]}waitForReady(e,t){let r=i=>{if(i){t(new Error("Failed to connect before the deadline"));return}let s;try{s=this[Tt].getConnectivityState(!0)}catch{t(new Error("The channel has been closed"));return}if(s===A_.ConnectivityState.READY)t();else try{this[Tt].watchConnectivityState(s,e,r)}catch{t(new Error("The channel has been closed"))}};setImmediate(r)}checkOptionalUnaryResponseArguments(e,t,r){if(uc(e))return{metadata:new Pr.Metadata,options:{},callback:e};if(uc(t))return e instanceof Pr.Metadata?{metadata:e,options:{},callback:t}:{metadata:new Pr.Metadata,options:e,callback:t};if(!(e instanceof Pr.Metadata&&t instanceof Object&&uc(r)))throw new Error("Incorrect arguments passed");return{metadata:e,options:t,callback:r}}makeUnaryRequest(e,t,r,i,s,o,a){var l,c;let u=this.checkOptionalUnaryResponseArguments(s,o,a),m={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:r},S={argument:i,metadata:u.metadata,call:new kt.ClientUnaryCallImpl,channel:this[Tt],methodDefinition:m,callOptions:u.options,callback:u.callback};this[Zt]&&(S=this[Zt](S));let E=S.call,_={clientInterceptors:this[Mr],clientInterceptorProviders:this[Lr],callInterceptors:(l=S.callOptions.interceptors)!==null&&l!==void 0?l:[],callInterceptorProviders:(c=S.callOptions.interceptor_providers)!==null&&c!==void 0?c:[]},w=(0,no.getInterceptingCall)(_,S.methodDefinition,S.callOptions,S.channel);E.call=w;let C=null,k=!1,P=new Error;return w.start(S.metadata,{onReceiveMetadata:M=>{E.emit("metadata",M)},onReceiveMessage(M){C!==null&&w.cancelWithStatus(_n.Status.INTERNAL,"Too many responses received"),C=M},onReceiveStatus(M){if(!k){if(k=!0,M.code===_n.Status.OK)if(C===null){let b=Fr(P);S.callback((0,kt.callErrorFromStatus)({code:_n.Status.INTERNAL,details:"No message received",metadata:M.metadata},b))}else S.callback(null,C);else{let b=Fr(P);S.callback((0,kt.callErrorFromStatus)(M,b))}P=null,E.emit("status",M)}}}),w.sendMessage(i),w.halfClose(),E}makeClientStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkOptionalUnaryResponseArguments(i,s,o),u={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:r},m={metadata:c.metadata,call:new kt.ClientWritableStreamImpl(t),channel:this[Tt],methodDefinition:u,callOptions:c.options,callback:c.callback};this[Zt]&&(m=this[Zt](m));let S=m.call,E={clientInterceptors:this[Mr],clientInterceptorProviders:this[Lr],callInterceptors:(a=m.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=m.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},_=(0,no.getInterceptingCall)(E,m.methodDefinition,m.callOptions,m.channel);S.call=_;let w=null,C=!1,k=new Error;return _.start(m.metadata,{onReceiveMetadata:P=>{S.emit("metadata",P)},onReceiveMessage(P){w!==null&&_.cancelWithStatus(_n.Status.INTERNAL,"Too many responses received"),w=P},onReceiveStatus(P){if(!C){if(C=!0,P.code===_n.Status.OK)if(w===null){let M=Fr(k);m.callback((0,kt.callErrorFromStatus)({code:_n.Status.INTERNAL,details:"No message received",metadata:P.metadata},M))}else m.callback(null,w);else{let M=Fr(k);m.callback((0,kt.callErrorFromStatus)(P,M))}k=null,S.emit("status",P)}}}),S}checkMetadataAndOptions(e,t){let r,i;return e instanceof Pr.Metadata?(r=e,t?i=t:i={}):(e?i=e:i={},r=new Pr.Metadata),{metadata:r,options:i}}makeServerStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkMetadataAndOptions(s,o),u={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:r},m={argument:i,metadata:c.metadata,call:new kt.ClientReadableStreamImpl(r),channel:this[Tt],methodDefinition:u,callOptions:c.options};this[Zt]&&(m=this[Zt](m));let S=m.call,E={clientInterceptors:this[Mr],clientInterceptorProviders:this[Lr],callInterceptors:(a=m.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=m.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},_=(0,no.getInterceptingCall)(E,m.methodDefinition,m.callOptions,m.channel);S.call=_;let w=!1,C=new Error;return _.start(m.metadata,{onReceiveMetadata(k){S.emit("metadata",k)},onReceiveMessage(k){S.push(k)},onReceiveStatus(k){if(!w){if(w=!0,S.push(null),k.code!==_n.Status.OK){let P=Fr(C);S.emit("error",(0,kt.callErrorFromStatus)(k,P))}C=null,S.emit("status",k)}}}),_.sendMessage(i),_.halfClose(),S}makeBidiStreamRequest(e,t,r,i,s){var o,a;let l=this.checkMetadataAndOptions(i,s),c={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:r},u={metadata:l.metadata,call:new kt.ClientDuplexStreamImpl(t,r),channel:this[Tt],methodDefinition:c,callOptions:l.options};this[Zt]&&(u=this[Zt](u));let m=u.call,S={clientInterceptors:this[Mr],clientInterceptorProviders:this[Lr],callInterceptors:(o=u.callOptions.interceptors)!==null&&o!==void 0?o:[],callInterceptorProviders:(a=u.callOptions.interceptor_providers)!==null&&a!==void 0?a:[]},E=(0,no.getInterceptingCall)(S,u.methodDefinition,u.callOptions,u.channel);m.call=E;let _=!1,w=new Error;return E.start(u.metadata,{onReceiveMetadata(C){m.emit("metadata",C)},onReceiveMessage(C){m.push(C)},onReceiveStatus(C){if(!_){if(_=!0,m.push(null),C.code!==_n.Status.OK){let k=Fr(w);m.emit("error",(0,kt.callErrorFromStatus)(C,k))}w=null,m.emit("status",C)}}}),m}};ro.Client=dc});var mc=I(Br=>{"use strict";Object.defineProperty(Br,"__esModule",{value:!0});Br.loadPackageDefinition=Br.makeClientConstructor=void 0;var Pi=hc(),N_={unary:Pi.Client.prototype.makeUnaryRequest,server_stream:Pi.Client.prototype.makeServerStreamRequest,client_stream:Pi.Client.prototype.makeClientStreamRequest,bidi:Pi.Client.prototype.makeBidiStreamRequest};function pc(n){return["__proto__","prototype","constructor"].includes(n)}function Lp(n,e,t){t||(t={});class r extends Pi.Client{}return Object.keys(n).forEach(i=>{if(pc(i))return;let s=n[i],o;if(typeof i=="string"&&i.charAt(0)==="$")throw new Error("Method names cannot start with $");s.requestStream?s.responseStream?o="bidi":o="client_stream":s.responseStream?o="server_stream":o="unary";let a=s.requestSerialize,l=s.responseDeserialize,c=O_(N_[o],s.path,a,l);r.prototype[i]=c,Object.assign(r.prototype[i],s),s.originalName&&!pc(s.originalName)&&(r.prototype[s.originalName]=r.prototype[i])}),r.service=n,r.serviceName=e,r}Br.makeClientConstructor=Lp;function O_(n,e,t,r){return function(...i){return n.call(this,e,t,r,...i)}}function x_(n){return"format"in n}function k_(n){let e={};for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let r=n[t],i=t.split(".");if(i.some(a=>pc(a)))continue;let s=i[i.length-1],o=e;for(let a of i.slice(0,-1))o[a]||(o[a]={}),o=o[a];x_(r)?o[s]=r:o[s]=Lp(r,s,{})}return e}Br.loadPackageDefinition=k_});var am=I((rk,om)=>{"use strict";var P_=1/0,M_="[object Symbol]",L_=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,F_=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,so="\\ud800-\\udfff",jp="\\u0300-\\u036f\\ufe20-\\ufe23",$p="\\u20d0-\\u20f0",Kp="\\u2700-\\u27bf",Wp="a-z\\xdf-\\xf6\\xf8-\\xff",B_="\\xac\\xb1\\xd7\\xf7",q_="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",U_="\\u2000-\\u206f",V_=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Hp="A-Z\\xc0-\\xd6\\xd8-\\xde",Qp="\\ufe0e\\ufe0f",Yp=B_+q_+U_+V_,yc="['\u2019]",z_="["+so+"]",Fp="["+Yp+"]",io="["+jp+$p+"]",Jp="\\d+",G_="["+Kp+"]",Xp="["+Wp+"]",Zp="[^"+so+Yp+Jp+Kp+Wp+Hp+"]",gc="\\ud83c[\\udffb-\\udfff]",j_="(?:"+io+"|"+gc+")",em="[^"+so+"]",vc="(?:\\ud83c[\\udde6-\\uddff]){2}",Sc="[\\ud800-\\udbff][\\udc00-\\udfff]",qr="["+Hp+"]",tm="\\u200d",Bp="(?:"+Xp+"|"+Zp+")",$_="(?:"+qr+"|"+Zp+")",qp="(?:"+yc+"(?:d|ll|m|re|s|t|ve))?",Up="(?:"+yc+"(?:D|LL|M|RE|S|T|VE))?",nm=j_+"?",rm="["+Qp+"]?",K_="(?:"+tm+"(?:"+[em,vc,Sc].join("|")+")"+rm+nm+")*",im=rm+nm+K_,W_="(?:"+[G_,vc,Sc].join("|")+")"+im,H_="(?:"+[em+io+"?",io,vc,Sc,z_].join("|")+")",Q_=RegExp(yc,"g"),Y_=RegExp(io,"g"),J_=RegExp(gc+"(?="+gc+")|"+H_+im,"g"),X_=RegExp([qr+"?"+Xp+"+"+qp+"(?="+[Fp,qr,"$"].join("|")+")",$_+"+"+Up+"(?="+[Fp,qr+Bp,"$"].join("|")+")",qr+"?"+Bp+"+"+qp,qr+"+"+Up,Jp,W_].join("|"),"g"),Z_=RegExp("["+tm+so+jp+$p+Qp+"]"),eb=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,tb={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"ss"},nb=typeof global=="object"&&global&&global.Object===Object&&global,rb=typeof self=="object"&&self&&self.Object===Object&&self,ib=nb||rb||Function("return this")();function sb(n,e,t,r){var i=-1,s=n?n.length:0;for(r&&s&&(t=n[++i]);++i<s;)t=e(t,n[i],i,n);return t}function ob(n){return n.split("")}function ab(n){return n.match(L_)||[]}function lb(n){return function(e){return n?.[e]}}var cb=lb(tb);function sm(n){return Z_.test(n)}function ub(n){return eb.test(n)}function db(n){return sm(n)?hb(n):ob(n)}function hb(n){return n.match(J_)||[]}function fb(n){return n.match(X_)||[]}var pb=Object.prototype,mb=pb.toString,Vp=ib.Symbol,zp=Vp?Vp.prototype:void 0,Gp=zp?zp.toString:void 0;function gb(n,e,t){var r=-1,i=n.length;e<0&&(e=-e>i?0:i+e),t=t>i?i:t,t<0&&(t+=i),i=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=n[r+e];return s}function yb(n){if(typeof n=="string")return n;if(_b(n))return Gp?Gp.call(n):"";var e=n+"";return e=="0"&&1/n==-P_?"-0":e}function vb(n,e,t){var r=n.length;return t=t===void 0?r:t,!e&&t>=r?n:gb(n,e,t)}function Sb(n){return function(e){e=oo(e);var t=sm(e)?db(e):void 0,r=t?t[0]:e.charAt(0),i=t?vb(t,1).join(""):e.slice(1);return r[n]()+i}}function Tb(n){return function(e){return sb(Rb(Cb(e).replace(Q_,"")),n,"")}}function Eb(n){return!!n&&typeof n=="object"}function _b(n){return typeof n=="symbol"||Eb(n)&&mb.call(n)==M_}function oo(n){return n==null?"":yb(n)}var bb=Tb(function(n,e,t){return e=e.toLowerCase(),n+(t?wb(e):e)});function wb(n){return Ib(oo(n).toLowerCase())}function Cb(n){return n=oo(n),n&&n.replace(F_,cb).replace(Y_,"")}var Ib=Sb("toUpperCase");function Rb(n,e,t){return n=oo(n),e=t?void 0:e,e===void 0?ub(n)?fb(n):ab(n):n.match(e)||[]}om.exports=bb});var Tc=I((ik,lm)=>{"use strict";lm.exports=Db;function Db(n,e){for(var t=new Array(arguments.length-1),r=0,i=2,s=!0;i<arguments.length;)t[r++]=arguments[i++];return new Promise(function(a,l){t[r]=function(u){if(s)if(s=!1,u)l(u);else{for(var m=new Array(arguments.length-1),S=0;S<m.length;)m[S++]=arguments[S];a.apply(null,m)}};try{n.apply(e||null,t)}catch(c){s&&(s=!1,l(c))}})}});var hm=I(dm=>{"use strict";var ao=dm;ao.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&e.charAt(t)==="=";)++r;return Math.ceil(e.length*3)/4-r};var Ur=new Array(64),um=new Array(123);for(Et=0;Et<64;)um[Ur[Et]=Et<26?Et+65:Et<52?Et+71:Et<62?Et-4:Et-59|43]=Et++;var Et;ao.encode=function(e,t,r){for(var i=null,s=[],o=0,a=0,l;t<r;){var c=e[t++];switch(a){case 0:s[o++]=Ur[c>>2],l=(c&3)<<4,a=1;break;case 1:s[o++]=Ur[l|c>>4],l=(c&15)<<2,a=2;break;case 2:s[o++]=Ur[l|c>>6],s[o++]=Ur[c&63],a=0;break}o>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),o=0)}return a&&(s[o++]=Ur[l],s[o++]=61,a===1&&(s[o++]=61)),i?(o&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))};var cm="invalid encoding";ao.decode=function(e,t,r){for(var i=r,s=0,o,a=0;a<e.length;){var l=e.charCodeAt(a++);if(l===61&&s>1)break;if((l=um[l])===void 0)throw Error(cm);switch(s){case 0:o=l,s=1;break;case 1:t[r++]=o<<2|(l&48)>>4,o=l,s=2;break;case 2:t[r++]=(o&15)<<4|(l&60)>>2,o=l,s=3;break;case 3:t[r++]=(o&3)<<6|l,s=0;break}}if(s===1)throw Error(cm);return r-i};ao.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var pm=I((ok,fm)=>{"use strict";fm.exports=lo;function lo(){this._listeners={}}lo.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this};lo.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var r=this._listeners[e],i=0;i<r.length;)r[i].fn===t?r.splice(i,1):++i;return this};lo.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],i=1;i<arguments.length;)r.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,r)}return this}});var Em=I((ak,Tm)=>{"use strict";Tm.exports=mm(mm);function mm(n){return typeof Float32Array<"u"?(function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),r=t[3]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3]}function s(l,c,u){e[0]=l,c[u]=t[3],c[u+1]=t[2],c[u+2]=t[1],c[u+3]=t[0]}n.writeFloatLE=r?i:s,n.writeFloatBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],e[0]}function a(l,c){return t[3]=l[c],t[2]=l[c+1],t[1]=l[c+2],t[0]=l[c+3],e[0]}n.readFloatLE=r?o:a,n.readFloatBE=r?a:o})():(function(){function e(r,i,s,o){var a=i<0?1:0;if(a&&(i=-i),i===0)r(1/i>0?0:2147483648,s,o);else if(isNaN(i))r(2143289344,s,o);else if(i>34028234663852886e22)r((a<<31|2139095040)>>>0,s,o);else if(i<11754943508222875e-54)r((a<<31|Math.round(i/1401298464324817e-60))>>>0,s,o);else{var l=Math.floor(Math.log(i)/Math.LN2),c=Math.round(i*Math.pow(2,-l)*8388608)&8388607;r((a<<31|l+127<<23|c)>>>0,s,o)}}n.writeFloatLE=e.bind(null,gm),n.writeFloatBE=e.bind(null,ym);function t(r,i,s){var o=r(i,s),a=(o>>31)*2+1,l=o>>>23&255,c=o&8388607;return l===255?c?NaN:a*(1/0):l===0?a*1401298464324817e-60*c:a*Math.pow(2,l-150)*(c+8388608)}n.readFloatLE=t.bind(null,vm),n.readFloatBE=t.bind(null,Sm)})(),typeof Float64Array<"u"?(function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),r=t[7]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3],c[u+4]=t[4],c[u+5]=t[5],c[u+6]=t[6],c[u+7]=t[7]}function s(l,c,u){e[0]=l,c[u]=t[7],c[u+1]=t[6],c[u+2]=t[5],c[u+3]=t[4],c[u+4]=t[3],c[u+5]=t[2],c[u+6]=t[1],c[u+7]=t[0]}n.writeDoubleLE=r?i:s,n.writeDoubleBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],t[4]=l[c+4],t[5]=l[c+5],t[6]=l[c+6],t[7]=l[c+7],e[0]}function a(l,c){return t[7]=l[c],t[6]=l[c+1],t[5]=l[c+2],t[4]=l[c+3],t[3]=l[c+4],t[2]=l[c+5],t[1]=l[c+6],t[0]=l[c+7],e[0]}n.readDoubleLE=r?o:a,n.readDoubleBE=r?a:o})():(function(){function e(r,i,s,o,a,l){var c=o<0?1:0;if(c&&(o=-o),o===0)r(0,a,l+i),r(1/o>0?0:2147483648,a,l+s);else if(isNaN(o))r(0,a,l+i),r(2146959360,a,l+s);else if(o>17976931348623157e292)r(0,a,l+i),r((c<<31|2146435072)>>>0,a,l+s);else{var u;if(o<22250738585072014e-324)u=o/5e-324,r(u>>>0,a,l+i),r((c<<31|u/4294967296)>>>0,a,l+s);else{var m=Math.floor(Math.log(o)/Math.LN2);m===1024&&(m=1023),u=o*Math.pow(2,-m),r(u*4503599627370496>>>0,a,l+i),r((c<<31|m+1023<<20|u*1048576&1048575)>>>0,a,l+s)}}}n.writeDoubleLE=e.bind(null,gm,0,4),n.writeDoubleBE=e.bind(null,ym,4,0);function t(r,i,s,o,a){var l=r(o,a+i),c=r(o,a+s),u=(c>>31)*2+1,m=c>>>20&2047,S=4294967296*(c&1048575)+l;return m===2047?S?NaN:u*(1/0):m===0?u*5e-324*S:u*Math.pow(2,m-1075)*(S+4503599627370496)}n.readDoubleLE=t.bind(null,vm,0,4),n.readDoubleBE=t.bind(null,Sm,4,0)})(),n}function gm(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}function ym(n,e,t){e[t]=n>>>24,e[t+1]=n>>>16&255,e[t+2]=n>>>8&255,e[t+3]=n&255}function vm(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0}function Sm(n,e){return(n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3])>>>0}});var Ec=I((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(n){}return null}});var bm=I(_m=>{"use strict";var _c=_m;_c.length=function(e){for(var t=0,r=0,i=0;i<e.length;++i)r=e.charCodeAt(i),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(i+1)&64512)===56320?(++i,t+=4):t+=3;return t};_c.read=function(e,t,r){var i=r-t;if(i<1)return"";for(var s=null,o=[],a=0,l;t<r;)l=e[t++],l<128?o[a++]=l:l>191&&l<224?o[a++]=(l&31)<<6|e[t++]&63:l>239&&l<365?(l=((l&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,o[a++]=55296+(l>>10),o[a++]=56320+(l&1023)):o[a++]=(l&15)<<12|(e[t++]&63)<<6|e[t++]&63,a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0);return s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};_c.write=function(e,t,r){for(var i=r,s,o,a=0;a<e.length;++a)s=e.charCodeAt(a),s<128?t[r++]=s:s<2048?(t[r++]=s>>6|192,t[r++]=s&63|128):(s&64512)===55296&&((o=e.charCodeAt(a+1))&64512)===56320?(s=65536+((s&1023)<<10)+(o&1023),++a,t[r++]=s>>18|240,t[r++]=s>>12&63|128,t[r++]=s>>6&63|128,t[r++]=s&63|128):(t[r++]=s>>12|224,t[r++]=s>>6&63|128,t[r++]=s&63|128);return r-i}});var Cm=I((ck,wm)=>{"use strict";wm.exports=Ab;function Ab(n,e,t){var r=t||8192,i=r>>>1,s=null,o=r;return function(l){if(l<1||l>i)return n(l);o+l>r&&(s=n(r),o=0);var c=e.call(s,o,o+=l);return o&7&&(o=(o|7)+1),c}}});var Rm=I((uk,Im)=>{"use strict";Im.exports=De;var Mi=Pt();function De(n,e){this.lo=n>>>0,this.hi=e>>>0}var Yn=De.zero=new De(0,0);Yn.toNumber=function(){return 0};Yn.zzEncode=Yn.zzDecode=function(){return this};Yn.length=function(){return 1};var Nb=De.zeroHash="\0\0\0\0\0\0\0\0";De.fromNumber=function(e){if(e===0)return Yn;var t=e<0;t&&(e=-e);var r=e>>>0,i=(e-r)/4294967296>>>0;return t&&(i=~i>>>0,r=~r>>>0,++r>4294967295&&(r=0,++i>4294967295&&(i=0))),new De(r,i)};De.from=function(e){if(typeof e=="number")return De.fromNumber(e);if(Mi.isString(e))if(Mi.Long)e=Mi.Long.fromString(e);else return De.fromNumber(parseInt(e,10));return e.low||e.high?new De(e.low>>>0,e.high>>>0):Yn};De.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+r*4294967296)}return this.lo+this.hi*4294967296};De.prototype.toLong=function(e){return Mi.Long?new Mi.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var bn=String.prototype.charCodeAt;De.fromHash=function(e){return e===Nb?Yn:new De((bn.call(e,0)|bn.call(e,1)<<8|bn.call(e,2)<<16|bn.call(e,3)<<24)>>>0,(bn.call(e,4)|bn.call(e,5)<<8|bn.call(e,6)<<16|bn.call(e,7)<<24)>>>0)};De.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};De.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};De.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};De.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return r===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}});var Pt=I(bc=>{"use strict";var q=bc;q.asPromise=Tc();q.base64=hm();q.EventEmitter=pm();q.float=Em();q.inquire=Ec();q.utf8=bm();q.pool=Cm();q.LongBits=Rm();q.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);q.global=q.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||bc;q.emptyArray=Object.freeze?Object.freeze([]):[];q.emptyObject=Object.freeze?Object.freeze({}):{};q.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};q.isString=function(e){return typeof e=="string"||e instanceof String};q.isObject=function(e){return e&&typeof e=="object"};q.isset=q.isSet=function(e,t){var r=e[t];return r!=null&&e.hasOwnProperty(t)?typeof r!="object"||(Array.isArray(r)?r.length:Object.keys(r).length)>0:!1};q.Buffer=(function(){try{var n=q.inquire("buffer").Buffer;return n.prototype.utf8Write?n:null}catch{return null}})();q._Buffer_from=null;q._Buffer_allocUnsafe=null;q.newBuffer=function(e){return typeof e=="number"?q.Buffer?q._Buffer_allocUnsafe(e):new q.Array(e):q.Buffer?q._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};q.Array=typeof Uint8Array<"u"?Uint8Array:Array;q.Long=q.global.dcodeIO&&q.global.dcodeIO.Long||q.global.Long||q.inquire("long");q.key2Re=/^true|false|0|1$/;q.key32Re=/^-?(?:0|[1-9][0-9]*)$/;q.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;q.longToHash=function(e){return e?q.LongBits.from(e).toHash():q.LongBits.zeroHash};q.longFromHash=function(e,t){var r=q.LongBits.fromHash(e);return q.Long?q.Long.fromBits(r.lo,r.hi,t):r.toNumber(!!t)};function Dm(n,e,t){for(var r=Object.keys(e),i=0;i<r.length;++i)(n[r[i]]===void 0||!t)&&(n[r[i]]=e[r[i]]);return n}q.merge=Dm;q.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function Am(n){function e(t,r){if(!(this instanceof e))return new e(t,r);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),r&&Dm(this,r)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return n},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}q.newError=Am;q.ProtocolError=Am("ProtocolError");q.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};q.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}};q.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};q._configure=function(){var n=q.Buffer;if(!n){q._Buffer_from=q._Buffer_allocUnsafe=null;return}q._Buffer_from=n.from!==Uint8Array.from&&n.from||function(t,r){return new n(t,r)},q._Buffer_allocUnsafe=n.allocUnsafe||function(t){return new n(t)}}});var uo=I((hk,km)=>{"use strict";km.exports=Z;var ft=Pt(),wc,co=ft.LongBits,Nm=ft.base64,Om=ft.utf8;function Li(n,e,t){this.fn=n,this.len=e,this.next=void 0,this.val=t}function Ic(){}function Ob(n){this.head=n.head,this.tail=n.tail,this.len=n.len,this.next=n.states}function Z(){this.len=0,this.head=new Li(Ic,0,0),this.tail=this.head,this.states=null}var xm=function(){return ft.Buffer?function(){return(Z.create=function(){return new wc})()}:function(){return new Z}};Z.create=xm();Z.alloc=function(e){return new ft.Array(e)};ft.Array!==Array&&(Z.alloc=ft.pool(Z.alloc,ft.Array.prototype.subarray));Z.prototype._push=function(e,t,r){return this.tail=this.tail.next=new Li(e,t,r),this.len+=t,this};function Rc(n,e,t){e[t]=n&255}function xb(n,e,t){for(;n>127;)e[t++]=n&127|128,n>>>=7;e[t]=n}function Dc(n,e){this.len=n,this.next=void 0,this.val=e}Dc.prototype=Object.create(Li.prototype);Dc.prototype.fn=xb;Z.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new Dc((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};Z.prototype.int32=function(e){return e<0?this._push(Ac,10,co.fromNumber(e)):this.uint32(e)};Z.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function Ac(n,e,t){for(;n.hi;)e[t++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)e[t++]=n.lo&127|128,n.lo=n.lo>>>7;e[t++]=n.lo}Z.prototype.uint64=function(e){var t=co.from(e);return this._push(Ac,t.length(),t)};Z.prototype.int64=Z.prototype.uint64;Z.prototype.sint64=function(e){var t=co.from(e).zzEncode();return this._push(Ac,t.length(),t)};Z.prototype.bool=function(e){return this._push(Rc,1,e?1:0)};function Cc(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}Z.prototype.fixed32=function(e){return this._push(Cc,4,e>>>0)};Z.prototype.sfixed32=Z.prototype.fixed32;Z.prototype.fixed64=function(e){var t=co.from(e);return this._push(Cc,4,t.lo)._push(Cc,4,t.hi)};Z.prototype.sfixed64=Z.prototype.fixed64;Z.prototype.float=function(e){return this._push(ft.float.writeFloatLE,4,e)};Z.prototype.double=function(e){return this._push(ft.float.writeDoubleLE,8,e)};var kb=ft.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var i=0;i<e.length;++i)t[r+i]=e[i]};Z.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(Rc,1,0);if(ft.isString(e)){var r=Z.alloc(t=Nm.length(e));Nm.decode(e,r,0),e=r}return this.uint32(t)._push(kb,t,e)};Z.prototype.string=function(e){var t=Om.length(e);return t?this.uint32(t)._push(Om.write,t,e):this._push(Rc,1,0)};Z.prototype.fork=function(){return this.states=new Ob(this),this.head=this.tail=new Li(Ic,0,0),this.len=0,this};Z.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Li(Ic,0,0),this.len=0),this};Z.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this};Z.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t};Z._configure=function(n){wc=n,Z.create=xm(),wc._configure()}});var Lm=I((fk,Mm)=>{"use strict";Mm.exports=Mt;var Pm=uo();(Mt.prototype=Object.create(Pm.prototype)).constructor=Mt;var wn=Pt();function Mt(){Pm.call(this)}Mt._configure=function(){Mt.alloc=wn._Buffer_allocUnsafe,Mt.writeBytesBuffer=wn.Buffer&&wn.Buffer.prototype instanceof Uint8Array&&wn.Buffer.prototype.set.name==="set"?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var i=0;i<e.length;)t[r++]=e[i++]}};Mt.prototype.bytes=function(e){wn.isString(e)&&(e=wn._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(Mt.writeBytesBuffer,t,e),this};function Pb(n,e,t){n.length<40?wn.utf8.write(n,e,t):e.utf8Write?e.utf8Write(n,t):e.write(n,t)}Mt.prototype.string=function(e){var t=wn.Buffer.byteLength(e);return this.uint32(t),t&&this._push(Pb,t,e),this};Mt._configure()});var fo=I((pk,Vm)=>{"use strict";Vm.exports=ye;var _t=Pt(),Oc,qm=_t.LongBits,Mb=_t.utf8;function bt(n,e){return RangeError("index out of range: "+n.pos+" + "+(e||1)+" > "+n.len)}function ye(n){this.buf=n,this.pos=0,this.len=n.length}var Fm=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new ye(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new ye(e);throw Error("illegal buffer")},Um=function(){return _t.Buffer?function(t){return(ye.create=function(i){return _t.Buffer.isBuffer(i)?new Oc(i):Fm(i)})(t)}:Fm};ye.create=Um();ye.prototype._slice=_t.Array.prototype.subarray||_t.Array.prototype.slice;ye.prototype.uint32=(function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,bt(this,10);return e}})();ye.prototype.int32=function(){return this.uint32()|0};ye.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function Nc(){var n=new qm(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n;if(n.lo=(n.lo|(this.buf[this.pos]&127)<<28)>>>0,n.hi=(n.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return n;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw bt(this);if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n}return n.lo=(n.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,n}if(this.len-this.pos>4){for(;e<5;++e)if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}else for(;e<5;++e){if(this.pos>=this.len)throw bt(this);if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}throw Error("invalid varint encoding")}ye.prototype.bool=function(){return this.uint32()!==0};function ho(n,e){return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0}ye.prototype.fixed32=function(){if(this.pos+4>this.len)throw bt(this,4);return ho(this.buf,this.pos+=4)};ye.prototype.sfixed32=function(){if(this.pos+4>this.len)throw bt(this,4);return ho(this.buf,this.pos+=4)|0};function Bm(){if(this.pos+8>this.len)throw bt(this,8);return new qm(ho(this.buf,this.pos+=4),ho(this.buf,this.pos+=4))}ye.prototype.float=function(){if(this.pos+4>this.len)throw bt(this,4);var e=_t.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};ye.prototype.double=function(){if(this.pos+8>this.len)throw bt(this,4);var e=_t.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};ye.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw bt(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var i=_t.Buffer;return i?i.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)};ye.prototype.string=function(){var e=this.bytes();return Mb.read(e,0,e.length)};ye.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw bt(this,e);this.pos+=e}else do if(this.pos>=this.len)throw bt(this);while(this.buf[this.pos++]&128);return this};ye.prototype.skipType=function(n){switch(n){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(n=this.uint32()&7)!==4;)this.skipType(n);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+n+" at offset "+this.pos)}return this};ye._configure=function(n){Oc=n,ye.create=Um(),Oc._configure();var e=_t.Long?"toLong":"toNumber";_t.merge(ye.prototype,{int64:function(){return Nc.call(this)[e](!1)},uint64:function(){return Nc.call(this)[e](!0)},sint64:function(){return Nc.call(this).zzDecode()[e](!1)},fixed64:function(){return Bm.call(this)[e](!0)},sfixed64:function(){return Bm.call(this)[e](!1)}})}});var $m=I((mk,jm)=>{"use strict";jm.exports=Jn;var Gm=fo();(Jn.prototype=Object.create(Gm.prototype)).constructor=Jn;var zm=Pt();function Jn(n){Gm.call(this,n)}Jn._configure=function(){zm.Buffer&&(Jn.prototype._slice=zm.Buffer.prototype.slice)};Jn.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};Jn._configure()});var Wm=I((gk,Km)=>{"use strict";Km.exports=Fi;var xc=Pt();(Fi.prototype=Object.create(xc.EventEmitter.prototype)).constructor=Fi;function Fi(n,e,t){if(typeof n!="function")throw TypeError("rpcImpl must be a function");xc.EventEmitter.call(this),this.rpcImpl=n,this.requestDelimited=!!e,this.responseDelimited=!!t}Fi.prototype.rpcCall=function n(e,t,r,i,s){if(!i)throw TypeError("request must be specified");var o=this;if(!s)return xc.asPromise(n,o,e,t,r,i);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(l,c){if(l)return o.emit("error",l,e),s(l);if(c===null){o.end(!0);return}if(!(c instanceof r))try{c=r[o.responseDelimited?"decodeDelimited":"decode"](c)}catch(u){return o.emit("error",u,e),s(u)}return o.emit("data",c,e),s(null,c)})}catch(a){o.emit("error",a,e),setTimeout(function(){s(a)},0);return}};Fi.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var kc=I(Hm=>{"use strict";var Lb=Hm;Lb.Service=Wm()});var Pc=I((vk,Qm)=>{"use strict";Qm.exports={}});var Xm=I(Jm=>{"use strict";var Xe=Jm;Xe.build="minimal";Xe.Writer=uo();Xe.BufferWriter=Lm();Xe.Reader=fo();Xe.BufferReader=$m();Xe.util=Pt();Xe.rpc=kc();Xe.roots=Pc();Xe.configure=Ym;function Ym(){Xe.util._configure(),Xe.Writer._configure(Xe.BufferWriter),Xe.Reader._configure(Xe.BufferReader)}Ym()});var eg=I((Tk,Zm)=>{"use strict";Zm.exports=Mc;function Mc(n,e){typeof n=="string"&&(e=n,n=void 0);var t=[];function r(s){if(typeof s!="string"){var o=i();if(Mc.verbose&&console.log("codegen: "+o),o="return "+o,s){for(var a=Object.keys(s),l=new Array(a.length+1),c=new Array(a.length),u=0;u<a.length;)l[u]=a[u],c[u]=s[a[u++]];return l[u]=o,Function.apply(null,l).apply(null,c)}return Function(o)()}for(var m=new Array(arguments.length-1),S=0;S<m.length;)m[S]=arguments[++S];if(S=0,s=s.replace(/%([%dfijs])/g,function(_,w){var C=m[S++];switch(w){case"d":case"f":return String(Number(C));case"i":return String(Math.floor(C));case"j":return JSON.stringify(C);case"s":return String(C)}return"%"}),S!==m.length)throw Error("parameter count mismatch");return t.push(s),r}function i(s){return"function "+(s||e||"")+"("+(n&&n.join(",")||"")+`){
  `+t.join(`
  `)+`
}`}return r.toString=i,r}Mc.verbose=!1});var ng=I((Ek,tg)=>{"use strict";tg.exports=Bi;var Fb=Tc(),Bb=Ec(),Lc=Bb("fs");function Bi(n,e,t){return typeof e=="function"?(t=e,e={}):e||(e={}),t?!e.xhr&&Lc&&Lc.readFile?Lc.readFile(n,function(i,s){return i&&typeof XMLHttpRequest<"u"?Bi.xhr(n,e,t):i?t(i):t(null,e.binary?s:s.toString("utf8"))}):Bi.xhr(n,e,t):Fb(Bi,this,n,e)}Bi.xhr=function(e,t,r){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===4){if(i.status!==0&&i.status!==200)return r(Error("status "+i.status));if(t.binary){var o=i.response;if(!o){o=[];for(var a=0;a<i.responseText.length;++a)o.push(i.responseText.charCodeAt(a)&255)}return r(null,typeof Uint8Array<"u"?new Uint8Array(o):o)}return r(null,i.responseText)}},t.binary&&("overrideMimeType"in i&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.responseType="arraybuffer"),i.open("GET",e),i.send()}});var sg=I(ig=>{"use strict";var Bc=ig,rg=Bc.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},Fc=Bc.normalize=function(e){e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/");var t=e.split("/"),r=rg(e),i="";r&&(i=t.shift()+"/");for(var s=0;s<t.length;)t[s]===".."?s>0&&t[s-1]!==".."?t.splice(--s,2):r?t.splice(s,1):++s:t[s]==="."?t.splice(s,1):++s;return i+t.join("/")};Bc.resolve=function(e,t,r){return r||(t=Fc(t)),rg(t)?t:(r||(e=Fc(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?Fc(e+"/"+t):t)}});var zr=I((bk,lg)=>{"use strict";lg.exports=J;var po=In();((J.prototype=Object.create(po.prototype)).constructor=J).className="Namespace";var qc=Cn(),mo=Ae(),qb=er(),Xn,Vr,Zn;J.fromJSON=function(e,t){return new J(e,t.options).addJSON(t.nested)};function og(n,e){if(n&&n.length){for(var t={},r=0;r<n.length;++r)t[n[r].name]=n[r].toJSON(e);return t}}J.arrayToJSON=og;J.isReservedId=function(e,t){if(e){for(var r=0;r<e.length;++r)if(typeof e[r]!="string"&&e[r][0]<=t&&e[r][1]>t)return!0}return!1};J.isReservedName=function(e,t){if(e){for(var r=0;r<e.length;++r)if(e[r]===t)return!0}return!1};function J(n,e){po.call(this,n,e),this.nested=void 0,this._nestedArray=null,this._lookupCache={},this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0}function ag(n){n._nestedArray=null,n._lookupCache={};for(var e=n;e=e.parent;)e._lookupCache={};return n}Object.defineProperty(J.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=mo.toArray(this.nested))}});J.prototype.toJSON=function(e){return mo.toObject(["options",this.options,"nested",og(this.nestedArray,e)])};J.prototype.addJSON=function(e){var t=this;if(e)for(var r=Object.keys(e),i=0,s;i<r.length;++i)s=e[r[i]],t.add((s.fields!==void 0?Xn.fromJSON:s.values!==void 0?Zn.fromJSON:s.methods!==void 0?Vr.fromJSON:s.id!==void 0?qc.fromJSON:J.fromJSON)(r[i],s));return this};J.prototype.get=function(e){return this.nested&&this.nested[e]||null};J.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof Zn)return this.nested[e].values;throw Error("no such enum: "+e)};J.prototype.add=function(e){if(!(e instanceof qc&&e.extend!==void 0||e instanceof Xn||e instanceof qb||e instanceof Zn||e instanceof Vr||e instanceof J))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{var t=this.get(e.name);if(t)if(t instanceof J&&e instanceof J&&!(t instanceof Xn||t instanceof Vr)){for(var r=t.nestedArray,i=0;i<r.length;++i)e.add(r[i]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}this.nested[e.name]=e,this instanceof Xn||this instanceof Vr||this instanceof Zn||this instanceof qc||e._edition||(e._edition=e._defaultEdition),this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0;for(var s=this;s=s.parent;)s._needsRecursiveFeatureResolution=!0,s._needsRecursiveResolve=!0;return e.onAdd(this),ag(this)};J.prototype.remove=function(e){if(!(e instanceof po))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),ag(this)};J.prototype.define=function(e,t){if(mo.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&e[0]==="")throw Error("path must be relative");for(var r=this;e.length>0;){var i=e.shift();if(r.nested&&r.nested[i]){if(r=r.nested[i],!(r instanceof J))throw Error("path conflicts with non-namespace objects")}else r.add(r=new J(i))}return t&&r.addJSON(t),r};J.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;this._resolveFeaturesRecursive(this._edition);var e=this.nestedArray,t=0;for(this.resolve();t<e.length;)e[t]instanceof J?e[t++].resolveAll():e[t++].resolve();return this._needsRecursiveResolve=!1,this};J.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution?(this._needsRecursiveFeatureResolution=!1,e=this._edition||e,po.prototype._resolveFeaturesRecursive.call(this,e),this.nestedArray.forEach(t=>{t._resolveFeaturesRecursive(e)}),this):this};J.prototype.lookup=function(e,t,r){if(typeof t=="boolean"?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),mo.isString(e)&&e.length){if(e===".")return this.root;e=e.split(".")}else if(!e.length)return this;var i=e.join(".");if(e[0]==="")return this.root.lookup(e.slice(1),t);var s=this.root._fullyQualifiedObjects&&this.root._fullyQualifiedObjects["."+i];if(s&&(!t||t.indexOf(s.constructor)>-1)||(s=this._lookupImpl(e,i),s&&(!t||t.indexOf(s.constructor)>-1)))return s;if(r)return null;for(var o=this;o.parent;){if(s=o.parent._lookupImpl(e,i),s&&(!t||t.indexOf(s.constructor)>-1))return s;o=o.parent}return null};J.prototype._lookupImpl=function(e,t){if(Object.prototype.hasOwnProperty.call(this._lookupCache,t))return this._lookupCache[t];var r=this.get(e[0]),i=null;if(r)e.length===1?i=r:r instanceof J&&(e=e.slice(1),i=r._lookupImpl(e,e.join(".")));else for(var s=0;s<this.nestedArray.length;++s)this._nestedArray[s]instanceof J&&(r=this._nestedArray[s]._lookupImpl(e,t))&&(i=r);return this._lookupCache[t]=i,i};J.prototype.lookupType=function(e){var t=this.lookup(e,[Xn]);if(!t)throw Error("no such type: "+e);return t};J.prototype.lookupEnum=function(e){var t=this.lookup(e,[Zn]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t};J.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[Xn,Zn]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t};J.prototype.lookupService=function(e){var t=this.lookup(e,[Vr]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t};J._configure=function(n,e,t){Xn=n,Vr=e,Zn=t}});var go=I((wk,cg)=>{"use strict";cg.exports=en;var Uc=Cn();((en.prototype=Object.create(Uc.prototype)).constructor=en).className="MapField";var Ub=tr(),qi=Ae();function en(n,e,t,r,i,s){if(Uc.call(this,n,e,r,void 0,void 0,i,s),!qi.isString(t))throw TypeError("keyType must be a string");this.keyType=t,this.resolvedKeyType=null,this.map=!0}en.fromJSON=function(e,t){return new en(e,t.id,t.keyType,t.type,t.options,t.comment)};en.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return qi.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};en.prototype.resolve=function(){if(this.resolved)return this;if(Ub.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return Uc.prototype.resolve.call(this)};en.d=function(e,t,r){return typeof r=="function"?r=qi.decorateType(r).name:r&&typeof r=="object"&&(r=qi.decorateEnum(r).name),function(s,o){qi.decorateType(s.constructor).add(new en(o,e,t,r))}}});var yo=I((Ck,ug)=>{"use strict";ug.exports=nr;var Vc=In();((nr.prototype=Object.create(Vc.prototype)).constructor=nr).className="Method";var Gr=Ae();function nr(n,e,t,r,i,s,o,a,l){if(Gr.isObject(i)?(o=i,i=s=void 0):Gr.isObject(s)&&(o=s,s=void 0),!(e===void 0||Gr.isString(e)))throw TypeError("type must be a string");if(!Gr.isString(t))throw TypeError("requestType must be a string");if(!Gr.isString(r))throw TypeError("responseType must be a string");Vc.call(this,n,o),this.type=e||"rpc",this.requestType=t,this.requestStream=i?!0:void 0,this.responseType=r,this.responseStream=s?!0:void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=a,this.parsedOptions=l}nr.fromJSON=function(e,t){return new nr(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)};nr.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Gr.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])};nr.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),Vc.prototype.resolve.call(this))}});var vo=I((Ik,hg)=>{"use strict";hg.exports=tt;var tn=zr();((tt.prototype=Object.create(tn.prototype)).constructor=tt).className="Service";var zc=yo(),Ui=Ae(),Vb=kc();function tt(n,e){tn.call(this,n,e),this.methods={},this._methodsArray=null}tt.fromJSON=function(e,t){var r=new tt(e,t.options);if(t.methods)for(var i=Object.keys(t.methods),s=0;s<i.length;++s)r.add(zc.fromJSON(i[s],t.methods[i[s]]));return t.nested&&r.addJSON(t.nested),t.edition&&(r._edition=t.edition),r.comment=t.comment,r._defaultEdition="proto3",r};tt.prototype.toJSON=function(e){var t=tn.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return Ui.toObject(["edition",this._editionToJSON(),"options",t&&t.options||void 0,"methods",tn.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};Object.defineProperty(tt.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=Ui.toArray(this.methods))}});function dg(n){return n._methodsArray=null,n}tt.prototype.get=function(e){return this.methods[e]||tn.prototype.get.call(this,e)};tt.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;tn.prototype.resolve.call(this);for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return this};tt.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution?(e=this._edition||e,tn.prototype._resolveFeaturesRecursive.call(this,e),this.methodsArray.forEach(t=>{t._resolveFeaturesRecursive(e)}),this):this};tt.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof zc?(this.methods[e.name]=e,e.parent=this,dg(this)):tn.prototype.add.call(this,e)};tt.prototype.remove=function(e){if(e instanceof zc){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,dg(this)}return tn.prototype.remove.call(this,e)};tt.prototype.create=function(e,t,r){for(var i=new Vb.Service(e,t,r),s=0,o;s<this.methodsArray.length;++s){var a=Ui.lcFirst((o=this._methodsArray[s]).resolve().name).replace(/[^$\w_]/g,"");i[a]=Ui.codegen(["r","c"],Ui.isReserved(a)?a+"_":a)("return this.rpcCall(m,q,s,r,c)")({m:o,q:o.resolvedRequestType.ctor,s:o.resolvedResponseType.ctor})}return i}});var So=I((Rk,fg)=>{"use strict";fg.exports=Lt;var zb=Pt();function Lt(n){if(n)for(var e=Object.keys(n),t=0;t<e.length;++t)this[e[t]]=n[e[t]]}Lt.create=function(e){return this.$type.create(e)};Lt.encode=function(e,t){return this.$type.encode(e,t)};Lt.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)};Lt.decode=function(e){return this.$type.decode(e)};Lt.decodeDelimited=function(e){return this.$type.decodeDelimited(e)};Lt.verify=function(e){return this.$type.verify(e)};Lt.fromObject=function(e){return this.$type.fromObject(e)};Lt.toObject=function(e,t){return this.$type.toObject(e,t)};Lt.prototype.toJSON=function(){return this.$type.toObject(this,zb.toJSONOptions)}});var Gc=I((Dk,mg)=>{"use strict";mg.exports=$b;var Gb=wt(),nn=tr(),pg=Ae();function jb(n){return"missing required '"+n.name+"'"}function $b(n){for(var e=pg.codegen(["r","l","e"],n.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(n.fieldsArray.filter(function(a){return a.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()")("if(t===e)")("break")("switch(t>>>3){"),t=0;t<n.fieldsArray.length;++t){var r=n._fieldsArray[t].resolve(),i=r.resolvedType instanceof Gb?"int32":r.type,s="m"+pg.safeProp(r.name);e("case %i: {",r.id),r.map?(e("if(%s===util.emptyObject)",s)("%s={}",s)("var c2 = r.uint32()+r.pos"),nn.defaults[r.keyType]!==void 0?e("k=%j",nn.defaults[r.keyType]):e("k=null"),nn.defaults[i]!==void 0?e("value=%j",nn.defaults[i]):e("value=null"),e("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",r.keyType)("case 2:"),nn.basic[i]===void 0?e("value=types[%i].decode(r,r.uint32())",t):e("value=r.%s()",i),e("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),nn.long[r.keyType]!==void 0?e('%s[typeof k==="object"?util.longToHash(k):k]=value',s):e("%s[k]=value",s)):r.repeated?(e("if(!(%s&&%s.length))",s,s)("%s=[]",s),nn.packed[i]!==void 0&&e("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,i)("}else"),nn.basic[i]===void 0?e(r.delimited?"%s.push(types[%i].decode(r,undefined,((t&~7)|4)))":"%s.push(types[%i].decode(r,r.uint32()))",s,t):e("%s.push(r.%s())",s,i)):nn.basic[i]===void 0?e(r.delimited?"%s=types[%i].decode(r,undefined,((t&~7)|4))":"%s=types[%i].decode(r,r.uint32())",s,t):e("%s=r.%s()",s,i),e("break")("}")}for(e("default:")("r.skipType(t&7)")("break")("}")("}"),t=0;t<n._fieldsArray.length;++t){var o=n._fieldsArray[t];o.required&&e("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",jb(o))}return e("return m")}});var Kc=I((Ak,gg)=>{"use strict";gg.exports=Hb;var Kb=wt(),jc=Ae();function pt(n,e){return n.name+": "+e+(n.repeated&&e!=="array"?"[]":n.map&&e!=="object"?"{k:"+n.keyType+"}":"")+" expected"}function $c(n,e,t,r){if(e.resolvedType)if(e.resolvedType instanceof Kb){n("switch(%s){",r)("default:")("return%j",pt(e,"enum value"));for(var i=Object.keys(e.resolvedType.values),s=0;s<i.length;++s)n("case %i:",e.resolvedType.values[i[s]]);n("break")("}")}else n("{")("var e=types[%i].verify(%s);",t,r)("if(e)")("return%j+e",e.name+".")("}");else switch(e.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.isInteger(%s))",r)("return%j",pt(e,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",r,r,r,r)("return%j",pt(e,"integer|Long"));break;case"float":case"double":n('if(typeof %s!=="number")',r)("return%j",pt(e,"number"));break;case"bool":n('if(typeof %s!=="boolean")',r)("return%j",pt(e,"boolean"));break;case"string":n("if(!util.isString(%s))",r)("return%j",pt(e,"string"));break;case"bytes":n('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',r,r,r)("return%j",pt(e,"buffer"));break}return n}function Wb(n,e,t){switch(e.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.key32Re.test(%s))",t)("return%j",pt(e,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.key64Re.test(%s))",t)("return%j",pt(e,"integer|Long key"));break;case"bool":n("if(!util.key2Re.test(%s))",t)("return%j",pt(e,"boolean key"));break}return n}function Hb(n){var e=jc.codegen(["m"],n.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),t=n.oneofsArray,r={};t.length&&e("var p={}");for(var i=0;i<n.fieldsArray.length;++i){var s=n._fieldsArray[i].resolve(),o="m"+jc.safeProp(s.name);if(s.optional&&e("if(%s!=null&&m.hasOwnProperty(%j)){",o,s.name),s.map)e("if(!util.isObject(%s))",o)("return%j",pt(s,"object"))("var k=Object.keys(%s)",o)("for(var i=0;i<k.length;++i){"),Wb(e,s,"k[i]"),$c(e,s,i,o+"[k[i]]")("}");else if(s.repeated)e("if(!Array.isArray(%s))",o)("return%j",pt(s,"array"))("for(var i=0;i<%s.length;++i){",o),$c(e,s,i,o+"[i]")("}");else{if(s.partOf){var a=jc.safeProp(s.partOf.name);r[s.partOf.name]===1&&e("if(p%s===1)",a)("return%j",s.partOf.name+": multiple values"),r[s.partOf.name]=1,e("p%s=1",a)}$c(e,s,i,o)}s.optional&&e("}")}return e("return null")}});var Qc=I(vg=>{"use strict";var yg=vg,Vi=wt(),Ft=Ae();function Wc(n,e,t,r){var i=!1;if(e.resolvedType)if(e.resolvedType instanceof Vi){n("switch(d%s){",r);for(var s=e.resolvedType.values,o=Object.keys(s),a=0;a<o.length;++a)s[o[a]]===e.typeDefault&&!i&&(n("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',r,r,r),e.repeated||n("break"),i=!0),n("case%j:",o[a])("case %i:",s[o[a]])("m%s=%j",r,s[o[a]])("break");n("}")}else n('if(typeof d%s!=="object")',r)("throw TypeError(%j)",e.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,t,r);else{var l=!1;switch(e.type){case"double":case"float":n("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":n("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":n("m%s=d%s|0",r,r);break;case"uint64":l=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,l)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,l?"true":"");break;case"bytes":n('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length >= 0)",r)("m%s=d%s",r,r);break;case"string":n("m%s=String(d%s)",r,r);break;case"bool":n("m%s=Boolean(d%s)",r,r);break}}return n}yg.fromObject=function(e){var t=e.fieldsArray,r=Ft.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var i=0;i<t.length;++i){var s=t[i].resolve(),o=Ft.safeProp(s.name);s.map?(r("if(d%s){",o)('if(typeof d%s!=="object")',o)("throw TypeError(%j)",s.fullName+": object expected")("m%s={}",o)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",o),Wc(r,s,i,o+"[ks[i]]")("}")("}")):s.repeated?(r("if(d%s){",o)("if(!Array.isArray(d%s))",o)("throw TypeError(%j)",s.fullName+": array expected")("m%s=[]",o)("for(var i=0;i<d%s.length;++i){",o),Wc(r,s,i,o+"[i]")("}")("}")):(s.resolvedType instanceof Vi||r("if(d%s!=null){",o),Wc(r,s,i,o),s.resolvedType instanceof Vi||r("}"))}return r("return m")};function Hc(n,e,t,r){if(e.resolvedType)e.resolvedType instanceof Vi?n("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",r,t,r,r,t,r,r):n("d%s=types[%i].toObject(m%s,o)",r,t,r);else{var i=!1;switch(e.type){case"double":case"float":n("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":i=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,i?"true":"",r);break;case"bytes":n("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:n("d%s=m%s",r,r);break}}return n}yg.toObject=function(e){var t=e.fieldsArray.slice().sort(Ft.compareFieldsById);if(!t.length)return Ft.codegen()("return {}");for(var r=Ft.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),i=[],s=[],o=[],a=0;a<t.length;++a)t[a].partOf||(t[a].resolve().repeated?i:t[a].map?s:o).push(t[a]);if(i.length){for(r("if(o.arrays||o.defaults){"),a=0;a<i.length;++a)r("d%s=[]",Ft.safeProp(i[a].name));r("}")}if(s.length){for(r("if(o.objects||o.defaults){"),a=0;a<s.length;++a)r("d%s={}",Ft.safeProp(s[a].name));r("}")}if(o.length){for(r("if(o.defaults){"),a=0;a<o.length;++a){var l=o[a],c=Ft.safeProp(l.name);if(l.resolvedType instanceof Vi)r("d%s=o.enums===String?%j:%j",c,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",c)("}else")("d%s=o.longs===String?%j:%i",c,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){var u="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",c,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",c,u)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",c,c)("}")}else r("d%s=%j",c,l.typeDefault)}r("}")}var m=!1;for(a=0;a<t.length;++a){var l=t[a],S=e._fieldsArray.indexOf(l),c=Ft.safeProp(l.name);l.map?(m||(m=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",c,c)("d%s={}",c)("for(var j=0;j<ks2.length;++j){"),Hc(r,l,S,c+"[ks2[j]]")("}")):l.repeated?(r("if(m%s&&m%s.length){",c,c)("d%s=[]",c)("for(var j=0;j<m%s.length;++j){",c),Hc(r,l,S,c+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",c,l.name),Hc(r,l,S,c),l.partOf&&r("if(o.oneofs)")("d%s=%j",Ft.safeProp(l.partOf.name),l.name)),r("}")}return r("return d")}});var Yc=I(Sg=>{"use strict";var Qb=Sg,Yb=So();Qb[".google.protobuf.Any"]={fromObject:function(n){if(n&&n["@type"]){var e=n["@type"].substring(n["@type"].lastIndexOf("/")+1),t=this.lookup(e);if(t){var r=n["@type"].charAt(0)==="."?n["@type"].slice(1):n["@type"];return r.indexOf("/")===-1&&(r="/"+r),this.create({type_url:r,value:t.encode(t.fromObject(n)).finish()})}}return this.fromObject(n)},toObject:function(n,e){var t="type.googleapis.com/",r="",i="";if(e&&e.json&&n.type_url&&n.value){i=n.type_url.substring(n.type_url.lastIndexOf("/")+1),r=n.type_url.substring(0,n.type_url.lastIndexOf("/")+1);var s=this.lookup(i);s&&(n=s.decode(n.value))}if(!(n instanceof this.ctor)&&n instanceof Yb){var o=n.$type.toObject(n,e),a=n.$type.fullName[0]==="."?n.$type.fullName.slice(1):n.$type.fullName;return r===""&&(r=t),i=r+a,o["@type"]=i,o}return this.toObject(n,e)}}});var _o=I((xk,Eg)=>{"use strict";Eg.exports=oe;var mt=zr();((oe.prototype=Object.create(mt.prototype)).constructor=oe).className="Type";var Jb=wt(),Zc=er(),To=Cn(),Xb=go(),Zb=vo(),Jc=So(),Xc=fo(),e0=uo(),Be=Ae(),t0=eu(),n0=Gc(),r0=Kc(),Tg=Qc(),i0=Yc();function oe(n,e){mt.call(this,n,e),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}Object.defineProperties(oe.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var n=Object.keys(this.fields),e=0;e<n.length;++e){var t=this.fields[n[e]],r=t.id;if(this._fieldsById[r])throw Error("duplicate id "+r+" in "+this);this._fieldsById[r]=t}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=Be.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=Be.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=oe.generateConstructor(this)())},set:function(n){var e=n.prototype;e instanceof Jc||((n.prototype=new Jc).constructor=n,Be.merge(n.prototype,e)),n.$type=n.prototype.$type=this,Be.merge(n,Jc,!0),this._ctor=n;for(var t=0;t<this.fieldsArray.length;++t)this._fieldsArray[t].resolve();var r={};for(t=0;t<this.oneofsArray.length;++t)r[this._oneofsArray[t].resolve().name]={get:Be.oneOfGetter(this._oneofsArray[t].oneof),set:Be.oneOfSetter(this._oneofsArray[t].oneof)};t&&Object.defineProperties(n.prototype,r)}}});oe.generateConstructor=function(e){for(var t=Be.codegen(["p"],e.name),r=0,i;r<e.fieldsArray.length;++r)(i=e._fieldsArray[r]).map?t("this%s={}",Be.safeProp(i.name)):i.repeated&&t("this%s=[]",Be.safeProp(i.name));return t("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")};function Eo(n){return n._fieldsById=n._fieldsArray=n._oneofsArray=null,delete n.encode,delete n.decode,delete n.verify,n}oe.fromJSON=function(e,t){var r=new oe(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var i=Object.keys(t.fields),s=0;s<i.length;++s)r.add((typeof t.fields[i[s]].keyType<"u"?Xb.fromJSON:To.fromJSON)(i[s],t.fields[i[s]]));if(t.oneofs)for(i=Object.keys(t.oneofs),s=0;s<i.length;++s)r.add(Zc.fromJSON(i[s],t.oneofs[i[s]]));if(t.nested)for(i=Object.keys(t.nested),s=0;s<i.length;++s){var o=t.nested[i[s]];r.add((o.id!==void 0?To.fromJSON:o.fields!==void 0?oe.fromJSON:o.values!==void 0?Jb.fromJSON:o.methods!==void 0?Zb.fromJSON:mt.fromJSON)(i[s],o))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r};oe.prototype.toJSON=function(e){var t=mt.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return Be.toObject(["edition",this._editionToJSON(),"options",t&&t.options||void 0,"oneofs",mt.arrayToJSON(this.oneofsArray,e),"fields",mt.arrayToJSON(this.fieldsArray.filter(function(i){return!i.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};oe.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;mt.prototype.resolveAll.call(this);var e=this.oneofsArray;for(r=0;r<e.length;)e[r++].resolve();for(var t=this.fieldsArray,r=0;r<t.length;)t[r++].resolve();return this};oe.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution?(e=this._edition||e,mt.prototype._resolveFeaturesRecursive.call(this,e),this.oneofsArray.forEach(t=>{t._resolveFeatures(e)}),this.fieldsArray.forEach(t=>{t._resolveFeatures(e)}),this):this};oe.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null};oe.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof To&&e.extend===void 0){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),Eo(this)}return e instanceof Zc?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),Eo(this)):mt.prototype.add.call(this,e)};oe.prototype.remove=function(e){if(e instanceof To&&e.extend===void 0){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),Eo(this)}if(e instanceof Zc){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),Eo(this)}return mt.prototype.remove.call(this,e)};oe.prototype.isReservedId=function(e){return mt.isReservedId(this.reserved,e)};oe.prototype.isReservedName=function(e){return mt.isReservedName(this.reserved,e)};oe.prototype.create=function(e){return new this.ctor(e)};oe.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=t0(this)({Writer:e0,types:t,util:Be}),this.decode=n0(this)({Reader:Xc,types:t,util:Be}),this.verify=r0(this)({types:t,util:Be}),this.fromObject=Tg.fromObject(this)({types:t,util:Be}),this.toObject=Tg.toObject(this)({types:t,util:Be});var i=i0[e];if(i){var s=Object.create(this);s.fromObject=this.fromObject,this.fromObject=i.fromObject.bind(s),s.toObject=this.toObject,this.toObject=i.toObject.bind(s)}return this};oe.prototype.encode=function(e,t){return this.setup().encode(e,t)};oe.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()};oe.prototype.decode=function(e,t){return this.setup().decode(e,t)};oe.prototype.decodeDelimited=function(e){return e instanceof Xc||(e=Xc.create(e)),this.decode(e,e.uint32())};oe.prototype.verify=function(e){return this.setup().verify(e)};oe.prototype.fromObject=function(e){return this.setup().fromObject(e)};oe.prototype.toObject=function(e,t){return this.setup().toObject(e,t)};oe.d=function(e){return function(r){Be.decorateType(r,e)}}});var Io=I((kk,wg)=>{"use strict";wg.exports=nt;var Co=zr();((nt.prototype=Object.create(Co.prototype)).constructor=nt).className="Root";var bo=Cn(),tu=wt(),s0=er(),Rn=Ae(),nu,ru,zi;function nt(n){Co.call(this,"",n),this.deferred=[],this.files=[],this._edition="proto2",this._fullyQualifiedObjects={}}nt.fromJSON=function(e,t){return t||(t=new nt),e.options&&t.setOptions(e.options),t.addJSON(e.nested).resolveAll()};nt.prototype.resolvePath=Rn.path.resolve;nt.prototype.fetch=Rn.fetch;function bg(){}nt.prototype.load=function n(e,t,r){typeof t=="function"&&(r=t,t=void 0);var i=this;if(!r)return Rn.asPromise(n,i,e,t);var s=r===bg;function o(E,_){if(r){if(s)throw E;_&&_.resolveAll();var w=r;r=null,w(E,_)}}function a(E){var _=E.lastIndexOf("google/protobuf/");if(_>-1){var w=E.substring(_);if(w in zi)return w}return null}function l(E,_){try{if(Rn.isString(_)&&_.charAt(0)==="{"&&(_=JSON.parse(_)),!Rn.isString(_))i.setOptions(_.options).addJSON(_.nested);else{ru.filename=E;var w=ru(_,i,t),C,k=0;if(w.imports)for(;k<w.imports.length;++k)(C=a(w.imports[k])||i.resolvePath(E,w.imports[k]))&&c(C);if(w.weakImports)for(k=0;k<w.weakImports.length;++k)(C=a(w.weakImports[k])||i.resolvePath(E,w.weakImports[k]))&&c(C,!0)}}catch(P){o(P)}!s&&!u&&o(null,i)}function c(E,_){if(E=a(E)||E,!(i.files.indexOf(E)>-1)){if(i.files.push(E),E in zi){s?l(E,zi[E]):(++u,setTimeout(function(){--u,l(E,zi[E])}));return}if(s){var w;try{w=Rn.fs.readFileSync(E).toString("utf8")}catch(C){_||o(C);return}l(E,w)}else++u,i.fetch(E,function(C,k){if(--u,!!r){if(C){_?u||o(null,i):o(C);return}l(E,k)}})}}var u=0;Rn.isString(e)&&(e=[e]);for(var m=0,S;m<e.length;++m)(S=i.resolvePath("",e[m]))&&c(S);return s?(i.resolveAll(),i):(u||o(null,i),i)};nt.prototype.loadSync=function(e,t){if(!Rn.isNode)throw Error("not supported");return this.load(e,t,bg)};nt.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return Co.prototype.resolveAll.call(this)};var wo=/^[A-Z]/;function _g(n,e){var t=e.parent.lookup(e.extend);if(t){var r=new bo(e.fullName,e.id,e.type,e.rule,void 0,e.options);return t.get(r.name)||(r.declaringField=e,e.extensionField=r,t.add(r)),!0}return!1}nt.prototype._handleAdd=function(e){if(e instanceof bo)e.extend!==void 0&&!e.extensionField&&(_g(this,e)||this.deferred.push(e));else if(e instanceof tu)wo.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof s0)){if(e instanceof nu)for(var t=0;t<this.deferred.length;)_g(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);wo.test(e.name)&&(e.parent[e.name]=e)}(e instanceof nu||e instanceof tu||e instanceof bo)&&(this._fullyQualifiedObjects[e.fullName]=e)};nt.prototype._handleRemove=function(e){if(e instanceof bo){if(e.extend!==void 0)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof tu)wo.test(e.name)&&delete e.parent[e.name];else if(e instanceof Co){for(var r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);wo.test(e.name)&&delete e.parent[e.name]}delete this._fullyQualifiedObjects[e.fullName]};nt._configure=function(n,e,t){nu=n,ru=e,zi=t}});var Ae=I((Pk,Ig)=>{"use strict";var ve=Ig.exports=Pt(),Cg=Pc(),iu,su;ve.codegen=eg();ve.fetch=ng();ve.path=sg();ve.fs=ve.inquire("fs");ve.toArray=function(e){if(e){for(var t=Object.keys(e),r=new Array(t.length),i=0;i<t.length;)r[i]=e[t[i++]];return r}return[]};ve.toObject=function(e){for(var t={},r=0;r<e.length;){var i=e[r++],s=e[r++];s!==void 0&&(t[i]=s)}return t};var o0=/\\/g,a0=/"/g;ve.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)};ve.safeProp=function(e){return!/^[$\w_]+$/.test(e)||ve.isReserved(e)?'["'+e.replace(o0,"\\\\").replace(a0,'\\"')+'"]':"."+e};ve.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var l0=/_([a-z])/g;ve.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(l0,function(t,r){return r.toUpperCase()})};ve.compareFieldsById=function(e,t){return e.id-t.id};ve.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(ve.decorateRoot.remove(e.$type),e.$type.name=t,ve.decorateRoot.add(e.$type)),e.$type;iu||(iu=_o());var r=new iu(t||e.name);return ve.decorateRoot.add(r),r.ctor=e,Object.defineProperty(e,"$type",{value:r,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:r,enumerable:!1}),r};var c0=0;ve.decorateEnum=function(e){if(e.$type)return e.$type;su||(su=wt());var t=new su("Enum"+c0++,e);return ve.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t};ve.setProperty=function(e,t,r,i){function s(o,a,l){var c=a.shift();if(c==="__proto__"||c==="prototype")return o;if(a.length>0)o[c]=s(o[c]||{},a,l);else{var u=o[c];if(u&&i)return o;u&&(l=[].concat(u).concat(l)),o[c]=l}return o}if(typeof e!="object")throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return t=t.split("."),s(e,t,r)};Object.defineProperty(ve,"decorateRoot",{get:function(){return Cg.decorated||(Cg.decorated=new(Io()))}})});var tr=I(Rg=>{"use strict";var Gi=Rg,u0=Ae(),d0=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function ji(n,e){var t=0,r={};for(e|=0;t<n.length;)r[d0[t+e]]=n[t++];return r}Gi.basic=ji([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]);Gi.defaults=ji([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",u0.emptyArray,null]);Gi.long=ji([0,0,0,1,1],7);Gi.mapKey=ji([0,0,0,5,5,0,0,0,1,1,0,2],2);Gi.packed=ji([1,5,0,0,0,5,5,0,0,0,1,1,0])});var Cn=I((Lk,Ag)=>{"use strict";Ag.exports=Ne;var Ki=In();((Ne.prototype=Object.create(Ki.prototype)).constructor=Ne).className="Field";var Dg=wt(),ou=tr(),Ee=Ae(),$i,h0=/^required|optional|repeated$/;Ne.fromJSON=function(e,t){var r=new Ne(e,t.id,t.type,t.rule,t.extend,t.options,t.comment);return t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r};function Ne(n,e,t,r,i,s,o){if(Ee.isObject(r)?(o=i,s=r,r=i=void 0):Ee.isObject(i)&&(o=s,s=i,i=void 0),Ki.call(this,n,s),!Ee.isInteger(e)||e<0)throw TypeError("id must be a non-negative integer");if(!Ee.isString(t))throw TypeError("type must be a string");if(r!==void 0&&!h0.test(r=r.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(i!==void 0&&!Ee.isString(i))throw TypeError("extend must be a string");r==="proto3_optional"&&(r="optional"),this.rule=r&&r!=="optional"?r:void 0,this.type=t,this.id=e,this.extend=i||void 0,this.repeated=r==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=Ee.Long?ou.long[t]!==void 0:!1,this.bytes=t==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this.comment=o}Object.defineProperty(Ne.prototype,"required",{get:function(){return this._features.field_presence==="LEGACY_REQUIRED"}});Object.defineProperty(Ne.prototype,"optional",{get:function(){return!this.required}});Object.defineProperty(Ne.prototype,"delimited",{get:function(){return this.resolvedType instanceof $i&&this._features.message_encoding==="DELIMITED"}});Object.defineProperty(Ne.prototype,"packed",{get:function(){return this._features.repeated_field_encoding==="PACKED"}});Object.defineProperty(Ne.prototype,"hasPresence",{get:function(){return this.repeated||this.map?!1:this.partOf||this.declaringField||this.extensionField||this._features.field_presence!=="IMPLICIT"}});Ne.prototype.setOption=function(e,t,r){return Ki.prototype.setOption.call(this,e,t,r)};Ne.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Ee.toObject(["edition",this._editionToJSON(),"rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};Ne.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=ou.defaults[this.type])===void 0?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof $i?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof Dg&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof Dg)&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=Ee.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var e;Ee.base64.test(this.typeDefault)?Ee.base64.decode(this.typeDefault,e=Ee.newBuffer(Ee.base64.length(this.typeDefault)),0):Ee.utf8.write(this.typeDefault,e=Ee.newBuffer(Ee.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=Ee.emptyObject:this.repeated?this.defaultValue=Ee.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof $i&&(this.parent.ctor.prototype[this.name]=this.defaultValue),Ki.prototype.resolve.call(this)};Ne.prototype._inferLegacyProtoFeatures=function(e){if(e!=="proto2"&&e!=="proto3")return{};var t={};if(this.rule==="required"&&(t.field_presence="LEGACY_REQUIRED"),this.parent&&ou.defaults[this.type]===void 0){var r=this.parent.get(this.type.split(".").pop());r&&r instanceof $i&&r.group&&(t.message_encoding="DELIMITED")}return this.getOption("packed")===!0?t.repeated_field_encoding="PACKED":this.getOption("packed")===!1&&(t.repeated_field_encoding="EXPANDED"),t};Ne.prototype._resolveFeatures=function(e){return Ki.prototype._resolveFeatures.call(this,this._edition||e)};Ne.d=function(e,t,r,i){return typeof t=="function"?t=Ee.decorateType(t).name:t&&typeof t=="object"&&(t=Ee.decorateEnum(t).name),function(o,a){Ee.decorateType(o.constructor).add(new Ne(a,e,t,r,{default:i}))}};Ne._configure=function(e){$i=e}});var er=I((Fk,xg)=>{"use strict";xg.exports=rt;var Do=In();((rt.prototype=Object.create(Do.prototype)).constructor=rt).className="OneOf";var Ng=Cn(),Ro=Ae();function rt(n,e,t,r){if(Array.isArray(e)||(t=e,e=void 0),Do.call(this,n,t),!(e===void 0||Array.isArray(e)))throw TypeError("fieldNames must be an Array");this.oneof=e||[],this.fieldsArray=[],this.comment=r}rt.fromJSON=function(e,t){return new rt(e,t.oneof,t.options,t.comment)};rt.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Ro.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])};function Og(n){if(n.parent)for(var e=0;e<n.fieldsArray.length;++e)n.fieldsArray[e].parent||n.parent.add(n.fieldsArray[e])}rt.prototype.add=function(e){if(!(e instanceof Ng))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,Og(this),this};rt.prototype.remove=function(e){if(!(e instanceof Ng))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),t=this.oneof.indexOf(e.name),t>-1&&this.oneof.splice(t,1),e.partOf=null,this};rt.prototype.onAdd=function(e){Do.prototype.onAdd.call(this,e);for(var t=this,r=0;r<this.oneof.length;++r){var i=e.get(this.oneof[r]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}Og(this)};rt.prototype.onRemove=function(e){for(var t=0,r;t<this.fieldsArray.length;++t)(r=this.fieldsArray[t]).parent&&r.parent.remove(r);Do.prototype.onRemove.call(this,e)};Object.defineProperty(rt.prototype,"isProto3Optional",{get:function(){if(this.fieldsArray==null||this.fieldsArray.length!==1)return!1;var n=this.fieldsArray[0];return n.options!=null&&n.options.proto3_optional===!0}});rt.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(i,s){Ro.decorateType(i.constructor).add(new rt(s,e)),Object.defineProperty(i,s,{get:Ro.oneOfGetter(e),set:Ro.oneOfSetter(e)})}}});var In=I((Bk,kg)=>{"use strict";kg.exports=Pe;Pe.className="ReflectionObject";var f0=er(),Wi=Ae(),Ao,p0={enum_type:"OPEN",field_presence:"EXPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"},m0={enum_type:"CLOSED",field_presence:"EXPLICIT",json_format:"LEGACY_BEST_EFFORT",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"EXPANDED",utf8_validation:"NONE"},g0={enum_type:"OPEN",field_presence:"IMPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"};function Pe(n,e){if(!Wi.isString(n))throw TypeError("name must be a string");if(e&&!Wi.isObject(e))throw TypeError("options must be an object");this.options=e,this.parsedOptions=null,this.name=n,this._edition=null,this._defaultEdition="proto2",this._features={},this._featuresResolved=!1,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(Pe.prototype,{root:{get:function(){for(var n=this;n.parent!==null;)n=n.parent;return n}},fullName:{get:function(){for(var n=[this.name],e=this.parent;e;)n.unshift(e.name),e=e.parent;return n.join(".")}}});Pe.prototype.toJSON=function(){throw Error()};Pe.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof Ao&&t._handleAdd(this)};Pe.prototype.onRemove=function(e){var t=e.root;t instanceof Ao&&t._handleRemove(this),this.parent=null,this.resolved=!1};Pe.prototype.resolve=function(){return this.resolved?this:(this.root instanceof Ao&&(this.resolved=!0),this)};Pe.prototype._resolveFeaturesRecursive=function(e){return this._resolveFeatures(this._edition||e)};Pe.prototype._resolveFeatures=function(e){if(!this._featuresResolved){var t={};if(!e)throw new Error("Unknown edition for "+this.fullName);var r=Object.assign(this.options?Object.assign({},this.options.features):{},this._inferLegacyProtoFeatures(e));if(this._edition){if(e==="proto2")t=Object.assign({},m0);else if(e==="proto3")t=Object.assign({},g0);else if(e==="2023")t=Object.assign({},p0);else throw new Error("Unknown edition: "+e);this._features=Object.assign(t,r||{}),this._featuresResolved=!0;return}if(this.partOf instanceof f0){var i=Object.assign({},this.partOf._features);this._features=Object.assign(i,r||{})}else if(!this.declaringField)if(this.parent){var s=Object.assign({},this.parent._features);this._features=Object.assign(s,r||{})}else throw new Error("Unable to find a parent for "+this.fullName);this.extensionField&&(this.extensionField._features=this._features),this._featuresResolved=!0}};Pe.prototype._inferLegacyProtoFeatures=function(){return{}};Pe.prototype.getOption=function(e){if(this.options)return this.options[e]};Pe.prototype.setOption=function(e,t,r){return this.options||(this.options={}),/^features\./.test(e)?Wi.setProperty(this.options,e,t,r):(!r||this.options[e]===void 0)&&(this.getOption(e)!==t&&(this.resolved=!1),this.options[e]=t),this};Pe.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var i=this.parsedOptions;if(r){var s=i.find(function(l){return Object.prototype.hasOwnProperty.call(l,e)});if(s){var o=s[e];Wi.setProperty(o,r,t)}else s={},s[e]=Wi.setProperty({},r,t),i.push(s)}else{var a={};a[e]=t,i.push(a)}return this};Pe.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)this.setOption(r[i],e[r[i]],t);return this};Pe.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e};Pe.prototype._editionToJSON=function(){if(!(!this._edition||this._edition==="proto3"))return this._edition};Pe._configure=function(n){Ao=n}});var wt=I((qk,Mg)=>{"use strict";Mg.exports=Ct;var au=In();((Ct.prototype=Object.create(au.prototype)).constructor=Ct).className="Enum";var Pg=zr(),No=Ae();function Ct(n,e,t,r,i,s){if(au.call(this,n,t),e&&typeof e!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=r,this.comments=i||{},this.valuesOptions=s,this._valuesFeatures={},this.reserved=void 0,e)for(var o=Object.keys(e),a=0;a<o.length;++a)typeof e[o[a]]=="number"&&(this.valuesById[this.values[o[a]]=e[o[a]]]=o[a])}Ct.prototype._resolveFeatures=function(e){return e=this._edition||e,au.prototype._resolveFeatures.call(this,e),Object.keys(this.values).forEach(t=>{var r=Object.assign({},this._features);this._valuesFeatures[t]=Object.assign(r,this.valuesOptions&&this.valuesOptions[t]&&this.valuesOptions[t].features)}),this};Ct.fromJSON=function(e,t){var r=new Ct(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r};Ct.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return No.toObject(["edition",this._editionToJSON(),"options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])};Ct.prototype.add=function(e,t,r,i){if(!No.isString(e))throw TypeError("name must be a string");if(!No.isInteger(t))throw TypeError("id must be an integer");if(this.values[e]!==void 0)throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(this.valuesById[t]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return i&&(this.valuesOptions===void 0&&(this.valuesOptions={}),this.valuesOptions[e]=i||null),this.comments[e]=r||null,this};Ct.prototype.remove=function(e){if(!No.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(t==null)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this};Ct.prototype.isReservedId=function(e){return Pg.isReservedId(this.reserved,e)};Ct.prototype.isReservedName=function(e){return Pg.isReservedName(this.reserved,e)}});var eu=I((Uk,Fg)=>{"use strict";Fg.exports=v0;var y0=wt(),lu=tr(),cu=Ae();function Lg(n,e,t,r){return e.delimited?n("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",t,r,(e.id<<3|3)>>>0,(e.id<<3|4)>>>0):n("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",t,r,(e.id<<3|2)>>>0)}function v0(n){for(var e=cu.codegen(["m","w"],n.name+"$encode")("if(!w)")("w=Writer.create()"),t,r,i=n.fieldsArray.slice().sort(cu.compareFieldsById),t=0;t<i.length;++t){var s=i[t].resolve(),o=n._fieldsArray.indexOf(s),a=s.resolvedType instanceof y0?"int32":s.type,l=lu.basic[a];r="m"+cu.safeProp(s.name),s.map?(e("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",r,s.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(s.id<<3|2)>>>0,8|lu.mapKey[s.keyType],s.keyType),l===void 0?e("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",o,r):e(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|l,a,r),e("}")("}")):s.repeated?(e("if(%s!=null&&%s.length){",r,r),s.packed&&lu.packed[a]!==void 0?e("w.uint32(%i).fork()",(s.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",a,r)("w.ldelim()"):(e("for(var i=0;i<%s.length;++i)",r),l===void 0?Lg(e,s,o,r+"[i]"):e("w.uint32(%i).%s(%s[i])",(s.id<<3|l)>>>0,a,r)),e("}")):(s.optional&&e("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",r,s.name),l===void 0?Lg(e,s,o,r):e("w.uint32(%i).%s(%s)",(s.id<<3|l)>>>0,a,r))}return e("return w")}});var qg=I((Vk,Bg)=>{"use strict";var X=Bg.exports=Xm();X.build="light";function S0(n,e,t){return typeof e=="function"?(t=e,e=new X.Root):e||(e=new X.Root),e.load(n,t)}X.load=S0;function T0(n,e){return e||(e=new X.Root),e.loadSync(n)}X.loadSync=T0;X.encoder=eu();X.decoder=Gc();X.verifier=Kc();X.converter=Qc();X.ReflectionObject=In();X.Namespace=zr();X.Root=Io();X.Enum=wt();X.Type=_o();X.Field=Cn();X.OneOf=er();X.MapField=go();X.Service=vo();X.Method=yo();X.Message=So();X.wrappers=Yc();X.types=tr();X.util=Ae();X.ReflectionObject._configure(X.Root);X.Namespace._configure(X.Type,X.Service,X.Enum);X.Root._configure(X.Type);X.Field._configure(X.Type)});var du=I((zk,zg)=>{"use strict";zg.exports=Vg;var uu=/[\s{}=;:[\],'"()<>]/g,E0=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,_0=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,b0=/^ *[*/]+ */,w0=/^\s*\*?\/*/,C0=/\n/g,I0=/\s/,R0=/\\(.?)/g,D0={0:"\0",r:"\r",n:`
`,t:"	"};function Ug(n){return n.replace(R0,function(e,t){switch(t){case"\\":case"":return t;default:return D0[t]||""}})}Vg.unescape=Ug;function Vg(n,e){n=n.toString();var t=0,r=n.length,i=1,s=0,o={},a=[],l=null;function c(b){return Error("illegal "+b+" (line "+i+")")}function u(){var b=l==="'"?_0:E0;b.lastIndex=t-1;var G=b.exec(n);if(!G)throw c("string");return t=b.lastIndex,C(l),l=null,Ug(G[1])}function m(b){return n.charAt(b)}function S(b,G,V){var v={type:n.charAt(b++),lineEmpty:!1,leading:V},p;e?p=2:p=3;var g=b-p,y;do if(--g<0||(y=n.charAt(g))===`
`){v.lineEmpty=!0;break}while(y===" "||y==="	");for(var h=n.substring(b,G).split(C0),T=0;T<h.length;++T)h[T]=h[T].replace(e?w0:b0,"").trim();v.text=h.join(`
`).trim(),o[i]=v,s=i}function E(b){var G=_(b),V=n.substring(b,G),v=/^\s*\/\//.test(V);return v}function _(b){for(var G=b;G<r&&m(G)!==`
`;)G++;return G}function w(){if(a.length>0)return a.shift();if(l)return u();var b,G,V,v,p,g=t===0;do{if(t===r)return null;for(b=!1;I0.test(V=m(t));)if(V===`
`&&(g=!0,++i),++t===r)return null;if(m(t)==="/"){if(++t===r)throw c("comment");if(m(t)==="/")if(e){if(v=t,p=!1,E(t-1)){p=!0;do if(t=_(t),t===r||(t++,!g))break;while(E(t))}else t=Math.min(r,_(t)+1);p&&(S(v,t,g),g=!0),i++,b=!0}else{for(p=m(v=t+1)==="/";m(++t)!==`
`;)if(t===r)return null;++t,p&&(S(v,t-1,g),g=!0),++i,b=!0}else if((V=m(t))==="*"){v=t+1,p=e||m(v)==="*";do{if(V===`
`&&++i,++t===r)throw c("comment");G=V,V=m(t)}while(G!=="*"||V!=="/");++t,p&&(S(v,t-2,g),g=!0),b=!0}else return"/"}}while(b);var y=t;uu.lastIndex=0;var h=uu.test(m(y++));if(!h)for(;y<r&&!uu.test(m(y));)++y;var T=n.substring(t,t=y);return(T==='"'||T==="'")&&(l=T),T}function C(b){a.push(b)}function k(){if(!a.length){var b=w();if(b===null)return null;C(b)}return a[0]}function P(b,G){var V=k(),v=V===b;if(v)return w(),!0;if(!G)throw c("token '"+V+"', '"+b+"' expected");return!1}function M(b){var G=null,V;return b===void 0?(V=o[i-1],delete o[i-1],V&&(e||V.type==="*"||V.lineEmpty)&&(G=V.leading?V.text:null)):(s<b&&k(),V=o[b],delete o[b],V&&!V.lineEmpty&&(e||V.type==="/")&&(G=V.leading?null:V.text)),G}return Object.defineProperty({next:w,peek:k,push:C,skip:P,cmnt:M},"line",{get:function(){return i}})}});var Hg=I((Gk,Wg)=>{"use strict";Wg.exports=rn;rn.filename=null;rn.defaults={keepCase:!1};var A0=du(),Gg=Io(),jg=_o(),$g=Cn(),N0=go(),Kg=er(),O0=wt(),x0=vo(),k0=yo(),P0=In(),M0=tr(),hu=Ae(),L0=/^[1-9][0-9]*$/,F0=/^-?[1-9][0-9]*$/,B0=/^0[x][0-9a-fA-F]+$/,q0=/^-?0[x][0-9a-fA-F]+$/,U0=/^0[0-7]+$/,V0=/^-?0[0-7]+$/,z0=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,Bt=/^[a-zA-Z_][a-zA-Z_0-9]*$/,qt=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/;function rn(n,e,t){e instanceof Gg||(t=e,e=new Gg),t||(t=rn.defaults);var r=t.preferTrailingComment||!1,i=A0(n,t.alternateCommentMode||!1),s=i.next,o=i.push,a=i.peek,l=i.skip,c=i.cmnt,u=!0,m,S,E,_="proto2",w=e,C=[],k={},P=t.keepCase?function(D){return D}:hu.camelCase;function M(){C.forEach(D=>{D._edition=_,Object.keys(k).forEach(R=>{D.getOption(R)===void 0&&D.setOption(R,k[R],!0)})})}function b(D,R,A){var B=rn.filename;return A||(rn.filename=null),Error("illegal "+(R||"token")+" '"+D+"' ("+(B?B+", ":"")+"line "+i.line+")")}function G(){var D=[],R;do{if((R=s())!=='"'&&R!=="'")throw b(R);D.push(s()),l(R),R=a()}while(R==='"'||R==="'");return D.join("")}function V(D){var R=s();switch(R){case"'":case'"':return o(R),G();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return p(R,!0)}catch{if(D&&qt.test(R))return R;throw b(R,"value")}}function v(D,R){var A,B;do if(R&&((A=a())==='"'||A==="'")){var F=G();if(D.push(F),_>=2023)throw b(F,"id")}else try{D.push([B=g(s()),l("to",!0)?g(s()):B])}catch(ue){if(R&&qt.test(A)&&_>=2023)D.push(A);else throw ue}while(l(",",!0));var $={options:void 0};$.setOption=function(ue,Le){this.options===void 0&&(this.options={}),this.options[ue]=Le},O($,function(Le){if(Le==="option")te($,Le),l(";");else throw b(Le)},function(){Yt($)})}function p(D,R){var A=1;switch(D.charAt(0)==="-"&&(A=-1,D=D.substring(1)),D){case"inf":case"INF":case"Inf":return A*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(L0.test(D))return A*parseInt(D,10);if(B0.test(D))return A*parseInt(D,16);if(U0.test(D))return A*parseInt(D,8);if(z0.test(D))return A*parseFloat(D);throw b(D,"number",R)}function g(D,R){switch(D){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!R&&D.charAt(0)==="-")throw b(D,"id");if(F0.test(D))return parseInt(D,10);if(q0.test(D))return parseInt(D,16);if(V0.test(D))return parseInt(D,8);throw b(D,"id")}function y(){if(m!==void 0)throw b("package");if(m=s(),!qt.test(m))throw b(m,"name");w=w.define(m),l(";")}function h(){var D=a(),R;switch(D){case"weak":R=E||(E=[]),s();break;case"public":s();default:R=S||(S=[]);break}D=G(),l(";"),R.push(D)}function T(){if(l("="),_=G(),_<2023)throw b(_,"syntax");l(";")}function d(){if(l("="),_=G(),!["2023"].includes(_))throw b(_,"edition");l(";")}function f(D,R){switch(R){case"option":return te(D,R),l(";"),!0;case"message":return Y(D,R),!0;case"enum":return je(D,R),!0;case"service":return UT(D,R),!0;case"extend":return zT(D,R),!0}return!1}function O(D,R,A){var B=i.line;if(D&&(typeof D.comment!="string"&&(D.comment=c()),D.filename=rn.filename),l("{",!0)){for(var F;(F=s())!=="}";)R(F);l(";",!0)}else A&&A(),l(";"),D&&(typeof D.comment!="string"||r)&&(D.comment=c(B)||D.comment)}function Y(D,R){if(!Bt.test(R=s()))throw b(R,"type name");var A=new jg(R);O(A,function(F){if(!f(A,F))switch(F){case"map":ge(A,F);break;case"required":if(_!=="proto2")throw b(F);case"repeated":Q(A,F);break;case"optional":if(_==="proto3")Q(A,"proto3_optional");else{if(_!=="proto2")throw b(F);Q(A,"optional")}break;case"oneof":Me(A,F);break;case"extensions":v(A.extensions||(A.extensions=[]));break;case"reserved":v(A.reserved||(A.reserved=[]),!0);break;default:if(_==="proto2"||!qt.test(F))throw b(F);o(F),Q(A,"optional");break}}),D.add(A),D===w&&C.push(A)}function Q(D,R,A){var B=s();if(B==="group"){se(D,R);return}for(;B.endsWith(".")||a().startsWith(".");)B+=s();if(!qt.test(B))throw b(B,"type");var F=s();if(!Bt.test(F))throw b(F,"name");F=P(F),l("=");var $=new $g(F,g(s()),B,R,A);if(O($,function(We){if(We==="option")te($,We),l(";");else throw b(We)},function(){Yt($)}),R==="proto3_optional"){var ue=new Kg("_"+F);$.setOption("proto3_optional",!0),ue.add($),D.add(ue)}else D.add($);D===w&&C.push($)}function se(D,R){if(_>=2023)throw b("group");var A=s();if(!Bt.test(A))throw b(A,"name");var B=hu.lcFirst(A);A===B&&(A=hu.ucFirst(A)),l("=");var F=g(s()),$=new jg(A);$.group=!0;var ue=new $g(B,F,A,R);ue.filename=rn.filename,O($,function(We){switch(We){case"option":te($,We),l(";");break;case"required":case"repeated":Q($,We);break;case"optional":_==="proto3"?Q($,"proto3_optional"):Q($,"optional");break;case"message":Y($,We);break;case"enum":je($,We);break;case"reserved":v($.reserved||($.reserved=[]),!0);break;default:throw b(We)}}),D.add($).add(ue)}function ge(D){l("<");var R=s();if(M0.mapKey[R]===void 0)throw b(R,"type");l(",");var A=s();if(!qt.test(A))throw b(A,"type");l(">");var B=s();if(!Bt.test(B))throw b(B,"name");l("=");var F=new N0(P(B),g(s()),R,A);O(F,function(ue){if(ue==="option")te(F,ue),l(";");else throw b(ue)},function(){Yt(F)}),D.add(F)}function Me(D,R){if(!Bt.test(R=s()))throw b(R,"name");var A=new Kg(P(R));O(A,function(F){F==="option"?(te(A,F),l(";")):(o(F),Q(A,"optional"))}),D.add(A)}function je(D,R){if(!Bt.test(R=s()))throw b(R,"name");var A=new O0(R);O(A,function(F){switch(F){case"option":te(A,F),l(";");break;case"reserved":v(A.reserved||(A.reserved=[]),!0),A.reserved===void 0&&(A.reserved=[]);break;default:Re(A,F)}}),D.add(A),D===w&&C.push(A)}function Re(D,R){if(!Bt.test(R))throw b(R,"name");l("=");var A=g(s(),!0),B={options:void 0};B.getOption=function(F){return this.options[F]},B.setOption=function(F,$){P0.prototype.setOption.call(B,F,$)},B.setParsedOption=function(){},O(B,function($){if($==="option")te(B,$),l(";");else throw b($)},function(){Yt(B)}),D.add(R,A,B.comment,B.parsedOptions||B.options)}function te(D,R){var A,B,F=!0;for(R==="option"&&(R=s());R!=="=";){if(R==="("){var $=s();l(")"),R="("+$+")"}if(F){if(F=!1,R.includes(".")&&!R.includes("(")){var ue=R.split(".");A=ue[0]+".",R=ue[1];continue}A=R}else B=B?B+=R:R;R=s()}var Le=B?A.concat(B):A,We=$e(D,Le);B=B&&B[0]==="."?B.slice(1):B,A=A&&A[A.length-1]==="."?A.slice(0,-1):A,Ke(D,A,We,B)}function $e(D,R){if(l("{",!0)){for(var A={};!l("}",!0);){if(!Bt.test(ke=s()))throw b(ke,"name");if(ke===null)throw b(ke,"end of input");var B,F=ke;if(l(":",!0),a()==="{")B=$e(D,R+"."+ke);else if(a()==="["){B=[];var $;if(l("[",!0)){do $=V(!0),B.push($);while(l(",",!0));l("]"),typeof $<"u"&&he(D,R+"."+ke,$)}}else B=V(!0),he(D,R+"."+ke,B);var ue=A[F];ue&&(B=[].concat(ue).concat(B)),A[F]=B,l(",",!0),l(";",!0)}return A}var Le=V(!0);return he(D,R,Le),Le}function he(D,R,A){if(w===D&&/^features\./.test(R)){k[R]=A;return}D.setOption&&D.setOption(R,A)}function Ke(D,R,A,B){D.setParsedOption&&D.setParsedOption(R,A,B)}function Yt(D){if(l("[",!0)){do te(D,"option");while(l(",",!0));l("]")}return D}function UT(D,R){if(!Bt.test(R=s()))throw b(R,"service name");var A=new x0(R);O(A,function(F){if(!f(A,F))if(F==="rpc")VT(A,F);else throw b(F)}),D.add(A),D===w&&C.push(A)}function VT(D,R){var A=c(),B=R;if(!Bt.test(R=s()))throw b(R,"name");var F=R,$,ue,Le,We;if(l("("),l("stream",!0)&&(ue=!0),!qt.test(R=s())||($=R,l(")"),l("returns"),l("("),l("stream",!0)&&(We=!0),!qt.test(R=s())))throw b(R);Le=R,l(")");var Ps=new k0(F,B,$,Le,ue,We);Ps.comment=A,O(Ps,function(yl){if(yl==="option")te(Ps,yl),l(";");else throw b(yl)}),D.add(Ps)}function zT(D,R){if(!qt.test(R=s()))throw b(R,"reference");var A=R;O(null,function(F){switch(F){case"required":case"repeated":Q(D,F,A);break;case"optional":_==="proto3"?Q(D,"proto3_optional",A):Q(D,"optional",A);break;default:if(_==="proto2"||!qt.test(F))throw b(F);o(F),Q(D,"optional",A);break}})}for(var ke;(ke=s())!==null;)switch(ke){case"package":if(!u)throw b(ke);y();break;case"import":if(!u)throw b(ke);h();break;case"syntax":if(!u)throw b(ke);T();break;case"edition":if(!u)throw b(ke);d();break;case"option":te(w,ke),l(";",!0);break;default:if(f(w,ke)){u=!1;continue}throw b(ke)}return M(),rn.filename=null,{package:m,imports:S,weakImports:E,root:e}}});var Jg=I((jk,Yg)=>{"use strict";Yg.exports=It;var G0=/\/|\./;function It(n,e){G0.test(n)||(n="google/protobuf/"+n+".proto",e={nested:{google:{nested:{protobuf:{nested:e}}}}}),It[n]=e}It("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}});var Qg;It("duration",{Duration:Qg={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}});It("timestamp",{Timestamp:Qg});It("empty",{Empty:{fields:{}}});It("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}});It("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}});It("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}});It.get=function(e){return It[e]||null}});var Zg=I(($k,Xg)=>{"use strict";var Dn=Xg.exports=qg();Dn.build="full";Dn.tokenize=du();Dn.parse=Hg();Dn.common=Jg();Dn.Root._configure(Dn.Type,Dn.parse,Dn.common)});var Oo=I((Kk,ey)=>{"use strict";ey.exports=Zg()});var fu=I((Wk,j0)=>{j0.exports={nested:{google:{nested:{protobuf:{options:{go_package:"google.golang.org/protobuf/types/descriptorpb",java_package:"com.google.protobuf",java_outer_classname:"DescriptorProtos",csharp_namespace:"Google.Protobuf.Reflection",objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{FileDescriptorSet:{edition:"proto2",fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}},extensions:[[536e6,536e6]]},Edition:{edition:"proto2",values:{EDITION_UNKNOWN:0,EDITION_LEGACY:900,EDITION_PROTO2:998,EDITION_PROTO3:999,EDITION_2023:1e3,EDITION_2024:1001,EDITION_1_TEST_ONLY:1,EDITION_2_TEST_ONLY:2,EDITION_99997_TEST_ONLY:99997,EDITION_99998_TEST_ONLY:99998,EDITION_99999_TEST_ONLY:99999,EDITION_MAX:2147483647}},FileDescriptorProto:{edition:"proto2",fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10},weakDependency:{rule:"repeated",type:"int32",id:11},optionDependency:{rule:"repeated",type:"string",id:15},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12},edition:{type:"Edition",id:14}}},DescriptorProto:{edition:"proto2",fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10},visibility:{type:"SymbolVisibility",id:11}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2},options:{type:"ExtensionRangeOptions",id:3}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},ExtensionRangeOptions:{edition:"proto2",fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999},declaration:{rule:"repeated",type:"Declaration",id:2,options:{retention:"RETENTION_SOURCE"}},features:{type:"FeatureSet",id:50},verification:{type:"VerificationState",id:3,options:{default:"UNVERIFIED",retention:"RETENTION_SOURCE"}}},extensions:[[1e3,536870911]],nested:{Declaration:{fields:{number:{type:"int32",id:1},fullName:{type:"string",id:2},type:{type:"string",id:3},reserved:{type:"bool",id:5},repeated:{type:"bool",id:6}},reserved:[[4,4]]},VerificationState:{values:{DECLARATION:0,UNVERIFIED:1}}}},FieldDescriptorProto:{edition:"proto2",fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8},proto3Optional:{type:"bool",id:17}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REPEATED:3,LABEL_REQUIRED:2}}}},OneofDescriptorProto:{edition:"proto2",fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{edition:"proto2",fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3},reservedRange:{rule:"repeated",type:"EnumReservedRange",id:4},reservedName:{rule:"repeated",type:"string",id:5},visibility:{type:"SymbolVisibility",id:6}},nested:{EnumReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},EnumValueDescriptorProto:{edition:"proto2",fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{edition:"proto2",fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{edition:"proto2",fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{edition:"proto2",fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31,options:{default:!0}},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},swiftPrefix:{type:"string",id:39},phpClassPrefix:{type:"string",id:40},phpNamespace:{type:"string",id:41},phpMetadataNamespace:{type:"string",id:44},rubyPackage:{type:"string",id:45},features:{type:"FeatureSet",id:50},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[42,42],[38,38],"php_generic_services"],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{edition:"proto2",fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},deprecatedLegacyJsonFieldConflicts:{type:"bool",id:11,options:{deprecated:!0}},features:{type:"FeatureSet",id:12},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4],[5,5],[6,6],[8,8],[9,9]]},FieldOptions:{edition:"proto2",fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},unverifiedLazy:{type:"bool",id:15},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10,options:{deprecated:!0}},debugRedact:{type:"bool",id:16},retention:{type:"OptionRetention",id:17},targets:{rule:"repeated",type:"OptionTargetType",id:19},editionDefaults:{rule:"repeated",type:"EditionDefault",id:20},features:{type:"FeatureSet",id:21},featureSupport:{type:"FeatureSupport",id:22},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4],[18,18]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}},OptionRetention:{values:{RETENTION_UNKNOWN:0,RETENTION_RUNTIME:1,RETENTION_SOURCE:2}},OptionTargetType:{values:{TARGET_TYPE_UNKNOWN:0,TARGET_TYPE_FILE:1,TARGET_TYPE_EXTENSION_RANGE:2,TARGET_TYPE_MESSAGE:3,TARGET_TYPE_FIELD:4,TARGET_TYPE_ONEOF:5,TARGET_TYPE_ENUM:6,TARGET_TYPE_ENUM_ENTRY:7,TARGET_TYPE_SERVICE:8,TARGET_TYPE_METHOD:9}},EditionDefault:{fields:{edition:{type:"Edition",id:3},value:{type:"string",id:2}}},FeatureSupport:{fields:{editionIntroduced:{type:"Edition",id:1},editionDeprecated:{type:"Edition",id:2},deprecationWarning:{type:"string",id:3},editionRemoved:{type:"Edition",id:4}}}}},OneofOptions:{edition:"proto2",fields:{features:{type:"FeatureSet",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{edition:"proto2",fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},deprecatedLegacyJsonFieldConflicts:{type:"bool",id:6,options:{deprecated:!0}},features:{type:"FeatureSet",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[5,5]]},EnumValueOptions:{edition:"proto2",fields:{deprecated:{type:"bool",id:1},features:{type:"FeatureSet",id:2},debugRedact:{type:"bool",id:3},featureSupport:{type:"FieldOptions.FeatureSupport",id:4},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{edition:"proto2",fields:{features:{type:"FeatureSet",id:34},deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{edition:"proto2",fields:{deprecated:{type:"bool",id:33},idempotencyLevel:{type:"IdempotencyLevel",id:34,options:{default:"IDEMPOTENCY_UNKNOWN"}},features:{type:"FeatureSet",id:35},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],nested:{IdempotencyLevel:{values:{IDEMPOTENCY_UNKNOWN:0,NO_SIDE_EFFECTS:1,IDEMPOTENT:2}}}},UninterpretedOption:{edition:"proto2",fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},FeatureSet:{edition:"proto2",fields:{fieldPresence:{type:"FieldPresence",id:1,options:{retention:"RETENTION_RUNTIME",targets:"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_2023","edition_defaults.value":"EXPLICIT"}},enumType:{type:"EnumType",id:2,options:{retention:"RETENTION_RUNTIME",targets:"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"OPEN"}},repeatedFieldEncoding:{type:"RepeatedFieldEncoding",id:3,options:{retention:"RETENTION_RUNTIME",targets:"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"PACKED"}},utf8Validation:{type:"Utf8Validation",id:4,options:{retention:"RETENTION_RUNTIME",targets:"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"VERIFY"}},messageEncoding:{type:"MessageEncoding",id:5,options:{retention:"RETENTION_RUNTIME",targets:"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_LEGACY","edition_defaults.value":"LENGTH_PREFIXED"}},jsonFormat:{type:"JsonFormat",id:6,options:{retention:"RETENTION_RUNTIME",targets:"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"ALLOW"}},enforceNamingStyle:{type:"EnforceNamingStyle",id:7,options:{retention:"RETENTION_SOURCE",targets:"TARGET_TYPE_METHOD","feature_support.edition_introduced":"EDITION_2024","edition_defaults.edition":"EDITION_2024","edition_defaults.value":"STYLE2024"}},defaultSymbolVisibility:{type:"VisibilityFeature.DefaultSymbolVisibility",id:8,options:{retention:"RETENTION_SOURCE",targets:"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2024","edition_defaults.edition":"EDITION_2024","edition_defaults.value":"EXPORT_TOP_LEVEL"}}},extensions:[[1e3,9994],[9995,9999],[1e4,1e4]],reserved:[[999,999]],nested:{FieldPresence:{values:{FIELD_PRESENCE_UNKNOWN:0,EXPLICIT:1,IMPLICIT:2,LEGACY_REQUIRED:3}},EnumType:{values:{ENUM_TYPE_UNKNOWN:0,OPEN:1,CLOSED:2}},RepeatedFieldEncoding:{values:{REPEATED_FIELD_ENCODING_UNKNOWN:0,PACKED:1,EXPANDED:2}},Utf8Validation:{values:{UTF8_VALIDATION_UNKNOWN:0,VERIFY:2,NONE:3}},MessageEncoding:{values:{MESSAGE_ENCODING_UNKNOWN:0,LENGTH_PREFIXED:1,DELIMITED:2}},JsonFormat:{values:{JSON_FORMAT_UNKNOWN:0,ALLOW:1,LEGACY_BEST_EFFORT:2}},EnforceNamingStyle:{values:{ENFORCE_NAMING_STYLE_UNKNOWN:0,STYLE2024:1,STYLE_LEGACY:2}},VisibilityFeature:{fields:{},reserved:[[1,536870911]],nested:{DefaultSymbolVisibility:{values:{DEFAULT_SYMBOL_VISIBILITY_UNKNOWN:0,EXPORT_ALL:1,EXPORT_TOP_LEVEL:2,LOCAL_ALL:3,STRICT:4}}}}}},FeatureSetDefaults:{edition:"proto2",fields:{defaults:{rule:"repeated",type:"FeatureSetEditionDefault",id:1},minimumEdition:{type:"Edition",id:4},maximumEdition:{type:"Edition",id:5}},nested:{FeatureSetEditionDefault:{fields:{edition:{type:"Edition",id:3},overridableFeatures:{type:"FeatureSet",id:4},fixedFeatures:{type:"FeatureSet",id:5}},reserved:[[1,1],[2,2],"features"]}}},SourceCodeInfo:{edition:"proto2",fields:{location:{rule:"repeated",type:"Location",id:1}},extensions:[[536e6,536e6]],nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1,options:{packed:!0}},span:{rule:"repeated",type:"int32",id:2,options:{packed:!0}},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{edition:"proto2",fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1,options:{packed:!0}},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4},semantic:{type:"Semantic",id:5}},nested:{Semantic:{values:{NONE:0,SET:1,ALIAS:2}}}}}},SymbolVisibility:{edition:"proto2",values:{VISIBILITY_UNSET:0,VISIBILITY_LOCAL:1,VISIBILITY_EXPORT:2}}}}}}}}});var ay=I((K,oy)=>{"use strict";var it=Oo();oy.exports=K=it.descriptor=it.Root.fromJSON(fu()).lookup(".google.protobuf");var ty=it.Namespace,Hi=it.Root,sn=it.Enum,Ut=it.Type,An=it.Field,$0=it.MapField,xo=it.OneOf,Qi=it.Service,ko=it.Method;Hi.fromDescriptor=function(e){typeof e.length=="number"&&(e=K.FileDescriptorSet.decode(e));var t=new Hi;if(e.file)for(var r,i,s=0,o;s<e.file.length;++s){i=t,(r=e.file[s]).package&&r.package.length&&(i=t.define(r.package));var a=tw(r);if(r.name&&r.name.length&&t.files.push(i.filename=r.name),r.messageType)for(o=0;o<r.messageType.length;++o)i.add(Ut.fromDescriptor(r.messageType[o],a));if(r.enumType)for(o=0;o<r.enumType.length;++o)i.add(sn.fromDescriptor(r.enumType[o],a));if(r.extension)for(o=0;o<r.extension.length;++o)i.add(An.fromDescriptor(r.extension[o],a));if(r.service)for(o=0;o<r.service.length;++o)i.add(Qi.fromDescriptor(r.service[o],a));var l=jr(r.options,K.FileOptions);if(l){var c=Object.keys(l);for(o=0;o<c.length;++o)i.setOption(c[o],l[c[o]])}}return t.resolveAll()};Hi.prototype.toDescriptor=function(e){var t=K.FileDescriptorSet.create();return ny(this,t.file,e),t};function ny(n,e,t){var r=K.FileDescriptorProto.create({name:n.filename||(n.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});nw(t,r),n instanceof Hi||(r.package=n.fullName.substring(1));for(var i=0,s;i<n.nestedArray.length;++i)(s=n._nestedArray[i])instanceof Ut?r.messageType.push(s.toDescriptor(t)):s instanceof sn?r.enumType.push(s.toDescriptor()):s instanceof An?r.extension.push(s.toDescriptor(t)):s instanceof Qi?r.service.push(s.toDescriptor()):s instanceof ty&&ny(s,e,t);r.options=$r(n.options,K.FileOptions),r.messageType.length+r.enumType.length+r.extension.length+r.service.length&&e.push(r)}var K0=0;Ut.fromDescriptor=function(e,t,r){typeof e.length=="number"&&(e=K.DescriptorProto.decode(e));var i=new Ut(e.name.length?e.name:"Type"+K0++,jr(e.options,K.MessageOptions)),s;if(r||(i._edition=t),e.oneofDecl)for(s=0;s<e.oneofDecl.length;++s)i.add(xo.fromDescriptor(e.oneofDecl[s]));if(e.field)for(s=0;s<e.field.length;++s){var o=An.fromDescriptor(e.field[s],t,!0);i.add(o),e.field[s].hasOwnProperty("oneofIndex")&&i.oneofsArray[e.field[s].oneofIndex].add(o)}if(e.extension)for(s=0;s<e.extension.length;++s)i.add(An.fromDescriptor(e.extension[s],t,!0));if(e.nestedType)for(s=0;s<e.nestedType.length;++s)i.add(Ut.fromDescriptor(e.nestedType[s],t,!0)),e.nestedType[s].options&&e.nestedType[s].options.mapEntry&&i.setOption("map_entry",!0);if(e.enumType)for(s=0;s<e.enumType.length;++s)i.add(sn.fromDescriptor(e.enumType[s],t,!0));if(e.extensionRange&&e.extensionRange.length)for(i.extensions=[],s=0;s<e.extensionRange.length;++s)i.extensions.push([e.extensionRange[s].start,e.extensionRange[s].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(i.reserved=[],e.reservedRange)for(s=0;s<e.reservedRange.length;++s)i.reserved.push([e.reservedRange[s].start,e.reservedRange[s].end]);if(e.reservedName)for(s=0;s<e.reservedName.length;++s)i.reserved.push(e.reservedName[s])}return i};Ut.prototype.toDescriptor=function(e){var t=K.DescriptorProto.create({name:this.name}),r;for(r=0;r<this.fieldsArray.length;++r){var i;if(t.field.push(i=this._fieldsArray[r].toDescriptor(e)),this._fieldsArray[r]instanceof $0){var s=pu(this._fieldsArray[r].keyType,this._fieldsArray[r].resolvedKeyType,!1),o=pu(this._fieldsArray[r].type,this._fieldsArray[r].resolvedType,!1),a=o===11||o===14?this._fieldsArray[r].resolvedType&&sy(this.parent,this._fieldsArray[r].resolvedType)||this._fieldsArray[r].type:void 0;t.nestedType.push(K.DescriptorProto.create({name:i.typeName,field:[K.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),K.FieldDescriptorProto.create({name:"value",number:2,label:1,type:o,typeName:a})],options:K.MessageOptions.create({mapEntry:!0})}))}}for(r=0;r<this.oneofsArray.length;++r)t.oneofDecl.push(this._oneofsArray[r].toDescriptor());for(r=0;r<this.nestedArray.length;++r)this._nestedArray[r]instanceof An?t.field.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof Ut?t.nestedType.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof sn&&t.enumType.push(this._nestedArray[r].toDescriptor());if(this.extensions)for(r=0;r<this.extensions.length;++r)t.extensionRange.push(K.DescriptorProto.ExtensionRange.create({start:this.extensions[r][0],end:this.extensions[r][1]}));if(this.reserved)for(r=0;r<this.reserved.length;++r)typeof this.reserved[r]=="string"?t.reservedName.push(this.reserved[r]):t.reservedRange.push(K.DescriptorProto.ReservedRange.create({start:this.reserved[r][0],end:this.reserved[r][1]}));return t.options=$r(this.options,K.MessageOptions),t};var W0=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;An.fromDescriptor=function(e,t,r){if(typeof e.length=="number"&&(e=K.DescriptorProto.decode(e)),typeof e.number!="number")throw Error("missing field id");var i;e.typeName&&e.typeName.length?i=e.typeName:i=X0(e.type);var s;switch(e.label){case 1:s=void 0;break;case 2:s="required";break;case 3:s="repeated";break;default:throw Error("illegal label: "+e.label)}var o=e.extendee;e.extendee!==void 0&&(o=o.length?o:void 0);var a=new An(e.name.length?e.name:"field"+e.number,e.number,i,s,o);if(r||(a._edition=t),a.options=jr(e.options,K.FieldOptions),e.proto3_optional&&(a.options.proto3_optional=!0),e.defaultValue&&e.defaultValue.length){var l=e.defaultValue;switch(l){case"true":case"TRUE":l=!0;break;case"false":case"FALSE":l=!1;break;default:var c=W0.exec(l);c&&(l=parseInt(l));break}a.setOption("default",l)}return Z0(e.type)&&(t==="proto3"?e.options&&!e.options.packed&&a.setOption("packed",!1):(!t||t==="proto2")&&e.options&&e.options.packed&&a.setOption("packed",!0)),a};An.prototype.toDescriptor=function(e){var t=K.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)t.type=11,t.typeName=it.util.ucFirst(this.name),t.label=3;else{switch(t.type=pu(this.type,this.resolve().resolvedType,this.delimited)){case 10:case 11:case 14:t.typeName=this.resolvedType?sy(this.parent,this.resolvedType):this.type;break}this.rule==="repeated"?t.label=3:this.required&&e==="proto2"?t.label=2:t.label=1}if(t.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(t.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(t.options=$r(this.options,K.FieldOptions),this.options.default!=null&&(t.defaultValue=String(this.options.default)),this.options.proto3_optional&&(t.proto3_optional=!0)),e==="proto3"?this.packed||((t.options||(t.options=K.FieldOptions.create())).packed=!1):(!e||e==="proto2")&&this.packed&&((t.options||(t.options=K.FieldOptions.create())).packed=!0),t};var H0=0;sn.fromDescriptor=function(e,t,r){typeof e.length=="number"&&(e=K.EnumDescriptorProto.decode(e));var i={};if(e.value)for(var s=0;s<e.value.length;++s){var o=e.value[s].name,a=e.value[s].number||0;i[o&&o.length?o:"NAME"+a]=a}var l=new sn(e.name&&e.name.length?e.name:"Enum"+H0++,i,jr(e.options,K.EnumOptions));return r||(l._edition=t),l};sn.prototype.toDescriptor=function(){for(var e=[],t=0,r=Object.keys(this.values);t<r.length;++t)e.push(K.EnumValueDescriptorProto.create({name:r[t],number:this.values[r[t]]}));return K.EnumDescriptorProto.create({name:this.name,value:e,options:$r(this.options,K.EnumOptions)})};var Q0=0;xo.fromDescriptor=function(e){return typeof e.length=="number"&&(e=K.OneofDescriptorProto.decode(e)),new xo(e.name&&e.name.length?e.name:"oneof"+Q0++)};xo.prototype.toDescriptor=function(){return K.OneofDescriptorProto.create({name:this.name})};var Y0=0;Qi.fromDescriptor=function(e,t,r){typeof e.length=="number"&&(e=K.ServiceDescriptorProto.decode(e));var i=new Qi(e.name&&e.name.length?e.name:"Service"+Y0++,jr(e.options,K.ServiceOptions));if(r||(i._edition=t),e.method)for(var s=0;s<e.method.length;++s)i.add(ko.fromDescriptor(e.method[s]));return i};Qi.prototype.toDescriptor=function(){for(var e=[],t=0;t<this.methodsArray.length;++t)e.push(this._methodsArray[t].toDescriptor());return K.ServiceDescriptorProto.create({name:this.name,method:e,options:$r(this.options,K.ServiceOptions)})};var J0=0;ko.fromDescriptor=function(e){return typeof e.length=="number"&&(e=K.MethodDescriptorProto.decode(e)),new ko(e.name&&e.name.length?e.name:"Method"+J0++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,jr(e.options,K.MethodOptions))};ko.prototype.toDescriptor=function(){return K.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:$r(this.options,K.MethodOptions)})};function X0(n){switch(n){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+n)}function Z0(n){switch(n){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function pu(n,e,t){switch(n){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(e instanceof sn)return 14;if(e instanceof Ut)return t?10:11;throw Error("illegal type: "+n)}function ry(n,e){for(var t={},r=0,i,s;r<e.fieldsArray.length;++r)if((s=(i=e._fieldsArray[r]).name)!=="uninterpretedOption"&&Object.prototype.hasOwnProperty.call(n,s)){var o=ew(s);i.resolvedType instanceof Ut?t[o]=ry(n[s],i.resolvedType):i.resolvedType instanceof sn?t[o]=i.resolvedType.valuesById[n[s]]:t[o]=n[s]}return t}function jr(n,e){if(n)return ry(e.toObject(n),e)}function iy(n,e){for(var t={},r=Object.keys(n),i=0;i<r.length;++i){var s=r[i],o=it.util.camelCase(s);if(Object.prototype.hasOwnProperty.call(e.fields,o)){var a=e.fields[o];a.resolvedType instanceof Ut?t[o]=iy(n[s],a.resolvedType):t[o]=n[s],a.repeated&&!Array.isArray(t[o])&&(t[o]=[t[o]])}}return t}function $r(n,e){if(n)return e.fromObject(iy(n,e))}function sy(n,e){var t=n.fullName.split("."),r=e.fullName.split("."),i=0,s=0,o=r.length-1;if(!(n instanceof Hi)&&e instanceof ty)for(;i<t.length&&s<o&&t[i]===r[s];){var a=e.lookup(t[i++],!0);if(a!==null&&a!==e)break;++s}else for(;i<t.length&&s<o&&t[i]===r[s];++i,++s);return r.slice(s).join(".")}function ew(n){return n.substring(0,1)+n.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}function tw(n){if(n.syntax==="editions")switch(n.edition){case K.Edition.EDITION_2023:return"2023";default:throw new Error("Unsupported edition "+n.edition)}return n.syntax==="proto3"?"proto3":"proto2"}function nw(n,e){if(n)if(n==="proto2"||n==="proto3")e.syntax=n;else switch(e.syntax="editions",n){case"2023":e.edition=K.Edition.EDITION_2023;break;default:throw new Error("Unsupported edition "+n)}}});var ly=I((Hk,rw)=>{rw.exports={nested:{google:{nested:{protobuf:{nested:{Api:{fields:{name:{type:"string",id:1},methods:{rule:"repeated",type:"Method",id:2},options:{rule:"repeated",type:"Option",id:3},version:{type:"string",id:4},sourceContext:{type:"SourceContext",id:5},mixins:{rule:"repeated",type:"Mixin",id:6},syntax:{type:"Syntax",id:7}}},Method:{fields:{name:{type:"string",id:1},requestTypeUrl:{type:"string",id:2},requestStreaming:{type:"bool",id:3},responseTypeUrl:{type:"string",id:4},responseStreaming:{type:"bool",id:5},options:{rule:"repeated",type:"Option",id:6},syntax:{type:"Syntax",id:7}}},Mixin:{fields:{name:{type:"string",id:1},root:{type:"string",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}}}}}}}}});var cy=I((Qk,iw)=>{iw.exports={nested:{google:{nested:{protobuf:{nested:{SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var uy=I((Yk,sw)=>{sw.exports={nested:{google:{nested:{protobuf:{nested:{Type:{fields:{name:{type:"string",id:1},fields:{rule:"repeated",type:"Field",id:2},oneofs:{rule:"repeated",type:"string",id:3},options:{rule:"repeated",type:"Option",id:4},sourceContext:{type:"SourceContext",id:5},syntax:{type:"Syntax",id:6}}},Field:{fields:{kind:{type:"Kind",id:1},cardinality:{type:"Cardinality",id:2},number:{type:"int32",id:3},name:{type:"string",id:4},typeUrl:{type:"string",id:6},oneofIndex:{type:"int32",id:7},packed:{type:"bool",id:8},options:{rule:"repeated",type:"Option",id:9},jsonName:{type:"string",id:10},defaultValue:{type:"string",id:11}},nested:{Kind:{values:{TYPE_UNKNOWN:0,TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Cardinality:{values:{CARDINALITY_UNKNOWN:0,CARDINALITY_OPTIONAL:1,CARDINALITY_REQUIRED:2,CARDINALITY_REPEATED:3}}}},Enum:{fields:{name:{type:"string",id:1},enumvalue:{rule:"repeated",type:"EnumValue",id:2},options:{rule:"repeated",type:"Option",id:3},sourceContext:{type:"SourceContext",id:4},syntax:{type:"Syntax",id:5}}},EnumValue:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{rule:"repeated",type:"Option",id:3}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var py=I(Nn=>{"use strict";Object.defineProperty(Nn,"__esModule",{value:!0});Nn.addCommonProtos=Nn.loadProtosWithOptionsSync=Nn.loadProtosWithOptions=void 0;var dy=re("fs"),hy=re("path"),Kr=Oo();function fy(n,e){let t=n.resolvePath;n.resolvePath=(r,i)=>{if(hy.isAbsolute(i))return i;for(let s of e){let o=hy.join(s,i);try{return dy.accessSync(o,dy.constants.R_OK),o}catch{continue}}return process.emitWarning(`${i} not found in any of the include paths ${e}`),t(r,i)}}async function ow(n,e){let t=new Kr.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))return Promise.reject(new Error("The includeDirs option must be an array"));fy(t,e.includeDirs)}let r=await t.load(n,e);return r.resolveAll(),r}Nn.loadProtosWithOptions=ow;function aw(n,e){let t=new Kr.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))throw new Error("The includeDirs option must be an array");fy(t,e.includeDirs)}let r=t.loadSync(n,e);return r.resolveAll(),r}Nn.loadProtosWithOptionsSync=aw;function lw(){let n=ly(),e=fu(),t=cy(),r=uy();Kr.common("api",n.nested.google.nested.protobuf.nested),Kr.common("descriptor",e.nested.google.nested.protobuf.nested),Kr.common("source_context",t.nested.google.nested.protobuf.nested),Kr.common("type",r.nested.google.nested.protobuf.nested)}Nn.addCommonProtos=lw});var my=I((Yi,mu)=>{"use strict";(function(n,e){function t(r){return r.default||r}typeof define=="function"&&define.amd?define([],function(){var r={};return e(r),t(r)}):typeof Yi=="object"?(e(Yi),typeof mu=="object"&&(mu.exports=t(Yi))):(function(){var r={};e(r),n.Long=t(r)})()})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:Yi,function(n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t(d,f,O){this.low=d|0,this.high=f|0,this.unsigned=!!O}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0});function r(d){return(d&&d.__isLong__)===!0}function i(d){var f=Math.clz32(d&-d);return d?31-f:f}t.isLong=r;var s={},o={};function a(d,f){var O,Y,Q;return f?(d>>>=0,(Q=0<=d&&d<256)&&(Y=o[d],Y)?Y:(O=c(d,0,!0),Q&&(o[d]=O),O)):(d|=0,(Q=-128<=d&&d<128)&&(Y=s[d],Y)?Y:(O=c(d,d<0?-1:0,!1),Q&&(s[d]=O),O))}t.fromInt=a;function l(d,f){if(isNaN(d))return f?b:M;if(f){if(d<0)return b;if(d>=C)return g}else{if(d<=-k)return y;if(d+1>=k)return p}return d<0?l(-d,f).neg():c(d%w|0,d/w|0,f)}t.fromNumber=l;function c(d,f,O){return new t(d,f,O)}t.fromBits=c;var u=Math.pow;function m(d,f,O){if(d.length===0)throw Error("empty string");if(typeof f=="number"?(O=f,f=!1):f=!!f,d==="NaN"||d==="Infinity"||d==="+Infinity"||d==="-Infinity")return f?b:M;if(O=O||10,O<2||36<O)throw RangeError("radix");var Y;if((Y=d.indexOf("-"))>0)throw Error("interior hyphen");if(Y===0)return m(d.substring(1),f,O).neg();for(var Q=l(u(O,8)),se=M,ge=0;ge<d.length;ge+=8){var Me=Math.min(8,d.length-ge),je=parseInt(d.substring(ge,ge+Me),O);if(Me<8){var Re=l(u(O,Me));se=se.mul(Re).add(l(je))}else se=se.mul(Q),se=se.add(l(je))}return se.unsigned=f,se}t.fromString=m;function S(d,f){return typeof d=="number"?l(d,f):typeof d=="string"?m(d,f):c(d.low,d.high,typeof f=="boolean"?f:d.unsigned)}t.fromValue=S;var E=65536,_=1<<24,w=E*E,C=w*w,k=C/2,P=a(_),M=a(0);t.ZERO=M;var b=a(0,!0);t.UZERO=b;var G=a(1);t.ONE=G;var V=a(1,!0);t.UONE=V;var v=a(-1);t.NEG_ONE=v;var p=c(-1,2147483647,!1);t.MAX_VALUE=p;var g=c(-1,-1,!0);t.MAX_UNSIGNED_VALUE=g;var y=c(0,-2147483648,!1);t.MIN_VALUE=y;var h=t.prototype;h.toInt=function(){return this.unsigned?this.low>>>0:this.low},h.toNumber=function(){return this.unsigned?(this.high>>>0)*w+(this.low>>>0):this.high*w+(this.low>>>0)},h.toString=function(f){if(f=f||10,f<2||36<f)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(y)){var O=l(f),Y=this.div(O),Q=Y.mul(O).sub(this);return Y.toString(f)+Q.toInt().toString(f)}else return"-"+this.neg().toString(f);for(var se=l(u(f,6),this.unsigned),ge=this,Me="";;){var je=ge.div(se),Re=ge.sub(je.mul(se)).toInt()>>>0,te=Re.toString(f);if(ge=je,ge.isZero())return te+Me;for(;te.length<6;)te="0"+te;Me=""+te+Me}},h.getHighBits=function(){return this.high},h.getHighBitsUnsigned=function(){return this.high>>>0},h.getLowBits=function(){return this.low},h.getLowBitsUnsigned=function(){return this.low>>>0},h.getNumBitsAbs=function(){if(this.isNegative())return this.eq(y)?64:this.neg().getNumBitsAbs();for(var f=this.high!=0?this.high:this.low,O=31;O>0&&(f&1<<O)==0;O--);return this.high!=0?O+33:O+1},h.isSafeInteger=function(){var f=this.high>>21;return f?this.unsigned?!1:f===-1&&!(this.low===0&&this.high===-2097152):!0},h.isZero=function(){return this.high===0&&this.low===0},h.eqz=h.isZero,h.isNegative=function(){return!this.unsigned&&this.high<0},h.isPositive=function(){return this.unsigned||this.high>=0},h.isOdd=function(){return(this.low&1)===1},h.isEven=function(){return(this.low&1)===0},h.equals=function(f){return r(f)||(f=S(f)),this.unsigned!==f.unsigned&&this.high>>>31===1&&f.high>>>31===1?!1:this.high===f.high&&this.low===f.low},h.eq=h.equals,h.notEquals=function(f){return!this.eq(f)},h.neq=h.notEquals,h.ne=h.notEquals,h.lessThan=function(f){return this.comp(f)<0},h.lt=h.lessThan,h.lessThanOrEqual=function(f){return this.comp(f)<=0},h.lte=h.lessThanOrEqual,h.le=h.lessThanOrEqual,h.greaterThan=function(f){return this.comp(f)>0},h.gt=h.greaterThan,h.greaterThanOrEqual=function(f){return this.comp(f)>=0},h.gte=h.greaterThanOrEqual,h.ge=h.greaterThanOrEqual,h.compare=function(f){if(r(f)||(f=S(f)),this.eq(f))return 0;var O=this.isNegative(),Y=f.isNegative();return O&&!Y?-1:!O&&Y?1:this.unsigned?f.high>>>0>this.high>>>0||f.high===this.high&&f.low>>>0>this.low>>>0?-1:1:this.sub(f).isNegative()?-1:1},h.comp=h.compare,h.negate=function(){return!this.unsigned&&this.eq(y)?y:this.not().add(G)},h.neg=h.negate,h.add=function(f){r(f)||(f=S(f));var O=this.high>>>16,Y=this.high&65535,Q=this.low>>>16,se=this.low&65535,ge=f.high>>>16,Me=f.high&65535,je=f.low>>>16,Re=f.low&65535,te=0,$e=0,he=0,Ke=0;return Ke+=se+Re,he+=Ke>>>16,Ke&=65535,he+=Q+je,$e+=he>>>16,he&=65535,$e+=Y+Me,te+=$e>>>16,$e&=65535,te+=O+ge,te&=65535,c(he<<16|Ke,te<<16|$e,this.unsigned)},h.subtract=function(f){return r(f)||(f=S(f)),this.add(f.neg())},h.sub=h.subtract,h.multiply=function(f){if(this.isZero())return this;if(r(f)||(f=S(f)),e){var O=e.mul(this.low,this.high,f.low,f.high);return c(O,e.get_high(),this.unsigned)}if(f.isZero())return this.unsigned?b:M;if(this.eq(y))return f.isOdd()?y:M;if(f.eq(y))return this.isOdd()?y:M;if(this.isNegative())return f.isNegative()?this.neg().mul(f.neg()):this.neg().mul(f).neg();if(f.isNegative())return this.mul(f.neg()).neg();if(this.lt(P)&&f.lt(P))return l(this.toNumber()*f.toNumber(),this.unsigned);var Y=this.high>>>16,Q=this.high&65535,se=this.low>>>16,ge=this.low&65535,Me=f.high>>>16,je=f.high&65535,Re=f.low>>>16,te=f.low&65535,$e=0,he=0,Ke=0,Yt=0;return Yt+=ge*te,Ke+=Yt>>>16,Yt&=65535,Ke+=se*te,he+=Ke>>>16,Ke&=65535,Ke+=ge*Re,he+=Ke>>>16,Ke&=65535,he+=Q*te,$e+=he>>>16,he&=65535,he+=se*Re,$e+=he>>>16,he&=65535,he+=ge*je,$e+=he>>>16,he&=65535,$e+=Y*te+Q*Re+se*je+ge*Me,$e&=65535,c(Ke<<16|Yt,$e<<16|he,this.unsigned)},h.mul=h.multiply,h.divide=function(f){if(r(f)||(f=S(f)),f.isZero())throw Error("division by zero");if(e){if(!this.unsigned&&this.high===-2147483648&&f.low===-1&&f.high===-1)return this;var O=(this.unsigned?e.div_u:e.div_s)(this.low,this.high,f.low,f.high);return c(O,e.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?b:M;var Y,Q,se;if(this.unsigned){if(f.unsigned||(f=f.toUnsigned()),f.gt(this))return b;if(f.gt(this.shru(1)))return V;se=b}else{if(this.eq(y)){if(f.eq(G)||f.eq(v))return y;if(f.eq(y))return G;var ge=this.shr(1);return Y=ge.div(f).shl(1),Y.eq(M)?f.isNegative()?G:v:(Q=this.sub(f.mul(Y)),se=Y.add(Q.div(f)),se)}else if(f.eq(y))return this.unsigned?b:M;if(this.isNegative())return f.isNegative()?this.neg().div(f.neg()):this.neg().div(f).neg();if(f.isNegative())return this.div(f.neg()).neg();se=M}for(Q=this;Q.gte(f);){Y=Math.max(1,Math.floor(Q.toNumber()/f.toNumber()));for(var Me=Math.ceil(Math.log(Y)/Math.LN2),je=Me<=48?1:u(2,Me-48),Re=l(Y),te=Re.mul(f);te.isNegative()||te.gt(Q);)Y-=je,Re=l(Y,this.unsigned),te=Re.mul(f);Re.isZero()&&(Re=G),se=se.add(Re),Q=Q.sub(te)}return se},h.div=h.divide,h.modulo=function(f){if(r(f)||(f=S(f)),e){var O=(this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,f.low,f.high);return c(O,e.get_high(),this.unsigned)}return this.sub(this.div(f).mul(f))},h.mod=h.modulo,h.rem=h.modulo,h.not=function(){return c(~this.low,~this.high,this.unsigned)},h.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},h.clz=h.countLeadingZeros,h.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},h.ctz=h.countTrailingZeros,h.and=function(f){return r(f)||(f=S(f)),c(this.low&f.low,this.high&f.high,this.unsigned)},h.or=function(f){return r(f)||(f=S(f)),c(this.low|f.low,this.high|f.high,this.unsigned)},h.xor=function(f){return r(f)||(f=S(f)),c(this.low^f.low,this.high^f.high,this.unsigned)},h.shiftLeft=function(f){return r(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low<<f,this.high<<f|this.low>>>32-f,this.unsigned):c(0,this.low<<f-32,this.unsigned)},h.shl=h.shiftLeft,h.shiftRight=function(f){return r(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low>>>f|this.high<<32-f,this.high>>f,this.unsigned):c(this.high>>f-32,this.high>=0?0:-1,this.unsigned)},h.shr=h.shiftRight,h.shiftRightUnsigned=function(f){return r(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low>>>f|this.high<<32-f,this.high>>>f,this.unsigned):f===32?c(this.high,0,this.unsigned):c(this.high>>>f-32,0,this.unsigned)},h.shru=h.shiftRightUnsigned,h.shr_u=h.shiftRightUnsigned,h.rotateLeft=function(f){var O;return r(f)&&(f=f.toInt()),(f&=63)===0?this:f===32?c(this.high,this.low,this.unsigned):f<32?(O=32-f,c(this.low<<f|this.high>>>O,this.high<<f|this.low>>>O,this.unsigned)):(f-=32,O=32-f,c(this.high<<f|this.low>>>O,this.low<<f|this.high>>>O,this.unsigned))},h.rotl=h.rotateLeft,h.rotateRight=function(f){var O;return r(f)&&(f=f.toInt()),(f&=63)===0?this:f===32?c(this.high,this.low,this.unsigned):f<32?(O=32-f,c(this.high<<O|this.low>>>f,this.low<<O|this.high>>>f,this.unsigned)):(f-=32,O=32-f,c(this.low<<O|this.high>>>f,this.high<<O|this.low>>>f,this.unsigned))},h.rotr=h.rotateRight,h.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},h.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},h.toBytes=function(f){return f?this.toBytesLE():this.toBytesBE()},h.toBytesLE=function(){var f=this.high,O=this.low;return[O&255,O>>>8&255,O>>>16&255,O>>>24,f&255,f>>>8&255,f>>>16&255,f>>>24]},h.toBytesBE=function(){var f=this.high,O=this.low;return[f>>>24,f>>>16&255,f>>>8&255,f&255,O>>>24,O>>>16&255,O>>>8&255,O&255]},t.fromBytes=function(f,O,Y){return Y?t.fromBytesLE(f,O):t.fromBytesBE(f,O)},t.fromBytesLE=function(f,O){return new t(f[0]|f[1]<<8|f[2]<<16|f[3]<<24,f[4]|f[5]<<8|f[6]<<16|f[7]<<24,O)},t.fromBytesBE=function(f,O){return new t(f[4]<<24|f[5]<<16|f[6]<<8|f[7],f[0]<<24|f[1]<<16|f[2]<<8|f[3],O)},typeof BigInt=="function"&&(t.fromBigInt=function(f,O){var Y=Number(BigInt.asIntN(32,f)),Q=Number(BigInt.asIntN(32,f>>BigInt(32)));return c(Y,Q,O)},t.fromValue=function(f,O){return typeof f=="bigint"?t.fromBigInt(f,O):S(f,O)},h.toBigInt=function(){var f=BigInt(this.low>>>0),O=BigInt(this.unsigned?this.high>>>0:this.high);return O<<BigInt(32)|f});var T=n.default=t})});var Su=I(Ce=>{"use strict";Object.defineProperty(Ce,"__esModule",{value:!0});Ce.loadFileDescriptorSetFromObject=Ce.loadFileDescriptorSetFromBuffer=Ce.fromJSON=Ce.loadSync=Ce.load=Ce.IdempotencyLevel=Ce.isAnyExtension=Ce.Long=void 0;var cw=am(),Vt=Oo(),yu=ay(),vu=py(),uw=my();Ce.Long=uw;function dw(n){return"@type"in n&&typeof n["@type"]=="string"}Ce.isAnyExtension=dw;var vy;(function(n){n.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",n.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",n.IDEMPOTENT="IDEMPOTENT"})(vy=Ce.IdempotencyLevel||(Ce.IdempotencyLevel={}));var Sy={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function hw(n,e){return n===""?e:n+"."+e}function fw(n){return n instanceof Vt.Service||n instanceof Vt.Type||n instanceof Vt.Enum}function pw(n){return n instanceof Vt.Namespace||n instanceof Vt.Root}function Ty(n,e){let t=hw(e,n.name);return fw(n)?[[t,n]]:pw(n)&&typeof n.nested<"u"?Object.keys(n.nested).map(r=>Ty(n.nested[r],t)).reduce((r,i)=>r.concat(i),[]):[]}function gy(n,e){return function(r){return n.toObject(n.decode(r),e)}}function yy(n){return function(t){if(Array.isArray(t))throw new Error(`Failed to serialize message: expected object with ${n.name} structure, got array instead`);let r=n.fromObject(t);return n.encode(r).finish()}}function mw(n){return(n||[]).reduce((e,t)=>{for(let[r,i]of Object.entries(t))switch(r){case"uninterpreted_option":e.uninterpreted_option.push(t.uninterpreted_option);break;default:e[r]=i}return e},{deprecated:!1,idempotency_level:vy.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function gw(n,e,t,r){let i=n.resolvedRequestType,s=n.resolvedResponseType;return{path:"/"+e+"/"+n.name,requestStream:!!n.requestStream,responseStream:!!n.responseStream,requestSerialize:yy(i),requestDeserialize:gy(i,t),responseSerialize:yy(s),responseDeserialize:gy(s,t),originalName:cw(n.name),requestType:gu(i,r),responseType:gu(s,r),options:mw(n.parsedOptions)}}function yw(n,e,t,r){let i={};for(let s of n.methodsArray)i[s.name]=gw(s,e,t,r);return i}function gu(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:t.$type.toObject(t,Sy),fileDescriptorProtos:e}}function vw(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:t.$type.toObject(t,Sy),fileDescriptorProtos:e}}function Sw(n,e,t,r){if(n instanceof Vt.Service)return yw(n,e,t,r);if(n instanceof Vt.Type)return gu(n,r);if(n instanceof Vt.Enum)return vw(n,r);throw new Error("Type mismatch in reflection object handling")}function Po(n,e){let t={};n.resolveAll();let i=n.toDescriptor("proto3").file.map(s=>Buffer.from(yu.FileDescriptorProto.encode(s).finish()));for(let[s,o]of Ty(n,""))t[s]=Sw(o,s,e,i);return t}function Ey(n,e){e=e||{};let t=Vt.Root.fromDescriptor(n);return t.resolveAll(),Po(t,e)}function Tw(n,e){return(0,vu.loadProtosWithOptions)(n,e).then(t=>Po(t,e))}Ce.load=Tw;function Ew(n,e){let t=(0,vu.loadProtosWithOptionsSync)(n,e);return Po(t,e)}Ce.loadSync=Ew;function _w(n,e){e=e||{};let t=Vt.Root.fromJSON(n);return t.resolveAll(),Po(t,e)}Ce.fromJSON=_w;function bw(n,e){let t=yu.FileDescriptorSet.decode(n);return Ey(t,e)}Ce.loadFileDescriptorSetFromBuffer=bw;function ww(n,e){let t=yu.FileDescriptorSet.fromObject(n);return Ey(t,e)}Ce.loadFileDescriptorSetFromObject=ww;(0,vu.addCommonProtos)()});var rr=I(de=>{"use strict";Object.defineProperty(de,"__esModule",{value:!0});de.setup=de.getChannelzServiceDefinition=de.getChannelzHandlers=de.unregisterChannelzRef=de.registerChannelzSocket=de.registerChannelzServer=de.registerChannelzSubchannel=de.registerChannelzChannel=de.ChannelzCallTracker=de.ChannelzChildrenTracker=de.ChannelzTrace=void 0;var _y=re("net"),Ji=ct(),Zi=ne(),Cw=xt(),Iw=eo(),Rw=mc();function Tu(n){return{channel_id:n.id,name:n.name}}function wu(n){return{subchannel_id:n.id,name:n.name}}function Dw(n){return{server_id:n.id}}function Lo(n){return{socket_id:n.id,name:n.name}}var by=32,Eu=class{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,r){let i=new Date;this.events.push({description:t,severity:e,timestamp:i,childChannel:r?.kind==="channel"?r:void 0,childSubchannel:r?.kind==="subchannel"?r:void 0}),this.events.length>=by*2&&(this.events=this.events.slice(by)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:on(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:on(e.timestamp),channel_ref:e.childChannel?Tu(e.childChannel):null,subchannel_ref:e.childSubchannel?wu(e.childSubchannel):null}))}}};de.ChannelzTrace=Eu;var _u=class{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,r,i;switch(e.kind){case"channel":{let s=(t=this.channelChildren.get(e.id))!==null&&t!==void 0?t:{ref:e,count:0};s.count+=1,this.channelChildren.set(e.id,s);break}case"subchannel":{let s=(r=this.subchannelChildren.get(e.id))!==null&&r!==void 0?r:{ref:e,count:0};s.count+=1,this.subchannelChildren.set(e.id,s);break}case"socket":{let s=(i=this.socketChildren.get(e.id))!==null&&i!==void 0?i:{ref:e,count:0};s.count+=1,this.socketChildren.set(e.id,s);break}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t));break}}}getChildLists(){let e=[];for(let{ref:i}of this.channelChildren.values())e.push(i);let t=[];for(let{ref:i}of this.subchannelChildren.values())t.push(i);let r=[];for(let{ref:i}of this.socketChildren.values())r.push(i);return{channels:e,subchannels:t,sockets:r}}};de.ChannelzChildrenTracker=_u;var bu=class{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}};de.ChannelzCallTracker=bu;var Aw=1;function Fo(){return Aw++}var Xi=[],Cu=[],On=[],Iu=[];function Nw(n,e,t){let r=Fo(),i={id:r,name:n,kind:"channel"};return t&&(Xi[r]={ref:i,getInfo:e}),i}de.registerChannelzChannel=Nw;function Ow(n,e,t){let r=Fo(),i={id:r,name:n,kind:"subchannel"};return t&&(Cu[r]={ref:i,getInfo:e}),i}de.registerChannelzSubchannel=Ow;function xw(n,e){let t=Fo(),r={id:t,kind:"server"};return e&&(On[t]={ref:r,getInfo:n}),r}de.registerChannelzServer=xw;function kw(n,e,t){let r=Fo(),i={id:r,name:n,kind:"socket"};return t&&(Iu[r]={ref:i,getInfo:e}),i}de.registerChannelzSocket=kw;function Pw(n){switch(n.kind){case"channel":delete Xi[n.id];return;case"subchannel":delete Cu[n.id];return;case"server":delete On[n.id];return;case"socket":delete Iu[n.id];return}}de.unregisterChannelzRef=Pw;function Mw(n){let e=Number.parseInt(n,16);return[e/256|0,e%256]}function wy(n){if(n==="")return[];let e=n.split(":").map(r=>Mw(r));return[].concat(...e)}function Lw(n){if((0,_y.isIPv4)(n))return Buffer.from(Uint8Array.from(n.split(".").map(e=>Number.parseInt(e))));if((0,_y.isIPv6)(n)){let e,t,r=n.indexOf("::");r===-1?(e=n,t=""):(e=n.substring(0,r),t=n.substring(r+2));let i=Buffer.from(wy(e)),s=Buffer.from(wy(t)),o=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,o,s])}else return null}function Iy(n){switch(n){case Ji.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case Ji.ConnectivityState.IDLE:return{state:"IDLE"};case Ji.ConnectivityState.READY:return{state:"READY"};case Ji.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case Ji.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function on(n){if(!n)return null;let e=n.getTime();return{seconds:e/1e3|0,nanos:e%1e3*1e6}}function Ry(n){let e=n.getInfo();return{ref:Tu(n.ref),data:{target:e.target,state:Iy(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:on(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},channel_ref:e.children.channels.map(t=>Tu(t)),subchannel_ref:e.children.subchannels.map(t=>wu(t))}}function Fw(n,e){let t=Number.parseInt(n.request.channel_id),r=Xi[t];if(r===void 0){e({code:Zi.Status.NOT_FOUND,details:"No channel data found for id "+t});return}e(null,{channel:Ry(r)})}function Bw(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_channel_id);for(;i<Xi.length;i++){let s=Xi[i];if(s!==void 0&&(r.push(Ry(s)),r.length>=t))break}e(null,{channel:r,end:i>=On.length})}function Dy(n){let e=n.getInfo();return{ref:Dw(n.ref),data:{calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:on(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},listen_socket:e.listenerChildren.sockets.map(t=>Lo(t))}}function qw(n,e){let t=Number.parseInt(n.request.server_id),r=On[t];if(r===void 0){e({code:Zi.Status.NOT_FOUND,details:"No server data found for id "+t});return}e(null,{server:Dy(r)})}function Uw(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_server_id);for(;i<On.length;i++){let s=On[i];if(s!==void 0&&(r.push(Dy(s)),r.length>=t))break}e(null,{server:r,end:i>=On.length})}function Vw(n,e){let t=Number.parseInt(n.request.subchannel_id),r=Cu[t];if(r===void 0){e({code:Zi.Status.NOT_FOUND,details:"No subchannel data found for id "+t});return}let i=r.getInfo(),s={ref:wu(r.ref),data:{target:i.target,state:Iy(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:on(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(o=>Lo(o))};e(null,{subchannel:s})}function Cy(n){var e;return(0,Cw.isTcpSubchannelAddress)(n)?{address:"tcpip_address",tcpip_address:{ip_address:(e=Lw(n.host))!==null&&e!==void 0?e:void 0,port:n.port}}:{address:"uds_address",uds_address:{filename:n.path}}}function zw(n,e){var t,r,i,s,o;let a=Number.parseInt(n.request.socket_id),l=Iu[a];if(l===void 0){e({code:Zi.Status.NOT_FOUND,details:"No socket data found for id "+a});return}let c=l.getInfo(),u=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:(t=c.security.cipherSuiteStandardName)!==null&&t!==void 0?t:void 0,other_name:(r=c.security.cipherSuiteOtherName)!==null&&r!==void 0?r:void 0,local_certificate:(i=c.security.localCertificate)!==null&&i!==void 0?i:void 0,remote_certificate:(s=c.security.remoteCertificate)!==null&&s!==void 0?s:void 0}}:null,m={ref:Lo(l.ref),local:c.localAddress?Cy(c.localAddress):null,remote:c.remoteAddress?Cy(c.remoteAddress):null,remote_name:(o=c.remoteName)!==null&&o!==void 0?o:void 0,security:u,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:on(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:on(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:on(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:on(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}};e(null,{socket:m})}function Gw(n,e){let t=Number.parseInt(n.request.server_id),r=On[t];if(r===void 0){e({code:Zi.Status.NOT_FOUND,details:"No server data found for id "+t});return}let i=Number.parseInt(n.request.start_socket_id),s=Number.parseInt(n.request.max_results),a=r.getInfo().sessionChildren.sockets.sort((u,m)=>u.id-m.id),l=[],c=0;for(;c<a.length&&!(a[c].id>=i&&(l.push(Lo(a[c])),l.length>=s));c++);e(null,{socket_ref:l,end:c>=a.length})}function Ay(){return{GetChannel:Fw,GetTopChannels:Bw,GetServer:qw,GetServers:Uw,GetSubchannel:Vw,GetSocket:zw,GetServerSockets:Gw}}de.getChannelzHandlers=Ay;var Mo=null;function Ny(){if(Mo)return Mo;let n=Su().loadSync,e=n("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return Mo=(0,Rw.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service,Mo}de.getChannelzServiceDefinition=Ny;function jw(){(0,Iw.registerAdminService)(Ny,Ay)}de.setup=jw});var Oy=I(qo=>{"use strict";Object.defineProperty(qo,"__esModule",{value:!0});qo.Subchannel=void 0;var ae=ct(),$w=Ai(),Ru=fe(),Bo=ne(),Kw=et(),Ww=xt(),Wr=rr(),Hw="subchannel",Qw=~(1<<31),Du=class{constructor(e,t,r,i,s){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=r,this.credentials=i,this.connector=s,this.connectivityState=ae.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new Wr.ChannelzCallTracker,this.childrenTracker=new Wr.ChannelzChildrenTracker,this.streamTracker=new Wr.ChannelzCallTracker;let a={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new $w.BackoffTimeout(()=>{this.handleBackoffTimer()},a),this.backoffTimeout.unref(),this.subchannelAddressString=(0,Ww.subchannelAddressToString)(t),this.keepaliveTime=(o=r["grpc.keepalive_time_ms"])!==null&&o!==void 0?o:-1,r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new Wr.ChannelzTrace,this.channelzRef=(0,Wr.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(r,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){Ru.trace(Bo.LogVerbosity.DEBUG,Hw,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){Ru.trace(Bo.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([ae.ConnectivityState.TRANSIENT_FAILURE],ae.ConnectivityState.CONNECTING):this.transitionToState([ae.ConnectivityState.TRANSIENT_FAILURE],ae.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,Qw);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(t=>{this.transitionToState([ae.ConnectivityState.CONNECTING],ae.ConnectivityState.READY)?(this.transport=t,this.channelzEnabled&&this.childrenTracker.refChild(t.getChannelzRef()),t.addDisconnectListener(r=>{this.transitionToState([ae.ConnectivityState.READY],ae.ConnectivityState.IDLE),r&&this.keepaliveTime>0&&(this.keepaliveTime*=2,Ru.log(Bo.LogVerbosity.ERROR,`Connection to ${(0,Kw.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):t.shutdown()},t=>{this.transitionToState([ae.ConnectivityState.CONNECTING],ae.ConnectivityState.TRANSIENT_FAILURE,`${t}`)})}transitionToState(e,t,r){var i,s;if(e.indexOf(this.connectivityState)===-1)return!1;this.trace(ae.ConnectivityState[this.connectivityState]+" -> "+ae.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+ae.ConnectivityState[t]);let o=this.connectivityState;switch(this.connectivityState=t,t){case ae.ConnectivityState.READY:this.stopBackoff();break;case ae.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case ae.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(i=this.transport)===null||i===void 0||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case ae.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(s=this.transport)===null||s===void 0||s.shutdown(),this.transport=null;break;default:throw new Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let a of this.stateListeners)a(this,o,t,this.keepaliveTime,r);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,this.refcount===0&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,Wr.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([ae.ConnectivityState.CONNECTING,ae.ConnectivityState.READY],ae.ConnectivityState.IDLE)}))}unrefIfOneRef(){return this.refcount===1?(this.unref(),!0):!1}createCall(e,t,r,i){if(!this.transport)throw new Error("Cannot create call, subchannel not READY");let s;return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),s={onCallEnd:o=>{o.code===Bo.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):s={},this.transport.createCall(e,t,r,i,s)}startConnecting(){process.nextTick(()=>{this.transitionToState([ae.ConnectivityState.IDLE],ae.ConnectivityState.CONNECTING)||this.connectivityState===ae.ConnectivityState.TRANSIENT_FAILURE&&(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([ae.ConnectivityState.TRANSIENT_FAILURE],ae.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}};qo.Subchannel=Du});var xu=I(Pn=>{"use strict";Object.defineProperty(Pn,"__esModule",{value:!0});Pn.setup=Pn.DEFAULT_PORT=void 0;var xy=Nt(),Py=re("dns"),My=re("util"),Yw=zl(),Au=ne(),Nu=Ye(),Jw=fe(),Xw=ne(),xn=et(),ky=re("net"),Zw=Ai(),eC="dns_resolver";function kn(n){Jw.trace(Xw.LogVerbosity.DEBUG,eC,n)}Pn.DEFAULT_PORT=443;var tC=3e4,nC=My.promisify(Py.resolveTxt),rC=My.promisify(Py.lookup);function iC(...n){let e=[];for(let t=0;t<Math.max.apply(null,n.map(r=>r.length));t++)for(let r of n)t<r.length&&e.push(r[t]);return e}var Ou=class{constructor(e,t,r){var i,s,o;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,kn("Resolver constructed for target "+(0,xn.uriToString)(e));let a=(0,xn.splitHostPort)(e.path);a===null?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,ky.isIPv4)(a.host)||(0,ky.isIPv6)(a.host)?(this.ipResult=[{host:a.host,port:(i=a.port)!==null&&i!==void 0?i:Pn.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=a.host,this.port=(s=a.port)!==null&&s!==void 0?s:Pn.DEFAULT_PORT),this.percentage=Math.random()*100,r["grpc.service_config_disable_resolution"]===1&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:Au.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,xn.uriToString)(this.target)}`,metadata:new Nu.Metadata};let l={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoff=new Zw.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},l),this.backoff.unref(),this.minTimeBetweenResolutionsMs=(o=r["grpc.dns_min_time_between_resolutions_ms"])!==null&&o!==void 0?o:tC,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(this.ipResult!==null){this.returnedIpResult||(kn("Returning IP address for target "+(0,xn.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(this.dnsHostname===null)kn("Failed to parse DNS address "+(0,xn.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:Au.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,xn.uriToString)(this.target)}`,metadata:new Nu.Metadata})}),this.stopNextResolutionTimer();else{if(this.pendingLookupPromise!==null)return;kn("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=rC(e,{all:!0}),this.pendingLookupPromise.then(t=>{if(this.pendingLookupPromise===null)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let r=t.filter(o=>o.family===4),i=t.filter(o=>o.family===6);this.latestLookupResult=iC(i,r).map(o=>({host:o.address,port:+this.port}));let s="["+this.latestLookupResult.map(o=>o.host+":"+o.port).join(",")+"]";if(kn("Resolved addresses for target "+(0,xn.uriToString)(this.target)+": "+s),this.latestLookupResult.length===0){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},t=>{this.pendingLookupPromise!==null&&(kn("Resolution error for target "+(0,xn.uriToString)(this.target)+": "+t.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&this.pendingTxtPromise===null&&(this.pendingTxtPromise=nC(e),this.pendingTxtPromise.then(t=>{if(this.pendingTxtPromise!==null){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,Yw.extractAndSelectServiceConfig)(t,this.percentage)}catch(r){this.latestServiceConfigError={code:Au.Status.UNAVAILABLE,details:`Parsing service config failed with error ${r.message}`,metadata:new Nu.Metadata}}this.latestLookupResult!==null&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},t=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)===null||t===void 0?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){this.pendingLookupPromise===null&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){this.pendingLookupPromise===null&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?kn('resolution update delayed by "min time between resolutions" rate limit'):kn("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}};function sC(){(0,xy.registerResolver)("dns",Ou),(0,xy.registerDefaultScheme)("dns")}Pn.setup=sC});var ku=I(Yr=>{"use strict";Object.defineProperty(Yr,"__esModule",{value:!0});Yr.getProxiedConnection=Yr.mapProxyName=void 0;var es=fe(),Hr=ne(),oC=Nt(),aC=re("http"),lC=re("tls"),cC=fe(),Ly=xt(),Qr=et(),uC=re("url"),dC=xu(),hC="proxy";function Mn(n){cC.trace(Hr.LogVerbosity.DEBUG,hC,n)}function fC(){let n="",e="";if(process.env.grpc_proxy)e="grpc_proxy",n=process.env.grpc_proxy;else if(process.env.https_proxy)e="https_proxy",n=process.env.https_proxy;else if(process.env.http_proxy)e="http_proxy",n=process.env.http_proxy;else return{};let t;try{t=new uC.URL(n)}catch{return(0,es.log)(Hr.LogVerbosity.ERROR,`cannot parse value of "${e}" env var`),{}}if(t.protocol!=="http:")return(0,es.log)(Hr.LogVerbosity.ERROR,`"${t.protocol}" scheme not supported in proxy URI`),{};let r=null;t.username&&(t.password?((0,es.log)(Hr.LogVerbosity.INFO,"userinfo found in proxy URI"),r=`${t.username}:${t.password}`):r=t.username);let i=t.hostname,s=t.port;s===""&&(s="80");let o={address:`${i}:${s}`};return r&&(o.creds=r),Mn("Proxy server "+o.address+" set by environment variable "+e),o}function pC(){let n=process.env.no_grpc_proxy,e="no_grpc_proxy";return n||(n=process.env.no_proxy,e="no_proxy"),n?(Mn("No proxy server list set by environment variable "+e),n.split(",")):[]}function mC(n,e){var t;let r={target:n,extraOptions:{}};if(((t=e["grpc.enable_http_proxy"])!==null&&t!==void 0?t:1)===0||n.scheme==="unix")return r;let i=fC();if(!i.address)return r;let s=(0,Qr.splitHostPort)(n.path);if(!s)return r;let o=s.host;for(let l of pC())if(l===o)return Mn("Not using proxy for target in no_proxy list: "+(0,Qr.uriToString)(n)),r;let a={"grpc.http_connect_target":(0,Qr.uriToString)(n)};return i.creds&&(a["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:a}}Yr.mapProxyName=mC;function gC(n,e,t){var r;if(!("grpc.http_connect_target"in e))return Promise.resolve({});let i=e["grpc.http_connect_target"],s=(0,Qr.parseUri)(i);if(s===null)return Promise.resolve({});let o=(0,Qr.splitHostPort)(s.path);if(o===null)return Promise.resolve({});let a=`${o.host}:${(r=o.port)!==null&&r!==void 0?r:dC.DEFAULT_PORT}`,l={method:"CONNECT",path:a},c={Host:a};(0,Ly.isTcpSubchannelAddress)(n)?(l.host=n.host,l.port=n.port):l.socketPath=n.path,"grpc.http_connect_creds"in e&&(c["Proxy-Authorization"]="Basic "+Buffer.from(e["grpc.http_connect_creds"]).toString("base64")),l.headers=c;let u=(0,Ly.subchannelAddressToString)(n);return Mn("Using proxy "+u+" to connect to "+l.path),new Promise((m,S)=>{let E=aC.request(l);E.once("connect",(_,w,C)=>{var k;if(E.removeAllListeners(),w.removeAllListeners(),_.statusCode===200)if(Mn("Successfully connected to "+l.path+" through proxy "+u),"secureContext"in t){let P=(0,oC.getDefaultAuthority)(s),M=(0,Qr.splitHostPort)(P),b=(k=M?.host)!==null&&k!==void 0?k:P,G=lC.connect(Object.assign({host:b,servername:b,socket:w},t),()=>{Mn("Successfully established a TLS connection to "+l.path+" through proxy "+u),m({socket:G,realTarget:s})});G.on("error",V=>{Mn("Failed to establish a TLS connection to "+l.path+" through proxy "+u+" with error "+V.message),S()})}else Mn("Successfully established a plaintext connection to "+l.path+" through proxy "+u),m({socket:w,realTarget:s});else(0,es.log)(Hr.LogVerbosity.ERROR,"Failed to connect to "+l.path+" through proxy "+u+" with status "+_.statusCode),S()}),E.once("error",_=>{E.removeAllListeners(),(0,es.log)(Hr.LogVerbosity.ERROR,"Failed to connect to proxy "+u+" with error "+_.message),S()}),E.end()})}Yr.getProxiedConnection=gC});var Mu=I(Uo=>{"use strict";Object.defineProperty(Uo,"__esModule",{value:!0});Uo.StreamDecoder=void 0;var an=(function(n){return n[n.NO_DATA=0]="NO_DATA",n[n.READING_SIZE=1]="READING_SIZE",n[n.READING_MESSAGE=2]="READING_MESSAGE",n})(an||{}),Pu=class{constructor(e){this.maxReadMessageLength=e,this.readState=an.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t=0,r,i=[];for(;t<e.length;)switch(this.readState){case an.NO_DATA:this.readCompressFlag=e.slice(t,t+1),t+=1,this.readState=an.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case an.READING_SIZE:if(r=Math.min(e.length-t,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,t,t+r),this.readSizeRemaining-=r,t+=r,this.readSizeRemaining===0){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),this.maxReadMessageLength!==-1&&this.readMessageSize>this.maxReadMessageLength)throw new Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=an.READING_MESSAGE;else{let s=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=an.NO_DATA,i.push(s)}}break;case an.READING_MESSAGE:if(r=Math.min(e.length-t,this.readMessageRemaining),this.readPartialMessage.push(e.slice(t,t+r)),this.readMessageRemaining-=r,t+=r,this.readMessageRemaining===0){let s=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),o=Buffer.concat(s,this.readMessageSize+5);this.readState=an.NO_DATA,i.push(o)}break;default:throw new Error("Unexpected read state")}return i}};Uo.StreamDecoder=Pu});var Fy=I(Vo=>{"use strict";Object.defineProperty(Vo,"__esModule",{value:!0});Vo.Http2SubchannelCall=void 0;var ln=re("http2"),yC=re("os"),ie=ne(),Ln=Ye(),vC=Mu(),SC=fe(),TC=ne(),EC="subchannel_call";function _C(n){for(let[e,t]of Object.entries(yC.constants.errno))if(t===n)return e;return"Unknown system error "+n}var Lu=class{constructor(e,t,r,i,s){var o;this.http2Stream=e,this.callEventTracker=t,this.listener=r,this.transport=i,this.callId=s,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=ie.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;let a=(o=i.getOptions()["grpc.max_receive_message_length"])!==null&&o!==void 0?o:ie.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new vC.StreamDecoder(a),e.on("response",(l,c)=>{let u="";for(let m of Object.keys(l))u+="		"+m+": "+l[m]+`
`;switch(this.trace(`Received server headers:
`+u),l[":status"]){case 400:this.mappedStatusCode=ie.Status.INTERNAL;break;case 401:this.mappedStatusCode=ie.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=ie.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=ie.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=ie.Status.UNAVAILABLE;break;default:this.mappedStatusCode=ie.Status.UNKNOWN}if(c&ln.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(l);else{let m;try{m=Ln.Metadata.fromHttp2Headers(l)}catch(S){this.endCall({code:ie.Status.UNKNOWN,details:S.message,metadata:new Ln.Metadata});return}this.listener.onReceiveMetadata(m)}}),e.on("trailers",l=>{this.handleTrailers(l)}),e.on("data",l=>{if(this.statusOutput)return;this.trace("receive HTTP/2 data frame of length "+l.length);let c;try{c=this.decoder.write(l)}catch(u){this.cancelWithStatus(ie.Status.RESOURCE_EXHAUSTED,u.message);return}for(let u of c)this.trace("parsed message of length "+u.length),this.callEventTracker.addMessageReceived(),this.tryPush(u)}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var l;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),((l=this.finalStatus)===null||l===void 0?void 0:l.code)===ie.Status.OK)return;let c,u="";switch(e.rstCode){case ln.constants.NGHTTP2_NO_ERROR:if(this.finalStatus!==null)return;c=ie.Status.INTERNAL,u=`Received RST_STREAM with code ${e.rstCode}`;break;case ln.constants.NGHTTP2_REFUSED_STREAM:c=ie.Status.UNAVAILABLE,u="Stream refused by server";break;case ln.constants.NGHTTP2_CANCEL:c=ie.Status.CANCELLED,u="Call cancelled";break;case ln.constants.NGHTTP2_ENHANCE_YOUR_CALM:c=ie.Status.RESOURCE_EXHAUSTED,u="Bandwidth exhausted or memory limit exceeded";break;case ln.constants.NGHTTP2_INADEQUATE_SECURITY:c=ie.Status.PERMISSION_DENIED,u="Protocol not secure enough";break;case ln.constants.NGHTTP2_INTERNAL_ERROR:c=ie.Status.INTERNAL,this.internalError===null?u=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:this.internalError.code==="ECONNRESET"||this.internalError.code==="ETIMEDOUT"?(c=ie.Status.UNAVAILABLE,u=this.internalError.message):u=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:c=ie.Status.INTERNAL,u=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:c,details:u,metadata:new Ln.Metadata,rstCode:e.rstCode})})}),e.on("error",l=>{l.code!=="ERR_HTTP2_STREAM_ERROR"&&(this.trace("Node error event: message="+l.message+" code="+l.code+" errno="+_C(l.errno)+" syscall="+l.syscall),this.internalError=l),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:ie.Status.UNAVAILABLE,details:"Connection dropped",metadata:new Ln.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){SC.trace(TC.LogVerbosity.DEBUG,EC,"["+this.callId+"] "+e)}endCall(e){(this.finalStatus===null||this.finalStatus.code===ie.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){this.finalStatus!==null&&(this.finalStatus.code!==ie.Status.OK||this.readsClosed&&this.unpushedReadMessages.length===0&&!this.isReadFilterPending&&!this.isPushPending)&&this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,!this.statusOutput&&(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){this.callEventTracker.onStreamEnd(!0);let t="";for(let l of Object.keys(e))t+="		"+l+": "+e[l]+`
`;this.trace(`Received server trailers:
`+t);let r;try{r=Ln.Metadata.fromHttp2Headers(e)}catch{r=new Ln.Metadata}let i=r.getMap(),s=this.mappedStatusCode;if(s===ie.Status.UNKNOWN&&typeof i["grpc-status"]=="string"){let l=Number(i["grpc-status"]);l in ie.Status&&(s=l,this.trace("received status code "+l+" from server")),r.remove("grpc-status")}let o="";if(typeof i["grpc-message"]=="string"){try{o=decodeURI(i["grpc-message"])}catch{o=i["grpc-message"]}r.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let a={code:s,details:o,metadata:r};this.endCall(a)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;((e=this.finalStatus)===null||e===void 0?void 0:e.code)===ie.Status.OK?t=ln.constants.NGHTTP2_NO_ERROR:t=ln.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new Ln.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(this.finalStatus!==null&&this.finalStatus.code!==ie.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let r=i=>{process.nextTick(()=>{var s;let o=ie.Status.UNAVAILABLE;i?.code==="ERR_STREAM_WRITE_AFTER_END"&&(o=ie.Status.INTERNAL),i&&this.cancelWithStatus(o,`Write error: ${i.message}`),(s=e.callback)===null||s===void 0||s.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,r)}catch(i){this.endCall({code:ie.Status.UNAVAILABLE,details:`Write failed with error ${i.message}`,metadata:new Ln.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}};Vo.Http2SubchannelCall=Lu});var Fu=I(zo=>{"use strict";Object.defineProperty(zo,"__esModule",{value:!0});zo.getNextCallNumber=void 0;var bC=0;function wC(){return bC++}zo.getNextCallNumber=wC});var Uy=I(jo=>{"use strict";Object.defineProperty(jo,"__esModule",{value:!0});jo.Http2SubchannelConnector=void 0;var zu=re("http2"),By=re("tls"),Bu=rr(),ts=ne(),CC=ku(),Xr=fe(),qy=Nt(),Go=xt(),Jr=et(),IC=re("net"),RC=Fy(),DC=Fu(),qu="transport",AC="transport_flowctrl",NC=wl().version,{HTTP2_HEADER_AUTHORITY:OC,HTTP2_HEADER_CONTENT_TYPE:xC,HTTP2_HEADER_METHOD:kC,HTTP2_HEADER_PATH:PC,HTTP2_HEADER_TE:MC,HTTP2_HEADER_USER_AGENT:LC}=zu.constants,FC=2e4,BC=Buffer.from("too_many_pings","ascii"),Uu=class{constructor(e,t,r,i){this.session=e,this.options=r,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=FC,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new Bu.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,Go.subchannelAddressToString)(t),r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,Bu.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[r["grpc.primary_user_agent"],`grpc-node-js/${NC}`,r["grpc.secondary_user_agent"]].filter(s=>s).join(" "),"grpc.keepalive_time_ms"in r&&(this.keepaliveTimeMs=r["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in r&&(this.keepaliveTimeoutMs=r["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in r?this.keepaliveWithoutCalls=r["grpc.keepalive_permit_without_calls"]===1:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(s,o,a)=>{let l=!1;s===zu.constants.NGHTTP2_ENHANCE_YOUR_CALM&&a&&a.equals(BC)&&(l=!0),this.trace("connection closed by GOAWAY with code "+s+" and data "+a?.toString()),this.reportDisconnectToOwner(l)}),e.once("error",s=>{this.trace("connection closed with error "+s.message)}),Xr.isTracerEnabled(qu)&&(e.on("remoteSettings",s=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))}),e.on("localSettings",s=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,r;let i=this.session.socket,s=i.remoteAddress?(0,Go.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,o=i.localAddress?(0,Go.stringToSubchannelAddress)(i.localAddress,i.localPort):null,a;if(this.session.encrypted){let c=i,u=c.getCipher(),m=c.getCertificate(),S=c.getPeerCertificate();a={cipherSuiteStandardName:(e=u.standardName)!==null&&e!==void 0?e:null,cipherSuiteOtherName:u.standardName?null:u.name,localCertificate:m&&"raw"in m?m.raw:null,remoteCertificate:S&&"raw"in S?S.raw:null}}else a=null;return{remoteAddress:s,localAddress:o,security:a,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:(t=this.session.state.localWindowSize)!==null&&t!==void 0?t:null,remoteFlowControlWindow:(r=this.session.state.remoteWindowSize)!==null&&r!==void 0?r:null}}trace(e){Xr.trace(ts.LogVerbosity.DEBUG,qu,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){Xr.trace(ts.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){Xr.trace(ts.LogVerbosity.DEBUG,AC,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){Xr.trace(ts.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),(t=(e=this.keepaliveTimeoutId).unref)===null||t===void 0||t.call(e));try{this.session.ping((r,i,s)=>{r&&(this.keepaliveTrace("Ping failed with error "+r.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch{this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):!this.keepaliveTimerId&&!this.keepaliveTimeoutId&&(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)===null||t===void 0?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),this.activeCalls.size===0&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),this.activeCalls.size===1&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,r,i,s){let o=e.toHttp2Headers();o[OC]=t,o[LC]=this.userAgent,o[xC]="application/grpc",o[kC]="POST",o[PC]=r,o[MC]="trailers";let a;try{a=this.session.request(o)}catch(u){throw this.handleDisconnect(),u}this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed);let l,c;return this.channelzEnabled?(this.streamTracker.addCallStarted(),l={addMessageSent:()=>{var u;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var m;(m=s.onCallEnd)===null||m===void 0||m.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var m;u?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),(m=s.onStreamEnd)===null||m===void 0||m.call(s,u)}}):l={addMessageSent:()=>{var u;(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var m;(m=s.onCallEnd)===null||m===void 0||m.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var m;(m=s.onStreamEnd)===null||m===void 0||m.call(s,u)}},c=new RC.Http2SubchannelCall(a,l,i,this,(0,DC.getNextCallNumber)()),this.addActiveCall(c),c}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,Bu.unregisterChannelzRef)(this.channelzRef)}},Vu=class{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){Xr.trace(ts.LogVerbosity.DEBUG,qu,(0,Jr.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,r,i){return this.isShutdown?Promise.reject():new Promise((s,o)=>{var a,l,c;let u;i.realTarget?(u=(0,Jr.uriToString)(i.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,Jr.uriToString)(i.realTarget))):(u=null,this.trace("creating HTTP/2 session to "+(0,Go.subchannelAddressToString)(e)));let m=(0,qy.getDefaultAuthority)((a=i.realTarget)!==null&&a!==void 0?a:this.channelTarget),S=t._getConnectionOptions()||{};S.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in r?S.maxSessionMemory=r["grpc-node.max_session_memory"]:S.maxSessionMemory=Number.MAX_SAFE_INTEGER;let E="http://";if("secureContext"in S){if(E="https://",r["grpc.ssl_target_name_override"]){let C=r["grpc.ssl_target_name_override"];S.checkServerIdentity=(k,P)=>(0,By.checkServerIdentity)(C,P),S.servername=C}else{let C=(c=(l=(0,Jr.splitHostPort)(m))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";S.servername=C}i.socket&&(S.createConnection=(C,k)=>i.socket)}else S.createConnection=(C,k)=>i.socket?i.socket:IC.connect(e);S=Object.assign(Object.assign(Object.assign({},S),e),{enableTrace:r["grpc-node.tls_enable_trace"]===1});let _=zu.connect(E+m,S);this.session=_;let w="Failed to connect";_.unref(),_.once("connect",()=>{_.removeAllListeners(),s(new Uu(_,e,r,u)),this.session=null}),_.once("close",()=>{this.session=null,setImmediate(()=>{o(`${w} (${new Date().toISOString()})`)})}),_.once("error",C=>{w=C.message,this.trace("connection failed with error "+w)})})}connect(e,t,r){var i,s;if(this.isShutdown)return Promise.reject();let o=t._getConnectionOptions()||{};if("secureContext"in o){if(o.ALPNProtocols=["h2"],r["grpc.ssl_target_name_override"]){let a=r["grpc.ssl_target_name_override"];o.checkServerIdentity=(l,c)=>(0,By.checkServerIdentity)(a,c),o.servername=a}else if("grpc.http_connect_target"in r){let a=(0,qy.getDefaultAuthority)((i=(0,Jr.parseUri)(r["grpc.http_connect_target"]))!==null&&i!==void 0?i:{path:"localhost"}),l=(0,Jr.splitHostPort)(a);o.servername=(s=l?.host)!==null&&s!==void 0?s:a}r["grpc-node.tls_enable_trace"]&&(o.enableTrace=!0)}return(0,CC.getProxiedConnection)(e,r,o).then(a=>this.createSession(e,t,r,a))}shutdown(){var e;this.isShutdown=!0,(e=this.session)===null||e===void 0||e.close(),this.session=null}};jo.Http2SubchannelConnector=Vu});var Vy=I(Zr=>{"use strict";Object.defineProperty(Zr,"__esModule",{value:!0});Zr.getSubchannelPool=Zr.SubchannelPool=void 0;var qC=Ap(),UC=Oy(),VC=xt(),zC=et(),GC=Uy(),jC=1e4,ns=class{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let i=this.pool[t].filter(s=>!s.subchannel.unrefIfOneRef());i.length>0&&(e=!1),this.pool[t]=i}e&&this.cleanupTimer!==null&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;this.cleanupTimer===null&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},jC),(t=(e=this.cleanupTimer).unref)===null||t===void 0||t.call(e))}getOrCreateSubchannel(e,t,r,i){this.ensureCleanupTask();let s=(0,zC.uriToString)(e);if(s in this.pool){let a=this.pool[s];for(let l of a)if((0,VC.subchannelAddressEqual)(t,l.subchannelAddress)&&(0,qC.channelOptionsEqual)(r,l.channelArguments)&&i._equals(l.channelCredentials))return l.subchannel}let o=new UC.Subchannel(e,t,r,i,new GC.Http2SubchannelConnector(e));return s in this.pool||(this.pool[s]=[]),this.pool[s].push({subchannelAddress:t,channelArguments:r,channelCredentials:i,subchannel:o}),o.ref(),o}};Zr.SubchannelPool=ns;var $C=new ns;function KC(n){return n?$C:new ns}Zr.getSubchannelPool=KC});var ju=I(ei=>{"use strict";Object.defineProperty(ei,"__esModule",{value:!0});ei.FilterStackFactory=ei.FilterStack=void 0;var $o=class{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMessage(t);return t}receiveMessage(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}};ei.FilterStack=$o;var Gu=class n{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new n([...this.factories])}createFilter(){return new $o(this.factories.map(e=>e.createFilter()))}};ei.FilterStackFactory=Gu});var $u=I(Ko=>{"use strict";Object.defineProperty(Ko,"__esModule",{value:!0});Ko.CompressionAlgorithms=void 0;var zy=(function(n){return n[n.identity=0]="identity",n[n.deflate=1]="deflate",n[n.gzip=2]="gzip",n})(zy||(Ko.CompressionAlgorithms=zy={}))});var Wu=I(Wo=>{"use strict";Object.defineProperty(Wo,"__esModule",{value:!0});Wo.BaseFilter=void 0;var Ku=class{async sendMetadata(e){return e}receiveMetadata(e){return e}async sendMessage(e){return e}async receiveMessage(e){return e}receiveTrailers(e){return e}};Wo.BaseFilter=Ku});var $y=I(ni=>{"use strict";Object.defineProperty(ni,"__esModule",{value:!0});ni.CompressionFilterFactory=ni.CompressionFilter=void 0;var Ho=re("zlib"),jy=$u(),Qo=ne(),WC=Wu(),HC=fe(),QC=n=>typeof n=="number"&&typeof jy.CompressionAlgorithms[n]=="string",ti=class{async writeMessage(e,t){let r=e;t&&(r=await this.compressMessage(r));let i=Buffer.allocUnsafe(r.length+5);return i.writeUInt8(t?1:0,0),i.writeUInt32BE(r.length,1),r.copy(i,5),i}async readMessage(e){let t=e.readUInt8(0)===1,r=e.slice(5);return t&&(r=await this.decompressMessage(r)),r}},ir=class extends ti{async compressMessage(e){return e}async writeMessage(e,t){let r=Buffer.allocUnsafe(e.length+5);return r.writeUInt8(0,0),r.writeUInt32BE(e.length,1),e.copy(r,5),r}decompressMessage(e){return Promise.reject(new Error('Received compressed message but "grpc-encoding" header was identity'))}},Hu=class extends ti{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{Ho.deflate(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,s=[],o=Ho.createInflate();o.on("data",a=>{s.push(a),i+=a.byteLength,this.maxRecvMessageLength!==-1&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:Qo.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(s))}),o.write(e),o.end()})}},Qu=class extends ti{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{Ho.gzip(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,s=[],o=Ho.createGunzip();o.on("data",a=>{s.push(a),i+=a.byteLength,this.maxRecvMessageLength!==-1&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:Qo.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(s))}),o.write(e),o.end()})}},Yu=class extends ti{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(new Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(new Error(`Compression method not supported: ${this.compressionName}`))}};function Gy(n,e){switch(n){case"identity":return new ir;case"deflate":return new Hu(e);case"gzip":return new Qu(e);default:return new Yu(n)}}var Yo=class extends WC.BaseFilter{constructor(e,t){var r,i;super(),this.sharedFilterConfig=t,this.sendCompression=new ir,this.receiveCompression=new ir,this.currentCompressionAlgorithm="identity";let s=e["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=(r=e["grpc.max_receive_message_length"])!==null&&r!==void 0?r:Qo.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,s!==void 0)if(QC(s)){let o=jy.CompressionAlgorithms[s],a=(i=t.serverSupportedEncodingHeader)===null||i===void 0?void 0:i.split(",");(!a||a.includes(o))&&(this.currentCompressionAlgorithm=o,this.sendCompression=Gy(this.currentCompressionAlgorithm,-1))}else HC.log(Qo.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${s}`)}async sendMetadata(e){let t=await e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),this.currentCompressionAlgorithm==="identity"?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let i=t[0];typeof i=="string"&&(this.receiveCompression=Gy(i,this.maxReceiveMessageLength))}e.remove("grpc-encoding");let r=e.get("grpc-accept-encoding")[0];return r&&(this.sharedFilterConfig.serverSupportedEncodingHeader=r,r.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new ir,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}async sendMessage(e){var t;let r=await e,i;return this.sendCompression instanceof ir?i=!1:i=(((t=r.flags)!==null&&t!==void 0?t:0)&2)===0,{message:await this.sendCompression.writeMessage(r.message,i),flags:r.flags}}async receiveMessage(e){return this.receiveCompression.readMessage(await e)}};ni.CompressionFilter=Yo;var Ju=class{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new Yo(this.options,this.sharedFilterConfig)}};ni.CompressionFilterFactory=Ju});var Jo=I(zt=>{"use strict";Object.defineProperty(zt,"__esModule",{value:!0});zt.deadlineToString=zt.getRelativeTimeout=zt.getDeadlineTimeoutString=zt.minDeadline=void 0;function YC(...n){let e=1/0;for(let t of n){let r=t instanceof Date?t.getTime():t;r<e&&(e=r)}return e}zt.minDeadline=YC;var JC=[["m",1],["S",1e3],["M",60*1e3],["H",3600*1e3]];function XC(n){let e=new Date().getTime();n instanceof Date&&(n=n.getTime());let t=Math.max(n-e,0);for(let[r,i]of JC){let s=t/i;if(s<1e8)return String(Math.ceil(s))+r}throw new Error("Deadline is too far in the future")}zt.getDeadlineTimeoutString=XC;var ZC=2147483647;function eI(n){let e=n instanceof Date?n.getTime():n,t=new Date().getTime(),r=e-t;return r<0?0:r>ZC?1/0:r}zt.getRelativeTimeout=eI;function tI(n){if(n instanceof Date)return n.toISOString();{let e=new Date(n);return Number.isNaN(e.getTime())?""+n:e.toISOString()}}zt.deadlineToString=tI});var Zo=I(Xo=>{"use strict";Object.defineProperty(Xo,"__esModule",{value:!0});Xo.restrictControlPlaneStatusCode=void 0;var Gt=ne(),nI=[Gt.Status.OK,Gt.Status.INVALID_ARGUMENT,Gt.Status.NOT_FOUND,Gt.Status.ALREADY_EXISTS,Gt.Status.FAILED_PRECONDITION,Gt.Status.ABORTED,Gt.Status.OUT_OF_RANGE,Gt.Status.DATA_LOSS];function rI(n,e){return nI.includes(n)?{code:Gt.Status.INTERNAL,details:`Invalid status from control plane: ${n} ${Gt.Status[n]} ${e}`}:{code:n,details:e}}Xo.restrictControlPlaneStatusCode=rI});var Wy=I(na=>{"use strict";Object.defineProperty(na,"__esModule",{value:!0});na.LoadBalancingCall=void 0;var Ky=ct(),ea=ne(),iI=Jo(),ta=Ye(),rs=En(),sI=et(),oI=fe(),Xu=Zo(),aI=re("http2"),lI="load_balancing_call",Zu=class{constructor(e,t,r,i,s,o,a){var l,c;this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let u=this.methodName.split("/"),m="";u.length>=2&&(m=u[1]);let S=(c=(l=(0,sI.splitHostPort)(this.host))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";this.serviceUrl=`https://${S}/${m}`}trace(e){oI.trace(ea.LogVerbosity.DEBUG,lI,"["+this.callNumber+"] "+e)}outputStatus(e,t){var r,i;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let s=Object.assign(Object.assign({},e),{progress:t});(r=this.listener)===null||r===void 0||r.onReceiveStatus(s),(i=this.onCallEnded)===null||i===void 0||i.call(this,s.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw new Error("doPick called before start");this.trace("Pick called");let r=this.channel.doPick(this.metadata,this.callConfig.pickInformation),i=r.subchannel?"("+r.subchannel.getChannelzRef().id+") "+r.subchannel.getAddress():""+r.subchannel;switch(this.trace("Pick result: "+rs.PickResultType[r.pickResultType]+" subchannel: "+i+" status: "+((e=r.status)===null||e===void 0?void 0:e.code)+" "+((t=r.status)===null||t===void 0?void 0:t.details)),r.pickResultType){case rs.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(a=>{var l,c,u;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let m=this.metadata.clone();if(m.merge(a),m.get("authorization").length>1&&this.outputStatus({code:ea.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new ta.Metadata},"PROCESSED"),r.subchannel.getConnectivityState()!==Ky.ConnectivityState.READY){this.trace("Picked subchannel "+i+" has state "+Ky.ConnectivityState[r.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&m.set("grpc-timeout",(0,iI.getDeadlineTimeoutString)(this.deadline));try{this.child=r.subchannel.getRealSubchannel().createCall(m,this.host,this.methodName,{onReceiveMetadata:S=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(S)},onReceiveMessage:S=>{this.trace("Received message"),this.listener.onReceiveMessage(S)},onReceiveStatus:S=>{this.trace("Received status"),S.rstCode===aI.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(S,"REFUSED"):this.outputStatus(S,"PROCESSED")}})}catch(S){this.trace("Failed to start call on picked subchannel "+i+" with error "+S.message),this.outputStatus({code:ea.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+S.message,metadata:new ta.Metadata},"NOT_STARTED");return}(c=(l=this.callConfig).onCommitted)===null||c===void 0||c.call(l),(u=r.onCallStarted)===null||u===void 0||u.call(r),this.onCallEnded=r.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},a=>{let{code:l,details:c}=(0,Xu.restrictControlPlaneStatusCode)(typeof a.code=="number"?a.code:ea.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${a.message}`);this.outputStatus({code:l,details:c,metadata:new ta.Metadata},"PROCESSED")});break;case rs.PickResultType.DROP:let{code:s,details:o}=(0,Xu.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:s,details:o,metadata:r.status.metadata},"DROP")});break;case rs.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:a,details:l}=(0,Xu.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:a,details:l,metadata:r.status.metadata},"PROCESSED")})}break;case rs.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new ta.Metadata},"PROCESSED")}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw new Error("Method not implemented.")}getCallNumber(){return this.callNumber}};na.LoadBalancingCall=Zu});var Qy=I(ia=>{"use strict";Object.defineProperty(ia,"__esModule",{value:!0});ia.ResolvingCall=void 0;var ri=ne(),ra=Jo(),Hy=Ye(),cI=fe(),uI=Zo(),dI="resolving_call",ed=class{constructor(e,t,r,i,s,o){this.channel=e,this.method=t,this.filterStackFactory=i,this.credentials=s,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=r.deadline,this.host=r.host,r.parentCall&&(r.flags&ri.Propagate.CANCELLATION&&r.parentCall.on("cancelled",()=>{this.cancelWithStatus(ri.Status.CANCELLED,"Cancelled by parent call")}),r.flags&ri.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+r.parentCall.getDeadline()),this.deadline=(0,ra.minDeadline)(this.deadline,r.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){cI.trace(ri.LogVerbosity.DEBUG,dI,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,ra.deadlineToString)(this.deadline));let e=(0,ra.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(ri.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(r=>r(t)),process.nextTick(()=>{var r;(r=this.listener)===null||r===void 0||r.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw new Error("sendMessageonChild called with child not populated");let r=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(i=>{this.writeFilterPending=!1,r.sendMessageWithContext(e,i.message),this.pendingHalfClose&&r.halfClose()},i=>{this.cancelWithStatus(i.code,i.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw new Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if(e.type==="NONE"){this.channel.queueCallForConfig(this);return}else if(e.type==="ERROR"){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error);return}let t=e.config;if(t.status!==ri.Status.OK){let{code:r,details:i}=(0,uI.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:r,details:i,metadata:new Hy.Metadata});return}if(t.methodConfig.timeout){let r=new Date;r.setSeconds(r.getSeconds()+t.methodConfig.timeout.seconds),r.setMilliseconds(r.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,ra.minDeadline)(this.deadline,r),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(r=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(r,{onReceiveMetadata:i=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(i))},onReceiveMessage:i=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(i).then(s=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(s),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},s=>{this.cancelWithStatus(s.code,s.details)})},onReceiveStatus:i=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=i:this.outputStatus(i)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},r=>{this.outputStatus(r)})}reportResolverError(e){var t;!((t=this.metadata)===null||t===void 0)&&t.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new Hy.Metadata})}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}};ia.ResolvingCall=ed});var Yy=I(Fn=>{"use strict";Object.defineProperty(Fn,"__esModule",{value:!0});Fn.RetryingCall=Fn.MessageBufferTracker=Fn.RetryThrottler=void 0;var sa=ne(),hI=Ye(),fI=fe(),pI="retrying_call",nd=class{constructor(e,t,r){this.maxTokens=e,this.tokenRatio=t,r?this.tokens=r.tokens*(e/r.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}};Fn.RetryThrottler=nd;var rd=class{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var r;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;return this.limitPerCall-i<e||this.totalLimit-this.totalAllocated<e?!1:(this.allocatedPerCall.set(t,i+e),this.totalAllocated+=e,!0)}free(e,t){var r;if(this.totalAllocated<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;if(i<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${i}`);this.allocatedPerCall.set(t,i-e)}freeAll(e){var t;let r=(t=this.allocatedPerCall.get(e))!==null&&t!==void 0?t:0;if(this.totalAllocated<r)throw new Error(`Invalid buffer allocation state: call ${e} allocated ${r} > total allocated ${this.totalAllocated}`);this.totalAllocated-=r,this.allocatedPerCall.delete(e)}};Fn.MessageBufferTracker=rd;var td="grpc-previous-rpc-attempts",id=class{constructor(e,t,r,i,s,o,a,l,c){if(this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.bufferTracker=l,this.retryThrottler=c,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let u=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(u.initialBackoff.substring(0,u.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){fI.trace(sa.LogVerbosity.DEBUG,pI,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;(t=this.listener)===null||t===void 0||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new hI.Metadata});for(let{call:r}of this.underlyingCalls)r.cancelWithStatus(e,t)}getPeer(){return this.committedCallIndex!==null?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return(t=this.writeBuffer[e-this.writeBufferOffset])!==null&&t!==void 0?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if(this.state!=="COMMITTED")return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let r=this.getBufferEntry(t);r.allocated&&this.bufferTracker.free(r.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if(this.state!=="COMMITTED"&&this.underlyingCalls[e].state!=="COMPLETED"){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&this.underlyingCalls[t].state!=="COMPLETED"&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(sa.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if(this.state==="COMMITTED")return;let e=-1,t=-1;for(let[r,i]of this.underlyingCalls.entries())i.state==="ACTIVE"&&i.nextMessageToSend>e&&(e=i.nextMessageToSend,t=r);t===-1?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(r=>r===t||r.toString().toLowerCase()===sa.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=(e=this.callConfig)===null||e===void 0?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let r=Math.random()*this.nextRetryBackoffSec*1e3,i=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,i),r}maybeRetryCall(e,t){if(this.state!=="RETRY"){t(!1);return}let r=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(r.maxAttempts,5)){t(!1);return}let i;if(e===null)i=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else i=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var s,o;if(this.state!=="RETRY"){t(!1);return}(!((o=(s=this.retryThrottler)===null||s===void 0?void 0:s.canRetryCall())!==null&&o!==void 0)||o)&&(t(!0),this.attempts+=1,this.startNewAttempt())},i)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,r){var i,s,o;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList((i=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)!==null&&i!==void 0?i:[],e.code)){(s=this.retryThrottler)===null||s===void 0||s.addCallFailed();let a;if(r===null)a=0;else if(r<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else a=r;setTimeout(()=>{this.maybeStartHedgingAttempt(),this.countActiveCalls()===0&&(this.commitCall(t),this.reportStatus(e))},a)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?((o=this.retryThrottler)===null||o===void 0||o.addCallFailed(),this.maybeRetryCall(r,a=>{a||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e));break}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(t.length===0)return null;try{return parseInt(t[0])}catch{return-1}}handleChildStatus(e,t){var r;if(this.underlyingCalls[t].state==="COMPLETED")return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===sa.Status.OK){(r=this.retryThrottler)===null||r===void 0||r.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if(this.state==="COMMITTED"){this.reportStatus(e);return}let i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i);break}}maybeStartHedgingAttempt(){if(this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,r;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let i=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(i.maxAttempts,5))return;let s=(e=i.hedgingDelay)!==null&&e!==void 0?e:"0s",o=Number(s.substring(0,s.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},o*1e3),(r=(t=this.hedgingTimer).unref)===null||r===void 0||r.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let r=this.attempts-1,i=this.initialMetadata.clone();r>0&&i.set(td,`${r}`);let s=!1;e.start(i,{onReceiveMetadata:o=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),s=!0,r>0&&o.set(td,`${r}`),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMetadata(o)},onReceiveMessage:o=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMessage(o)},onReceiveStatus:o=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!s&&r>0&&o.metadata.set(td,`${r}`),this.handleChildStatus(o,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,r;let i=this.underlyingCalls[e],s=i.nextMessageToSend;(r=(t=this.getBufferEntry(s)).callback)===null||r===void 0||r.call(t),this.clearSentMessages(),i.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if(t.state!=="COMPLETED"&&this.getBufferEntry(t.nextMessageToSend)){let r=this.getBufferEntry(t.nextMessageToSend);switch(r.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:i=>{this.handleChildWriteCompleted(e)}},r.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose();break;case"FREED":break}}}sendMessageWithContext(e,t){var r;this.trace("write() called with message of length "+t.length);let i={message:t,flags:e.flags},s=this.getNextBufferIndex(),o={entryType:"MESSAGE",message:i,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(o),o.allocated){(r=e.callback)===null||r===void 0||r.call(e);for(let[a,l]of this.underlyingCalls.entries())l.state==="ACTIVE"&&l.nextMessageToSend===s&&l.call.sendMessageWithContext({callback:c=>{this.handleChildWriteCompleted(a)}},t)}else{if(this.commitCallWithMostMessages(),this.committedCallIndex===null)return;let a=this.underlyingCalls[this.committedCallIndex];o.callback=e.callback,a.state==="ACTIVE"&&a.nextMessageToSend===s&&a.call.sendMessageWithContext({callback:l=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){this.trace("startRead called"),this.readStarted=!0;for(let e of this.underlyingCalls)e?.state==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1});for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw new Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}};Fn.RetryingCall=id});var aa=I(oa=>{"use strict";Object.defineProperty(oa,"__esModule",{value:!0});oa.BaseSubchannelWrapper=void 0;var sd=class{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}};oa.BaseSubchannelWrapper=sd});var Zy=I(ua=>{"use strict";Object.defineProperty(ua,"__esModule",{value:!0});ua.InternalChannel=void 0;var mI=$s(),gI=Dp(),yI=Vy(),Jy=En(),is=ne(),vI=ju(),SI=$y(),Xy=Nt(),od=fe(),TI=ku(),la=et(),jt=ct(),ss=rr(),EI=Wy(),_I=Jo(),bI=Qy(),ad=Fu(),wI=Zo(),ld=Yy(),CI=aa(),II=2147483647,RI=1e3,DI=1800*1e3,ca=new Map,AI=1<<24,NI=1<<20,cd=class extends CI.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(r,i,s,o)=>{t.throttleKeepalive(o)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}},ud=class{constructor(e,t,r){var i,s,o,a,l,c,u,m;if(this.credentials=t,this.options=r,this.connectivityState=jt.ConnectivityState.IDLE,this.currentPicker=new Jy.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new ss.ChannelzCallTracker,this.childrenTracker=new ss.ChannelzChildrenTracker,typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof mI.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.originalTarget=e;let S=(0,la.parseUri)(e);if(S===null)throw new Error(`Could not parse target name "${e}"`);let E=(0,Xy.mapUriDefaultScheme)(S);if(E===null)throw new Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},II),(s=(i=this.callRefTimer).unref)===null||s===void 0||s.call(i),this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new ss.ChannelzTrace,this.channelzRef=(0,ss.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,Xy.getDefaultAuthority)(E);let _=(0,TI.mapProxyName)(E,r);this.target=_.target,this.options=Object.assign({},this.options,_.extraOptions),this.subchannelPool=(0,yI.getSubchannelPool)(((o=r["grpc.use_local_subchannel_pool"])!==null&&o!==void 0?o:0)===0),this.retryBufferTracker=new ld.MessageBufferTracker((a=r["grpc.retry_buffer_size"])!==null&&a!==void 0?a:AI,(l=r["grpc.per_rpc_retry_buffer_size"])!==null&&l!==void 0?l:NI),this.keepaliveTime=(c=r["grpc.keepalive_time_ms"])!==null&&c!==void 0?c:-1,this.idleTimeoutMs=Math.max((u=r["grpc.client_idle_timeout_ms"])!==null&&u!==void 0?u:DI,RI);let w={createSubchannel:(k,P)=>{let M=this.subchannelPool.getOrCreateSubchannel(this.target,k,Object.assign({},this.options,P),this.credentials);M.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",M.getChannelzRef());let b=new cd(M,this);return this.wrappedSubchannels.add(b),b},updateState:(k,P)=>{this.currentPicker=P;let M=this.pickQueue.slice();this.pickQueue=[],M.length>0&&this.callRefTimerUnref();for(let b of M)b.doPick();this.updateState(k)},requestReresolution:()=>{throw new Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:k=>{this.channelzEnabled&&this.childrenTracker.refChild(k)},removeChannelzChild:k=>{this.channelzEnabled&&this.childrenTracker.unrefChild(k)}};this.resolvingLoadBalancer=new gI.ResolvingLoadBalancer(this.target,w,r,(k,P)=>{k.retryThrottling?ca.set(this.getTarget(),new ld.RetryThrottler(k.retryThrottling.maxTokens,k.retryThrottling.tokenRatio,ca.get(this.getTarget()))):ca.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=P,this.currentResolutionError=null,process.nextTick(()=>{let M=this.configSelectionQueue;this.configSelectionQueue=[],M.length>0&&this.callRefTimerUnref();for(let b of M)b.getConfig()})},k=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+k.code+' and details "'+k.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),this.configSelector===null&&(this.currentResolutionError=Object.assign(Object.assign({},(0,wI.restrictControlPlaneStatusCode)(k.code,k.details)),{metadata:k.metadata}));let P=this.configSelectionQueue;this.configSelectionQueue=[],P.length>0&&this.callRefTimerUnref();for(let M of P)M.reportResolverError(k)}),this.filterStackFactory=new vI.FilterStackFactory([new SI.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(r,void 0,2));let C=new Error;(0,od.trace)(is.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+`) Channel constructed 
`+((m=C.stack)===null||m===void 0?void 0:m.substring(C.stack.indexOf(`
`)+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,od.trace)(t??is.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,la.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,r,i;!((t=(e=this.callRefTimer).hasRef)===null||t===void 0)&&t.call(e)||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(i=(r=this.callRefTimer).ref)===null||i===void 0||i.call(r))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(t=(e=this.callRefTimer).unref)===null||t===void 0||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(r=>r===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){(0,od.trace)(is.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,la.uriToString)(this.target)+" "+jt.ConnectivityState[this.connectivityState]+" -> "+jt.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+jt.ConnectivityState[e]),this.connectivityState=e;let t=this.connectivityStateWatchers.slice();for(let r of t)e!==r.currentState&&(r.timer&&clearTimeout(r.timer),this.removeConnectivityStateWatcher(r),r.callback());e!==jt.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime){this.keepaliveTime=e;for(let t of this.wrappedSubchannels)t.throttleKeepalive(e)}}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return this.resolvingLoadBalancer.exitIdle(),this.configSelector?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(jt.ConnectivityState.IDLE),this.currentPicker=new Jy.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,r;this.idleTimer=setTimeout(()=>{if(this.callCount>0){this.startIdleTimeout(this.idleTimeoutMs);return}let s=new Date().valueOf()-this.lastActivityTimestamp.valueOf();s>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-s)},e),(r=(t=this.idleTimer).unref)===null||r===void 0||r.call(t)}maybeStartIdleTimer(){this.connectivityState!==jt.ConnectivityState.SHUTDOWN&&!this.idleTimer&&this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===is.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,r,i,s){let o=(0,ad.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+o+'] method="'+t+'"'),new EI.LoadBalancingCall(this,e,t,r,i,s,o)}createRetryingCall(e,t,r,i,s){let o=(0,ad.getNextCallNumber)();return this.trace("createRetryingCall ["+o+'] method="'+t+'"'),new ld.RetryingCall(this,e,t,r,i,s,o,this.retryBufferTracker,ca.get(this.getTarget()))}createInnerCall(e,t,r,i,s){return this.options["grpc.enable_retries"]===0?this.createLoadBalancingCall(e,t,r,i,s):this.createRetryingCall(e,t,r,i,s)}createResolvingCall(e,t,r,i,s){let o=(0,ad.getNextCallNumber)();this.trace("createResolvingCall ["+o+'] method="'+e+'", deadline='+(0,_I.deadlineToString)(t));let a={deadline:t,flags:s??is.Propagate.DEFAULTS,host:r??this.defaultAuthority,parentCall:i},l=new bI.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),o);return this.onCallStart(),l.addStatusWatcher(c=>{this.onCallEnd(c)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(jt.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,ss.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,la.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,r){if(this.connectivityState===jt.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");let i=null;if(t!==1/0){let o=t instanceof Date?t:new Date(t),a=new Date;if(t===-1/0||o<=a){process.nextTick(r,new Error("Deadline passed without connectivity state change"));return}i=setTimeout(()=>{this.removeConnectivityStateWatcher(s),r(new Error("Deadline passed without connectivity state change"))},o.getTime()-a.getTime())}let s={currentState:e,callback:r,timer:i};this.connectivityStateWatchers.push(s)}getChannelzRef(){return this.channelzRef}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===jt.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");return this.createResolvingCall(e,t,r,i,s)}};ua.InternalChannel=ud});var fc=I(da=>{"use strict";Object.defineProperty(da,"__esModule",{value:!0});da.ChannelImplementation=void 0;var OI=$s(),xI=Zy(),dd=class{constructor(e,t,r){if(typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof OI.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.internalChannel=new xI.InternalChannel(e,t,r)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,r){this.internalChannel.watchConnectivityState(e,t,r)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,r,i,s)}};da.ChannelImplementation=dd});var lv=I(gt=>{"use strict";Object.defineProperty(gt,"__esModule",{value:!0});gt.Http2ServerCallStream=gt.ServerDuplexStreamImpl=gt.ServerWritableStreamImpl=gt.ServerReadableStreamImpl=gt.ServerUnaryCallImpl=void 0;var sv=re("events"),ii=re("http2"),pd=re("stream"),ev=re("zlib"),ce=ne(),md=Ye(),kI=Mu(),ov=fe(),as=qs(),av="server_call";function os(n){ov.trace(ce.LogVerbosity.DEBUG,av,n)}var PI="grpc-accept-encoding",MI="grpc-encoding",tv="grpc-message",nv="grpc-status",rv="grpc-timeout",LI=/(\d{1,8})\s*([HMSmun])/,FI={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},BI={[PI]:"identity,deflate,gzip",[MI]:"identity"},iv={[ii.constants.HTTP2_HEADER_STATUS]:ii.constants.HTTP_STATUS_OK,[ii.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},qI={waitForTrailers:!0},hd=class extends sv.EventEmitter{constructor(e,t,r){super(),this.call=e,this.metadata=t,this.request=r,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};gt.ServerUnaryCallImpl=hd;var ha=class extends pd.Readable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=r,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};gt.ServerReadableStreamImpl=ha;var ls=class extends pd.Writable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.request=i,this.cancelled=!1,this.trailingMetadata=new md.Metadata,this.call.setupSurfaceCall(this),this.on("error",s=>{this.call.sendError(s),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,r){try{let i=this.call.serializeMessage(e);if(!this.call.write(i)){this.call.once("drain",r);return}}catch(i){this.emit("error",{details:(0,as.getErrorMessage)(i),code:ce.Status.INTERNAL})}r()}_final(e){this.call.sendStatus({code:ce.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}};gt.ServerWritableStreamImpl=ls;var si=class extends pd.Duplex{constructor(e,t,r,i,s){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.deserialize=i,this.cancelled=!1,this.trailingMetadata=new md.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,s),this.on("error",o=>{this.call.sendError(o),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}};gt.ServerDuplexStreamImpl=si;si.prototype._read=ha.prototype._read;si.prototype._write=ls.prototype._write;si.prototype._final=ls.prototype._final;var fd=class extends sv.EventEmitter{constructor(e,t,r){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=ce.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=ce.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",i=>{}),this.stream.once("close",()=>{var i;os("Request to method "+((i=this.handler)===null||i===void 0?void 0:i.path)+" stream closed with rstCode "+this.stream.rstCode),this.statusSent||(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:ce.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in r&&(this.maxSendMessageSize=r["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in r&&(this.maxReceiveMessageSize=r["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){let r=e.subarray(5);if(t==="identity")return r;if(t==="deflate"||t==="gzip"){let i;return t==="deflate"?i=ev.createInflate():i=ev.createGunzip(),new Promise((s,o)=>{let a=0,l=[];i.on("data",c=>{l.push(c),a+=c.byteLength,this.maxReceiveMessageSize!==-1&&a>this.maxReceiveMessageSize&&(i.destroy(),o({code:ce.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),i.on("end",()=>{s(Buffer.concat(l))}),i.write(r),i.end()})}else return Promise.reject({code:ce.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`})}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,r=Object.assign(Object.assign(Object.assign({},iv),BI),t);this.stream.respond(r,qI)}receiveMetadata(e){let t=md.Metadata.fromHttp2Headers(e);ov.isTracerEnabled(av)&&os("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let r=t.get(rv);if(r.length>0){let i=r[0].toString().match(LI);if(i===null){let a=new Error("Invalid deadline");return a.code=ce.Status.OUT_OF_RANGE,this.sendError(a),t}let s=+i[1]*FI[i[2]]|0,o=new Date;this.deadline=o.setMilliseconds(o.getMilliseconds()+s),this.deadlineTimer=setTimeout(UI,s,this),t.remove(rv)}return t.remove(ii.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(ii.constants.HTTP2_HEADER_TE),t.remove(ii.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,r)=>{let{stream:i}=this,s=0,o=this,a=[],l=this.maxReceiveMessageSize;this.stream.on("data",c),this.stream.on("end",u),this.stream.on("error",u);function c(m){if(s+=m.byteLength,l!==-1&&s>l){i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),r({code:ce.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${s} vs. ${l})`});return}a.push(m)}function u(m){if(i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),m!==void 0){r({code:ce.Status.INTERNAL,details:m.message});return}if(s===0){r({code:ce.Status.INTERNAL,details:"received empty unary message"});return}o.emit("receiveMessage");let S=Buffer.concat(a,s),_=S.readUInt8(0)===1?e:"identity",w=o.getDecompressedMessage(S,_);if(Buffer.isBuffer(w)){t(o.deserializeMessageWithInternalError(w));return}w.then(C=>t(o.deserializeMessageWithInternalError(C)),C=>r(C.code?C:{code:ce.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}})}async deserializeMessageWithInternalError(e){try{return this.deserializeMessage(e)}catch(t){throw{details:(0,as.getErrorMessage)(t),code:ce.Status.INTERNAL}}}serializeMessage(e){let t=this.handler.serialize(e),r=t.byteLength,i=Buffer.allocUnsafe(r+5);return i.writeUInt8(0,0),i.writeUInt32BE(r,1),t.copy(i,5),i}deserializeMessage(e){return this.handler.deserialize(e)}async sendUnaryMessage(e,t,r,i){if(!this.checkCancelled()){if(r===void 0&&(r=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&r&&(e.metadata=r),this.sendError(e);return}try{let s=this.serializeMessage(t);this.write(s),this.sendStatus({code:ce.Status.OK,details:"OK",metadata:r})}catch(s){this.sendError({details:(0,as.getErrorMessage)(s),code:ce.Status.INTERNAL})}}}sendStatus(e){var t,r;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===ce.Status.OK),!this.checkCancelled())if(os("Request to method "+((t=this.handler)===null||t===void 0?void 0:t.path)+" ended with status code: "+ce.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var i;let s=Object.assign({[nv]:e.code,[tv]:encodeURI(e.details)},(i=e.metadata)===null||i===void 0?void 0:i.toHttp2Headers());this.stream.sendTrailers(s),this.statusSent=!0}),this.stream.end());else{let i=Object.assign(Object.assign({[nv]:e.code,[tv]:encodeURI(e.details)},iv),(r=e.metadata)===null||r===void 0?void 0:r.toHttp2Headers());this.stream.respond(i,{endStream:!0}),this.statusSent=!0}}sendError(e){let t={code:ce.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&e.metadata!==void 0?e.metadata:null};"code"in e&&typeof e.code=="number"&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&typeof e.details=="string"&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled()){if(this.maxSendMessageSize!==-1&&e.length>this.maxSendMessageSize){this.sendError({code:ce.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e)}}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let r=new kI.StreamDecoder(this.maxReceiveMessageSize),i=!1,s=!1,o=!1,a=async()=>{!o&&i&&!s&&(o=!0,await this.pushOrBufferMessage(e,null))};this.stream.on("data",async l=>{let c;try{c=r.write(l)}catch(u){this.sendError({code:ce.Status.RESOURCE_EXHAUSTED,details:u.message});return}s=!0,this.stream.pause();for(let u of c){this.emit("receiveMessage");let S=u.readUInt8(0)===1?t:"identity",E;try{E=await this.getDecompressedMessage(u,S)}catch(_){this.sendError(_);return}if(!E)return;await this.pushOrBufferMessage(e,E)}s=!1,this.stream.resume(),await a()}),this.stream.once("end",async()=>{i=!0,await a()})}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),r=e.push(t);if(t===null||r===!1){this.canPush=!1;break}}return this.canPush}async pushOrBufferMessage(e,t){this.isPushPending?this.bufferedMessages.push(t):await this.pushMessage(e,t)}async pushMessage(e,t){if(t===null){os("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}os("Received message of length "+t.length),this.isPushPending=!0;try{let r=await this.deserializeMessage(t);this.canPush?e.push(r)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(r)}catch(r){this.bufferedMessages.length=0;let i=(0,as.getErrorCode)(r);(i===null||i<ce.Status.OK||i>ce.Status.UNAUTHENTICATED)&&(i=ce.Status.INTERNAL),e.emit("error",{details:(0,as.getErrorMessage)(r),code:i})}this.isPushPending=!1,this.bufferedMessages.length>0&&await this.pushMessage(e,this.bufferedMessages.shift())}getPeer(){var e;let t=(e=this.stream.session)===null||e===void 0?void 0:e.socket;return t?.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}};gt.Http2ServerCallStream=fd;function UI(n){let e=new Error("Deadline exceeded");e.code=ce.Status.DEADLINE_EXCEEDED,n.sendError(e),n.cancelled=!0,n.emit("cancelled","deadline")}});var vd=I(fa=>{"use strict";Object.defineProperty(fa,"__esModule",{value:!0});fa.ServerCredentials=void 0;var cv=Fl(),cs=class{static createInsecure(){return new gd}static createSsl(e,t,r=!1){if(e!==null&&!Buffer.isBuffer(e))throw new TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw new TypeError("keyCertPairs must be an array");if(typeof r!="boolean")throw new TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let o=0;o<t.length;o++){let a=t[o];if(a===null||typeof a!="object")throw new TypeError(`keyCertPair[${o}] must be an object`);if(!Buffer.isBuffer(a.private_key))throw new TypeError(`keyCertPair[${o}].private_key must be a Buffer`);if(!Buffer.isBuffer(a.cert_chain))throw new TypeError(`keyCertPair[${o}].cert_chain must be a Buffer`);i.push(a.cert_chain),s.push(a.private_key)}return new yd({ca:e||(0,cv.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:r,ciphers:cv.CIPHER_SUITES})}};fa.ServerCredentials=cs;var gd=class extends cs{_isSecure(){return!1}_getSettings(){return null}},yd=class extends cs{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}});var hv=I(ga=>{"use strict";Object.defineProperty(ga,"__esModule",{value:!0});ga.Server=void 0;var Bn=re("http2"),cn=ne(),sr=lv(),VI=vd(),uv=Nt(),pa=fe(),Rt=xt(),zI=et(),Ze=rr(),ma=~(1<<31),GI=~(1<<31),jI=2e4,{HTTP2_HEADER_PATH:dv}=Bn.constants,$I="server";function KI(){}function Sd(n){return{code:cn.Status.UNIMPLEMENTED,details:`The server does not implement the method ${n}`}}function WI(n,e){let t=Sd(e);switch(n){case"unary":return(r,i)=>{i(t,null)};case"clientStream":return(r,i)=>{i(t,null)};case"serverStream":return r=>{r.emit("error",t)};case"bidi":return r=>{r.emit("error",t)};default:throw new Error(`Invalid handlerType ${n}`)}}var Td=class{constructor(e){var t,r,i,s;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new Ze.ChannelzTrace,this.callTracker=new Ze.ChannelzCallTracker,this.listenerChildrenTracker=new Ze.ChannelzChildrenTracker,this.sessionChildrenTracker=new Ze.ChannelzChildrenTracker,this.options=e??{},this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,Ze.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=(t=this.options["grpc.max_connection_age_ms"])!==null&&t!==void 0?t:ma,this.maxConnectionAgeGraceMs=(r=this.options["grpc.max_connection_age_grace_ms"])!==null&&r!==void 0?r:ma,this.keepaliveTimeMs=(i=this.options["grpc.keepalive_time_ms"])!==null&&i!==void 0?i:GI,this.keepaliveTimeoutMs=(s=this.options["grpc.keepalive_timeout_ms"])!==null&&s!==void 0?s:jI,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,r,i;let s=this.sessions.get(e),o=e.socket,a=o.remoteAddress?(0,Rt.stringToSubchannelAddress)(o.remoteAddress,o.remotePort):null,l=o.localAddress?(0,Rt.stringToSubchannelAddress)(o.localAddress,o.localPort):null,c;if(e.encrypted){let m=o,S=m.getCipher(),E=m.getCertificate(),_=m.getPeerCertificate();c={cipherSuiteStandardName:(t=S.standardName)!==null&&t!==void 0?t:null,cipherSuiteOtherName:S.standardName?null:S.name,localCertificate:E&&"raw"in E?E.raw:null,remoteCertificate:_&&"raw"in _?_.raw:null}}else c=null;return{remoteAddress:a,localAddress:l,security:c,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:(r=e.state.localWindowSize)!==null&&r!==void 0?r:null,remoteFlowControlWindow:(i=e.state.remoteWindowSize)!==null&&i!==void 0?i:null}}}trace(e){pa.trace(cn.LogVerbosity.DEBUG,$I,"("+this.channelzRef.id+") "+e)}addProtoService(){throw new Error("Not implemented. Use addService() instead")}addService(e,t){if(e===null||typeof e!="object"||t===null||typeof t!="object")throw new Error("addService() requires two objects as arguments");let r=Object.keys(e);if(r.length===0)throw new Error("Cannot add an empty service to a server");r.forEach(i=>{let s=e[i],o;s.requestStream?s.responseStream?o="bidi":o="clientStream":s.responseStream?o="serverStream":o="unary";let a=t[i],l;if(a===void 0&&typeof s.originalName=="string"&&(a=t[s.originalName]),a!==void 0?l=a.bind(t):l=WI(o,i),this.register(s.path,l,s.responseSerialize,s.requestDeserialize,o)===!1)throw new Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(e===null||typeof e!="object")throw new Error("removeService() requires object as argument");Object.keys(e).forEach(r=>{let i=e[r];this.unregister(i.path)})}bind(e,t){throw new Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,r){if(this.started===!0)throw new Error("server is already started");if(this.shutdown)throw new Error("bindAsync called after shutdown");if(typeof e!="string")throw new TypeError("port must be a string");if(t===null||!(t instanceof VI.ServerCredentials))throw new TypeError("creds must be a ServerCredentials object");if(typeof r!="function")throw new TypeError("callback must be a function");let i=(0,zI.parseUri)(e);if(i===null)throw new Error(`Could not parse port "${e}"`);let s=(0,uv.mapUriDefaultScheme)(i);if(s===null)throw new Error(`Could not get a default scheme for port "${e}"`);let o={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?o.maxSessionMemory=this.options["grpc-node.max_session_memory"]:o.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(o.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let a=(E,_)=>{process.nextTick(()=>r(E,_))},l=()=>{let E;if(t._isSecure()){let _=Object.assign(o,t._getSettings());_.enableTrace=this.options["grpc-node.tls_enable_trace"]===1,E=Bn.createSecureServer(_),E.on("secureConnection",w=>{w.on("error",C=>{this.trace("An incoming TLS connection closed with error: "+C.message)})})}else E=Bn.createServer(o);return E.setTimeout(0,KI),this._setupHandlers(E),E},c=(E,_,w)=>E.length===0?Promise.resolve({port:_,count:w}):Promise.all(E.map(C=>{this.trace("Attempting to bind "+(0,Rt.subchannelAddressToString)(C));let k;(0,Rt.isTcpSubchannelAddress)(C)?k={host:C.host,port:_}:k=C;let P=l();return new Promise((M,b)=>{let G=V=>{this.trace("Failed to bind "+(0,Rt.subchannelAddressToString)(C)+" with error "+V.message),M(V)};P.once("error",G),P.listen(k,()=>{if(this.shutdown){P.close(),M(new Error("bindAsync failed because server is shutdown"));return}let V=P.address(),v;typeof V=="string"?v={path:V}:v={host:V.address,port:V.port};let p=(0,Ze.registerChannelzSocket)((0,Rt.subchannelAddressToString)(v),()=>({localAddress:v,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(p),this.http2ServerList.push({server:P,channelzRef:p}),this.trace("Successfully bound "+(0,Rt.subchannelAddressToString)(v)),M("port"in v?v.port:_),P.removeListener("error",G)})})})).then(C=>{let k=0;for(let P of C)if(typeof P=="number"&&(k+=1,P!==_))throw new Error("Invalid state: multiple port numbers added from single address");return{port:_,count:k+w}}),u=E=>{if(E.length===0)return Promise.resolve({port:0,count:0});let _=E[0],w=l();return new Promise((C,k)=>{let P=M=>{this.trace("Failed to bind "+(0,Rt.subchannelAddressToString)(_)+" with error "+M.message),C(u(E.slice(1)))};w.once("error",P),w.listen(_,()=>{if(this.shutdown){w.close(),C({port:0,count:0});return}let M=w.address(),b={host:M.address,port:M.port},G=(0,Ze.registerChannelzSocket)((0,Rt.subchannelAddressToString)(b),()=>({localAddress:b,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(G),this.http2ServerList.push({server:w,channelzRef:G}),this.trace("Successfully bound "+(0,Rt.subchannelAddressToString)(b)),C(c(E.slice(1),M.port,1)),w.removeListener("error",P)})})},m={onSuccessfulResolution:(E,_,w)=>{if(m.onSuccessfulResolution=()=>{},this.shutdown&&a(new Error("bindAsync failed because server is shutdown"),0),E.length===0){a(new Error(`No addresses resolved for port ${e}`),0);return}let C;(0,Rt.isTcpSubchannelAddress)(E[0])?E[0].port===0?C=u(E):C=c(E,E[0].port,0):C=c(E,1,0),C.then(k=>{if(k.count===0){let P=`No address added out of total ${E.length} resolved`;pa.log(cn.LogVerbosity.ERROR,P),a(new Error(P),0)}else k.count<E.length&&pa.log(cn.LogVerbosity.INFO,`WARNING Only ${k.count} addresses added out of total ${E.length} resolved`),a(null,k.port)},k=>{let P=`No address added out of total ${E.length} resolved`;pa.log(cn.LogVerbosity.ERROR,P),a(new Error(P),0)})},onError:E=>{a(new Error(E.details),0)}};(0,uv.createResolver)(s,m,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,Ze.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(Bn.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,Ze.unregisterChannelzRef)(this.channelzRef)}register(e,t,r,i,s){return this.handlers.has(e)?!1:(this.handlers.set(e,{func:t,serialize:r,deserialize:i,type:s,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(this.http2ServerList.length===0||this.http2ServerList.every(({server:e})=>e.listening!==!0))throw new Error("server must be bound in order to start");if(this.started===!0)throw new Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=s=>{this.channelzEnabled&&(0,Ze.unregisterChannelzRef)(this.channelzRef),e(s)},r=0;function i(){r--,r===0&&t()}this.started=!1,this.shutdown=!0;for(let{server:s,channelzRef:o}of this.http2ServerList)s.listening&&(r++,s.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(o),(0,Ze.unregisterChannelzRef)(o)),i()}));this.sessions.forEach((s,o)=>{o.closed||(r+=1,o.close(i))}),r===0&&t()}addHttp2Port(){throw new Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let r=t[Bn.constants.HTTP2_HEADER_CONTENT_TYPE];return typeof r!="string"||!r.startsWith("application/grpc")?(e.respond({[Bn.constants.HTTP2_HEADER_STATUS]:Bn.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1):!0}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return t===void 0?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,r=null){let i=new sr.Http2ServerCallStream(t,null,this.options);e.code===void 0&&(e.code=cn.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed()),i.sendError(e)}_channelzHandler(e,t){let r=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),r?.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed();return}let i=t[dv],s=this._retrieveHandler(i);if(!s){this._respondWithError(Sd(i),e,r);return}let o=new sr.Http2ServerCallStream(e,s,this.options);o.once("callEnd",a=>{a===cn.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),r&&(o.once("streamEnd",a=>{a?r.streamTracker.addCallSucceeded():r.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{r.messagesSent+=1,r.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{r.messagesReceived+=1,r.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,s,t)||(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed(),o.sendError({code:cn.Status.INTERNAL,details:`Unknown handler type: ${s.type}`}))}_streamHandler(e,t){if(this._verifyContentType(e,t)!==!0)return;let r=t[dv],i=this._retrieveHandler(r);if(!i){this._respondWithError(Sd(r),e,null);return}let s=new sr.Http2ServerCallStream(e,i,this.options);this._runHandlerForCall(s,i,t)||s.sendError({code:cn.Status.INTERNAL,details:`Unknown handler type: ${i.type}`})}_runHandlerForCall(e,t,r){var i;let s=e.receiveMetadata(r),o=(i=s.get("grpc-encoding")[0])!==null&&i!==void 0?i:"identity";s.remove("grpc-encoding");let{type:a}=t;if(a==="unary")HI(e,t,s,o);else if(a==="clientStream")QI(e,t,s,o);else if(a==="serverStream")YI(e,t,s,o);else if(a==="bidi")JI(e,t,s,o);else return!1;return!0}_setupHandlers(e){if(e===null)return;let t=e.address(),r="null";t&&(typeof t=="string"?r=t:r=t.address+":"+t.port),this.serverAddressString=r;let i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",s=>{var o,a,l,c,u;if(!this.started){s.destroy();return}let m=(0,Ze.registerChannelzSocket)((o=s.socket.remoteAddress)!==null&&o!==void 0?o:"unknown",this.getChannelzSessionInfoGetter(s),this.channelzEnabled),S={ref:m,streamTracker:new Ze.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(s,S);let E=s.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+E),this.sessionChildrenTracker.refChild(m));let _=null,w=null,C=!1;if(this.maxConnectionAgeMs!==ma){let P=this.maxConnectionAgeMs/10,M=Math.random()*P*2-P;_=(l=(a=setTimeout(()=>{var b,G;C=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+E);try{s.goaway(Bn.constants.NGHTTP2_NO_ERROR,~(1<<31),Buffer.from("max_age"))}catch{s.destroy();return}s.close(),this.maxConnectionAgeGraceMs!==ma&&(w=(G=(b=setTimeout(()=>{s.destroy()},this.maxConnectionAgeGraceMs)).unref)===null||G===void 0?void 0:G.call(b))},this.maxConnectionAgeMs+M)).unref)===null||l===void 0?void 0:l.call(a)}let k=(u=(c=setInterval(()=>{var P,M;let b=(M=(P=setTimeout(()=>{C=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+E),s.close()},this.keepaliveTimeoutMs)).unref)===null||M===void 0?void 0:M.call(P);try{s.ping((G,V,v)=>{clearTimeout(b)})}catch{s.destroy()}},this.keepaliveTimeMs)).unref)===null||u===void 0?void 0:u.call(c);s.on("close",()=>{this.channelzEnabled&&(C||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+E),this.sessionChildrenTracker.unrefChild(m),(0,Ze.unregisterChannelzRef)(m)),_&&clearTimeout(_),w&&clearTimeout(w),k&&clearTimeout(k),this.sessions.delete(s)})})}};ga.Server=Td;async function HI(n,e,t,r){try{let i=await n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new sr.ServerUnaryCallImpl(n,t,i);e.func(s,(o,a,l,c)=>{n.sendUnaryMessage(o,a,l,c)})}catch(i){n.sendError(i)}}function QI(n,e,t,r){let i=new sr.ServerReadableStreamImpl(n,t,e.deserialize,r);function s(o,a,l,c){i.destroy(),n.sendUnaryMessage(o,a,l,c)}n.cancelled||(i.on("error",s),e.func(i,s))}async function YI(n,e,t,r){try{let i=await n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new sr.ServerWritableStreamImpl(n,t,e.serialize,i);e.func(s)}catch(i){n.sendError(i)}}function JI(n,e,t,r){let i=new sr.ServerDuplexStreamImpl(n,t,e.serialize,e.deserialize,r);n.cancelled||e.func(i)}});var fv=I(ya=>{"use strict";Object.defineProperty(ya,"__esModule",{value:!0});ya.StatusBuilder=void 0;var Ed=class{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return this.code!==null&&(e.code=this.code),this.details!==null&&(e.details=this.details),this.metadata!==null&&(e.metadata=this.metadata),e}};ya.StatusBuilder=Ed});var _d=I(qn=>{"use strict";Object.defineProperty(qn,"__esModule",{value:!0});qn.isDuration=qn.durationToMs=qn.msToDuration=void 0;function XI(n){return{seconds:n/1e3|0,nanos:n%1e3*1e6|0}}qn.msToDuration=XI;function ZI(n){return n.seconds*1e3+n.nanos/1e6|0}qn.durationToMs=ZI;function eR(n){return typeof n.seconds=="number"&&typeof n.nanos=="number"}qn.isDuration=eR});var Nd=I(Un=>{"use strict";var bd;Object.defineProperty(Un,"__esModule",{value:!0});Un.setup=Un.OutlierDetectionLoadBalancer=Un.OutlierDetectionLoadBalancingConfig=void 0;var Sa=ct(),mv=ne(),or=_d(),gv=Od(),yv=yn(),tR=Xs(),nR=En(),pv=xt(),rR=aa(),iR=fe(),sR="outlier_detection";function Oe(n){iR.trace(mv.LogVerbosity.DEBUG,sR,n)}var Ad="outlier_detection",oR=((bd=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)!==null&&bd!==void 0?bd:"true")==="true",aR={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},lR={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function oi(n,e,t,r){if(e in n&&typeof n[e]!==t){let i=r?`${r}.${e}`:e;throw new Error(`outlier detection config ${i} parse error: expected ${t}, got ${typeof n[e]}`)}}function wd(n,e,t){let r=t?`${t}.${e}`:e;if(e in n){if(!(0,or.isDuration)(n[e]))throw new Error(`outlier detection config ${r} parse error: expected Duration, got ${typeof n[e]}`);if(!(n[e].seconds>=0&&n[e].seconds<=315576e6&&n[e].nanos>=0&&n[e].nanos<=999999999))throw new Error(`outlier detection config ${r} parse error: values out of range for non-negative Duaration`)}}function va(n,e,t){let r=t?`${t}.${e}`:e;if(oi(n,e,"number",t),e in n&&!(n[e]>=0&&n[e]<=100))throw new Error(`outlier detection config ${r} parse error: value out of range for percentage (0-100)`)}var us=class n{constructor(e,t,r,i,s,o,a){if(this.childPolicy=a,a.length>0&&a[0].getLoadBalancerName()==="pick_first")throw new Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=e??1e4,this.baseEjectionTimeMs=t??3e4,this.maxEjectionTimeMs=r??3e5,this.maxEjectionPercent=i??10,this.successRateEjection=s?Object.assign(Object.assign({},aR),s):null,this.failurePercentageEjection=o?Object.assign(Object.assign({},lR),o):null}getLoadBalancerName(){return Ad}toJsonObject(){return{interval:(0,or.msToDuration)(this.intervalMs),base_ejection_time:(0,or.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,or.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new n(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(wd(e,"interval"),wd(e,"base_ejection_time"),wd(e,"max_ejection_time"),va(e,"max_ejection_percent"),"success_rate_ejection"in e){if(typeof e.success_rate_ejection!="object")throw new Error("outlier detection config success_rate_ejection must be an object");oi(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),va(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),oi(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),oi(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if(typeof e.failure_percentage_ejection!="object")throw new Error("outlier detection config failure_percentage_ejection must be an object");va(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),va(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),oi(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),oi(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new n(e.interval?(0,or.durationToMs)(e.interval):null,e.base_ejection_time?(0,or.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,or.durationToMs)(e.max_ejection_time):null,(t=e.max_ejection_percent)!==null&&t!==void 0?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(yv.validateLoadBalancingConfig))}};Un.OutlierDetectionLoadBalancingConfig=us;var Id=class extends rR.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((r,i,s,o)=>{if(this.childSubchannelState=s,!this.ejected)for(let a of this.stateListeners)a(this,i,s,o)})}getConnectivityState(){return this.ejected?Sa.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){this.ejected=!0;for(let e of this.stateListeners)e(this,this.childSubchannelState,Sa.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){this.ejected=!1;for(let e of this.stateListeners)e(this,Sa.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}};function Cd(){return{success:0,failure:0}}var Rd=class{constructor(){this.activeBucket=Cd(),this.inactiveBucket=Cd()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=Cd()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}},Dd=class{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType===nR.PickResultType.COMPLETE){let r=t.subchannel,i=r.getMapEntry();if(i){let s=t.onCallEnded;return this.countCalls&&(s=o=>{var a;o===mv.Status.OK?i.counter.addSuccess():i.counter.addFailure(),(a=t.onCallEnded)===null||a===void 0||a.call(t,o)}),Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel(),onCallEnded:s})}else return Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel()})}else return t}},Ta=class{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new tR.ChildLoadBalancerHandler((0,gv.createChildChannelControlHelper)(e,{createSubchannel:(t,r)=>{let i=e.createSubchannel(t,r),s=this.addressMap.get((0,pv.subchannelAddressToString)(t)),o=new Id(i,s);return s?.currentEjectionTimestamp!==null&&o.eject(),s?.subchannelWrappers.push(o),o},updateState:(t,r)=>{t===Sa.ConnectivityState.READY?e.updateState(t,new Dd(r,this.isCountingEnabled())):e.updateState(t,r)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return this.latestConfig!==null&&(this.latestConfig.getSuccessRateEjectionConfig()!==null||this.latestConfig.getFailurePercentageEjectionConfig()!==null)}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())t.currentEjectionTimestamp!==null&&(e+=1);return e*100/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;Oe("Running success rate check");let r=t.request_volume,i=0,s=[];for(let[m,S]of this.addressMap){let E=S.counter.getLastSuccesses(),_=S.counter.getLastFailures();Oe("Stats for "+m+": successes="+E+" failures="+_+" targetRequestVolume="+r),E+_>=r&&(i+=1,s.push(E/(E+_)))}if(Oe("Found "+i+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+s+"]"),i<t.minimum_hosts)return;let o=s.reduce((m,S)=>m+S)/s.length,a=0;for(let m of s){let S=m-o;a+=S*S}let l=a/s.length,c=Math.sqrt(l),u=o-c*(t.stdev_factor/1e3);Oe("stdev="+c+" ejectionThreshold="+u);for(let[m,S]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let E=S.counter.getLastSuccesses(),_=S.counter.getLastFailures();if(E+_<r)continue;let w=E/(E+_);if(Oe("Checking candidate "+m+" successRate="+w),w<u){let C=Math.random()*100;Oe("Candidate "+m+" randomNumber="+C+" enforcement_percentage="+t.enforcement_percentage),C<t.enforcement_percentage&&(Oe("Ejecting candidate "+m),this.eject(S,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;Oe("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let r=0;for(let i of this.addressMap.values()){let s=i.counter.getLastSuccesses(),o=i.counter.getLastFailures();s+o>=t.request_volume&&(r+=1)}if(!(r<t.minimum_hosts))for(let[i,s]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let o=s.counter.getLastSuccesses(),a=s.counter.getLastFailures();if(Oe("Candidate successes="+o+" failures="+a),o+a<t.request_volume)continue;if(a*100/(a+o)>t.threshold){let c=Math.random()*100;Oe("Candidate "+i+" randomNumber="+c+" enforcement_percentage="+t.enforcement_percentage),c<t.enforcement_percentage&&(Oe("Ejecting candidate "+i),this.eject(s,e))}}}eject(e,t){e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1;for(let r of e.subchannelWrappers)r.eject()}uneject(e){e.currentEjectionTimestamp=null;for(let t of e.subchannelWrappers)t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,r;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),(r=(t=this.ejectionTimer).unref)===null||r===void 0||r.call(t)}runChecks(){let e=new Date;if(Oe("Ejection timer running"),this.switchAllBuckets(),!!this.latestConfig){this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e);for(let[t,r]of this.addressMap.entries())if(r.currentEjectionTimestamp===null)r.ejectionTimeMultiplier>0&&(r.ejectionTimeMultiplier-=1);else{let i=this.latestConfig.getBaseEjectionTimeMs(),s=this.latestConfig.getMaxEjectionTimeMs(),o=new Date(r.currentEjectionTimestamp.getTime());o.setMilliseconds(o.getMilliseconds()+Math.min(i*r.ejectionTimeMultiplier,Math.max(i,s))),o<new Date&&(Oe("Unejecting "+t),this.uneject(r))}}}updateAddressList(e,t,r){if(!(t instanceof us))return;let i=new Set;for(let o of e)i.add((0,pv.subchannelAddressToString)(o));for(let o of i)this.addressMap.has(o)||(Oe("Adding map entry for "+o),this.addressMap.set(o,{counter:new Rd,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let o of this.addressMap.keys())i.has(o)||(Oe("Removing map entry for "+o),this.addressMap.delete(o));let s=(0,yv.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,s,r),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){Oe("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let o=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(o)}else Oe("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else{Oe("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer);for(let o of this.addressMap.values())this.uneject(o),o.ejectionTimeMultiplier=0}this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return Ad}};Un.OutlierDetectionLoadBalancer=Ta;function cR(){oR&&(0,gv.registerLoadBalancerType)(Ad,Ta,us)}Un.setup=cR});var Od=I(j=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0});j.OutlierDetectionLoadBalancingConfig=j.BaseSubchannelWrapper=j.registerAdminService=j.FilterStackFactory=j.BaseFilter=j.PickResultType=j.QueuePicker=j.UnavailablePicker=j.ChildLoadBalancerHandler=j.subchannelAddressToString=j.validateLoadBalancingConfig=j.getFirstUsableConfig=j.registerLoadBalancerType=j.createChildChannelControlHelper=j.BackoffTimeout=j.durationToMs=j.uriToString=j.createResolver=j.registerResolver=j.log=j.trace=void 0;var vv=fe();Object.defineProperty(j,"trace",{enumerable:!0,get:function(){return vv.trace}});Object.defineProperty(j,"log",{enumerable:!0,get:function(){return vv.log}});var Sv=Nt();Object.defineProperty(j,"registerResolver",{enumerable:!0,get:function(){return Sv.registerResolver}});Object.defineProperty(j,"createResolver",{enumerable:!0,get:function(){return Sv.createResolver}});var uR=et();Object.defineProperty(j,"uriToString",{enumerable:!0,get:function(){return uR.uriToString}});var dR=_d();Object.defineProperty(j,"durationToMs",{enumerable:!0,get:function(){return dR.durationToMs}});var hR=Ai();Object.defineProperty(j,"BackoffTimeout",{enumerable:!0,get:function(){return hR.BackoffTimeout}});var Ea=yn();Object.defineProperty(j,"createChildChannelControlHelper",{enumerable:!0,get:function(){return Ea.createChildChannelControlHelper}});Object.defineProperty(j,"registerLoadBalancerType",{enumerable:!0,get:function(){return Ea.registerLoadBalancerType}});Object.defineProperty(j,"getFirstUsableConfig",{enumerable:!0,get:function(){return Ea.getFirstUsableConfig}});Object.defineProperty(j,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return Ea.validateLoadBalancingConfig}});var fR=xt();Object.defineProperty(j,"subchannelAddressToString",{enumerable:!0,get:function(){return fR.subchannelAddressToString}});var pR=Xs();Object.defineProperty(j,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return pR.ChildLoadBalancerHandler}});var xd=En();Object.defineProperty(j,"UnavailablePicker",{enumerable:!0,get:function(){return xd.UnavailablePicker}});Object.defineProperty(j,"QueuePicker",{enumerable:!0,get:function(){return xd.QueuePicker}});Object.defineProperty(j,"PickResultType",{enumerable:!0,get:function(){return xd.PickResultType}});var mR=Wu();Object.defineProperty(j,"BaseFilter",{enumerable:!0,get:function(){return mR.BaseFilter}});var gR=ju();Object.defineProperty(j,"FilterStackFactory",{enumerable:!0,get:function(){return gR.FilterStackFactory}});var yR=eo();Object.defineProperty(j,"registerAdminService",{enumerable:!0,get:function(){return yR.registerAdminService}});var vR=aa();Object.defineProperty(j,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return vR.BaseSubchannelWrapper}});var SR=Nd();Object.defineProperty(j,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return SR.OutlierDetectionLoadBalancingConfig}})});var Tv=I(_a=>{"use strict";Object.defineProperty(_a,"__esModule",{value:!0});_a.setup=void 0;var TR=Nt(),kd=class{constructor(e,t,r){this.listener=t,this.addresses=[],this.hasReturnedResult=!1;let i;e.authority===""?i="/"+e.path:i=e.path,this.addresses=[{path:i}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}};function ER(){(0,TR.registerResolver)("unix",kd)}_a.setup=ER});var Cv=I(Ca=>{"use strict";Object.defineProperty(Ca,"__esModule",{value:!0});Ca.setup=void 0;var Ev=re("net"),ba=ne(),Pd=Ye(),_v=Nt(),bv=et(),_R=fe(),bR="ip_resolver";function wv(n){_R.trace(ba.LogVerbosity.DEBUG,bR,n)}var Md="ipv4",Ld="ipv6",wR=443,wa=class{constructor(e,t,r){var i;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,wv("Resolver constructed for target "+(0,bv.uriToString)(e));let s=[];if(!(e.scheme===Md||e.scheme===Ld)){this.error={code:ba.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new Pd.Metadata};return}let o=e.path.split(",");for(let a of o){let l=(0,bv.splitHostPort)(a);if(l===null){this.error={code:ba.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new Pd.Metadata};return}if(e.scheme===Md&&!(0,Ev.isIPv4)(l.host)||e.scheme===Ld&&!(0,Ev.isIPv6)(l.host)){this.error={code:ba.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new Pd.Metadata};return}s.push({host:l.host,port:(i=l.port)!==null&&i!==void 0?i:wR})}this.addresses=s,wv("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}};function CR(){(0,_v.registerResolver)(Md,wa),(0,_v.registerResolver)(Ld,wa)}Ca.setup=CR});var Dv=I($t=>{"use strict";Object.defineProperty($t,"__esModule",{value:!0});$t.setup=$t.PickFirstLoadBalancer=$t.shuffled=$t.PickFirstLoadBalancingConfig=void 0;var Iv=yn(),qe=ct(),Ia=En(),IR=fe(),RR=ne(),DR="pick_first";function Fd(n){IR.trace(RR.LogVerbosity.DEBUG,DR,n)}var ds="pick_first",AR=250,hs=class n{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return ds}toJsonObject(){return{[ds]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&typeof e.shuffleAddressList!="boolean")throw new Error("pick_first config field shuffleAddressList must be a boolean if provided");return new n(e.shuffleAddressList===!0)}};$t.PickFirstLoadBalancingConfig=hs;var Bd=class{constructor(e){this.subchannel=e}pick(e){return{pickResultType:Ia.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}};function Rv(n){let e=n.slice();for(let t=e.length-1;t>1;t--){let r=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[r],e[r]=i}return e}$t.shuffled=Rv;var Ra=class{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=qe.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.onSubchannelStateUpdate(t,r,i,o)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(qe.ConnectivityState.READY,new Bd(this.currentPick)):this.children.length===0?this.updateState(qe.ConnectivityState.IDLE,new Ia.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(qe.ConnectivityState.TRANSIENT_FAILURE,new Ia.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(qe.ConnectivityState.CONNECTING,new Ia.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){this.stickyTransientFailureMode=!0;for(let{subchannel:e}of this.children)e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(this.currentPick!==null){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,r,i){var s;if(!((s=this.currentPick)===null||s===void 0)&&s.realSubchannelEquals(e)){r!==qe.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[o,a]of this.children.entries())if(e.realSubchannelEquals(a.subchannel)){r===qe.ConnectivityState.READY&&this.pickSubchannel(a.subchannel),r===qe.ConnectivityState.TRANSIENT_FAILURE&&(a.hasReportedTransientFailure=!0,i&&(this.lastError=i),this.maybeEnterStickyTransientFailureMode(),o===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(o+1)),a.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,r]of this.children.entries())if(t>=e){let i=r.subchannel.getConnectivityState();if(i===qe.ConnectivityState.IDLE||i===qe.ConnectivityState.CONNECTING){this.startConnecting(t);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,r;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===qe.ConnectivityState.IDLE&&(Fd("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var i;(i=this.children[e])===null||i===void 0||i.subchannel.startConnecting()})),this.connectionDelayTimeout=(r=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},AR)).unref)===null||r===void 0?void 0:r.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(Fd("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,this.currentPick!==null&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){Fd(qe.ConnectivityState[this.currentState]+" -> "+qe.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(r=>({subchannel:this.channelControlHelper.createSubchannel(r,{}),hasReportedTransientFailure:!1}));for(let{subchannel:r}of t)r.ref(),this.channelControlHelper.addChannelzChild(r.getChannelzRef());this.resetSubchannelList(),this.children=t;for(let{subchannel:r}of this.children)if(r.addConnectivityStateListener(this.subchannelStateListener),r.getConnectivityState()===qe.ConnectivityState.READY){this.pickSubchannel(r);return}for(let r of this.children)r.subchannel.getConnectivityState()===qe.ConnectivityState.TRANSIENT_FAILURE&&(r.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof hs&&(t.getShuffleAddressList()&&(e=Rv(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===qe.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return ds}};$t.PickFirstLoadBalancer=Ra;function NR(){(0,Iv.registerLoadBalancerType)(ds,Ra,hs),(0,Iv.registerDefaultLoadBalancerType)(ds)}$t.setup=NR});var Nv=I(ai=>{"use strict";Object.defineProperty(ai,"__esModule",{value:!0});ai.setup=ai.RoundRobinLoadBalancer=void 0;var OR=yn(),Ue=ct(),Da=En(),xR=xt(),kR=fe(),PR=ne(),MR="round_robin";function Av(n){kR.trace(PR.LogVerbosity.DEBUG,MR,n)}var Aa="round_robin",qd=class n{getLoadBalancerName(){return Aa}constructor(){}toJsonObject(){return{[Aa]:{}}}static createFromJson(e){return new n}},Ud=class{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:Da.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}},Na=class{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=Ue.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.calculateAndUpdateState(),(i===Ue.ConnectivityState.TRANSIENT_FAILURE||i===Ue.ConnectivityState.IDLE)&&(o&&(this.lastError=o),this.channelControlHelper.requestReresolution(),t.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(Ue.ConnectivityState.READY)>0){let e=this.subchannels.filter(r=>r.getConnectivityState()===Ue.ConnectivityState.READY),t=0;this.currentReadyPicker!==null&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()),t<0&&(t=0)),this.updateState(Ue.ConnectivityState.READY,new Ud(e,t))}else this.countSubchannelsWithState(Ue.ConnectivityState.CONNECTING)>0?this.updateState(Ue.ConnectivityState.CONNECTING,new Da.QueuePicker(this)):this.countSubchannelsWithState(Ue.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(Ue.ConnectivityState.TRANSIENT_FAILURE,new Da.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(Ue.ConnectivityState.IDLE,new Da.QueuePicker(this))}updateState(e,t){Av(Ue.ConnectivityState[this.currentState]+" -> "+Ue.ConnectivityState[e]),e===Ue.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){this.resetSubchannelList(),Av("Connect to address list "+e.map(r=>(0,xR.subchannelAddressToString)(r))),this.subchannels=e.map(r=>this.channelControlHelper.createSubchannel(r,{}));for(let r of this.subchannels){r.ref(),r.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(r.getChannelzRef());let i=r.getConnectivityState();(i===Ue.ConnectivityState.IDLE||i===Ue.ConnectivityState.TRANSIENT_FAILURE)&&r.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return Aa}};ai.RoundRobinLoadBalancer=Na;function LR(){(0,OR.registerLoadBalancerType)(Aa,Na,qd)}ai.setup=LR});var Pv=I(L=>{"use strict";Object.defineProperty(L,"__esModule",{value:!0});L.experimental=L.addAdminServicesToServer=L.getChannelzHandlers=L.getChannelzServiceDefinition=L.InterceptorConfigurationError=L.InterceptingCall=L.RequesterBuilder=L.ListenerBuilder=L.StatusBuilder=L.getClientChannel=L.ServerCredentials=L.Server=L.setLogVerbosity=L.setLogger=L.load=L.loadObject=L.CallCredentials=L.ChannelCredentials=L.waitForClientReady=L.closeClient=L.Channel=L.makeGenericClientConstructor=L.makeClientConstructor=L.loadPackageDefinition=L.Client=L.compressionAlgorithms=L.propagate=L.connectivityState=L.status=L.logVerbosity=L.Metadata=L.credentials=void 0;var Oa=Ml();Object.defineProperty(L,"CallCredentials",{enumerable:!0,get:function(){return Oa.CallCredentials}});var FR=fc();Object.defineProperty(L,"Channel",{enumerable:!0,get:function(){return FR.ChannelImplementation}});var BR=$u();Object.defineProperty(L,"compressionAlgorithms",{enumerable:!0,get:function(){return BR.CompressionAlgorithms}});var qR=ct();Object.defineProperty(L,"connectivityState",{enumerable:!0,get:function(){return qR.ConnectivityState}});var xa=$s();Object.defineProperty(L,"ChannelCredentials",{enumerable:!0,get:function(){return xa.ChannelCredentials}});var Ov=hc();Object.defineProperty(L,"Client",{enumerable:!0,get:function(){return Ov.Client}});var Vd=ne();Object.defineProperty(L,"logVerbosity",{enumerable:!0,get:function(){return Vd.LogVerbosity}});Object.defineProperty(L,"status",{enumerable:!0,get:function(){return Vd.Status}});Object.defineProperty(L,"propagate",{enumerable:!0,get:function(){return Vd.Propagate}});var xv=fe(),zd=mc();Object.defineProperty(L,"loadPackageDefinition",{enumerable:!0,get:function(){return zd.loadPackageDefinition}});Object.defineProperty(L,"makeClientConstructor",{enumerable:!0,get:function(){return zd.makeClientConstructor}});Object.defineProperty(L,"makeGenericClientConstructor",{enumerable:!0,get:function(){return zd.makeClientConstructor}});var UR=Ye();Object.defineProperty(L,"Metadata",{enumerable:!0,get:function(){return UR.Metadata}});var VR=hv();Object.defineProperty(L,"Server",{enumerable:!0,get:function(){return VR.Server}});var zR=vd();Object.defineProperty(L,"ServerCredentials",{enumerable:!0,get:function(){return zR.ServerCredentials}});var GR=fv();Object.defineProperty(L,"StatusBuilder",{enumerable:!0,get:function(){return GR.StatusBuilder}});L.credentials={combineChannelCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),combineCallCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),createInsecure:xa.ChannelCredentials.createInsecure,createSsl:xa.ChannelCredentials.createSsl,createFromSecureContext:xa.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:Oa.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:Oa.CallCredentials.createFromGoogleCredential,createEmpty:Oa.CallCredentials.createEmpty};var jR=n=>n.close();L.closeClient=jR;var $R=(n,e,t)=>n.waitForReady(e,t);L.waitForClientReady=$R;var KR=(n,e)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};L.loadObject=KR;var WR=(n,e,t)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};L.load=WR;var HR=n=>{xv.setLogger(n)};L.setLogger=HR;var QR=n=>{xv.setLoggerVerbosity(n)};L.setLogVerbosity=QR;var YR=n=>Ov.Client.prototype.getChannel.call(n);L.getClientChannel=YR;var ka=cc();Object.defineProperty(L,"ListenerBuilder",{enumerable:!0,get:function(){return ka.ListenerBuilder}});Object.defineProperty(L,"RequesterBuilder",{enumerable:!0,get:function(){return ka.RequesterBuilder}});Object.defineProperty(L,"InterceptingCall",{enumerable:!0,get:function(){return ka.InterceptingCall}});Object.defineProperty(L,"InterceptorConfigurationError",{enumerable:!0,get:function(){return ka.InterceptorConfigurationError}});var kv=rr();Object.defineProperty(L,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return kv.getChannelzServiceDefinition}});Object.defineProperty(L,"getChannelzHandlers",{enumerable:!0,get:function(){return kv.getChannelzHandlers}});var JR=eo();Object.defineProperty(L,"addAdminServicesToServer",{enumerable:!0,get:function(){return JR.addAdminServicesToServer}});var XR=Od();L.experimental=XR;var ZR=xu(),eD=Tv(),tD=Cv(),nD=Dv(),rD=Nv(),iD=Nd(),sD=rr();ZR.setup(),eD.setup(),tD.setup(),nD.setup(),rD.setup(),iD.setup(),sD.setup()});import{TextEncoder as oD,inspect as aD,TextDecoder as HP}from"util";var dp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},hp={};var Bs,fp;(function(){var n;function e(v,p){function g(){}g.prototype=p.prototype,v.D=p.prototype,v.prototype=new g,v.prototype.constructor=v,v.C=function(y,h,T){for(var d=Array(arguments.length-2),f=2;f<arguments.length;f++)d[f-2]=arguments[f];return p.prototype[h].apply(y,d)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(v,p,g){g||(g=0);var y=Array(16);if(typeof p=="string")for(var h=0;16>h;++h)y[h]=p.charCodeAt(g++)|p.charCodeAt(g++)<<8|p.charCodeAt(g++)<<16|p.charCodeAt(g++)<<24;else for(h=0;16>h;++h)y[h]=p[g++]|p[g++]<<8|p[g++]<<16|p[g++]<<24;p=v.g[0],g=v.g[1],h=v.g[2];var T=v.g[3],d=p+(T^g&(h^T))+y[0]+3614090360&4294967295;p=g+(d<<7&4294967295|d>>>25),d=T+(h^p&(g^h))+y[1]+3905402710&4294967295,T=p+(d<<12&4294967295|d>>>20),d=h+(g^T&(p^g))+y[2]+606105819&4294967295,h=T+(d<<17&4294967295|d>>>15),d=g+(p^h&(T^p))+y[3]+3250441966&4294967295,g=h+(d<<22&4294967295|d>>>10),d=p+(T^g&(h^T))+y[4]+4118548399&4294967295,p=g+(d<<7&4294967295|d>>>25),d=T+(h^p&(g^h))+y[5]+1200080426&4294967295,T=p+(d<<12&4294967295|d>>>20),d=h+(g^T&(p^g))+y[6]+2821735955&4294967295,h=T+(d<<17&4294967295|d>>>15),d=g+(p^h&(T^p))+y[7]+4249261313&4294967295,g=h+(d<<22&4294967295|d>>>10),d=p+(T^g&(h^T))+y[8]+1770035416&4294967295,p=g+(d<<7&4294967295|d>>>25),d=T+(h^p&(g^h))+y[9]+2336552879&4294967295,T=p+(d<<12&4294967295|d>>>20),d=h+(g^T&(p^g))+y[10]+4294925233&4294967295,h=T+(d<<17&4294967295|d>>>15),d=g+(p^h&(T^p))+y[11]+2304563134&4294967295,g=h+(d<<22&4294967295|d>>>10),d=p+(T^g&(h^T))+y[12]+1804603682&4294967295,p=g+(d<<7&4294967295|d>>>25),d=T+(h^p&(g^h))+y[13]+4254626195&4294967295,T=p+(d<<12&4294967295|d>>>20),d=h+(g^T&(p^g))+y[14]+2792965006&4294967295,h=T+(d<<17&4294967295|d>>>15),d=g+(p^h&(T^p))+y[15]+1236535329&4294967295,g=h+(d<<22&4294967295|d>>>10),d=p+(h^T&(g^h))+y[1]+4129170786&4294967295,p=g+(d<<5&4294967295|d>>>27),d=T+(g^h&(p^g))+y[6]+3225465664&4294967295,T=p+(d<<9&4294967295|d>>>23),d=h+(p^g&(T^p))+y[11]+643717713&4294967295,h=T+(d<<14&4294967295|d>>>18),d=g+(T^p&(h^T))+y[0]+3921069994&4294967295,g=h+(d<<20&4294967295|d>>>12),d=p+(h^T&(g^h))+y[5]+3593408605&4294967295,p=g+(d<<5&4294967295|d>>>27),d=T+(g^h&(p^g))+y[10]+38016083&4294967295,T=p+(d<<9&4294967295|d>>>23),d=h+(p^g&(T^p))+y[15]+3634488961&4294967295,h=T+(d<<14&4294967295|d>>>18),d=g+(T^p&(h^T))+y[4]+3889429448&4294967295,g=h+(d<<20&4294967295|d>>>12),d=p+(h^T&(g^h))+y[9]+568446438&4294967295,p=g+(d<<5&4294967295|d>>>27),d=T+(g^h&(p^g))+y[14]+3275163606&4294967295,T=p+(d<<9&4294967295|d>>>23),d=h+(p^g&(T^p))+y[3]+4107603335&4294967295,h=T+(d<<14&4294967295|d>>>18),d=g+(T^p&(h^T))+y[8]+1163531501&4294967295,g=h+(d<<20&4294967295|d>>>12),d=p+(h^T&(g^h))+y[13]+2850285829&4294967295,p=g+(d<<5&4294967295|d>>>27),d=T+(g^h&(p^g))+y[2]+4243563512&4294967295,T=p+(d<<9&4294967295|d>>>23),d=h+(p^g&(T^p))+y[7]+1735328473&4294967295,h=T+(d<<14&4294967295|d>>>18),d=g+(T^p&(h^T))+y[12]+2368359562&4294967295,g=h+(d<<20&4294967295|d>>>12),d=p+(g^h^T)+y[5]+4294588738&4294967295,p=g+(d<<4&4294967295|d>>>28),d=T+(p^g^h)+y[8]+2272392833&4294967295,T=p+(d<<11&4294967295|d>>>21),d=h+(T^p^g)+y[11]+1839030562&4294967295,h=T+(d<<16&4294967295|d>>>16),d=g+(h^T^p)+y[14]+4259657740&4294967295,g=h+(d<<23&4294967295|d>>>9),d=p+(g^h^T)+y[1]+2763975236&4294967295,p=g+(d<<4&4294967295|d>>>28),d=T+(p^g^h)+y[4]+1272893353&4294967295,T=p+(d<<11&4294967295|d>>>21),d=h+(T^p^g)+y[7]+4139469664&4294967295,h=T+(d<<16&4294967295|d>>>16),d=g+(h^T^p)+y[10]+3200236656&4294967295,g=h+(d<<23&4294967295|d>>>9),d=p+(g^h^T)+y[13]+681279174&4294967295,p=g+(d<<4&4294967295|d>>>28),d=T+(p^g^h)+y[0]+3936430074&4294967295,T=p+(d<<11&4294967295|d>>>21),d=h+(T^p^g)+y[3]+3572445317&4294967295,h=T+(d<<16&4294967295|d>>>16),d=g+(h^T^p)+y[6]+76029189&4294967295,g=h+(d<<23&4294967295|d>>>9),d=p+(g^h^T)+y[9]+3654602809&4294967295,p=g+(d<<4&4294967295|d>>>28),d=T+(p^g^h)+y[12]+3873151461&4294967295,T=p+(d<<11&4294967295|d>>>21),d=h+(T^p^g)+y[15]+530742520&4294967295,h=T+(d<<16&4294967295|d>>>16),d=g+(h^T^p)+y[2]+3299628645&4294967295,g=h+(d<<23&4294967295|d>>>9),d=p+(h^(g|~T))+y[0]+4096336452&4294967295,p=g+(d<<6&4294967295|d>>>26),d=T+(g^(p|~h))+y[7]+1126891415&4294967295,T=p+(d<<10&4294967295|d>>>22),d=h+(p^(T|~g))+y[14]+2878612391&4294967295,h=T+(d<<15&4294967295|d>>>17),d=g+(T^(h|~p))+y[5]+4237533241&4294967295,g=h+(d<<21&4294967295|d>>>11),d=p+(h^(g|~T))+y[12]+1700485571&4294967295,p=g+(d<<6&4294967295|d>>>26),d=T+(g^(p|~h))+y[3]+2399980690&4294967295,T=p+(d<<10&4294967295|d>>>22),d=h+(p^(T|~g))+y[10]+4293915773&4294967295,h=T+(d<<15&4294967295|d>>>17),d=g+(T^(h|~p))+y[1]+2240044497&4294967295,g=h+(d<<21&4294967295|d>>>11),d=p+(h^(g|~T))+y[8]+1873313359&4294967295,p=g+(d<<6&4294967295|d>>>26),d=T+(g^(p|~h))+y[15]+4264355552&4294967295,T=p+(d<<10&4294967295|d>>>22),d=h+(p^(T|~g))+y[6]+2734768916&4294967295,h=T+(d<<15&4294967295|d>>>17),d=g+(T^(h|~p))+y[13]+1309151649&4294967295,g=h+(d<<21&4294967295|d>>>11),d=p+(h^(g|~T))+y[4]+4149444226&4294967295,p=g+(d<<6&4294967295|d>>>26),d=T+(g^(p|~h))+y[11]+3174756917&4294967295,T=p+(d<<10&4294967295|d>>>22),d=h+(p^(T|~g))+y[2]+718787259&4294967295,h=T+(d<<15&4294967295|d>>>17),d=g+(T^(h|~p))+y[9]+3951481745&4294967295,v.g[0]=v.g[0]+p&4294967295,v.g[1]=v.g[1]+(h+(d<<21&4294967295|d>>>11))&4294967295,v.g[2]=v.g[2]+h&4294967295,v.g[3]=v.g[3]+T&4294967295}r.prototype.u=function(v,p){p===void 0&&(p=v.length);for(var g=p-this.blockSize,y=this.B,h=this.h,T=0;T<p;){if(h==0)for(;T<=g;)i(this,v,T),T+=this.blockSize;if(typeof v=="string"){for(;T<p;)if(y[h++]=v.charCodeAt(T++),h==this.blockSize){i(this,y),h=0;break}}else for(;T<p;)if(y[h++]=v[T++],h==this.blockSize){i(this,y),h=0;break}}this.h=h,this.o+=p},r.prototype.v=function(){var v=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);v[0]=128;for(var p=1;p<v.length-8;++p)v[p]=0;var g=8*this.o;for(p=v.length-8;p<v.length;++p)v[p]=g&255,g/=256;for(this.u(v),v=Array(16),p=g=0;4>p;++p)for(var y=0;32>y;y+=8)v[g++]=this.g[p]>>>y&255;return v};function s(v,p){var g=a;return Object.prototype.hasOwnProperty.call(g,v)?g[v]:g[v]=p(v)}function o(v,p){this.h=p;for(var g=[],y=!0,h=v.length-1;0<=h;h--){var T=v[h]|0;y&&T==p||(g[h]=T,y=!1)}this.g=g}var a={};function l(v){return-128<=v&&128>v?s(v,function(p){return new o([p|0],0>p?-1:0)}):new o([v|0],0>v?-1:0)}function c(v){if(isNaN(v)||!isFinite(v))return m;if(0>v)return C(c(-v));for(var p=[],g=1,y=0;v>=g;y++)p[y]=v/g|0,g*=4294967296;return new o(p,0)}function u(v,p){if(v.length==0)throw Error("number format error: empty string");if(p=p||10,2>p||36<p)throw Error("radix out of range: "+p);if(v.charAt(0)=="-")return C(u(v.substring(1),p));if(0<=v.indexOf("-"))throw Error('number format error: interior "-" character');for(var g=c(Math.pow(p,8)),y=m,h=0;h<v.length;h+=8){var T=Math.min(8,v.length-h),d=parseInt(v.substring(h,h+T),p);8>T?(T=c(Math.pow(p,T)),y=y.j(T).add(c(d))):(y=y.j(g),y=y.add(c(d)))}return y}var m=l(0),S=l(1),E=l(16777216);n=o.prototype,n.m=function(){if(w(this))return-C(this).m();for(var v=0,p=1,g=0;g<this.g.length;g++){var y=this.i(g);v+=(0<=y?y:4294967296+y)*p,p*=4294967296}return v},n.toString=function(v){if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(_(this))return"0";if(w(this))return"-"+C(this).toString(v);for(var p=c(Math.pow(v,6)),g=this,y="";;){var h=b(g,p).g;g=k(g,h.j(p));var T=((0<g.g.length?g.g[0]:g.h)>>>0).toString(v);if(g=h,_(g))return T+y;for(;6>T.length;)T="0"+T;y=T+y}},n.i=function(v){return 0>v?0:v<this.g.length?this.g[v]:this.h};function _(v){if(v.h!=0)return!1;for(var p=0;p<v.g.length;p++)if(v.g[p]!=0)return!1;return!0}function w(v){return v.h==-1}n.l=function(v){return v=k(this,v),w(v)?-1:_(v)?0:1};function C(v){for(var p=v.g.length,g=[],y=0;y<p;y++)g[y]=~v.g[y];return new o(g,~v.h).add(S)}n.abs=function(){return w(this)?C(this):this},n.add=function(v){for(var p=Math.max(this.g.length,v.g.length),g=[],y=0,h=0;h<=p;h++){var T=y+(this.i(h)&65535)+(v.i(h)&65535),d=(T>>>16)+(this.i(h)>>>16)+(v.i(h)>>>16);y=d>>>16,T&=65535,d&=65535,g[h]=d<<16|T}return new o(g,g[g.length-1]&-2147483648?-1:0)};function k(v,p){return v.add(C(p))}n.j=function(v){if(_(this)||_(v))return m;if(w(this))return w(v)?C(this).j(C(v)):C(C(this).j(v));if(w(v))return C(this.j(C(v)));if(0>this.l(E)&&0>v.l(E))return c(this.m()*v.m());for(var p=this.g.length+v.g.length,g=[],y=0;y<2*p;y++)g[y]=0;for(y=0;y<this.g.length;y++)for(var h=0;h<v.g.length;h++){var T=this.i(y)>>>16,d=this.i(y)&65535,f=v.i(h)>>>16,O=v.i(h)&65535;g[2*y+2*h]+=d*O,P(g,2*y+2*h),g[2*y+2*h+1]+=T*O,P(g,2*y+2*h+1),g[2*y+2*h+1]+=d*f,P(g,2*y+2*h+1),g[2*y+2*h+2]+=T*f,P(g,2*y+2*h+2)}for(y=0;y<p;y++)g[y]=g[2*y+1]<<16|g[2*y];for(y=p;y<2*p;y++)g[y]=0;return new o(g,0)};function P(v,p){for(;(v[p]&65535)!=v[p];)v[p+1]+=v[p]>>>16,v[p]&=65535,p++}function M(v,p){this.g=v,this.h=p}function b(v,p){if(_(p))throw Error("division by zero");if(_(v))return new M(m,m);if(w(v))return p=b(C(v),p),new M(C(p.g),C(p.h));if(w(p))return p=b(v,C(p)),new M(C(p.g),p.h);if(30<v.g.length){if(w(v)||w(p))throw Error("slowDivide_ only works with positive integers.");for(var g=S,y=p;0>=y.l(v);)g=G(g),y=G(y);var h=V(g,1),T=V(y,1);for(y=V(y,2),g=V(g,2);!_(y);){var d=T.add(y);0>=d.l(v)&&(h=h.add(g),T=d),y=V(y,1),g=V(g,1)}return p=k(v,h.j(p)),new M(h,p)}for(h=m;0<=v.l(p);){for(g=Math.max(1,Math.floor(v.m()/p.m())),y=Math.ceil(Math.log(g)/Math.LN2),y=48>=y?1:Math.pow(2,y-48),T=c(g),d=T.j(p);w(d)||0<d.l(v);)g-=y,T=c(g),d=T.j(p);_(T)&&(T=S),h=h.add(T),v=k(v,d)}return new M(h,v)}n.A=function(v){return b(this,v).h},n.and=function(v){for(var p=Math.max(this.g.length,v.g.length),g=[],y=0;y<p;y++)g[y]=this.i(y)&v.i(y);return new o(g,this.h&v.h)},n.or=function(v){for(var p=Math.max(this.g.length,v.g.length),g=[],y=0;y<p;y++)g[y]=this.i(y)|v.i(y);return new o(g,this.h|v.h)},n.xor=function(v){for(var p=Math.max(this.g.length,v.g.length),g=[],y=0;y<p;y++)g[y]=this.i(y)^v.i(y);return new o(g,this.h^v.h)};function G(v){for(var p=v.g.length+1,g=[],y=0;y<p;y++)g[y]=v.i(y)<<1|v.i(y-1)>>>31;return new o(g,v.h)}function V(v,p){var g=p>>5;p%=32;for(var y=v.g.length-g,h=[],T=0;T<y;T++)h[T]=0<p?v.i(T+g)>>>p|v.i(T+g+1)<<32-p:v.i(T+g);return new o(h,v.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,fp=hp.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=u,Bs=hp.Integer=o}).apply(typeof dp<"u"?dp:typeof self<"u"?self:typeof window<"u"?window:{});var cr=Df(Pv(),1),gS=Df(Su(),1);import{randomBytes as lD}from"crypto";var Mv="@firebase/firestore",Lv="4.8.0";var Ge=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Ge.UNAUTHENTICATED=new Ge(null);Ge.GOOGLE_CREDENTIALS=new Ge("google-credentials-uid");Ge.FIRST_PARTY=new Ge("first-party-uid");Ge.MOCK_USER=new Ge("mock-user");var cD="11.10.0";var Ri=cD;function uD(n){Ri=n}function dD(n){return aD(n,{depth:100})}var ur=new Kf("@firebase/firestore");function li(){return ur.logLevel}function U(n,...e){if(ur.logLevel<=At.DEBUG){let t=e.map(df);ur.debug(`Firestore (${Ri}): ${n}`,...t)}}function un(n,...e){if(ur.logLevel<=At.ERROR){let t=e.map(df);ur.error(`Firestore (${Ri}): ${n}`,...t)}}function qa(n,...e){if(ur.logLevel<=At.WARN){let t=e.map(df);ur.warn(`Firestore (${Ri}): ${n}`,...t)}}function df(n){if(typeof n=="string")return n;try{return dD(n)}catch{return n}}function W(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,yS(n,r,t)}function yS(n,e,t){let r=`FIRESTORE (${Ri}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{let i=JSON.stringify(t);r+=" CONTEXT: "+i}catch{r+=" CONTEXT: "+t}throw un(r),new Error(r)}function me(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||yS(e,i,r)}function le(n,e){return n}var x={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},z=class extends jf{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Ht=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Qd=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Yd=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ge.UNAUTHENTICATED))}shutdown(){}};var Jd=class{constructor(e){this.authProvider=e,this.currentUser=Ge.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){me(this.tokenListener===void 0,42304);let r=this.tokenCounter,i=l=>this.tokenCounter!==r?(r=this.tokenCounter,t(l)):Promise.resolve(),s=new Ht;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),s.resolve(),s=new Ht,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let l=s;e.enqueueRetryable(async()=>{await l.promise,await i(this.currentUser)})},a=l=>{U("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.tokenListener&&(this.auth.addAuthTokenListener(this.tokenListener),o())};this.authProvider.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){let l=this.authProvider.getImmediate({optional:!0});l?a(l):(U("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Ht)}},0),o()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.tokenCounter!==e?(U("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(me(typeof r.accessToken=="string",31837,{tokenData:r}),new Qd(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.tokenListener&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=void 0}getUser(){let e=this.auth&&this.auth.getUid();return me(e===null||typeof e=="string",2055,{currentUid:e}),new Ge(e)}},Xd=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r,this.type="FirstParty",this.user=Ge.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}},Zd=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r}getToken(){return Promise.resolve(new Xd(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(Ge.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Ua=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},eh=class{constructor(e,t){this.appCheckProvider=t,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null,this.serverAppAppCheckToken=null,Hf(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken)}start(e,t){me(this.tokenListener===void 0,3512);let r=s=>{s.error!=null&&U("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.latestAppCheckToken;return this.latestAppCheckToken=s.token,U("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.tokenListener=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{U("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.tokenListener&&this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.appCheckProvider.getImmediate({optional:!0});s?i(s):U("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.serverAppAppCheckToken)return Promise.resolve(new Ua(this.serverAppAppCheckToken));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(me(typeof t.token=="string",44558,{tokenResult:t}),this.latestAppCheckToken=t.token,new Ua(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.tokenListener&&this.appCheck.removeTokenListener(this.tokenListener),this.tokenListener=void 0}};function hD(n){if(!n)return new Yd;switch(n.type){case"firstParty":return new Zd(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new z(x.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}function fD(n){return lD(n)}function vS(){return new oD}var fi=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="",i=20;for(;r.length<i;){let s=fD(40);for(let o=0;o<s.length;++o)r.length<i&&s[o]<t&&(r+=e.charAt(s[o]%e.length))}return r}};function ee(n,e){return n<e?-1:n>e?1:0}function hf(n,e){let t=0;for(;t<n.length&&t<e.length;){let r=n.codePointAt(t),i=e.codePointAt(t);if(r!==i){if(r<128&&i<128)return ee(r,i);{let s=vS(),o=s.encode(Fv(n,t)),a=s.encode(Fv(e,t)),l=pD(o,a);return l!==0?l:ee(r,i)}}t+=r>65535?2:1}return ee(n.length,e.length)}function Fv(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function pD(n,e){for(let t=0;t<n.length&&t<e.length;++t)if(n[t]!==e[t])return ee(n[t],e[t]);return ee(n.length,e.length)}function dr(n,e,t){return n.length!==e.length?!1:n.every((r,i)=>t(r,e[i]))}var Bv="__name__",Va=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&W(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&W(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=n.compareSegments(e.get(i),t.get(i));if(s!==0)return s}return ee(e.length,t.length)}static compareSegments(e,t){let r=n.isNumericId(e),i=n.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?n.extractNumericId(e).compare(n.extractNumericId(t)):hf(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Bs.fromString(e.substring(4,e.length-2))}},Se=class n extends Va{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new z(x.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},mD=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ot=class n extends Va{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return mD.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Bv}static keyField(){return new n([Bv])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new z(x.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new z(x.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[i+1];if(!(l==="\\"||l==="."||l==="`"))throw new z(x.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else a==="`"?(o=!o,i++):a==="."&&!o?(s(),i++):(r+=a,i++)}if(s(),o)throw new z(x.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var H=class n{constructor(e){this.path=e}static fromPath(e){return new n(Se.fromString(e))}static fromName(e){return new n(Se.fromString(e).popFirst(5))}static empty(){return new n(Se.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Se.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Se.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2===0}static fromSegments(e){return new n(new Se(e.slice()))}};function SS(n,e,t){if(!t)throw new z(x.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function gD(n,e,t,r){if(e===!0&&r===!0)throw new z(x.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function qv(n){if(!H.isDocumentKey(n))throw new z(x.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Uv(n){if(H.isDocumentKey(n))throw new z(x.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function TS(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function ff(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=yD(n);return e?`a custom ${e} object`:"an object"}}else return typeof n=="function"?"a function":W(12329,{type:typeof n})}function yD(n){return n.constructor?n.constructor.name:null}function vD(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new z(x.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=ff(n);throw new z(x.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function be(n,e){let t={typeString:n};return e&&(t.value=e),t}function As(n,e){if(!TS(n))throw new z(x.INVALID_ARGUMENT,"JSON must be an object");let t;for(let r in e)if(e[r]){let i=e[r].typeString,s="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}let o=n[r];if(i&&typeof o!==i){t=`JSON field '${r}' must be a ${i}.`;break}else if(s!==void 0&&o!==s.value){t=`Expected '${r}' field to equal '${s.value}'`;break}}if(t)throw new z(x.INVALID_ARGUMENT,t);return!0}var Vv=-62135596800,zv=1e6,Te=class n{static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-t*1e3)*zv);return new n(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new z(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new z(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Vv)throw new z(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new z(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return this.seconds*1e3+this.nanoseconds/zv}_compareTo(e){return this.seconds===e.seconds?ee(this.nanoseconds,e.nanoseconds):ee(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:n._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(As(e,n._jsonSchema))return new n(e.seconds,e.nanoseconds)}valueOf(){let e=this.seconds-Vv,t=String(e).padStart(12,"0"),r=String(this.nanoseconds).padStart(9,"0");return t+"."+r}};Te._jsonSchemaVersion="firestore/timestamp/1.0";Te._jsonSchema={type:be("string",Te._jsonSchemaVersion),seconds:be("number"),nanoseconds:be("number")};var pe=class n{static fromTimestamp(e){return new n(e)}static min(){return new n(new Te(0,0))}static max(){return new n(new Te(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return this.timestamp.seconds*1e6+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var ys=-1;function SD(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=pe.fromTimestamp(r===1e9?new Te(t+1,0):new Te(t,r));return new hr(i,H.empty(),e)}function TD(n){return new hr(n.readTime,n.key,ys)}var hr=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(pe.min(),H.empty(),ys)}static max(){return new n(pe.max(),H.empty(),ys)}};function ED(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0||(t=H.comparator(n.documentKey,e.documentKey),t!==0)?t:ee(n.largestBatchId,e.largestBatchId)}var _D="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",th=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};async function pf(n){if(n.code===x.FAILED_PRECONDITION&&n.message===_D)U("LocalStore","Unexpectedly lost primary lease");else throw n}var N=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&W(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},l=>r(l))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let l=0;l<s;l++){let c=l;t(e[c]).next(u=>{o[c]=u,++a,a===s&&r(o)},u=>i(u))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};function bD(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Ns(n){return n.name==="IndexedDbTransactionError"}var XP=15*1e3,ZP=60*1e3;var ES=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.setPreviousValue(i),this.writeNewSequenceNumber=i=>r.writeSequenceNumber(i))}setPreviousValue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t}}n.INVALID=-1;return n})(),Fa="",wD="",CD="",ID="";function RD(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Gv(e)),e=DD(n.get(t),e);return Gv(e)}function DD(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+=Fa+CD;break;case Fa:t+=Fa+ID;break;default:t+=s}}return t}function Gv(n){return n+Fa+wD}var AD="remoteDocuments";var _S="owner";var bS="mutationQueues";var wS="mutations";var CS="documentMutations",ND="remoteDocumentsV14";var IS="remoteDocumentGlobal";var RS="targets";var DS="targetDocuments";var AS="targetGlobal",NS="collectionParents";var OS="clientMetadata";var xS="bundles";var kS="namedQueries";var OD="indexConfiguration";var xD="indexState";var kD="indexEntries";var PS="documentOverlays";var PD="globals";var MD=[bS,wS,CS,AD,RS,_S,AS,DS],LD=MD,FD=[...LD,OS],BD=[...FD,IS],qD=[...BD,NS],UD=[...qD,xS,kS],eM=[...UD,PS],VD=[bS,wS,CS,ND,RS,_S,AS,DS,OS,IS,NS,xS,kS,PS],zD=VD,GD=[...zD,OD,xD,kD];var tM=[...GD,PD];function jv(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Di(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function MS(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var at=class n{constructor(e,t){this.comparator=e,this.root=t||ps.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ps.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ps.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ui(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ui(this.root,e,this.comparator,!1)}getReverseIterator(){return new ui(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ui(this.root,e,this.comparator,!0)}},ui=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)this.isReverse?e=e.left:e=e.right;else if(s===0){this.nodeStack.push(e);break}else this.nodeStack.push(e),this.isReverse?e=e.right:e=e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},ps=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return!t.left.isRed()&&!t.left.left.isRed()&&(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,r){let i,s=this;if(r(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed()&&!s.left.left.isRed()&&(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,r),null);else{if(s.left.isRed()&&(s=s.rotateRight()),!s.right.isEmpty()&&!s.right.isRed()&&!s.right.left.isRed()&&(s=s.moveRedRight()),r(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,r))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw W(43730,{key:this.key,value:this.value});if(this.right.isRed())throw W(14113,{key:this.key,value:this.value});let t=this.left.check();if(t!==this.right.check())throw W(27949);return t+(this.isRed()?0:1)}}return n.EMPTY=null,n.RED=!0,n.BLACK=!1,n})(),nh=class{constructor(){this.size=0}get key(){throw W(57766)}get value(){throw W(16141)}get color(){throw W(16727)}get left(){throw W(29726)}get right(){throw W(36894)}copy(e,t,r,i,s){return this}insert(e,t,r){return new ps(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};ps.EMPTY=new nh;var ze=class n{constructor(e){this.comparator=e,this.data=new at(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(t!==void 0?r=this.data.getIteratorFrom(t):r=this.data.getIterator();r.hasNext();){let i=r.getNext();if(!e(i.key))return}}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new za(this.data.getIterator())}getIteratorFrom(e){return new za(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},za=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var Wt=class n{constructor(e){this.fields=e,e.sort(ot.comparator)}static empty(){return new n([])}unionWith(e){let t=new ze(ot.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return dr(this.fields,e.fields,(t,r)=>t.isEqual(r))}};function jD(n){return Buffer.from(n,"base64").toString("binary")}function $D(n){return Buffer.from(n,"binary").toString("base64")}var dn=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=jD(e);return new n(t)}static fromUint8Array(e){let t=KD(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return $D(this.binaryString)}toUint8Array(){return WD(this.binaryString)}approximateByteSize(){return this.binaryString.length*2}compareTo(e){return ee(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};dn.EMPTY_BYTE_STRING=new dn("");function KD(n){let e="";for(let t=0;t<n.length;++t)e+=String.fromCharCode(n[t]);return e}function WD(n){let e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}var HD=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function jn(n){if(me(!!n,39018),typeof n=="string"){let e=0,t=HD.exec(n);if(me(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}else{let e=we(n.seconds),t=we(n.nanos);return{seconds:e,nanos:t}}}function we(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function fr(n){return typeof n=="string"?dn.fromBase64String(n):dn.fromUint8Array(n)}var LS="server_timestamp",FS="__type__",BS="__previous_value__",qS="__local_write_time__";function mf(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[FS])===null||t===void 0?void 0:t.stringValue)===LS}function QD(n,e){let t={fields:{[FS]:{stringValue:LS},[qS]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}};return e&&mf(e)&&(e=gf(e)),e&&(t.fields[BS]=e),{mapValue:t}}function gf(n){let e=n.mapValue.fields[BS];return mf(e)?gf(e):e}function Ga(n){let e=jn(n.mapValue.fields[qS].timestampValue);return new Te(e.seconds,e.nanos)}var rh=class{constructor(e,t,r,i,s,o,a,l,c,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c,this.isUsingEmulator=u}},$v="(default)",ih=class n{constructor(e,t){this.projectId=e,this.database=t||$v}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===$v}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};function YD(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new z(x.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ih(n.options.projectId,e)}var yf=-1;function al(n){return n==null}function vs(n){return n===0&&1/n===-1/0}function JD(n){return typeof n=="number"&&Number.isInteger(n)&&!vs(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var vf="__type__",US="__max__",Pa={mapValue:{fields:{__type__:{stringValue:US}}}},Sf="__vector__",Ss="value";function pr(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?mf(n)?4:GS(n)?9007199254740991:zS(n)?10:11:W(28295,{value:n})}function Dt(n,e){if(n===e)return!0;let t=pr(n),r=pr(e);if(t!==r)return!1;switch(t){case 0:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Ga(n).isEqual(Ga(e));case 3:return XD(n,e);case 5:return n.stringValue===e.stringValue;case 6:return eA(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return ZD(n,e);case 2:return tA(n,e);case 9:return dr(n.arrayValue.values||[],e.arrayValue.values||[],Dt);case 10:case 11:return nA(n,e);case 9007199254740991:return!0;default:return W(52216,{left:n})}}function XD(n,e){if(typeof n.timestampValue=="string"&&typeof e.timestampValue=="string"&&n.timestampValue.length===e.timestampValue.length)return n.timestampValue===e.timestampValue;let t=jn(n.timestampValue),r=jn(e.timestampValue);return t.seconds===r.seconds&&t.nanos===r.nanos}function ZD(n,e){return we(n.geoPointValue.latitude)===we(e.geoPointValue.latitude)&&we(n.geoPointValue.longitude)===we(e.geoPointValue.longitude)}function eA(n,e){return fr(n.bytesValue).isEqual(fr(e.bytesValue))}function tA(n,e){if("integerValue"in n&&"integerValue"in e)return we(n.integerValue)===we(e.integerValue);if("doubleValue"in n&&"doubleValue"in e){let t=we(n.doubleValue),r=we(e.doubleValue);return t===r?vs(t)===vs(r):isNaN(t)&&isNaN(r)}return!1}function nA(n,e){let t=n.mapValue.fields||{},r=e.mapValue.fields||{};if(jv(t)!==jv(r))return!1;for(let i in t)if(t.hasOwnProperty(i)&&(r[i]===void 0||!Dt(t[i],r[i])))return!1;return!0}function Ts(n,e){return(n.values||[]).find(t=>Dt(t,e))!==void 0}function pi(n,e){if(n===e)return 0;let t=pr(n),r=pr(e);if(t!==r)return ee(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ee(n.booleanValue,e.booleanValue);case 2:return rA(n,e);case 3:return Kv(n.timestampValue,e.timestampValue);case 4:return Kv(Ga(n),Ga(e));case 5:return hf(n.stringValue,e.stringValue);case 6:return oA(n.bytesValue,e.bytesValue);case 7:return iA(n.referenceValue,e.referenceValue);case 8:return sA(n.geoPointValue,e.geoPointValue);case 9:return VS(n.arrayValue,e.arrayValue);case 10:return aA(n.mapValue,e.mapValue);case 11:return lA(n.mapValue,e.mapValue);default:throw W(23264,{leftType:t})}}function rA(n,e){let t=we(n.integerValue||n.doubleValue),r=we(e.integerValue||e.doubleValue);return t<r?-1:t>r?1:t===r?0:isNaN(t)?isNaN(r)?0:-1:1}function Kv(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ee(n,e);let t=jn(n),r=jn(e),i=ee(t.seconds,r.seconds);return i!==0?i:ee(t.nanos,r.nanos)}function iA(n,e){let t=n.split("/"),r=e.split("/");for(let i=0;i<t.length&&i<r.length;i++){let s=ee(t[i],r[i]);if(s!==0)return s}return ee(t.length,r.length)}function sA(n,e){let t=ee(we(n.latitude),we(e.latitude));return t!==0?t:ee(we(n.longitude),we(e.longitude))}function oA(n,e){let t=fr(n),r=fr(e);return t.compareTo(r)}function VS(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=pi(t[i],r[i]);if(s)return s}return ee(t.length,r.length)}function aA(n,e){var t,r,i,s;let o=n.fields||{},a=e.fields||{},l=(t=o[Ss])===null||t===void 0?void 0:t.arrayValue,c=(r=a[Ss])===null||r===void 0?void 0:r.arrayValue,u=ee(((i=l?.values)===null||i===void 0?void 0:i.length)||0,((s=c?.values)===null||s===void 0?void 0:s.length)||0);return u!==0?u:VS(l,c)}function lA(n,e){if(n===Pa.mapValue&&e===Pa.mapValue)return 0;if(n===Pa.mapValue)return 1;if(e===Pa.mapValue)return-1;let t=n.fields||{},r=Object.keys(t),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){let a=hf(r[o],s[o]);if(a!==0)return a;let l=pi(t[r[o]],i[s[o]]);if(l!==0)return l}return ee(r.length,s.length)}function mi(n){return Tf(n)}function Tf(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?uA(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?cA(n.bytesValue):"referenceValue"in n?hA(n.referenceValue):"geoPointValue"in n?dA(n.geoPointValue):"arrayValue"in n?pA(n.arrayValue):"mapValue"in n?fA(n.mapValue):W(61005,{value:n})}function cA(n){return fr(n).toBase64()}function uA(n){let e=jn(n);return`time(${e.seconds},${e.nanos})`}function dA(n){return`geo(${n.latitude},${n.longitude})`}function hA(n){return H.fromName(n).toString()}function fA(n){let e=Object.keys(n.fields||{}).sort(),t="{",r=!0;for(let i of e)r?r=!1:t+=",",t+=`${i}:${Tf(n.fields[i])}`;return t+"}"}function pA(n){let e="[",t=!0;for(let r of n.values||[])t?t=!1:e+=",",e+=Tf(r);return e+"]"}function ll(n){switch(pr(n)){case 0:return 4;case 1:return 4;case 2:return 8;case 3:return 16;case 4:let e=gf(n);return e?16+ll(e):16;case 5:return n.stringValue.length*2;case 6:return fr(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 8:return 16;case 9:return gA(n.arrayValue);case 10:case 11:return mA(n.mapValue);default:throw W(13486,{value:n})}}function mA(n){let e=0;return Di(n.fields,(t,r)=>{e+=t.length+ll(r)}),e}function gA(n){return(n.values||[]).reduce((e,t)=>e+ll(t),0)}function sh(n){return!!n&&"integerValue"in n}function yA(n){return!!n&&"doubleValue"in n}function vA(n){return sh(n)||yA(n)}function Ef(n){return!!n&&"arrayValue"in n}function Wv(n){return!!n&&"nullValue"in n}function Hv(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ba(n){return!!n&&"mapValue"in n}function zS(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[vf])===null||t===void 0?void 0:t.stringValue)===Sf}function ms(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Di(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=ms(r)),e}else if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ms(n.arrayValue.values[t]);return e}else return Object.assign({},n)}function GS(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===US}var nM={mapValue:{fields:{[vf]:{stringValue:Sf},[Ss]:{arrayValue:{}}}}};var Kt=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Ba(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){let r=this.getFieldsMap(e.popLast());r[e.lastSegment()]=ms(t)}setAll(e){let t=ot.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=ms(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());Ba(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Dt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];(!Ba(i)||!i.mapValue.fields)&&(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Di(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(ms(this.value))}};function jS(n){let e=[];return Di(n.fields,(t,r)=>{let i=new ot([t]);if(Ba(r)){let o=jS(r.mapValue).fields;if(o.length===0)e.push(i);else for(let a of o)e.push(i.child(a))}else e.push(i)}),new Wt(e)}var gi=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,pe.min(),pe.min(),pe.min(),Kt.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,pe.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,pe.min(),pe.min(),Kt.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,pe.min(),pe.min(),Kt.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(pe.min())&&(this.documentType===2||this.documentType===0)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Kt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Kt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=pe.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};function SA(n,e,t){let r=e.data.field(n),i=t.data.field(n);return r!==null&&i!==null?pi(r,i):W(42886)}var yi=class{constructor(e,t){this.position=e,this.inclusive=t}};function $S(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField())r=H.comparator(H.fromName(o.referenceValue),t.key);else{let a=t.data.field(s.field);r=pi(o,a)}if(s.dir==="desc"&&(r=r*-1),r!==0)break}return r}function TA(n,e,t){let r=$S(n,e,t);return n.inclusive?r>=0:r>0}function EA(n,e,t){let r=$S(n,e,t);return n.inclusive?r<=0:r<0}function Qv(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++){let r=n.position[t],i=e.position[t];if(!Dt(r,i))return!1}return!0}var vi=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function _A(n){return n.field.canonicalString()+n.dir}function bA(n){return`${n.field.canonicalString()} (${n.dir})`}function wA(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var ja=class{},Ie=class n extends ja{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new ah(e,t,r):t==="array-contains"?new uh(e,r):t==="in"?new dh(e,r):t==="not-in"?new hh(e,r):t==="array-contains-any"?new fh(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new lh(e,r):new ch(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(pi(t,this.value)):t!==null&&pr(this.value)===pr(t)&&this.matchesComparison(pi(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return W(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Qt=class n extends ja{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new n(e,t)}matches(e){return KS(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.memoizedFlattenedFilters!==null?this.memoizedFlattenedFilters:(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[]),this.memoizedFlattenedFilters)}getFilters(){return Object.assign([],this.filters)}};function KS(n){return n.op==="and"}function WS(n){return CA(n)&&KS(n)}function CA(n){for(let e of n.filters)if(e instanceof Qt)return!1;return!0}function oh(n){if(n instanceof Ie)return n.field.canonicalString()+n.op.toString()+mi(n.value);if(WS(n))return n.filters.map(e=>oh(e)).join(",");{let e=n.filters.map(t=>oh(t)).join(",");return`${n.op}(${e})`}}function HS(n,e){if(n instanceof Ie)return IA(n,e);if(n instanceof Qt)return RA(n,e);W(19439)}function IA(n,e){return e instanceof Ie&&n.op===e.op&&n.field.isEqual(e.field)&&Dt(n.value,e.value)}function RA(n,e){return e instanceof Qt&&n.op===e.op&&n.filters.length===e.filters.length?n.filters.reduce((r,i,s)=>r&&HS(i,e.filters[s]),!0):!1}function QS(n){return n instanceof Ie?AA(n):n instanceof Qt?DA(n):"Filter"}function DA(n){return n.op.toString()+" {"+n.getFilters().map(QS).join(" ,")+"}"}function AA(n){return`${n.field.canonicalString()} ${n.op} ${mi(n.value)}`}var ah=class extends Ie{constructor(e,t,r){super(e,t,r),this.key=H.fromName(r.referenceValue)}matches(e){let t=H.comparator(e.key,this.key);return this.matchesComparison(t)}},lh=class extends Ie{constructor(e,t){super(e,"in",t),this.keys=YS("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},ch=class extends Ie{constructor(e,t){super(e,"not-in",t),this.keys=YS("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function YS(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>H.fromName(r.referenceValue))}var uh=class extends Ie{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Ef(t)&&Ts(t.arrayValue,this.value)}},dh=class extends Ie{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Ts(this.value.arrayValue,t)}},hh=class extends Ie{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ts(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Ts(this.value.arrayValue,t)}},fh=class extends Ie{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!Ef(t)||!t.arrayValue.values?!1:t.arrayValue.values.some(r=>Ts(this.value.arrayValue,r))}};var ph=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}};function Yv(n,e=null,t=[],r=[],i=null,s=null,o=null){return new ph(n,e,t,r,i,s,o)}function _f(n){let e=le(n);if(e.memoizedCanonicalId===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>oh(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>_A(r)).join(","),al(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>mi(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>mi(r)).join(",")),e.memoizedCanonicalId=t}return e.memoizedCanonicalId}function NA(n){let e=n.path.canonicalString();return n.collectionGroup!==null&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>QS(t)).join(", ")}]`),al(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>bA(t)).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>mi(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>mi(t)).join(",")),`Target(${e})`}function bf(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!wA(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!HS(n.filters[t],e.filters[t]))return!1;return n.collectionGroup!==e.collectionGroup||!n.path.isEqual(e.path)||!Qv(n.startAt,e.startAt)?!1:Qv(n.endAt,e.endAt)}var Si=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}};function OA(n,e,t,r,i,s,o,a){return new Si(n,e,t,r,i,s,o,a)}function xA(n){return new Si(n)}function kA(n,e){return new Si(e,null,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function Jv(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function PA(n){let e=new ze(ot.comparator);return n.filters.forEach(t=>{t.getFlattenedFilters().forEach(i=>{i.isInequality()&&(e=e.add(i.field))})}),e}function MA(n){return H.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function LA(n){return n.collectionGroup!==null}function Es(n){let e=le(n);if(e.memoizedNormalizedOrderBy===null){e.memoizedNormalizedOrderBy=[];let t=new Set;for(let s of e.explicitOrderBy)e.memoizedNormalizedOrderBy.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";PA(e).forEach(s=>{!t.has(s.canonicalString())&&!s.isKeyField()&&e.memoizedNormalizedOrderBy.push(new vi(s,r))}),t.has(ot.keyField().canonicalString())||e.memoizedNormalizedOrderBy.push(new vi(ot.keyField(),r))}return e.memoizedNormalizedOrderBy}function zn(n){let e=le(n);return e.memoizedTarget||(e.memoizedTarget=FA(e,Es(n))),e.memoizedTarget}function FA(n,e){if(n.limitType==="F")return Yv(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new vi(i.field,s)});let t=n.endAt?new yi(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new yi(n.startAt.position,n.startAt.inclusive):null;return Yv(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function mh(n,e,t){return new Si(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function JS(n,e){return bf(zn(n),zn(e))&&n.limitType===e.limitType}function XS(n){return`${_f(zn(n))}|lt:${n.limitType}`}function fs(n){return`Query(target=${NA(zn(n))}; limitType=${n.limitType})`}function wf(n,e){return e.isFoundDocument()&&BA(n,e)&&qA(n,e)&&UA(n,e)&&VA(n,e)}function BA(n,e){let t=e.key.path;return n.collectionGroup!==null?e.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(t):H.isDocumentKey(n.path)?n.path.isEqual(t):n.path.isImmediateParentOf(t)}function qA(n,e){for(let t of Es(n))if(!t.field.isKeyField()&&e.data.field(t.field)===null)return!1;return!0}function UA(n,e){for(let t of n.filters)if(!t.matches(e))return!1;return!0}function VA(n,e){return!(n.startAt&&!EA(n.startAt,Es(n),e)||n.endAt&&!TA(n.endAt,Es(n),e))}function zA(n){return(e,t)=>{let r=!1;for(let i of Es(n)){let s=GA(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function GA(n,e,t){let r=n.field.isKeyField()?H.comparator(e.key,t.key):SA(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return W(19790,{direction:n.dir})}}var hn=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0){this.inner[r]=[[e,t]],this.innerSize++;return}for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e)){i[s]=[e,t];return}i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Di(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return MS(this.inner)}size(){return this.innerSize}};var jA=new at(H.comparator);function $a(){return jA}var ZS=new at(H.comparator);function Ma(...n){let e=ZS;for(let t of n)e=e.insert(t.key,t);return e}function $A(){return _s()}function eT(n){let e=ZS;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function ar(){return _s()}function tT(){return _s()}function _s(){return new hn(n=>n.toString(),(n,e)=>n.isEqual(e))}var KA=new at(H.comparator);function WA(){return KA}var HA=new ze(H.comparator);function Ve(...n){let e=HA;for(let t of n)e=e.add(t);return e}var QA=new ze(ee);function YA(){return QA}function Cf(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:vs(e)?"-0":e}}function nT(n){return{integerValue:""+n}}function JA(n,e){return JD(e)?nT(e):Cf(n,e)}var Ti=class{constructor(){this._=void 0}};function XA(n,e,t){return n instanceof Ei?QD(t,e):n instanceof mr?iT(n,e):n instanceof gr?sT(n,e):tN(n,e)}function ZA(n,e,t){return n instanceof mr?iT(n,e):n instanceof gr?sT(n,e):t}function rT(n,e){return n instanceof _i?vA(e)?e:{integerValue:0}:null}function eN(n,e){return n instanceof mr&&e instanceof mr||n instanceof gr&&e instanceof gr?dr(n.elements,e.elements,Dt):n instanceof _i&&e instanceof _i?Dt(n.operand,e.operand):n instanceof Ei&&e instanceof Ei}var Ei=class extends Ti{},mr=class extends Ti{constructor(e){super(),this.elements=e}};function iT(n,e){let t=oT(e);for(let r of n.elements)t.some(i=>Dt(i,r))||t.push(r);return{arrayValue:{values:t}}}var gr=class extends Ti{constructor(e){super(),this.elements=e}};function sT(n,e){let t=oT(e);for(let r of n.elements)t=t.filter(i=>!Dt(i,r));return{arrayValue:{values:t}}}var _i=class extends Ti{constructor(e,t){super(),this.serializer=e,this.operand=t}};function tN(n,e){let t=rT(n,e),r=Xv(t)+Xv(n.operand);return sh(t)&&sh(n.operand)?nT(r):Cf(n.serializer,r)}function Xv(n){return we(n.integerValue||n.doubleValue)}function oT(n){return Ef(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function nN(n,e){return n.field.isEqual(e.field)&&eN(n.transform,e.transform)}function rN(n,e){return n===void 0&&e===void 0?!0:n&&e?dr(n,e,(t,r)=>nN(t,r)):!1}var gh=class{constructor(e,t){this.version=e,this.transformResults=t}},lr=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function cl(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists!==void 0?n.exists===e.isFoundDocument():!0}var bi=class{};function aT(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Ka(n.key,lr.none()):new yr(n.key,n.data,lr.none());{let t=n.data,r=Kt.empty(),i=new ze(ot.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new fn(n.key,r,new Wt(i.toArray()),lr.none())}}function iN(n,e,t){n instanceof yr?oN(n,e,t):n instanceof fn?lN(n,e,t):uN(n,e,t)}function gs(n,e,t,r){return n instanceof yr?aN(n,e,t,r):n instanceof fn?cN(n,e,t,r):dN(n,e,t)}function sN(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=rT(r.transform,i||null);s!=null&&(t===null&&(t=Kt.empty()),t.set(r.field,s))}return t||null}function Zv(n,e){return n.type!==e.type||!n.key.isEqual(e.key)||!n.precondition.isEqual(e.precondition)||!rN(n.fieldTransforms,e.fieldTransforms)?!1:n.type===0?n.value.isEqual(e.value):n.type===1?n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask):!0}var yr=class extends bi{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}};function oN(n,e,t){let r=n.value.clone(),i=cT(n.fieldTransforms,e,t.transformResults);r.setAll(i),e.convertToFoundDocument(t.version,r).setHasCommittedMutations()}function aN(n,e,t,r){if(!cl(n.precondition,e))return t;let i=n.value.clone(),s=uT(n.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}var fn=class extends bi{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function lN(n,e,t){if(!cl(n.precondition,e)){e.convertToUnknownDocument(t.version);return}let r=cT(n.fieldTransforms,e,t.transformResults),i=e.data;i.setAll(lT(n)),i.setAll(r),e.convertToFoundDocument(t.version,i).setHasCommittedMutations()}function cN(n,e,t,r){if(!cl(n.precondition,e))return t;let i=uT(n.fieldTransforms,r,e),s=e.data;return s.setAll(lT(n)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),t===null?null:t.unionWith(n.fieldMask.fields).unionWith(n.fieldTransforms.map(o=>o.field))}function lT(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function cT(n,e,t){let r=new Map;me(n.length===t.length,32656,{serverTransformResultCount:t.length,fieldTransformCount:n.length});for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,ZA(o,a,t[i]))}return r}function uT(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,XA(s,o,e))}return r}var Ka=class extends bi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}};function uN(n,e,t){e.convertToNoDocument(t.version).setHasCommittedMutations()}function dN(n,e,t){return cl(n.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):t}var yh=class extends bi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var vh=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];if(s.key.isEqual(e.key)){let o=r[i];iN(s,e,o)}}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=gs(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=gs(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=tT();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let l=aT(o,a);l!==null&&r.set(i.key,l),o.isValidDocument()||o.convertToNoDocument(pe.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Ve())}isEqual(e){return this.batchId===e.batchId&&dr(this.mutations,e.mutations,(t,r)=>Zv(t,r))&&dr(this.baseMutations,e.baseMutations,(t,r)=>Zv(t,r))}},Sh=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){me(e.mutations.length===r.length,58842,{mutationsSent:e.mutations.length,resultsReceived:r.length});let i=WA(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var Th=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var xe=(function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n})(xe||{});function hN(n){switch(n){case x.OK:return W(64938);case x.CANCELLED:case x.UNKNOWN:case x.DEADLINE_EXCEEDED:case x.RESOURCE_EXHAUSTED:case x.INTERNAL:case x.UNAVAILABLE:case x.UNAUTHENTICATED:return!1;case x.INVALID_ARGUMENT:case x.NOT_FOUND:case x.ALREADY_EXISTS:case x.PERMISSION_DENIED:case x.FAILED_PRECONDITION:case x.ABORTED:case x.OUT_OF_RANGE:case x.UNIMPLEMENTED:case x.DATA_LOSS:return!0;default:return W(15467,{code:n})}}function fN(n){return hN(n)&&n!==x.ABORTED}function Gd(n){if(n===void 0)return un("GRPC error has no .code"),x.UNKNOWN;switch(n){case xe.OK:return x.OK;case xe.CANCELLED:return x.CANCELLED;case xe.UNKNOWN:return x.UNKNOWN;case xe.DEADLINE_EXCEEDED:return x.DEADLINE_EXCEEDED;case xe.RESOURCE_EXHAUSTED:return x.RESOURCE_EXHAUSTED;case xe.INTERNAL:return x.INTERNAL;case xe.UNAVAILABLE:return x.UNAVAILABLE;case xe.UNAUTHENTICATED:return x.UNAUTHENTICATED;case xe.INVALID_ARGUMENT:return x.INVALID_ARGUMENT;case xe.NOT_FOUND:return x.NOT_FOUND;case xe.ALREADY_EXISTS:return x.ALREADY_EXISTS;case xe.PERMISSION_DENIED:return x.PERMISSION_DENIED;case xe.FAILED_PRECONDITION:return x.FAILED_PRECONDITION;case xe.ABORTED:return x.ABORTED;case xe.OUT_OF_RANGE:return x.OUT_OF_RANGE;case xe.UNIMPLEMENTED:return x.UNIMPLEMENTED;case xe.DATA_LOSS:return x.DATA_LOSS;default:return W(39323,{code:n})}}var rM=new Bs([4294967295,4294967295],0);var pN=(()=>{let n={};return n.asc="ASCENDING",n.desc="DESCENDING",n})(),mN=(()=>{let n={};return n["<"]="LESS_THAN",n["<="]="LESS_THAN_OR_EQUAL",n[">"]="GREATER_THAN",n[">="]="GREATER_THAN_OR_EQUAL",n["=="]="EQUAL",n["!="]="NOT_EQUAL",n["array-contains"]="ARRAY_CONTAINS",n.in="IN",n["not-in"]="NOT_IN",n["array-contains-any"]="ARRAY_CONTAINS_ANY",n})(),gN=(()=>{let n={};return n.and="AND",n.or="OR",n})();var Wa=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function yN(n,e){return n.useProto3Json||al(e)?e:{value:e}}function vN(n){let e;return typeof n=="object"?e=n.value:e=n,al(e)?null:e}function Vn(n,e){if(n.useProto3Json){let r=new Date(e.seconds*1e3).toISOString().replace(/\.\d*/,"").replace("Z",""),i=("000000000"+e.nanoseconds).slice(-9);return`${r}.${i}Z`}else return{seconds:""+e.seconds,nanos:e.nanoseconds}}function dT(n){let e=jn(n);return new Te(e.seconds,e.nanos)}function SN(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function TN(n,e){return Vn(n,e.toTimestamp())}function hi(n){return me(!!n,49232),pe.fromTimestamp(dT(n))}function If(n,e){return Eh(n,e).canonicalString()}function Eh(n,e){let t=CN(n).child("documents");return e===void 0?t:t.child(e)}function EN(n){let e=Se.fromString(n);return me(n1(e),10190,{key:e.toString()}),e}function bs(n,e){return If(n.databaseId,e.path)}function _N(n,e){return If(n.databaseId,e)}function bN(n){let e=EN(n);return e.length===4?Se.emptyPath():IN(e)}function wN(n){return new Se(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function CN(n){return new Se(["projects",n.projectId,"databases",n.database])}function IN(n){return me(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function eS(n,e,t){return{name:bs(n,e),fields:t.value.mapValue.fields}}function RN(n,e){let t;if(e instanceof yr)t={update:eS(n,e.key,e.value)};else if(e instanceof Ka)t={delete:bs(n,e.key)};else if(e instanceof fn)t={update:eS(n,e.key,e.data),updateMask:t1(e.fieldMask)};else if(e instanceof yh)t={verify:bs(n,e.key)};else return W(16599,{mutationType:e.type});return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>ON(n,r))),e.precondition.isNone||(t.currentDocument=DN(n,e.precondition)),t}function DN(n,e){return e.updateTime!==void 0?{updateTime:TN(n,e.updateTime)}:e.exists!==void 0?{exists:e.exists}:W(27497)}function AN(n,e){let t=n.updateTime?hi(n.updateTime):hi(e);return t.isEqual(pe.min())&&(t=hi(e)),new gh(t,n.transformResults||[])}function NN(n,e){return n&&n.length>0?(me(e!==void 0,14353),n.map(t=>AN(t,e))):[]}function ON(n,e){let t=e.transform;if(t instanceof Ei)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof mr)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof gr)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof _i)return{fieldPath:e.field.canonicalString(),increment:t.operand};throw W(20930,{transform:e.transform})}function xN(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=_N(n,i);let s=PN(e.filters);s&&(t.structuredQuery.where=s);let o=LN(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=yN(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=BN(e.startAt)),e.endAt&&(t.structuredQuery.endAt=qN(e.endAt)),{queryTarget:t,parent:i}}function kN(n){let e=bN(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){me(r===1,65062);let u=t.from[0];u.allDescendants?i=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=MN(t.where));let o=[];t.orderBy&&(o=FN(t.orderBy));let a=null;t.limit&&(a=vN(t.limit));let l=null;t.startAt&&(l=UN(t.startAt));let c=null;return t.endAt&&(c=VN(t.endAt)),OA(e,i,o,s,a,"F",l,c)}function PN(n){if(n.length!==0)return fT(Qt.create(n,"and"))}function MN(n){let e=hT(n);return e instanceof Qt&&WS(e)?e.getFilters():[e]}function hT(n){return n.unaryFilter!==void 0?XN(n):n.fieldFilter!==void 0?ZN(n):n.compositeFilter!==void 0?e1(n):W(30097,{filter:n})}function LN(n){if(n.length!==0)return n.map(e=>HN(e))}function FN(n){return n.map(e=>QN(e))}function BN(n){return{before:n.inclusive,values:n.position}}function qN(n){return{before:!n.inclusive,values:n.position}}function UN(n){let e=!!n.before,t=n.values||[];return new yi(t,e)}function VN(n){let e=!n.before,t=n.values||[];return new yi(t,e)}function zN(n){return pN[n]}function GN(n){switch(n){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function jN(n){return mN[n]}function $N(n){return gN[n]}function KN(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return W(58110);default:return W(50506)}}function WN(n){switch(n){case"AND":return"and";case"OR":return"or";default:return W(1026)}}function ci(n){return{fieldPath:n.canonicalString()}}function di(n){return ot.fromServerFormat(n.fieldPath)}function HN(n){return{field:ci(n.field),direction:zN(n.dir)}}function QN(n){return new vi(di(n.field),GN(n.direction))}function fT(n){return n instanceof Ie?JN(n):n instanceof Qt?YN(n):W(54877,{filter:n})}function YN(n){let e=n.getFilters().map(t=>fT(t));return e.length===1?e[0]:{compositeFilter:{op:$N(n.op),filters:e}}}function JN(n){if(n.op==="=="){if(Hv(n.value))return{unaryFilter:{field:ci(n.field),op:"IS_NAN"}};if(Wv(n.value))return{unaryFilter:{field:ci(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(Hv(n.value))return{unaryFilter:{field:ci(n.field),op:"IS_NOT_NAN"}};if(Wv(n.value))return{unaryFilter:{field:ci(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ci(n.field),op:jN(n.op),value:n.value}}}function XN(n){switch(n.unaryFilter.op){case"IS_NAN":let e=di(n.unaryFilter.field);return Ie.create(e,"==",{doubleValue:NaN});case"IS_NULL":let t=di(n.unaryFilter.field);return Ie.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=di(n.unaryFilter.field);return Ie.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=di(n.unaryFilter.field);return Ie.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return W(61313);default:return W(60726)}}function ZN(n){return Ie.create(di(n.fieldFilter.field),KN(n.fieldFilter.op),n.fieldFilter.value)}function e1(n){return Qt.create(n.compositeFilter.filters.map(e=>hT(e)),WN(n.compositeFilter.op))}function t1(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function n1(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var _h=class{constructor(e){this.remoteSerializer=e}};function r1(n){let e=kN({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?mh(e,e.limit,"L"):e}function i1(n){return{name:n.name,query:r1(n.bundledQuery),readTime:hi(n.readTime)}}function s1(n){return{id:n.id,version:n.version,createTime:hi(n.createTime)}}var o1=5,a1=10,l1=13,jd=15,c1=20,u1=25,d1=30,h1=37,f1=45,p1=50,m1=53,g1=55,y1=60,v1=2,Ha=class{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,o1);else if("booleanValue"in e)this.writeValueTypeLabel(t,a1),t.writeNumber(e.booleanValue?1:0);else if("integerValue"in e)this.writeValueTypeLabel(t,jd),t.writeNumber(we(e.integerValue));else if("doubleValue"in e){let r=we(e.doubleValue);isNaN(r)?this.writeValueTypeLabel(t,l1):(this.writeValueTypeLabel(t,jd),vs(r)?t.writeNumber(0):t.writeNumber(r))}else if("timestampValue"in e){let r=e.timestampValue;this.writeValueTypeLabel(t,c1),typeof r=="string"&&(r=jn(r)),t.writeString(`${r.seconds||""}`),t.writeNumber(r.nanos||0)}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,d1),t.writeBytes(fr(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.writeValueTypeLabel(t,f1),t.writeNumber(r.latitude||0),t.writeNumber(r.longitude||0)}else"mapValue"in e?GS(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):zS(e)?this.writeIndexVector(e.mapValue,t):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):W(19022,{indexValue:e})}writeIndexString(e,t){this.writeValueTypeLabel(t,u1),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let r=e.fields||{};this.writeValueTypeLabel(t,g1);for(let i of Object.keys(r))this.writeIndexString(i,t),this.writeIndexValueAux(r[i],t)}writeIndexVector(e,t){var r,i;let s=e.fields||{};this.writeValueTypeLabel(t,m1);let o=Ss,a=((i=(r=s[o].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.writeValueTypeLabel(t,jd),t.writeNumber(we(a)),this.writeIndexString(o,t),this.writeIndexValueAux(s[o],t)}writeIndexArray(e,t){let r=e.values||[];this.writeValueTypeLabel(t,p1);for(let i of r)this.writeIndexValueAux(i,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,h1),H.fromName(e).path.forEach(i=>{this.writeValueTypeLabel(t,y1),this.writeUnlabeledIndexString(i,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(v1)}};Ha.INSTANCE=new Ha;var bh=class{constructor(){this.collectionParentIndex=new wh}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),N.resolve()}getCollectionParents(e,t){return N.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return N.resolve()}deleteFieldIndex(e,t){return N.resolve()}deleteAllFieldIndexes(e){return N.resolve()}createTargetIndexes(e,t){return N.resolve()}getDocumentsMatchingTarget(e,t){return N.resolve(null)}getIndexType(e,t){return N.resolve(0)}getFieldIndexes(e,t){return N.resolve([])}getNextCollectionGroupToUpdate(e){return N.resolve(null)}getMinOffset(e,t){return N.resolve(hr.min())}getMinOffsetFromCollectionGroup(e,t){return N.resolve(hr.min())}updateCollectionGroup(e,t,r){return N.resolve()}updateIndexEntries(e,t){return N.resolve()}},wh=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new ze(Se.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new ze(Se.comparator)).toArray()}};var iM=new Uint8Array(0);var $d=2,ws=class n{constructor(e){this.lastId=e}next(){return this.lastId+=$d,this.lastId}static forTargetCache(){return new n(2-$d)}static forSyncEngine(){return new n(1-$d)}};var tS={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},ul=-1,pT=40*1024*1024,yt=class n{static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}};yt.DEFAULT_COLLECTION_PERCENTILE=10;yt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3;yt.DEFAULT=new yt(pT,yt.DEFAULT_COLLECTION_PERCENTILE,yt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);yt.DISABLED=new yt(ul,0,0);var nS="LruGarbageCollector",rS=1*1024*1024,S1=60*1e3,T1=300*1e3;function iS([n,e],[t,r]){let i=ee(n,t);return i===0?ee(e,r):i}var Ch=class{constructor(e){this.maxElements=e,this.buffer=new ze(iS),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();iS(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},Ih=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==ul&&this.scheduleGC(S1)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return this.gcTask!==null}scheduleGC(e){U(nS,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.gcTask=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Ns(t)?U(nS,"Ignoring IndexedDB error during garbage collection: ",t):await pf(t)}await this.scheduleGC(T1)})}},Rh=class{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return N.resolve(ES.INVALID);let r=new Ch(t);return this.delegate.forEachTarget(e,i=>r.addElement(i.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,i=>r.addElement(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.delegate.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===ul?(U("LruGarbageCollector","Garbage collection skipped; disabled"),N.resolve(tS)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(U("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),tS):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let r,i,s,o,a,l,c,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(m=>(m>this.params.maximumSequenceNumbersToCollect?(U("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),i=this.params.maximumSequenceNumbersToCollect):i=m,o=Date.now(),this.nthSequenceNumber(e,i))).next(m=>(r=m,a=Date.now(),this.removeTargets(e,r,t))).next(m=>(s=m,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(m=>{if(c=Date.now(),li()<=At.DEBUG){let S=`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${i} in ${a-o}ms
	Removed ${s} targets in ${l-a}ms
	Removed ${m} documents in ${c-l}ms
Total Duration: ${c-u}ms`;U("LruGarbageCollector",S)}return N.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:m})})}};function E1(n,e){return new Rh(n,e)}var Dh=class{constructor(){this.changes=new hn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,gi.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?N.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Ah=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Nh=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&gs(r.mutation,i,Wt.empty(),Te.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Ve()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Ve()){let i=ar();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Ma();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=ar();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Ve()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=$a(),o=_s(),a=$A();return t.forEach((l,c)=>{let u=r.get(c.key);i.has(c.key)&&(u===void 0||u.mutation instanceof fn)?s=s.insert(c.key,c):u!==void 0?(o.set(c.key,u.mutation.getFieldMask()),gs(u.mutation,c,u.mutation.getFieldMask(),Te.now())):o.set(c.key,Wt.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((c,u)=>o.set(c,u)),t.forEach((c,u)=>{var m;return a.set(c,new Ah(u,(m=o.get(c))!==null&&m!==void 0?m:null))}),a))}recalculateAndSaveOverlays(e,t){let r=_s(),i=new at((o,a)=>o-a),s=Ve();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(l=>{let c=t.get(l);if(c===null)return;let u=r.get(l)||Wt.empty();u=a.applyToLocalView(c,u),r.set(l,u);let m=(i.get(a.batchId)||Ve()).add(l);i=i.insert(a.batchId,m)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let l=a.getNext(),c=l.key,u=l.value,m=tT();u.forEach(S=>{if(!s.has(S)){let E=aT(t.get(S),r.get(S));E!==null&&m.set(S,E),s=s.add(S)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,m))}return N.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return MA(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):LA(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):N.resolve(ar()),a=ys,l=s;return o.next(c=>N.forEach(c,(u,m)=>(a<m.largestBatchId&&(a=m.largestBatchId),s.get(u)?N.resolve():this.remoteDocumentCache.getEntry(e,u).next(S=>{l=l.insert(u,S)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,l,c,Ve())).next(u=>({batchId:a,changes:eT(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new H(t)).next(r=>{let i=Ma();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=Ma();return this.indexManager.getCollectionParents(e,s).next(a=>N.forEach(a,l=>{let c=kA(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(u=>{u.forEach((m,S)=>{o=o.insert(m,S)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((l,c)=>{let u=c.getKey();o.get(u)===null&&(o=o.insert(u,gi.newInvalidDocument(u)))});let a=Ma();return o.forEach((l,c)=>{let u=s.get(l);u!==void 0&&gs(u.mutation,c,Wt.empty(),Te.now()),wf(t,c)&&(a=a.insert(l,c))}),a})}};var Oh=class{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return N.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,s1(t)),N.resolve()}getNamedQuery(e,t){return N.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,i1(t)),N.resolve()}};var xh=class{constructor(){this.overlays=new at(H.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return N.resolve(this.overlays.get(t))}getOverlays(e,t){let r=ar();return N.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.saveOverlay(e,t,s)}),N.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.overlayByBatchId.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.overlayByBatchId.delete(r)),N.resolve()}getOverlaysForCollection(e,t,r){let i=ar(),s=t.length+1,o=new H(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return N.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new at((c,u)=>c-u),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let S=s.get(u.largestBatchId);S===null&&(S=ar(),s=s.insert(u.largestBatchId,S)),S.set(u.getKey(),u)}}let a=ar(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((m,S)=>a.set(m,S)),!(a.size()>=i)););return N.resolve(a)}saveOverlay(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.overlayByBatchId.get(i.largestBatchId).delete(r.key);this.overlayByBatchId.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Th(t,r));let s=this.overlayByBatchId.get(t);s===void 0&&(s=Ve(),this.overlayByBatchId.set(t,s)),this.overlayByBatchId.set(t,s.add(r.key))}};var kh=class{constructor(){this.sessionToken=dn.EMPTY_BYTE_STRING}getSessionToken(e){return N.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,N.resolve()}};var Cs=class{constructor(){this.refsByKey=new ze(_e.compareByKey),this.refsByTarget=new ze(_e.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let r=new _e(e,t);this.refsByKey=this.refsByKey.add(r),this.refsByTarget=this.refsByTarget.add(r)}addReferences(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.removeRef(new _e(e,t))}removeReferences(e,t){e.forEach(r=>this.removeReference(r,t))}removeReferencesForId(e){let t=new H(new Se([])),r=new _e(t,e),i=new _e(t,e+1),s=[];return this.refsByTarget.forEachInRange([r,i],o=>{this.removeRef(o),s.push(o.key)}),s}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new H(new Se([])),r=new _e(t,e),i=new _e(t,e+1),s=Ve();return this.refsByTarget.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new _e(e,0),r=this.refsByKey.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},_e=class{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return H.comparator(e.key,t.key)||ee(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return ee(e.targetOrBatchId,t.targetOrBatchId)||H.comparator(e.key,t.key)}};var Ph=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new ze(_e.compareByKey)}checkEmpty(e){return N.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new vh(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.batchesByDocumentKey=this.batchesByDocumentKey.add(new _e(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return N.resolve(o)}lookupMutationBatch(e,t){return N.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.indexOfBatchId(r),s=i<0?0:i;return N.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return N.resolve(this.mutationQueue.length===0?yf:this.nextBatchId-1)}getAllMutationBatches(e){return N.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new _e(t,0),i=new _e(t,Number.POSITIVE_INFINITY),s=[];return this.batchesByDocumentKey.forEachInRange([r,i],o=>{let a=this.findMutationBatch(o.targetOrBatchId);s.push(a)}),N.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ze(ee);return t.forEach(i=>{let s=new _e(i,0),o=new _e(i,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([s,o],a=>{r=r.add(a.targetOrBatchId)})}),N.resolve(this.findMutationBatches(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;H.isDocumentKey(s)||(s=s.child(""));let o=new _e(new H(s),0),a=new ze(ee);return this.batchesByDocumentKey.forEachWhile(l=>{let c=l.key.path;return r.isPrefixOf(c)?(c.length===i&&(a=a.add(l.targetOrBatchId)),!0):!1},o),N.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(r=>{let i=this.findMutationBatch(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){let r=this.indexOfExistingBatchId(t.batchId,"removed");me(r===0,55003),this.mutationQueue.shift();let i=this.batchesByDocumentKey;return N.forEach(t.mutations,s=>{let o=new _e(s.key,t.batchId);return i=i.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.batchesByDocumentKey=i})}removeCachedMutationKeys(e){}containsKey(e,t){let r=new _e(t,0),i=this.batchesByDocumentKey.firstAfterOrEqual(r);return N.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,N.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){if(this.mutationQueue.length===0)return 0;let t=this.mutationQueue[0].batchId;return e-t}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var _1="-9223372036854775808";function b1(){return new at(H.comparator)}var Mh=class{constructor(e){this.sizer=e,this.docs=b1(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.sizer(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return N.resolve(r?r.document.mutableCopy():gi.newInvalidDocument(t))}getEntries(e,t){let r=$a();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():gi.newInvalidDocument(i))}),N.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=$a(),o=t.path,a=new H(o.child("__id"+_1+"__")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){let{key:c,value:{document:u}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||ED(TD(u),r)<=0||!i.has(u.key)&&!wf(t,u)||(s=s.insert(u.key,u.mutableCopy()))}return N.resolve(s)}getAllFromCollectionGroup(e,t,r,i){W(9500)}forEachDocumentKey(e,t){return N.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Lh(this)}getSize(e){return N.resolve(this.size)}};function w1(n){return new Mh(n)}var Lh=class extends Dh{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.documentCache.addEntry(e,i)):this.documentCache.removeEntry(r)}),N.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}};var Fh=class{constructor(e){this.persistence=e,this.targets=new hn(t=>_f(t),bf),this.lastRemoteSnapshotVersion=pe.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new Cs,this.targetCount=0,this.targetIdGenerator=ws.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((r,i)=>t(i)),N.resolve()}getLastRemoteSnapshotVersion(e){return N.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return N.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),N.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),N.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new ws(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,N.resolve()}updateTargetData(e,t){return this.saveTargetData(t),N.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,N.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.targets.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.targets.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),N.waitFor(s).next(()=>i)}getTargetCount(e){return N.resolve(this.targetCount)}getTargetData(e,t){let r=this.targets.get(t)||null;return N.resolve(r)}addMatchingKeys(e,t,r){return this.references.addReferences(t,r),N.resolve()}removeMatchingKeys(e,t,r){this.references.removeReferences(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),N.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),N.resolve()}getMatchingKeysForTargetId(e,t){let r=this.references.referencesForId(t);return N.resolve(r)}containsKey(e,t){return N.resolve(this.references.containsKey(t))}};var C1="MemoryPersistence",Qa=class{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new ES(0),this._started=!1,this._started=!0,this.globalsCache=new kh,this.referenceDelegate=e(this),this.targetCache=new Fh(this);let r=i=>this.referenceDelegate.documentSize(i);this.indexManager=new bh,this.remoteDocumentCache=w1(r),this.serializer=new _h(t),this.bundleCache=new Oh(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new xh,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.mutationQueues[e.toKey()];return r||(r=new Ph(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=r),r}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){U(C1,"Starting transaction:",e);let i=new Bh(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),r(i).next(s=>this.referenceDelegate.onTransactionCommitted(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}mutationQueuesContainKey(e,t){return N.or(Object.values(this.mutationQueues).map(r=>()=>r.containsKey(e,t)))}},Bh=class extends th{constructor(e){super(),this.currentSequenceNumber=e}},qh=class n{constructor(e){this.persistence=e,this.localViewReferences=new Cs,this._orphanedDocuments=null}static factory(e){return new n(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw W(60996)}addReference(e,t,r){return this.localViewReferences.addReference(r,t),this.orphanedDocuments.delete(r.toString()),N.resolve()}removeReference(e,t,r){return this.localViewReferences.removeReference(r,t),this.orphanedDocuments.add(r.toString()),N.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),N.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(s=>this.orphanedDocuments.add(s.toString()));let i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(o=>this.orphanedDocuments.add(o.toString()))}).next(()=>i.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return N.forEach(this.orphanedDocuments,i=>{let s=H.fromPath(i);return this.isReferenced(e,s).next(o=>{o||r.removeEntry(s,pe.min())})}).next(()=>(this._orphanedDocuments=null,r.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(r=>{r?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return N.or([()=>N.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}},Ya=class n{constructor(e,t){this.persistence=e,this.orphanedSequenceNumbers=new hn(r=>RD(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=E1(this,t)}static factory(e,t){return new n(e,t)}onTransactionStarted(){}onTransactionCommitted(e){return N.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.persistence.getTargetCache().getTargetCount(e).next(i=>t.next(s=>i+s))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,r=>{t++}).next(()=>t)}forEachOrphanedDocumentSequenceNumber(e,t){return N.forEach(this.orphanedSequenceNumbers,(r,i)=>this.isPinned(e,r,i).next(s=>s?N.resolve():t(i)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.forEachDocumentKey(e,a=>this.isPinned(e,a,t).next(l=>{l||(r++,s.removeEntry(a,pe.min()))})).next(()=>s.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),N.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.orphanedSequenceNumbers.set(r,e.currentSequenceNumber),N.resolve()}removeReference(e,t,r){return this.orphanedSequenceNumbers.set(r,e.currentSequenceNumber),N.resolve()}updateLimboDocument(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),N.resolve()}documentSize(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=ll(e.data.value)),t}isPinned(e,t,r){return N.or([()=>this.persistence.mutationQueuesContainKey(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.orphanedSequenceNumbers.get(t);return N.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};var sM=1800*1e3;function I1(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}var R1="LocalStore",oM=300*1e6,Uh=class{constructor(e,t,r,i){this.persistence=e,this.queryEngine=t,this.serializer=i,this.targetDataByTarget=new at(ee),this.targetIdByTarget=new hn(s=>_f(s),bf),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(r)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Nh(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}};function D1(n,e,t,r){return new Uh(n,e,t,r)}async function mT(n,e){let t=le(n);return await t.persistence.runTransaction("Handle user change","readonly",i=>{let s;return t.mutationQueue.getAllMutationBatches(i).next(o=>(s=o,t.initializeUserComponents(e),t.mutationQueue.getAllMutationBatches(i))).next(o=>{let a=[],l=[],c=Ve();for(let u of s){a.push(u.batchId);for(let m of u.mutations)c=c.add(m.key)}for(let u of o){l.push(u.batchId);for(let m of u.mutations)c=c.add(m.key)}return t.localDocuments.getDocuments(i,c).next(u=>({affectedDocuments:u,removedBatchIds:a,addedBatchIds:l}))})})}function A1(n,e){let t=le(n),r=Te.now(),i=e.reduce((a,l)=>a.add(l.key),Ve()),s,o;return t.persistence.runTransaction("Locally write mutations","readwrite",a=>{let l=$a(),c=Ve();return t.remoteDocuments.getEntries(a,i).next(u=>{l=u,l.forEach((m,S)=>{S.isValidDocument()||(c=c.add(m))})}).next(()=>t.localDocuments.getOverlayedDocuments(a,l)).next(u=>{s=u;let m=[];for(let S of e){let E=sN(S,s.get(S.key).overlayedDocument);E!=null&&m.push(new fn(S.key,E,jS(E.value.mapValue),lr.exists(!0)))}return t.mutationQueue.addMutationBatch(a,r,m,e)}).next(u=>{o=u;let m=u.applyToLocalDocumentSet(s,c);return t.documentOverlayCache.saveOverlays(a,u.batchId,m)})}).then(()=>({batchId:o.batchId,changes:eT(s)}))}function N1(n,e){let t=le(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});return L1(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,O1(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function O1(n){let e=Ve();for(let t=0;t<n.mutationResults.length;++t)n.mutationResults[t].transformResults.length>0&&(e=e.add(n.batch.mutations[t].key));return e}function x1(n,e){let t=le(n);return t.persistence.runTransaction("Reject batch","readwrite-primary",r=>{let i;return t.mutationQueue.lookupMutationBatch(r,e).next(s=>(me(s!==null,37113),i=s.keys(),t.mutationQueue.removeMutationBatch(r,s))).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,i)).next(()=>t.localDocuments.getDocuments(r,i))})}function k1(n){let e=le(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.targetCache.getLastRemoteSnapshotVersion(t))}async function P1(n,e){let t=le(n);try{await t.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>N.forEach(e,i=>N.forEach(i.addedKeys,s=>t.persistence.referenceDelegate.addReference(r,i.targetId,s)).next(()=>N.forEach(i.removedKeys,s=>t.persistence.referenceDelegate.removeReference(r,i.targetId,s)))))}catch(r){if(Ns(r))U(R1,"Failed to update sequence numbers: "+r);else throw r}for(let r of e){let i=r.targetId;if(!r.fromCache){let s=t.targetDataByTarget.get(i),o=s.snapshotVersion,a=s.withLastLimboFreeSnapshotVersion(o);t.targetDataByTarget=t.targetDataByTarget.insert(i,a)}}}function M1(n,e){let t=le(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=yf),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function L1(n,e,t,r){let i=t.batch,s=i.keys(),o=N.resolve();return s.forEach(a=>{o=o.next(()=>r.getEntry(e,a)).next(l=>{let c=t.docVersions.get(a);me(c!==null,48541),l.version.compareTo(c)<0&&(i.applyToRemoteDocument(l,t),l.isValidDocument()&&(l.setReadTime(t.commitVersion),r.addEntry(l)))})}),o.next(()=>n.mutationQueue.removeMutationBatch(e,i))}var Vh=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var F1=100;function B1(){return Gf()?8:bD(zf())>0?6:4}var zh=class{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=F1,this.relativeIndexReadCostPerDocument=B1()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.performQueryUsingIndex(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.performQueryUsingRemoteKeys(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new Vh;return this.executeFullCollectionScan(e,t,o).next(a=>{if(s.result=a,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,o,a.size)})}).next(()=>s.result)}createCacheIndexes(e,t,r,i){return r.documentReadCount<this.indexAutoCreationMinCollectionSize?(li()<=At.DEBUG&&U("QueryEngine","SDK will not create cache indexes for query:",fs(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),N.resolve()):(li()<=At.DEBUG&&U("QueryEngine","Query:",fs(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.relativeIndexReadCostPerDocument*i?(li()<=At.DEBUG&&U("QueryEngine","The SDK decides to create cache indexes for query:",fs(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,zn(t))):N.resolve())}performQueryUsingIndex(e,t){if(Jv(t))return N.resolve(null);let r=zn(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=mh(t,null,"F"),r=zn(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=Ve(...s);return this.localDocumentsView.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{let c=this.applyQuery(t,a);return this.needsRefill(t,c,o,l.readTime)?this.performQueryUsingIndex(e,mh(t,null,"F")):this.appendRemainingResults(e,c,t,l)}))})))}performQueryUsingRemoteKeys(e,t,r,i){return Jv(t)||i.isEqual(pe.min())?N.resolve(null):this.localDocumentsView.getDocuments(e,r).next(s=>{let o=this.applyQuery(t,s);return this.needsRefill(t,o,r,i)?N.resolve(null):(li()<=At.DEBUG&&U("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),fs(t)),this.appendRemainingResults(e,o,t,SD(i,ys)).next(a=>a))})}applyQuery(e,t){let r=new ze(zA(e));return t.forEach((i,s)=>{wf(e,s)&&(r=r.add(s))}),r}needsRefill(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return s?s.hasPendingWrites||s.version.compareTo(i)>0:!1}executeFullCollectionScan(e,t,r){return li()<=At.DEBUG&&U("QueryEngine","Using full collection scan to execute query:",fs(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,hr.min(),r)}appendRemainingResults(e,t,r,i){return this.localDocumentsView.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var Ja=class{constructor(){this.activeTargetIds=YA()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var Gh=class{constructor(){this.localState=new Ja,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,r){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new Ja,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var jh=class{addCallback(e){}shutdown(){}};var $h=class{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onConnected(e){this.wrappedOnConnected=e}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}};var La=null;function q1(){return 268435456+Math.round(2147483648*Math.random())}function Kd(){return La===null?La=q1():La++,"0x"+La.toString(16)}function U1(n){return new Promise((e,t)=>{n((r,i)=>{r?t(r):e(i)})})}var V1="1.9.15",Qe="GrpcConnection",z1=`gl-node/${process.versions.node} fire/${Ri} grpc/${V1}`;function Wd(n,e,t,r){me(e===null||e.type==="OAuth",36936);let i=new cr.Metadata;return e&&e.headers.forEach((s,o)=>i.set(o,s)),t&&t.headers.forEach((s,o)=>i.set(o,s)),r&&i.set("X-Firebase-GMPID",r),i.set("X-Goog-Api-Client",z1),i.set("Google-Cloud-Resource-Prefix",n),i.set("x-goog-request-params",n),i}var Kh=class{get shouldResourcePathBeIncludedInRequest(){return!0}constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}ensureActiveStub(){if(!this.cachedStub){U(Qe,"Creating Firestore stub.");let e=this.databaseInfo.ssl?cr.credentials.createSsl():cr.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,r,i,s){let o=Kd(),a=this.ensureActiveStub(),l=Wd(this.databasePath,i,s,this.databaseInfo.appId),c=Object.assign({database:this.databasePath},r);return U1(u=>(U(Qe,`RPC '${e}' ${o} invoked with request:`,r),a[e](c,l,(m,S)=>{m?(U(Qe,`RPC '${e}' ${o} failed with error:`,m),u(new z(Gd(m.code),m.message))):(U(Qe,`RPC '${e}' ${o} completed with response:`,S),u(void 0,S))})))}invokeStreamingRPC(e,t,r,i,s,o){let a=Kd(),l=[],c=new Ht;U(Qe,`RPC '${e}' ${a} invoked (streaming) with request:`,r);let u=this.ensureActiveStub(),m=Wd(this.databasePath,i,s,this.databaseInfo.appId),S=Object.assign(Object.assign({},r),{database:this.databasePath}),E=u[e](S,m),_=!1;return E.on("data",w=>{U(Qe,`RPC ${e} ${a} received result:`,w),l.push(w),o!==void 0&&l.length===o&&(_=!0,c.resolve(l))}),E.on("end",()=>{U(Qe,`RPC '${e}' ${a} completed.`),_||(_=!0,c.resolve(l))}),E.on("error",w=>{U(Qe,`RPC '${e}' ${a} failed with error:`,w);let C=Gd(w.code);c.reject(new z(C,w.message))}),c.promise}openStream(e,t,r){let i=Kd(),s=this.ensureActiveStub(),o=Wd(this.databasePath,t,r,this.databaseInfo.appId),a=s[e](o),l=!1,c=S=>{l||(l=!0,u.callOnClose(S),a.end())},u=new $h({sendFn:S=>{if(l)U(Qe,`RPC '${e}' stream ${i} not sending because gRPC stream is closed:`,S);else{U(Qe,`RPC '${e}' stream ${i} sending:`,S);try{a.write(S)}catch(E){throw un("Failure sending:",S),un("Error:",E),E}}},closeFn:()=>{U(Qe,`RPC '${e}' stream ${i} closed locally via close().`),c()}}),m=!1;return a.on("data",S=>{l||(U(Qe,`RPC '${e}' stream ${i} received:`,S),m||(u.callOnConnected(),m=!0),u.callOnMessage(S))}),a.on("end",()=>{U(Qe,`RPC '${e}' stream ${i} ended.`),c()}),a.on("error",S=>{if(!l){qa(Qe,`RPC '${e}' stream ${i} error. Code:`,S.code,"Message:",S.message);let E=Gd(S.code);c(new z(E,S.message))}}),U(Qe,`Opening RPC '${e}' stream ${i} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}},gT={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}},G1={nested:gT},j1=Object.freeze({__proto__:null,nested:gT,default:G1});var $1={longs:String,enums:String,defaults:!0,oneofs:!1};function K1(){let n=gS.fromJSON(j1,$1);return cr.loadPackageDefinition(n)}function W1(n){let e=K1();return new Kh(e,n)}function H1(){return new jh}function dl(n){return new Wa(n,!1)}var Q1="ExponentialBackoff",Y1=1e3,J1=1.5,X1=60*1e3,Xa=class{constructor(e,t,r=Y1,i=J1,s=X1){this.queue=e,this.timerId=t,this.initialDelayMs=r,this.backoffFactor=i,this.maxDelayMs=s,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,t-r);i>0&&U(Q1,`Backing off for ${i} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){this.timerPromise!==null&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){this.timerPromise!==null&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}};var sS="PersistentStream",Z1=60*1e3,eO=10*1e3,Wh=class{constructor(e,t,r,i,s,o,a,l){this.queue=e,this.idleTimerId=r,this.healthTimerId=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new Xa(e,t)}isStarted(){return this.state===1||this.state===5||this.isOpen()}isOpen(){return this.state===2||this.state===3}start(){if(this.responseCount=0,this.state===4){this.performBackoff();return}this.auth()}async stop(){this.isStarted()&&await this.close(0)}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&this.idleTimer===null&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,Z1,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}async handleIdleCloseTimer(){if(this.isOpen())return this.close(0)}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}async close(e,t){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,e!==4?this.backoff.reset():t&&t.code===x.RESOURCE_EXHAUSTED?(un(t.toString()),un("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===x.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,await this.listener.onClose(t)}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.closeCount===t&&this.startStream(r,i)},r=>{e(()=>{let i=new z(x.UNKNOWN,"Fetching auth token failed: "+r.message);return this.handleStreamClose(i)})})}startStream(e,t){let r=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onConnected(()=>{r(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{r(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,eO,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(i=>{r(()=>this.handleStreamClose(i))}),this.stream.onMessage(i=>{r(()=>++this.responseCount===1?this.onFirst(i):this.onNext(i))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(async()=>{this.state=0,this.start()})}handleStreamClose(e){return U(sS,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(U(sS,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}};var Hh=class extends Wh{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onFirst(e){return me(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,me(!e.writeResults||e.writeResults.length===0,55816),this.listener.onHandshakeComplete()}onNext(e){me(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.backoff.reset();let t=NN(e.writeResults,e.commitTime),r=hi(e.commitTime);return this.listener.onMutationResult(r,t)}writeHandshake(){let e={};e.database=wN(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>RN(this.serializer,r))};this.sendRequest(t)}};var Qh=class{},Yh=class extends Qh{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new z(x.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,r,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.invokeRPC(e,Eh(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new z(x.UNKNOWN,s.toString())})}invokeStreamingRPC(e,t,r,i,s){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.invokeStreamingRPC(e,Eh(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new z(x.UNKNOWN,o.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}};function tO(n,e,t,r){return new Yh(n,e,t,r)}function nO(n,e,t){let r=le(n);return r.verifyInitialized(),new Hh(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}var rO="OnlineStateTracker",oS=1,aS=10*1e3,Jh=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){this.watchStreamFailures===0&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",aS,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${aS/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){this.state==="Online"?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=oS&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${oS} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,e==="Online"&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(un(t),this.shouldWarnClientIsOffline=!1):U(rO,t)}clearOnlineStateTimer(){this.onlineStateTimer!==null&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}};var Os="RemoteStore",iO=10,Xh=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=s,this.connectivityMonitor.addCallback(o=>{r.enqueueAndForget(async()=>{ks(this)&&(U(Os,"Restarting streams for network reachability change."),await pO(this))})}),this.onlineStateTracker=new Jh(r,i)}};function sO(n,e,t,r,i){return new Xh(n,e,t,r,i)}async function hl(n){if(ks(n))for(let e of n.onNetworkStatusChange)await e(!0)}async function xs(n){for(let e of n.onNetworkStatusChange)await e(!1)}async function oO(n){let e=le(n);U(Os,"RemoteStore shutting down."),e.offlineCauses.add(5),await xs(e),e.connectivityMonitor.shutdown(),e.onlineStateTracker.set("Unknown")}function ks(n){return le(n).offlineCauses.size===0}async function yT(n,e,t){if(Ns(e))n.offlineCauses.add(1),await xs(n),n.onlineStateTracker.set("Offline"),t||(t=()=>k1(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{U(Os,"Retrying IndexedDB access"),await t(),n.offlineCauses.delete(1),await hl(n)});else throw e}function vT(n,e){return e().catch(t=>yT(n,t,e))}async function fl(n){let e=le(n),t=Kn(e),r=e.writePipeline.length>0?e.writePipeline[e.writePipeline.length-1].batchId:yf;for(;aO(e);)try{let i=await M1(e.localStore,r);if(i===null){e.writePipeline.length===0&&t.markIdle();break}else r=i.batchId,lO(e,i)}catch(i){await yT(e,i)}ST(e)&&TT(e)}function aO(n){return ks(n)&&n.writePipeline.length<iO}function lO(n,e){n.writePipeline.push(e);let t=Kn(n);t.isOpen()&&t.handshakeComplete&&t.writeMutations(e.mutations)}function ST(n){return ks(n)&&!Kn(n).isStarted()&&n.writePipeline.length>0}function TT(n){Kn(n).start()}async function cO(n){Kn(n).writeHandshake()}async function uO(n){let e=Kn(n);for(let t of n.writePipeline)e.writeMutations(t.mutations)}async function dO(n,e,t){let r=n.writePipeline.shift(),i=Sh.from(r,e,t);await vT(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),await fl(n)}async function hO(n,e){e&&Kn(n).handshakeComplete&&await fO(n,e),ST(n)&&TT(n)}async function fO(n,e){if(fN(e.code)){let t=n.writePipeline.shift();Kn(n).inhibitBackoff(),await vT(n,()=>n.remoteSyncer.rejectFailedWrite(t.batchId,e)),await fl(n)}}async function pO(n){let e=le(n);e.offlineCauses.add(4),await xs(e),e.onlineStateTracker.set("Unknown"),e.offlineCauses.delete(4),await hl(e)}async function lS(n,e){let t=le(n);t.asyncQueue.verifyOperationInProgress(),U(Os,"RemoteStore received new credentials");let r=ks(t);t.offlineCauses.add(3),await xs(t),r&&t.onlineStateTracker.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.offlineCauses.delete(3),await hl(t)}async function mO(n,e){let t=le(n);e?(t.offlineCauses.delete(2),await hl(t)):e||(t.offlineCauses.add(2),await xs(t),t.onlineStateTracker.set("Unknown"))}function Kn(n){return n.writeStream||(n.writeStream=nO(n.datastore,n.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:cO.bind(null,n),onClose:hO.bind(null,n),onHandshakeComplete:uO.bind(null,n),onMutationResult:dO.bind(null,n)}),n.onNetworkStatusChange.push(async e=>{e?(n.writeStream.inhibitBackoff(),await fl(n)):(await n.writeStream.stop(),n.writePipeline.length>0&&(U(Os,`Stopping write stream with ${n.writePipeline.length} pending writes`),n.writePipeline=[]))})),n.writeStream}var gO="AsyncQueue",Zh=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Ht,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new z(x.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function ET(n,e){if(un(gO,`${e}: ${n}`),Ns(n))return new z(x.UNAVAILABLE,`${e}: ${n}`);throw n}function yO(){return new ef}var ef=class{constructor(){this.queries=_T(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){SO(this,new z(x.ABORTED,"Firestore shutting down"))}};function _T(){return new hn(n=>XS(n),JS)}function vO(n,e){let t=le(n);t.onlineState=e;let r=!1;t.queries.forEach((i,s)=>{for(let o of s.listeners)o.applyOnlineStateChange(e)&&(r=!0)}),r&&TO(t)}function SO(n,e){let t=le(n),r=t.queries;t.queries=_T(),r.forEach((i,s)=>{for(let o of s.listeners)o.onError(e)})}function TO(n){n.snapshotsInSyncListeners.forEach(e=>{e.next()})}var tf=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.addedKeys=r,this.removedKeys=i}static fromSnapshot(e,t){let r=Ve(),i=Ve();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key);break}return new n(e,t.fromCache,r,i)}};var EO="SyncEngine";var nf=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.syncEngineListener={},this.queryViewsByQuery=new hn(a=>XS(a),JS),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new at(H.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new Cs,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=ws.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return this._isPrimaryClient===!0}};function _O(n,e,t,r,i,s,o){let a=new nf(n,e,t,r,i,s);return o&&(a._isPrimaryClient=!0),a}async function bO(n,e,t){let r=AO(n);try{let i=await A1(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),RO(r,i.batchId,t),await pl(r,i.changes),await fl(r.remoteStore)}catch(i){let s=ET(i,"Failed to persist write");t.reject(s)}}function cS(n,e,t){let r=le(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.queryViewsByQuery.forEach((s,o)=>{let a=o.view.applyOnlineStateChange(e);a.snapshot&&i.push(a.snapshot)}),vO(r.eventManager,e),i.length&&r.syncEngineListener.onWatchChange(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function wO(n,e){let t=le(n),r=e.batch.batchId;try{let i=await N1(t.localStore,e);wT(t,r,null),bT(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await pl(t,i)}catch(i){await pf(i)}}async function CO(n,e,t){let r=le(n);try{let i=await x1(r.localStore,e);wT(r,e,t),bT(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await pl(r,i)}catch(i){await pf(i)}}function bT(n,e){(n.pendingWritesCallbacks.get(e)||[]).forEach(t=>{t.resolve()}),n.pendingWritesCallbacks.delete(e)}function IO(n,e){n.pendingWritesCallbacks.forEach(t=>{t.forEach(r=>{r.reject(new z(x.CANCELLED,e))})}),n.pendingWritesCallbacks.clear()}function RO(n,e,t){let r=n.mutationUserCallbacks[n.currentUser.toKey()];r||(r=new at(ee)),r=r.insert(e,t),n.mutationUserCallbacks[n.currentUser.toKey()]=r}function wT(n,e,t){let r=le(n),i=r.mutationUserCallbacks[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.mutationUserCallbacks[r.currentUser.toKey()]=i}}async function pl(n,e,t){let r=le(n),i=[],s=[],o=[];r.queryViewsByQuery.isEmpty()||(r.queryViewsByQuery.forEach((a,l)=>{o.push(r.applyDocChanges(l,e,t).then(c=>{var u;if((c||t)&&r.isPrimaryClient){let m=c?!c.fromCache:(u=t?.targetChanges.get(l.targetId))===null||u===void 0?void 0:u.current;r.sharedClientState.updateQueryState(l.targetId,m?"current":"not-current")}if(c){i.push(c);let m=tf.fromSnapshot(l.targetId,c);s.push(m)}}))}),await Promise.all(o),r.syncEngineListener.onWatchChange(i),await P1(r.localStore,s))}async function DO(n,e){let t=le(n);if(!t.currentUser.isEqual(e)){U(EO,"User change. New user:",e.toKey());let i=await mT(t.localStore,e);t.currentUser=e,IO(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),await pl(t,i.affectedDocuments)}}function AO(n){let e=le(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=wO.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=CO.bind(null,e),e}var CT=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=dl(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),await this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)}createGarbageCollectionScheduler(t,r){return null}createIndexBackfillerScheduler(t,r){return null}createLocalStore(t){return D1(this.persistence,new zh,t.initialUser,this.serializer)}createPersistence(t){return new Qa(qh.factory,this.serializer)}createSharedClientState(t){return new Gh}async terminate(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}return n.provider={build:()=>new n},n})(),rf=class extends CT{constructor(e){super(),this.cacheSizeBytes=e}createGarbageCollectionScheduler(e,t){me(this.persistence.referenceDelegate instanceof Ya,46915);let r=this.persistence.referenceDelegate.garbageCollector;return new Ih(r,e.asyncQueue,t)}createPersistence(e){let t=this.cacheSizeBytes!==void 0?yt.withCacheSize(this.cacheSizeBytes):yt.DEFAULT;return new Qa(r=>Ya.factory(r,t),this.serializer)}};var NO=(()=>{class n{async initialize(t,r){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>cS(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=DO.bind(null,this.syncEngine),await mO(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return yO()}createDatastore(t){let r=dl(t.databaseInfo.databaseId),i=W1(t.databaseInfo);return tO(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return sO(this.localStore,this.datastore,t.asyncQueue,r=>cS(this.syncEngine,r,0),H1())}createSyncEngine(t,r){return _O(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}async terminate(){var t,r;await oO(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()}}n.provider={build:()=>new n};return n})();var $n="FirestoreClient",OO=100,xO=11,kO=20,PO=22,sf=class{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Ge.UNAUTHENTICATED,this.clientId=fi.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,async o=>{U($n,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(U($n,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:OO}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Ht;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=ET(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}};async function Hd(n,e){n.asyncQueue.verifyOperationInProgress(),U($n,"Initializing OfflineComponentProvider");let t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async i=>{r.isEqual(i)||(await mT(e.localStore,i),r=i)}),e.persistence.setDatabaseDeletedListener(()=>{qa("Terminating Firestore due to IndexedDb database deletion"),n.terminate().then(()=>{U("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(i=>{qa("Terminating Firestore due to IndexedDb database deletion failed",i)})}),n._offlineComponents=e}async function uS(n,e){n.asyncQueue.verifyOperationInProgress();let t=await LO(n);U($n,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>lS(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>lS(e.remoteStore,i)),n._onlineComponents=e}function MO(n){return n.name==="FirebaseError"?n.code===x.FAILED_PRECONDITION||n.code===x.UNIMPLEMENTED:typeof DOMException<"u"&&n instanceof DOMException?n.code===PO||n.code===kO||n.code===xO:!0}async function LO(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){U($n,"Using user provided OfflineComponentProvider");try{await Hd(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!MO(t))throw t;qa("Error using user provided cache. Falling back to memory cache: "+t),await Hd(n,new CT)}}else U($n,"Using default OfflineComponentProvider"),await Hd(n,new rf(void 0));return n._offlineComponents}async function FO(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(U($n,"Using user provided OnlineComponentProvider"),await uS(n,n._uninitializedComponentsProvider._online)):(U($n,"Using default OnlineComponentProvider"),await uS(n,new NO))),n._onlineComponents}function BO(n){return FO(n).then(e=>e.syncEngine)}function qO(n,e){let t=new Ht;return n.asyncQueue.enqueueAndForget(async()=>{let r=await BO(n);return bO(r,e,t)}),t.promise}function UO(n,e){return n.timeoutSeconds===e.timeoutSeconds}function IT(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var VO="ComponentProvider",dS=new Map;function zO(n){let e=dS.get(n);e&&(U(VO,"Removing Datastore"),dS.delete(n),e.terminate())}function GO(n,e,t,r){return new rh(n,e,t,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,IT(r.experimentalLongPollingOptions),r.useFetchStreams,r.isUsingEmulator)}var jO="firestore.googleapis.com",hS=!0,fS=5,pS=30,$O=!0,Za=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new z(x.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=jO,this.ssl=hS}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:hS;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=pT;else{if(e.cacheSizeBytes!==ul&&e.cacheSizeBytes<rS)throw new z(x.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${rS}`);this.cacheSizeBytes=e.cacheSizeBytes}gD("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=$O:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=IT((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),KO(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&UO(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}};function KO(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new z(x.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<fS)throw new z(x.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is ${fS})`);if(n.timeoutSeconds>pS)throw new z(x.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is ${pS})`)}}var Is=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Za({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new z(x.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new z(x.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Za(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=hD(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return zO(this),Promise.resolve()}};var of=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},st=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Gn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}toJSON(){return{type:n._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(As(t,n._jsonSchema))return new n(e,r||null,new H(Se.fromString(t.referencePath)))}};st._jsonSchemaVersion="firestore/documentReference/1.0";st._jsonSchema={type:be("string",st._jsonSchemaVersion),referencePath:be("string")};var Gn=class n extends of{constructor(e,t,r){super(e,t,xA(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new st(this.firestore,null,new H(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function RT(n,e,...t){if(n=_r(n),SS("collection","path",e),n instanceof Is){let r=Se.fromString(e,...t);return Uv(r),new Gn(n,null,r)}else{if(!(n instanceof st)&&!(n instanceof Gn))throw new z(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(Se.fromString(e,...t));return Uv(r),new Gn(n.firestore,null,r)}}function DT(n,e,...t){if(n=_r(n),arguments.length===1&&(e=fi.newId()),SS("doc","path",e),n instanceof Is){let r=Se.fromString(e,...t);return qv(r),new st(n,null,new H(r))}else{if(!(n instanceof st)&&!(n instanceof Gn))throw new z(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(Se.fromString(e,...t));return qv(r),new st(n.firestore,n instanceof Gn?n.converter:null,new H(r))}}var WO="AsyncQueue",el=class{constructor(e=Promise.resolve()){this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new Xa(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()},this.tail=e}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new Ht;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}async retryNextOp(){if(this.retryableOps.length!==0){try{await this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(Ns(e))U(WO,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(r=>{this.failure=r,this.operationInProgress=!1;let i=mS(r);throw un("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.operationInProgress=!1,r))));return this.tail=t,t}enqueueAfterDelay(e,t,r){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let i=Zh.createAndSchedule(this,e,t,r,s=>this.removeDelayedOperation(s));return this.delayedOperations.push(i),i}verifyNotFailed(){this.failure&&W(47125,{messageOrStack:mS(this.failure)})}verifyOperationInProgress(){}async drain(){let e;do e=this.tail,await e;while(e!==this.tail)}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{this.delayedOperations.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.delayedOperations)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}};function mS(n){let e=n.message||"";return n.stack&&(n.stack.includes(n.message)?e=n.stack:e=n.message+`
`+n.stack),e}var tl=class extends Is{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new el,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new el(e),this._firestoreClient=void 0,await e}}};function HO(n){if(n._terminated)throw new z(x.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||QO(n),n._firestoreClient}function QO(n){var e,t,r;let i=n._freezeSettings(),s=GO(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new sf(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&YO(n._componentsProvider))}function YO(n){let e=n?._online.build();return{_offline:n?._offline.build(e),_online:e}}function JO(n,e=!0){uD(Qf),Wf(new $f("firestore",(t,{instanceIdentifier:r,options:i})=>{let s=t.getProvider("app").getImmediate(),o=new tl(new Jd(t.getProvider("auth-internal")),new eh(s,t.getProvider("app-check-internal")),YD(s,r),s);return i=Object.assign({useFetchStreams:e},i),o._setSettings(i),o},"PUBLIC").setMultipleInstances(!0)),Fs(Mv,Lv,n),Fs(Mv,Lv,"esm2017")}var vr=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(dn.fromBase64String(e))}catch(t){throw new z(x.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(dn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:n._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(As(e,n._jsonSchema))return n.fromBase64String(e.bytes)}};vr._jsonSchemaVersion="firestore/bytes/1.0";vr._jsonSchema={type:be("string",vr._jsonSchemaVersion),bytes:be("string")};var Rs=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new z(x.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ot(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var nl=class{constructor(e){this._methodName=e}};var Sr=class n{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new z(x.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new z(x.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return ee(this._lat,e._lat)||ee(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:n._jsonSchemaVersion}}static fromJSON(e){if(As(e,n._jsonSchema))return new n(e.latitude,e.longitude)}};Sr._jsonSchemaVersion="firestore/geoPoint/1.0";Sr._jsonSchema={type:be("string",Sr._jsonSchemaVersion),latitude:be("number"),longitude:be("number")};var Tr=class n{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return I1(this._values,e._values)}toJSON(){return{type:n._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(As(e,n._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new n(e.vectorValues);throw new z(x.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};Tr._jsonSchemaVersion="firestore/vectorValue/1.0";Tr._jsonSchema={type:be("string",Tr._jsonSchemaVersion),vectorValues:be("object")};var XO=/^__.*__$/,af=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new fn(e,this.data,this.fieldMask,t,this.fieldTransforms):new yr(e,this.data,t,this.fieldTransforms)}};function AT(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw W(40011,{dataSource:n})}}var lf=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePathSegment(e),i}childContextForFieldPath(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePath(),i}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return il(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(AT(this.dataSource)&&XO.test(e))throw this.createError('Document fields cannot begin and end with "__"')}},rl=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||dl(e)}createContext(e,t,r,i=!1){return new lf({dataSource:e,methodName:t,targetDoc:r,path:ot.emptyPath(),arrayElement:!1,hasConverter:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function ZO(n){let e=n._freezeSettings(),t=dl(n._databaseId);return new rl(n._databaseId,!!e.ignoreUndefinedProperties,t)}function ex(n,e,t,r,i,s={}){let o=n.createContext(s.merge||s.mergeFields?2:0,e,t,i);xT("Data must be an object, but it was:",o,r);let a=Rf(r,o),l,c;if(s.merge)l=new Wt(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let u=[];for(let m of s.mergeFields){let S=sx(e,m,t);if(!o.contains(S))throw new z(x.INVALID_ARGUMENT,`Field '${S}' is specified in your field mask but missing from your input data.`);ax(u,S)||u.push(S)}l=new Wt(u),c=o.fieldTransforms.filter(m=>l.covers(m.field))}else l=null,c=o.fieldTransforms;return new af(new Kt(a),l,c)}function NT(n,e){if(n=_r(n),OT(n))return xT("Unsupported field value:",e,n),Rf(n,e);if(n instanceof nl)return nx(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return tx(n,e)}else return rx(n,e)}function Rf(n,e){let t={};return MS(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Di(n,(r,i)=>{let s=NT(i,e.childContextForField(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function tx(n,e){let t=[],r=0;for(let i of n){let s=NT(i,e.childContextForArray(r));s==null&&(s={nullValue:"NULL_VALUE"}),t.push(s),r++}return{arrayValue:{values:t}}}function nx(n,e){if(!AT(e.dataSource))throw e.createError(`${n._methodName}() can only be used with update() and set()`);if(!e.path)throw e.createError(`${n._methodName}() is not currently supported inside arrays`);let t=n._toFieldTransform(e);t&&e.fieldTransforms.push(t)}function rx(n,e){if(n=_r(n),n===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return JA(e.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let t=Te.fromDate(n);return{timestampValue:Vn(e.serializer,t)}}else if(n instanceof Te){let t=new Te(n.seconds,Math.floor(n.nanoseconds/1e3)*1e3);return{timestampValue:Vn(e.serializer,t)}}else{if(n instanceof Sr)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof vr)return{bytesValue:SN(e.serializer,n._byteString)};if(n instanceof st){let t=e.databaseId,r=n.firestore._databaseId;if(!r.isEqual(t))throw e.createError(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${t.projectId}/${t.database}`);return{referenceValue:If(n.firestore._databaseId||e.databaseId,n._key.path)}}else{if(n instanceof Tr)return ix(n,e);throw e.createError(`Unsupported field value: ${ff(n)}`)}}}function ix(n,e){return{mapValue:{fields:{[vf]:{stringValue:Sf},[Ss]:{arrayValue:{values:n.toArray().map(r=>{if(typeof r!="number")throw e.createError("VectorValues must only contain numeric values.");return Cf(e.serializer,r)})}}}}}}function OT(n){return typeof n=="object"&&n!==null&&!(n instanceof Array)&&!(n instanceof Date)&&!(n instanceof Te)&&!(n instanceof Sr)&&!(n instanceof vr)&&!(n instanceof st)&&!(n instanceof nl)&&!(n instanceof Tr)}function xT(n,e,t){if(!OT(t)||!TS(t)){let r=ff(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function sx(n,e,t){if(e=_r(e),e instanceof Rs)return e._internalPath;if(typeof e=="string")return kT(n,e);throw il("Field path arguments must be of type string or ",n,!1,void 0,t)}var ox=new RegExp("[~\\*/\\[\\]]");function kT(n,e,t){if(e.search(ox)>=0)throw il(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Rs(...e.split("."))._internalPath}catch{throw il(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function il(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new z(x.INVALID_ARGUMENT,a+n+l)}function ax(n,e){return n.some(t=>t.isEqual(e))}var sl=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new st(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document)if(this._converter){let e=new cf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}else return this._userDataWriter.convertValue(this._document.data.value);else return}get(e){if(this._document){let t=this._document.data.field(PT("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},cf=class extends sl{data(){return super.data()}};function PT(n,e){return typeof e=="string"?kT(n,e):e instanceof Rs?e._internalPath:e._delegate._internalPath}function lx(n,e,t){let r;return n?t&&(t.merge||t.mergeFields)?r=n.toFirestore(e,t):r=n.toFirestore(e):r=e,r}var uf=vS();function Wn(n){let e=JSON.stringify(n);return`${uf.encode(e).byteLength}${e}`}var cx={metadata:{id:"test-bundle",createTime:{seconds:1577836805,nanos:6},version:1,totalDocuments:1,totalBytes:416}};Wn(cx);var ux={documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",readTime:{seconds:5,nanos:6},exists:!0}};Wn(ux);var dx={document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value"},bar:{integerValue:-42}}}};Wn(dx);var hx={documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",readTime:{seconds:5,nanos:6},exists:!0}};Wn(hx);var fx={document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value1"},bar:{integerValue:42},emptyArray:{arrayValue:{}},emptyMap:{mapValue:{}}}}};Wn(fx);var px={documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/nodoc",readTime:{seconds:5,nanos:6},exists:!1}};Wn(px);var mx={namedQuery:{name:"limitQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"DESCENDING"}],limit:{value:1}},limitType:"FIRST"},readTime:{seconds:1590011379,nanos:191164e3}}};Wn(mx);var gx={namedQuery:{name:"limitToLastQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"ASCENDING"}],limit:{value:1}},limitType:"LAST"},readTime:{seconds:1590011379,nanos:543063e3}}};Wn(gx);var yx=1,ol=class{constructor(e,t){this.firestore=e,this.bundleId=t,this.documents=new Map,this.namedQueries=new Map,this.latestReadTime=new Te(0,0),this.databaseId=e._databaseId,this.serializer=new Wa(this.databaseId,!0),this.userDataReader=new rl(this.databaseId,!0,this.serializer)}addBundleDocument(e,t){let r=this.documents.get(e.documentPath),i=r?.metadata.queries,s=e.readTime,o=r?.metadata.readTime?dT(r.metadata.readTime):null,a=!s&&o==null,l=s!==void 0&&(o==null||o<s);if((a||l)&&this.documents.set(e.documentPath,{document:this.toBundleDocument(e),metadata:{name:bs(this.serializer,e.documentKey),readTime:s?Vn(this.serializer,s):void 0,exists:e.documentExists}}),s&&s>this.latestReadTime&&(this.latestReadTime=s),t){let c=this.documents.get(e.documentPath);c.metadata.queries=i||[],c.metadata.queries.push(t)}}addBundleQuery(e){if(this.namedQueries.has(e.name))throw new Error(`Query name conflict: ${name} has already been added.`);let t=new Te(0,0);for(let s of e.docBundleDataArray)this.addBundleDocument(s,e.name),s.readTime&&s.readTime>t&&(t=s.readTime);let r=xN(this.serializer,zn(e.query)),i={parent:e.parent,structuredQuery:r.queryTarget.structuredQuery};this.namedQueries.set(e.name,{name:e.name,bundledQuery:i,readTime:Vn(this.serializer,t)})}toBundleDocument(e){let t=this.userDataReader.createContext(4,"internal toBundledDocument"),r=Rf(e.documentData,t);return{name:bs(this.serializer,e.documentKey),fields:r.mapValue.fields,updateTime:Vn(this.serializer,e.versionTime),createTime:Vn(this.serializer,e.createdTime)}}lengthPrefixedString(e){let t=JSON.stringify(e);return`${uf.encode(t).byteLength}${t}`}build(){let e="";for(let r of this.namedQueries.values())e+=this.lengthPrefixedString({namedQuery:r});for(let r of this.documents.values()){let i=r.metadata;e+=this.lengthPrefixedString({documentMetadata:i});let s=r.document;s&&(e+=this.lengthPrefixedString({document:s}))}let t={id:this.bundleId,createTime:Vn(this.serializer,this.latestReadTime),version:yx,totalDocuments:this.documents.size,totalBytes:uf.encode(e).length};return e=this.lengthPrefixedString({metadata:t})+e,e}};function vx(n,e,t,r){let i=new ol(n,fi.newId());return i.addBundleDocument(MT(r,t,e)),i.build()}function Sx(n,e,t,r,i,s,o){let a=[];for(let u=0;u<s.length;u++)a.push(MT(i[u],o[u],s[u]));let l={name:t,query:e,parent:r,docBundleDataArray:a},c=new ol(n,t);return c.addBundleQuery(l),c.build()}function MT(n,e,t){return{documentData:e,documentKey:t.mutableCopy().key,documentPath:n,documentExists:!0,createdTime:t.createTime.toTimestamp(),readTime:t.readTime.toTimestamp(),versionTime:t.version.toTimestamp()}}var wi=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Ci=class n extends sl{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document)if(this._converter){let t=new Ii(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}else return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);else return}get(e,t={}){if(this._document){let r=this._document.data.field(PT("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new z(x.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};if(t.type=n._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument())return t;let r=this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous");return t.bundle=vx(this._firestore,e,r,this.ref.path),t}};Ci._jsonSchemaVersion="firestore/documentSnapshot/1.0";Ci._jsonSchema={type:be("string",Ci._jsonSchemaVersion),bundleSource:be("string","DocumentSnapshot"),bundleName:be("string"),bundle:be("string")};var Ii=class extends Ci{data(e={}){return super.data(e)}},Ds=class n{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new wi(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Ii(this._firestore,this._userDataWriter,r.key,r,new wi(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new z(x.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return(!this._cachedChanges||this._cachedChangesIncludeMetadataChanges!==t)&&(this._cachedChanges=Tx(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new z(x.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=n._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=fi.newId();let t=this._firestore._databaseId.database,i=`projects/${this._firestore._databaseId.projectId}/databases/${t}/documents`,s=[],o=[],a=[];return this.docs.forEach(l=>{l._document!==null&&(s.push(l._document),o.push(this._userDataWriter.convertObjectMap(l._document.data.value.mapValue.fields,"previous")),a.push(l.ref.path))}),e.bundle=Sx(this._firestore,this.query._query,e.bundleName,i,a,s,o),e}};Ds._jsonSchemaVersion="firestore/querySnapshot/1.0";Ds._jsonSchema={type:be("string",Ds._jsonSchemaVersion),bundleSource:be("string","QuerySnapshot"),bundleName:be("string"),bundle:be("string")};function Tx(n,e){if(n._snapshot.oldDocs.isEmpty()){let t=0;return n._snapshot.docChanges.map(r=>{let i=new Ii(n._firestore,n._userDataWriter,r.doc.key,r.doc,new wi(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter);return r.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}})}else{let t=n._snapshot.oldDocs;return n._snapshot.docChanges.filter(r=>e||r.type!==3).map(r=>{let i=new Ii(n._firestore,n._userDataWriter,r.doc.key,r.doc,new wi(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter),s=-1,o=-1;return r.type!==0&&(s=t.indexOf(r.doc.key),t=t.delete(r.doc.key)),r.type!==1&&(t=t.add(r.doc),o=t.indexOf(r.doc.key)),{type:Ex(r.type),doc:i,oldIndex:s,newIndex:o}})}}function Ex(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return W(61501,{type:n})}}function LT(n,e){let t=vD(n.firestore,tl),r=DT(n),i=lx(n.converter,e),s=ZO(n.firestore),a=ex(s,"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,lr.exists(!1));return _x(t,[a]).then(()=>r)}function _x(n,e){let t=HO(n);return qO(t,e)}JO("node");var ml=class{constructor(e){return e}};var FT=bl(LT,!0,2);var BT=bl(RT,!0,2);var gl=class n{constructor(e){this.http=e}firestore=vl(ml);injector=vl(xf);getPeliculaPorId(e){let t=up.tmdbApiKey;return this.http.get(`https://api.themoviedb.org/3/movie/${e}?api_key=${t}`)}guardarRese\u00F1a(e){return Of(this.injector,()=>{let t=BT(this.firestore,"resenas");return FT(t,e)})}static \u0275fac=function(t){return new(t||n)(Nf(qf))};static \u0275prov=Af({token:n,factory:n.\u0275fac,providedIn:"root"})};function Cx(n,e){if(n&1&&_l(0,"img",5),n&2){let t=Hn(2);pn("alt",Lf(t.movie.title))("src","https://image.tmdb.org/t/p/w500"+t.movie.poster_path,kf)}}function Ix(n,e){if(n&1&&(vt(0,"div")(1,"h3"),Xt(2),St(),El(3,Cx,1,3,"img",4),vt(4,"p"),Xt(5),St()()),n&2){let t=Hn();Jt(2),Ls(t.movie.title),Jt(),pn("ngIf",t.movie.poster_path),Jt(2),Ls(t.movie.overview)}}function Rx(n,e){if(n&1){let t=Mf();vt(0,"form",6),Ms("ngSubmit",function(){Sl(t);let i=Hn();return Tl(i.guardarResena())}),vt(1,"label",7),Xt(2,"Tu rese\xF1a:"),St(),vt(3,"textarea",8),Ms("input",function(i){Sl(t);let s=Hn();return Tl(s.autoResize(i))}),St(),vt(4,"label",9),Xt(5,"Calificaci\xF3n (1\u201310):"),St(),_l(6,"input",10),vt(7,"button",11),Xt(8,"Enviar Rese\xF1a"),St()()}if(n&2){let t=Hn();pn("formGroup",t.resenaForm),Jt(7),pn("disabled",t.resenaForm.invalid)}}function Dx(n,e){if(n&1&&(vt(0,"p"),Xt(1),St()),n&2){let t=Hn();Jt(),Ls(t.message)}}var qT=class n{constructor(e,t,r,i,s){this.fb=e;this.rese\u00F1aService=t;this.authService=r;this.route=i;this.router=s;this.resenaForm=this.fb.group({comentario:["",[br.required,br.minLength(20)]],calificacion:[5,[br.required,br.min(1),br.max(10)]]}),this.route.params.subscribe(o=>{this.peliculaId=o.peliculaId;let a=this.router.getCurrentNavigation();this.movie=a?.extras.state?.movie})}movie;reviewText="";message="";peliculaId;resenaForm;autoResize(e){let t=e.target;t.style.height="auto",t.style.height=t.scrollHeight+"px"}irAHome(){this.router.navigate(["/home"])}guardarResena(){if(!this.authService.userId){this.message="Usuario no autenticado.";return}if(this.resenaForm.invalid||!this.authService.userId)return;let e={peliculaId:this.peliculaId,comentario:this.resenaForm.value.comentario,calificacion:this.resenaForm.value.calificacion,usuarioId:this.authService.userId,fecha:new Date().toISOString()};console.log("Rese\xF1a a guardar:",e),console.log("Campos v\xE1lidos:",Object.entries(e).every(([t,r])=>typeof r<"u"&&r!==null)),this.rese\u00F1aService.guardarRese\u00F1a(e).then(t=>{console.log("Rese\xF1a guardada con ID:",t.id),this.message="\xA1Rese\xF1a enviada correctamente!",this.resenaForm.reset({calificacion:5})}).catch(t=>{console.error("Error al guardar rese\xF1a:",t),this.message="Error al guardar la rese\xF1a."})}static \u0275fac=function(t){return new(t||n)(Er(op),Er(gl),Er(cp),Er(Uf),Er(Vf))};static \u0275cmp=Pf({type:n,selectors:[["app-resena"]],decls:8,vars:3,consts:[[1,"tarjeta"],[1,"volver",3,"click"],[4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],[3,"src","alt",4,"ngIf"],[3,"src","alt"],[3,"ngSubmit","formGroup"],["for","comentario"],["id","comentario","formControlName","comentario","placeholder","Escribe tu rese\xF1a","rows","1","required","",2,"overflow","hidden","resize","none",3,"input"],["for","calificacion"],["type","number","id","calificacion","formControlName","calificacion","min","1","max","10"],["type","submit",1,"resena",3,"disabled"]],template:function(t,r){t&1&&(vt(0,"div",0)(1,"h2"),Xt(2,"Rese\xF1a de Pel\xEDcula"),St(),vt(3,"button",1),Ms("click",function(){return r.irAHome()}),Xt(4,"Volver"),St(),El(5,Ix,6,3,"div",2)(6,Rx,9,2,"form",3)(7,Dx,2,1,"p",2),St()),t&2&&(Jt(5),pn("ngIf",r.movie),Jt(),pn("ngIf",r.movie),Jt(),pn("ngIf",r.message))},dependencies:[Bf,Ff,lp,Zf,Yf,ep,Jf,Xf,sp,ip,rp,tp,np,ap],styles:["h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%]{text-align:center;margin-top:20px;margin-bottom:20px}img[_ngcontent-%COMP%]{display:block;margin-left:auto;margin-right:auto;width:60%;border-radius:10px;margin-bottom:20px}label[_ngcontent-%COMP%]{display:block}.resena[_ngcontent-%COMP%]{display:block;margin:0 auto;border-radius:4px;padding:10px;color:#faebd7;background-color:#000}textarea[_ngcontent-%COMP%]{width:90%;padding:10px;border-radius:4px;border:1px solid #ccc;box-sizing:border-box;font-size:16px;resize:vertical}"]})};export{qT as Resena};
