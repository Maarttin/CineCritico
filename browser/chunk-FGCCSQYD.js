import{a as W,c as X,d as Y}from"./chunk-RZHWZD6M.js";import{a as k,b as p,c as P,d as D,g as O,h as z,i as G,j as H,k as q,l as B,m as K,n as L,o as U,p as $}from"./chunk-TYUWL7TT.js";import{a as Q}from"./chunk-3MVTGTK5.js";import{a as J}from"./chunk-WA67IRQH.js";import{B as l,C as E,G as _,L as c,M as r,N as o,O as b,P as j,Q as d,R as m,U as s,V as f,Z as w,ga as M,ha as V,j as R,ja as A,m as S,ma as N,n as g,oa as T,p as C,q as x,r as h,s as y,y as F,z as a}from"./chunk-FVBHV7GW.js";var v=class t{constructor(i){this.http=i}firestore=g(W);injector=g(y);getPeliculaPorId(i){let e=Q.tmdbApiKey;return this.http.get(`https://api.themoviedb.org/3/movie/${i}?api_key=${e}`)}guardarRese\u00F1a(i){return C(this.injector,()=>{let e=Y(this.firestore,"resenas");return X(e,i)})}static \u0275fac=function(e){return new(e||t)(S(A))};static \u0275prov=R({token:t,factory:t.\u0275fac,providedIn:"root"})};function oe(t,i){if(t&1&&b(0,"img",5),t&2){let e=m(2);c("alt",w(e.movie.title))("src","https://image.tmdb.org/t/p/w500"+e.movie.poster_path,F)}}function ne(t,i){if(t&1&&(r(0,"div")(1,"h3"),s(2),o(),_(3,oe,1,3,"img",4),r(4,"p"),s(5),o()()),t&2){let e=m();a(2),f(e.movie.title),a(),c("ngIf",e.movie.poster_path),a(2),f(e.movie.overview)}}function ae(t,i){if(t&1){let e=j();r(0,"form",6),d("ngSubmit",function(){x(e);let u=m();return h(u.guardarResena())}),r(1,"label",7),s(2,"Tu rese\xF1a:"),o(),r(3,"textarea",8),d("input",function(u){x(e);let I=m();return h(I.autoResize(u))}),o(),r(4,"label",9),s(5,"Calificaci\xF3n (1\u201310):"),o(),b(6,"input",10),r(7,"button",11),s(8,"Enviar Rese\xF1a"),o()()}if(t&2){let e=m();c("formGroup",e.resenaForm),a(7),c("disabled",e.resenaForm.invalid)}}function se(t,i){if(t&1&&(r(0,"p"),s(1),o()),t&2){let e=m();a(),f(e.message)}}var Z=class t{constructor(i,e,n,u,I){this.fb=i;this.rese\u00F1aService=e;this.authService=n;this.route=u;this.router=I;this.resenaForm=this.fb.group({comentario:["",[p.required,p.minLength(20)]],calificacion:[5,[p.required,p.min(1),p.max(10)]]}),this.route.params.subscribe(ee=>{this.peliculaId=ee.peliculaId;let te=this.router.getCurrentNavigation();this.movie=te?.extras.state?.movie})}movie;reviewText="";message="";peliculaId;resenaForm;autoResize(i){let e=i.target;e.style.height="auto",e.style.height=e.scrollHeight+"px"}irAHome(){this.router.navigate(["/home"])}guardarResena(){if(!this.authService.userId){this.message="Usuario no autenticado.";return}if(this.resenaForm.invalid||!this.authService.userId)return;let i={peliculaId:this.peliculaId,comentario:this.resenaForm.value.comentario,calificacion:this.resenaForm.value.calificacion,usuarioId:this.authService.userId,fecha:new Date().toISOString()};console.log("Rese\xF1a a guardar:",i),console.log("Campos v\xE1lidos:",Object.entries(i).every(([e,n])=>typeof n<"u"&&n!==null)),this.rese\u00F1aService.guardarRese\u00F1a(i).then(e=>{console.log("Rese\xF1a guardada con ID:",e.id),this.message="\xA1Rese\xF1a enviada correctamente!",this.resenaForm.reset({calificacion:5})}).catch(e=>{console.error("Error al guardar rese\xF1a:",e),this.message="Error al guardar la rese\xF1a."})}static \u0275fac=function(e){return new(e||t)(l(L),l(v),l(J),l(N),l(T))};static \u0275cmp=E({type:t,selectors:[["app-resena"]],decls:8,vars:3,consts:[[1,"tarjeta"],[1,"volver",3,"click"],[4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],[3,"src","alt",4,"ngIf"],[3,"src","alt"],[3,"ngSubmit","formGroup"],["for","comentario"],["id","comentario","formControlName","comentario","placeholder","Escribe tu rese\xF1a","rows","1","required","",2,"overflow","hidden","resize","none",3,"input"],["for","calificacion"],["type","number","id","calificacion","formControlName","calificacion","min","1","max","10"],["type","submit",1,"resena",3,"disabled"]],template:function(e,n){e&1&&(r(0,"div",0)(1,"h2"),s(2,"Rese\xF1a de Pel\xEDcula"),o(),r(3,"button",1),d("click",function(){return n.irAHome()}),s(4,"Volver"),o(),_(5,ne,6,3,"div",2)(6,ae,9,2,"form",3)(7,se,2,1,"p",2),o()),e&2&&(a(5),c("ngIf",n.movie),a(),c("ngIf",n.movie),a(),c("ngIf",n.message))},dependencies:[V,M,$,O,k,z,P,D,K,B,q,G,H,U],styles:["h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%]{text-align:center;margin-top:20px;margin-bottom:20px}img[_ngcontent-%COMP%]{display:block;margin-left:auto;margin-right:auto;width:60%;border-radius:10px;margin-bottom:20px}label[_ngcontent-%COMP%]{display:block}.resena[_ngcontent-%COMP%]{display:block;margin:0 auto;border-radius:4px;padding:10px;color:#faebd7;background-color:#000}textarea[_ngcontent-%COMP%]{width:90%;padding:10px;border-radius:4px;border:1px solid #ccc;box-sizing:border-box;font-size:16px;resize:vertical}"]})};export{Z as Resena};
