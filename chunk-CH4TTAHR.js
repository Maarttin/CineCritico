import{a as Q}from"./chunk-3MVTGTK5.js";import{a as V,b as p,c as T,d as k,g as D,h as z,i as G,j as H,k as q,l as B,m as K,n as L,o as U,p as $,q as J}from"./chunk-227IPE5V.js";import{a as W,d as X,e as Y}from"./chunk-EPUEYRLY.js";import{A as a,C as l,D as M,H as _,M as c,N as r,O as n,P as b,S as j,T as u,U as m,X as s,Y as f,ba as P,k as I,n as R,o as v,oa as O,q as S,r as x,ra as w,s as h,t as y,ta as E,wa as A,ya as N,z as F}from"./chunk-6TFRQBMD.js";var g=class t{constructor(i){this.http=i}firestore=v(W);injector=v(y);getPeliculaPorId(i){let e=Q.tmdbApiKey;return this.http.get(`https://api.themoviedb.org/3/movie/${i}?api_key=${e}`)}guardarRese\u00F1a(i){return S(this.injector,()=>{let e=Y(this.firestore,"resenas");return X(e,i)})}static \u0275fac=function(e){return new(e||t)(R(E))};static \u0275prov=I({token:t,factory:t.\u0275fac,providedIn:"root"})};function ne(t,i){if(t&1&&b(0,"img",5),t&2){let e=m(2);c("alt",P(e.movie.title))("src","https://image.tmdb.org/t/p/w500"+e.movie.poster_path,F)}}function oe(t,i){if(t&1&&(r(0,"div")(1,"h3"),s(2),n(),_(3,ne,1,3,"img",4),r(4,"p"),s(5),n()()),t&2){let e=m();a(2),f(e.movie.title),a(),c("ngIf",e.movie.poster_path),a(2),f(e.movie.overview)}}function ae(t,i){if(t&1){let e=j();r(0,"form",6),u("ngSubmit",function(){x(e);let d=m();return h(d.guardarResena())}),r(1,"label",7),s(2,"Tu rese\xF1a:"),n(),r(3,"textarea",8),u("input",function(d){x(e);let C=m();return h(C.autoResize(d))}),n(),r(4,"label",9),s(5,"Calificaci\xF3n (1\u201310):"),n(),b(6,"input",10),r(7,"button",11),s(8,"Enviar Rese\xF1a"),n()()}if(t&2){let e=m();c("formGroup",e.resenaForm),a(7),c("disabled",e.resenaForm.invalid)}}function se(t,i){if(t&1&&(r(0,"p"),s(1),n()),t&2){let e=m();a(),f(e.message)}}var Z=class t{constructor(i,e,o,d,C){this.fb=i;this.rese\u00F1aService=e;this.authService=o;this.route=d;this.router=C;this.resenaForm=this.fb.group({comentario:["",[p.required,p.minLength(20)]],calificacion:[5,[p.required,p.min(1),p.max(10)]]}),this.route.params.subscribe(ee=>{this.peliculaId=ee.peliculaId;let te=this.router.getCurrentNavigation();this.movie=te?.extras.state?.movie})}movie;reviewText="";message="";peliculaId;resenaForm;autoResize(i){let e=i.target;e.style.height="auto",e.style.height=e.scrollHeight+"px"}irAHome(){this.router.navigate(["/home"])}guardarResena(){if(!this.authService.userId){this.message="Usuario no autenticado.";return}if(this.resenaForm.invalid||!this.authService.userId)return;let i={peliculaId:this.peliculaId,peliculaNombre:this.movie?.title||"Desconocido",comentario:this.resenaForm.value.comentario,calificacion:this.resenaForm.value.calificacion,usuarioId:this.authService.userId,fecha:new Date().toISOString()};console.log("Rese\xF1a a guardar:",i),console.log("Campos v\xE1lidos:",Object.entries(i).every(([e,o])=>typeof o<"u"&&o!==null)),this.rese\u00F1aService.guardarRese\u00F1a(i).then(e=>{console.log("Rese\xF1a guardada con ID:",e.id),this.message="\xA1Rese\xF1a enviada correctamente!",this.resenaForm.reset({calificacion:5})}).catch(e=>{console.error("Error al guardar rese\xF1a:",e),this.message="Error al guardar la rese\xF1a."})}static \u0275fac=function(e){return new(e||t)(l(L),l(g),l(J),l(A),l(N))};static \u0275cmp=M({type:t,selectors:[["app-resena"]],decls:8,vars:3,consts:[[1,"tarjeta"],[1,"volver",3,"click"],[4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],[3,"src","alt",4,"ngIf"],[3,"src","alt"],[3,"ngSubmit","formGroup"],["for","comentario"],["id","comentario","formControlName","comentario","placeholder","Escribe tu rese\xF1a","rows","1","required","",2,"overflow","hidden","resize","none",3,"input"],["for","calificacion"],["type","number","id","calificacion","formControlName","calificacion","min","1","max","10"],["type","submit",1,"resena",3,"disabled"]],template:function(e,o){e&1&&(r(0,"div",0)(1,"h2"),s(2,"Rese\xF1a de Pel\xEDcula"),n(),r(3,"button",1),u("click",function(){return o.irAHome()}),s(4,"Volver"),n(),_(5,oe,6,3,"div",2)(6,ae,9,2,"form",3)(7,se,2,1,"p",2),n()),e&2&&(a(5),c("ngIf",o.movie),a(),c("ngIf",o.movie),a(),c("ngIf",o.message))},dependencies:[w,O,$,D,V,z,T,k,K,B,q,G,H,U],styles:[".tarjeta[_ngcontent-%COMP%]{max-width:600px;margin:2rem auto;padding:1.5rem;border:1px solid #ddd;border-radius:8px;font-family:Arial,sans-serif;background:#fafafa}.tarjeta[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:1rem;font-size:1.5rem;text-align:center}.volver[_ngcontent-%COMP%]{margin-bottom:1rem;padding:.4rem .8rem;border:1px solid #ccc;border-radius:6px;background:#f5f5f5;cursor:pointer}.tarjeta[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:.5rem 0}.tarjeta[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;border-radius:6px;margin:.5rem 0}form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.8rem;margin-top:1rem}label[_ngcontent-%COMP%]{font-weight:700;font-size:.9rem}textarea[_ngcontent-%COMP%], input[type=number][_ngcontent-%COMP%]{padding:.5rem;border:1px solid #bbb;border-radius:6px;font-size:.95rem}.resena[_ngcontent-%COMP%]{padding:.6rem;border:none;border-radius:6px;background:#007bff;color:#fff;cursor:pointer}.resena[_ngcontent-%COMP%]:disabled{background:#aaa;cursor:not-allowed}.tarjeta[_ngcontent-%COMP%]   p[ng-reflect-ng-if][_ngcontent-%COMP%]{margin-top:1rem;color:green;text-align:center}"]})};export{Z as Resena};
