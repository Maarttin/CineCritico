import{a as Z}from"./chunk-JKZOWFQR.js";import{a as Y}from"./chunk-LIO3XGLU.js";import{a as ee,d as te,e as ie}from"./chunk-S7W4SSN2.js";import{a as z,b as d,c as G,d as H,g as L,h as q,j as B,k as U,l as K,m as $,n as J,o as Q,p as W,q as X}from"./chunk-GSFLE64X.js";import{A as r,C as p,D as E,H as g,M as a,N as n,O as o,P as _,S as k,T as h,U as s,X as m,Y as x,Z as S,ba as M,k as F,n as P,o as b,pa as T,q as O,r as C,s as R,sa as A,t as w,ua as N,xa as V,z as y,za as D}from"./chunk-FWRNMML4.js";var I=class t{constructor(i){this.http=i}firestore=b(ee);injector=b(w);getPeliculaPorId(i){let e=Z.tmdbApiKey;return this.http.get(`https://api.themoviedb.org/3/movie/${i}?api_key=${e}`)}guardarRese\u00F1a(i){return O(this.injector,()=>{let e=ie(this.firestore,"resenas");return te(e,i)})}static \u0275fac=function(e){return new(e||t)(P(N))};static \u0275prov=F({token:t,factory:t.\u0275fac,providedIn:"root"})};function ae(t,i){if(t&1&&_(0,"img",5),t&2){let e=s(2);a("alt",M(e.movie.title))("src","https://image.tmdb.org/t/p/w500"+e.movie.poster_path,y)}}function me(t,i){if(t&1&&_(0,"img",5),t&2){let e=s(2);a("alt",M(e.movie.volumeInfo==null?null:e.movie.volumeInfo.title))("src",e.movie.volumeInfo.imageLinks.thumbnail,y)}}function le(t,i){if(t&1&&(n(0,"p"),m(1),o()),t&2){let e=s(2);r(),S("Autor: ",e.movie.volumeInfo.authors.join(", "))}}function se(t,i){if(t&1&&(n(0,"small"),m(1),o()),t&2){let e=s(2);r(),S("Publicado: ",e.movie.volumeInfo.publishedDate)}}function ce(t,i){if(t&1&&(n(0,"div")(1,"h3"),m(2),o(),g(3,ae,1,3,"img",4)(4,me,1,3,"img",4),n(5,"p"),m(6),o(),g(7,le,2,1,"p",2)(8,se,2,1,"small",2),o()),t&2){let e=s();r(2),x(e.movie.title||(e.movie.volumeInfo==null?null:e.movie.volumeInfo.title)),r(),a("ngIf",e.movie.poster_path),r(),a("ngIf",e.movie.volumeInfo==null||e.movie.volumeInfo.imageLinks==null?null:e.movie.volumeInfo.imageLinks.thumbnail),r(2),x(e.movie.overview||(e.movie.volumeInfo==null?null:e.movie.volumeInfo.description)),r(),a("ngIf",e.movie.volumeInfo==null?null:e.movie.volumeInfo.authors),r(),a("ngIf",e.movie.volumeInfo==null?null:e.movie.volumeInfo.publishedDate)}}function ue(t,i){if(t&1){let e=k();n(0,"form",6),h("ngSubmit",function(){C(e);let c=s();return R(c.guardarResena())}),n(1,"label",7),m(2,"Tu comentario:"),o(),n(3,"textarea",8),h("input",function(c){C(e);let f=s();return R(f.autoResize(c))}),o(),n(4,"label",9),m(5,"Calificaci\xF3n (1\u201310):"),o(),_(6,"input",10),n(7,"button",11),m(8,"Comentar"),o()()}if(t&2){let e=s();a("formGroup",e.resenaForm),r(7),a("disabled",e.resenaForm.invalid)}}function pe(t,i){if(t&1&&(n(0,"p"),m(1),o()),t&2){let e=s();r(),x(e.message)}}var re=class t{constructor(i,e,l,c,f){this.fb=i;this.rese\u00F1aService=e;this.authService=l;this.route=c;this.router=f;this.resenaForm=this.fb.group({comentario:["",[d.required,d.minLength(20)]],calificacion:[5,[d.required,d.min(1),d.max(10)]]}),this.route.params.subscribe(v=>{this.peliculaId=v.peliculaId;let u=this.router.getCurrentNavigation();this.movie=u?.extras.state?.movie})}movie;reviewText="";message="";peliculaId;resenaForm;autoResize(i){let e=i.target;e.style.height="auto",e.style.height=e.scrollHeight+"px"}irAHome(){this.router.navigate(["/home"])}guardarResena(){if(!this.authService.userId){this.message="Usuario no autenticado.";return}if(this.resenaForm.invalid||!this.authService.userId)return;let i="pelicula",e=this.movie?.title||"",l=this.movie?.poster_path||"",c="",f=this.peliculaId;this.movie?.volumeInfo&&(i="libro",e=this.movie.volumeInfo.title||"",l=this.movie.volumeInfo.imageLinks?.thumbnail||"",c=this.movie.volumeInfo.authors?.join(", ")||"",f=this.movie.id||"");let v={peliculaId:f,peliculaNombre:e,autor:c,comentario:this.resenaForm.value.comentario,calificacion:this.resenaForm.value.calificacion,usuarioId:this.authService.userId,posterPath:l,fecha:new Date().toISOString(),tipo:i};console.log("Rese\xF1a a guardar:",v),console.log("Campos v\xE1lidos:",Object.entries(v).every(([u,j])=>typeof j<"u"&&j!==null)),this.rese\u00F1aService.guardarRese\u00F1a(v).then(u=>{console.log("Rese\xF1a guardada con ID:",u.id),this.message="\xA1Rese\xF1a enviada correctamente!",this.resenaForm.reset({calificacion:5}),this.router.navigate(["/home"])}).catch(u=>{console.error("Error al guardar rese\xF1a:",u),this.message="Error al guardar la rese\xF1a."})}static \u0275fac=function(e){return new(e||t)(p(Q),p(I),p(Y),p(V),p(D))};static \u0275cmp=E({type:t,selectors:[["app-resena"]],decls:8,vars:3,consts:[[1,"tarjeta"],[1,"volver",3,"click"],[4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],[3,"src","alt",4,"ngIf"],[3,"src","alt"],[3,"ngSubmit","formGroup"],["for","comentario"],["id","comentario","formControlName","comentario","placeholder","Escribe tu comentario...","rows","1","required","",2,"overflow","hidden","resize","none",3,"input"],["for","calificacion"],["type","number","id","calificacion","formControlName","calificacion","min","1","max","10"],["type","submit",1,"resena",3,"disabled"]],template:function(e,l){e&1&&(n(0,"div",0)(1,"h2"),m(2,"Comentario"),o(),n(3,"button",1),h("click",function(){return l.irAHome()}),m(4,"Volver"),o(),g(5,ce,9,6,"div",2)(6,ue,9,2,"form",3)(7,pe,2,1,"p",2),o()),e&2&&(r(5),a("ngIf",l.movie),r(),a("ngIf",l.movie),r(),a("ngIf",l.message))},dependencies:[A,T,X,L,z,q,G,H,J,$,K,B,U,W],styles:[".tarjeta[_ngcontent-%COMP%]{max-width:600px;margin:2rem auto;padding:1.5rem;border:1px solid #ddd;border-radius:8px;font-family:Arial,sans-serif;background:#fafafa}img[_ngcontent-%COMP%]{display:block;margin:0 auto;width:50%;border-radius:8px;margin-top:1rem}.tarjeta[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:1rem;font-size:1.5rem;text-align:center}.volver[_ngcontent-%COMP%]{margin-bottom:1rem;padding:.4rem .8rem;border:1px solid #ccc;border-radius:6px;background:#f5f5f5;cursor:pointer}.tarjeta[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:.5rem 0}.tarjeta[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;border-radius:6px;margin:.5rem 0}form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.8rem;margin-top:1rem}label[_ngcontent-%COMP%]{font-weight:700;font-size:.9rem}textarea[_ngcontent-%COMP%], input[type=number][_ngcontent-%COMP%]{padding:.5rem;border:1px solid #bbb;border-radius:6px;font-size:.95rem}.resena[_ngcontent-%COMP%]{padding:.6rem;border:none;border-radius:6px;background:#007bff;color:#fff;cursor:pointer}.resena[_ngcontent-%COMP%]:disabled{background:#aaa;cursor:not-allowed}.tarjeta[_ngcontent-%COMP%]   p[ng-reflect-ng-if][_ngcontent-%COMP%]{margin-top:1rem;color:green;text-align:center}"]})};export{re as Resena};
